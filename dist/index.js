!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("rxjs/operators"),require("rxjs"),require("@project-sunbird/client-services"),require("@project-sunbird/client-services/core/http-service"),require("@project-sunbird/client-services/services/content/utilities/primary-category-mapper"),require("@project-sunbird/client-services/services/content"),require("@project-sunbird/client-services/models/content"),require("@project-sunbird/client-services/models"),require("@project-sunbird/client-services/core"),require("@project-sunbird/client-services/core/http-service/utilities/interceptors"),require("@project-sunbird/client-services/models/group"),require("@project-sunbird/client-services/models/user"),require("@project-sunbird/client-services/services/content/utilities/content-group-generator"),require("@project-sunbird/client-services/services/content/utilities/content-progress-calculator"),require("@project-sunbird/client-services/services/content/utilities/mime-type-facet-to-mime-type-category-aggregator"));else if("function"==typeof define&&define.amd)define(["rxjs/operators","rxjs","@project-sunbird/client-services","@project-sunbird/client-services/core/http-service","@project-sunbird/client-services/services/content/utilities/primary-category-mapper","@project-sunbird/client-services/services/content","@project-sunbird/client-services/models/content","@project-sunbird/client-services/models","@project-sunbird/client-services/core","@project-sunbird/client-services/core/http-service/utilities/interceptors","@project-sunbird/client-services/models/group","@project-sunbird/client-services/models/user","@project-sunbird/client-services/services/content/utilities/content-group-generator","@project-sunbird/client-services/services/content/utilities/content-progress-calculator","@project-sunbird/client-services/services/content/utilities/mime-type-facet-to-mime-type-category-aggregator"],t);else{var n="object"==typeof exports?t(require("rxjs/operators"),require("rxjs"),require("@project-sunbird/client-services"),require("@project-sunbird/client-services/core/http-service"),require("@project-sunbird/client-services/services/content/utilities/primary-category-mapper"),require("@project-sunbird/client-services/services/content"),require("@project-sunbird/client-services/models/content"),require("@project-sunbird/client-services/models"),require("@project-sunbird/client-services/core"),require("@project-sunbird/client-services/core/http-service/utilities/interceptors"),require("@project-sunbird/client-services/models/group"),require("@project-sunbird/client-services/models/user"),require("@project-sunbird/client-services/services/content/utilities/content-group-generator"),require("@project-sunbird/client-services/services/content/utilities/content-progress-calculator"),require("@project-sunbird/client-services/services/content/utilities/mime-type-facet-to-mime-type-category-aggregator")):t(e.rxjs.operators,e.rxjs,e["@project-sunbird"]["client-services"],e["@project-sunbird"]["client-services"].core["http-service"],e["@project-sunbird"]["client-services"].services.content.utilities["primary-category-mapper"],e["@project-sunbird"]["client-services"].services.content,e["@project-sunbird"]["client-services"].models.content,e["@project-sunbird"]["client-services"].models,e["@project-sunbird"]["client-services"].core,e["@project-sunbird"]["client-services"].core["http-service"].utilities.interceptors,e["@project-sunbird"]["client-services"].models.group,e["@project-sunbird"]["client-services"].models.user,e["@project-sunbird"]["client-services"].services.content.utilities["content-group-generator"],e["@project-sunbird"]["client-services"].services.content.utilities["content-progress-calculator"],e["@project-sunbird"]["client-services"].services.content.utilities["mime-type-facet-to-mime-type-category-aggregator"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,(function(e,t,n,r,i,o,a,c,s,u,f,l,p,d,h){return function(e){function t(t){for(var n,i,o=t[0],a=t[1],c=0,u=[];c<o.length;c++)i=o[c],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(s&&s(t);u.length;)u.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=o);var a,c=document.createElement("script");c.charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.src=function(e){return i.p+""+e+".index.js"}(e);var s=new Error;a=function(t){c.onerror=c.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,n[1](s)}r[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:c})}),12e4);c.onerror=c.onload=a,document.head.appendChild(c)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var s=a;return i(i.s=317)}([function(t,n){t.exports=e},function(e,t,n){"use strict";n.r(t);var r=n(117);n.d(t,"DbConstants",(function(){return r.a}));var i=n(118);for(var o in i)["default","DbConstants"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(88);n.d(t,"Migration",(function(){return a.a}));var c=n(119);for(var o in c)["default","DbConstants","Migration"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var s=n(120);n.d(t,"DbService",(function(){return s.a}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return a}));var r,i,o,a,c=n(1);!function(e){e.TABLE_NAME="content",e._ID="_id",e.COLUMN_NAME_IDENTIFIER="identifier",e.COLUMN_NAME_SERVER_DATA="server_data",e.COLUMN_NAME_LOCAL_DATA="local_data",e.COLUMN_NAME_MIME_TYPE="mime_type",e.COLUMN_NAME_PATH="path",e.COLUMN_NAME_INDEX="search_index",e.COLUMN_NAME_VISIBILITY="visibility",e.COLUMN_NAME_SERVER_LAST_UPDATED_ON="server_last_updated_on",e.COLUMN_NAME_LOCAL_LAST_UPDATED_ON="local_last_updated_on",e.COLUMN_NAME_MANIFEST_VERSION="manifest_version",e.COLUMN_NAME_REF_COUNT="ref_count",e.COLUMN_NAME_CONTENT_STATE="content_state",e.COLUMN_NAME_CONTENT_TYPE="content_type",e.COLUMN_NAME_AUDIENCE="audience",e.COLUMN_NAME_PRAGMA="pragma",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_SIZE_ON_DEVICE="size_on_device",e.COLUMN_NAME_BOARD="board",e.COLUMN_NAME_MEDIUM="medium",e.COLUMN_NAME_GRADE="grade",e.COLUMN_NAME_DIALCODES="dialcodes",e.COLUMN_NAME_CHILD_NODES="child_nodes",e.COLUMN_NAME_PRIMARY_CATEGORY="primary_category",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_IDENTIFIER+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" UNIQUE NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_SERVER_DATA+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_LOCAL_DATA+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_MIME_TYPE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_PATH+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_INDEX+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_VISIBILITY+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_SERVER_LAST_UPDATED_ON+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_LOCAL_LAST_UPDATED_ON+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_REF_COUNT+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+" NOT NULL DEFAULT 1"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_STATE+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+" NOT NULL DEFAULT 2"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_TYPE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_AUDIENCE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" DEFAULT 'Learner'"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_SIZE_ON_DEVICE+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+" NOT NULL DEFAULT 0"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRAGMA+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_BOARD+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_MEDIUM+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_MANIFEST_VERSION+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_DIALCODES+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CHILD_NODES+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRIMARY_CATEGORY+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT '' )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME},e.getAlterEntryForContentSize=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_SIZE_ON_DEVICE+c.DbConstants.INT_TYPE+" NOT NULL DEFAULT 0;"},e.getAlterEntryForPragma=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_PRAGMA+c.DbConstants.TEXT_TYPE+" DEFAULT '';"},e.getAlterEntryForBoard=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_BOARD+" TEXT DEFAULT ''"},e.getAlterEntryForMedium=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_MEDIUM+" TEXT DEFAULT ''"},e.getAlterEntryForGrade=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_GRADE+" TEXT DEFAULT ''"},e.getAlterEntryForDialCode=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_DIALCODES+" TEXT DEFAULT ''"},e.getAlterEntryForChildNodes=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_CHILD_NODES+" TEXT DEFAULT ''"},e.getAlterEntryForPrimaryCategory=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_PRIMARY_CATEGORY+" TEXT DEFAULT ''"}}(r||(r={})),function(e){e._ID="_id",e.TABLE_NAME="content_access",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_CONTENT_IDENTIFIER="identifier",e.COLUMN_NAME_EPOCH_TIMESTAMP="epoch_timestamp",e.COLUMN_NAME_STATUS="status",e.COLUMN_NAME_CONTENT_TYPE="content_type",e.COLUMN_NAME_LEARNER_STATE="learner_state",e.COLUMN_NAME_PRIMARY_CATEGORY="primary_category",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_IDENTIFIER+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_EPOCH_TIMESTAMP+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_STATUS+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_TYPE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_LEARNER_STATE+c.DbConstants.SPACE+c.DbConstants.BLOB_TYPE+" )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME},e.getAlterEntryForPrimaryCategory=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_PRIMARY_CATEGORY+" TEXT DEFAULT ''"}}(i||(i={})),function(e){e._ID="_id",e.TABLE_NAME="feedback",e.COLUMN_NAME_CONTENT_ID="identifier",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_RATING="rating",e.COLUMN_NAME_COMMENTS="comments",e.COLUMN_NAME_CREATED_AT="createdAt",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_CONTENT_ID+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_UID+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_RATING+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_COMMENTS+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CREATED_AT+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+" )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(o||(o={})),function(e){e._ID="_id",e.TABLE_NAME="content_marker",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_CONTENT_IDENTIFIER="identifier",e.COLUMN_NAME_EPOCH_TIMESTAMP="epoch_timestamp",e.COLUMN_NAME_DATA="data",e.COLUMN_NAME_EXTRA_INFO="extra_info",e.COLUMN_NAME_MARKER="marker",e.COLUMN_NAME_MIME_TYPE="mime_type",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+" NOT NULL"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_IDENTIFIER+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_EPOCH_TIMESTAMP+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_DATA+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_EXTRA_INFO+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_MIME_TYPE+c.DbConstants.SPACE+c.DbConstants.TEXT_TYPE+"  DEFAULT ''"+c.DbConstants.COMMA_SEP+e.COLUMN_NAME_MARKER+c.DbConstants.SPACE+c.DbConstants.INT_TYPE+" )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME},e.getAlterEntryForMimeType=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_NAME_MIME_TYPE+" TEXT DEFAULT ''"}}(a||(a={}))},function(e,n){e.exports=t},function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u}));var r,i,o,a,c,s,u,f=n(1);!function(e){e._ID="_id",e.TABLE_NAME="profiles",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_HANDLE="handle",e.COLUMN_NAME_AVATAR="avatar",e.COLUMN_NAME_AGE="age",e.COLUMN_NAME_GENDER="gender",e.COLUMN_NAME_STANDARD="standard",e.COLUMN_NAME_LANGUAGE="language",e.COLUMN_NAME_DAY="day",e.COLUMN_NAME_MONTH="month",e.COLUMN_NAME_IS_GROUP_USER="is_group_user",e.COLUMN_NAME_CREATED_AT="created_at",e.COLUMN_NAME_MEDIUM="medium",e.COLUMN_NAME_BOARD="board",e.COLUMN_NAME_PROFILE_IMAGE="profile_image",e.COLUMN_NAME_SUBJECT="subject",e.COLUMN_NAME_PROFILE_TYPE="profile_type",e.COLUMN_NAME_GRADE="grade",e.COLUMN_NAME_SYLLABUS="syllabus",e.COLUMN_NAME_SOURCE="source",e.COLUMN_NAME_GRADE_VALUE="grade_value",e.COLUMN_VALUE="value",e.COLUMN_NAME_CATEGORIES="categories",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+"("+e._ID+f.DbConstants.SPACE+"INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+" UNIQUE NOT NULL"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_HANDLE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_AVATAR+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_AGE+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GENDER+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_STANDARD+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_LANGUAGE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_DAY+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+" NOT NULL DEFAULT -1"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_MONTH+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+" NOT NULL DEFAULT -1"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_IS_GROUP_USER+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+" NOT NULL DEFAULT 0"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CREATED_AT+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_MEDIUM+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_BOARD+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SUBJECT+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_PROFILE_IMAGE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_PROFILE_TYPE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+' DEFAULT "teacher"'+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CATEGORIES+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+"  DEFAULT ''"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SYLLABUS+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SOURCE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_VALUE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+' DEFAULT ""'+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE_VALUE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+")"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME},e.getAlterEntryForProfileSyllabus=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+f.DbConstants.SPACE+e.COLUMN_NAME_SYLLABUS+f.DbConstants.TEXT_TYPE+"  DEFAULT '';"},e.getAlterEntryForProfileCategories=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+f.DbConstants.SPACE+e.COLUMN_NAME_CATEGORIES+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+"  DEFAULT '';"}}(r||(r={})),function(e){e._ID="_id",e.TABLE_NAME="users",e.COLUMN_NAME_UID="uid",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+" )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(i||(i={})),function(e){e.TABLE_NAME="group_profile",e._ID="_id",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_GID="gid",e.COLUMN_NAME_EPOCH_TIMESTAMP="epoch_timestamp",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_EPOCH_TIMESTAMP+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+"UNIQUE ("+e.COLUMN_NAME_GID+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_UID+") ON CONFLICT REPLACE)"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(o||(o={})),function(e){e.TABLE_NAME="groups",e._ID="_id",e.COLUMN_NAME_GID="gid",e.COLUMN_NAME_NAME="name",e.COLUMN_NAME_SYLLABUS="syllabus",e.COLUMN_NAME_GRADE="grade",e.COLUMN_NAME_GRADE_VALUE="grade_value",e.COLUMN_NAME_CREATED_AT="created_at",e.COLUMN_NAME_UPDATED_AT="updated_at",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_NAME+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SYLLABUS+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+' DEFAULT ""'+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+' DEFAULT ""'+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE_VALUE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+' DEFAULT ""'+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CREATED_AT+" INTEGER"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_UPDATED_AT+" INTEGER )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(a||(a={})),function(e){e._ID="_id",e.TABLE_NAME="imported_metadata",e.COLUMN_NAME_IMPORTED_ID="imported_id",e.COLUMN_NAME_DEVICE_ID="device_id",e.COLUMN_NAME_COUNT="count",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_IMPORTED_ID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_DEVICE_ID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_COUNT+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(c||(c={})),function(e){e._ID="_id",e.TABLE_NAME="learner_assessments",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_CONTENT_ID="content_id",e.COLUMN_NAME_QID="qid",e.COLUMN_NAME_Q_INDEX="qindex",e.COLUMN_NAME_CORRECT="correct",e.COLUMN_NAME_SCORE="score",e.COLUMN_NAME_MAX_SCORE="max_score",e.COLUMN_NAME_TIME_SPENT="time_spent",e.COLUMN_NAME_RES="res",e.COLUMN_NAME_TIMESTAMP="timestamp",e.COLUMN_NAME_Q_DESC="qdesc",e.COLUMN_NAME_Q_TITLE="qtitle",e.COLUMN_NAME_HIERARCHY_DATA="h_data",e.COLUMN_NAME_TOTAL_TS="total_ts",e.COLUMN_NAME_MARKS="marks",e.COLUMN_NAME_COUNT="occurence_count",e.COLUMN_NAME_TOTAL_MAX_SCORE="sum_max_score",e.COLUMN_NAME_USERS_COUNT="users_count",e.COLUMN_NAME_HANDLE="handle",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+" NOT NULL"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_ID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_QID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_Q_INDEX+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CORRECT+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SCORE+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_MAX_SCORE+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_TIME_SPENT+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_RES+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_TIMESTAMP+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_Q_DESC+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_Q_TITLE+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_HIERARCHY_DATA+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+"  DEFAULT ''  )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(s||(s={})),function(e){e._ID="_id",e.TABLE_NAME="learner_content_summary",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_CONTENT_ID="content_id",e.COLUMN_NAME_AVG_TS="avg_ts",e.COLUMN_NAME_SESSIONS="sessions",e.COLUMN_NAME_TOTAL_TS="total_ts",e.COLUMN_NAME_LAST_UPDATED_ON="last_updated_on",e.COLUMN_NAME_HIERARCHY_DATA="h_data",e.COLUMN_NAME_NO_OF_QUESTIONS="no_of_questions",e.COLUMN_NAME_CORRECT_ANSWERS="correct_answers",e.COLUMN_NAME_TOTAL_TIME_SPENT="total_time_spent",e.COLUMN_NAME_TOTAL_MAX_SCORE="total_max_score",e.COLUMN_NAME_TOTAL_SCORE="total_score",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+" NOT NULL"+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_ID+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_AVG_TS+f.DbConstants.SPACE+f.DbConstants.REAL_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_SESSIONS+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_TOTAL_TS+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_LAST_UPDATED_ON+f.DbConstants.SPACE+f.DbConstants.SPACE+f.DbConstants.INT_TYPE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_HIERARCHY_DATA+f.DbConstants.SPACE+f.DbConstants.TEXT_TYPE+f.DbConstants.COMMA_SEP+" UNIQUE ("+e.COLUMN_NAME_UID+f.DbConstants.SPACE+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONTENT_ID+f.DbConstants.COMMA_SEP+e.COLUMN_NAME_HIERARCHY_DATA+") ON CONFLICT REPLACE )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(u||(u={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r={HTTP_SERVICE:Symbol.for("CS_HTTP_SERVICE"),GROUP_SERVICE:Symbol.for("CS_GROUP_SERVICE"),COURSE_SERVICE:Symbol.for("CS_COURSE_SERVICE"),USER_SERVICE:Symbol.for("CS_USER_SERVICE"),DISCUSSION_SERVICE:Symbol.for("CS_DISCUSSION_SERVICE"),CONTENT_SERVICE:Symbol.for("CS_CONTENT_SERVICE"),NOTIFICATION_SERVICE_V2:Symbol.for("CS_NOTIFICATION_SERVICE"),CERTIFICATE_SERVICE:Symbol.for("CS_CERTIFICATE_SERVICE"),FRAMEWORK_SERVICE:Symbol.for("CS_FRAMEWORK_SERVICE")},i={CONTAINER:Symbol.for("CONTAINER"),DB_VERSION:Symbol.for("DB_VERSION"),DB_MIGRATION_LIST:Symbol.for("DB_MIGRATION_LIST"),SDK_CONFIG:Symbol.for("SDK_CONFIG"),DEVICE_INFO:Symbol.for("DEVICE_INFO"),SHARED_PREFERENCES:Symbol.for("SHARED_PREFERENCES"),EVENTS_BUS_SERVICE:Symbol.for("EVENTS_BUS_SERVICE"),DB_SERVICE:Symbol.for("DB_SERVICE"),APP_INFO:Symbol.for("APP_INFO"),API_SERVICE:Symbol.for("API_SERVICE"),AUTH_SERVICE:Symbol.for("AUTH_SERVICE"),FILE_SERVICE:Symbol.for("FILE_SERVICE"),SYSTEM_SETTINGS_SERVICE:Symbol.for("SYSTEM_SETTINGS_SERVICE"),FRAMEWORK_SERVICE:Symbol.for("FRAMEWORK_SERVICE"),PROFILE_SERVICE:Symbol.for("PROFILE_SERVICE"),GROUP_SERVICE:Symbol.for("GROUP_SERVICE"),GROUP_SERVICE_DEPRECATED:Symbol.for("GROUP_SERVICE_DEPRECATED"),ZIP_SERVICE:Symbol.for("ZIP_SERVICE"),TELEMETRY_SERVICE:Symbol.for("TELEMETRY_SERVICE"),CONTENT_FEEDBACK_SERVICE:Symbol.for("CONTENT_FEEDBACK_SERVICE"),FORM_SERVICE:Symbol.for("FORM_SERVICE"),PAGE_ASSEMBLE_SERVICE:Symbol.for("PAGE_ASSEMBLE_SERVICE"),FRAMEWORK_UTIL_SERVICE:Symbol.for("FRAMEWORK_UTIL_SERVICE"),DOWNLOAD_SERVICE:Symbol.for("DOWNLOAD_SERVICE"),CONTENT_SERVICE:Symbol.for("CONTENT_SERVICE"),COURSE_SERVICE:Symbol.for("COURSE_SERVICE"),SUMMARIZER_SERVICE:Symbol.for("SUMMARIZER_SERVICE"),PLAYER_SERVICE:Symbol.for("PLAYER_SERVICE"),CACHED_ITEM_STORE:Symbol.for("CACHED_ITEM_STORE"),KEY_VALUE_STORE:Symbol.for("KEY_VALUE_STORE"),TELEMETRY_DECORATOR:Symbol.for("TELEMETRY_DECORATOR"),STORAGE_SERVICE:Symbol.for("STORAGE_SERVICE"),NOTIFICATION_SERVICE:Symbol.for("NOTIFICATION_SERVICE"),ERROR_LOGGER_SERVICE:Symbol.for("ERROR_LOGGER_SERVICE"),NETWORKINFO_SERVICE:Symbol.for("NETWORKINFO_SERVICE"),SEARCH_HISTORY_SERVICE:Symbol.for("SEARCH_HISTORY_SERVICE"),CODEPUSH_EXPERIMENT_SERVICE:Symbol.for("CODEPUSH_EXPERIMENT_SERVICE"),FAQ_SERVICE:Symbol.for("FAQ_SERVICE"),DEVICE_REGISTER_SERVICE:Symbol.for("DEVICE_REGISTER_SERVICE"),CONTENT_RATING_SERVICE:Symbol.for("CONTENT_RATING_SERVICE"),ARCHIVE_SERVICE:Symbol.for("ARCHIVE_SERVICE"),NETWORK_QUEUE:Symbol.for("NETWORK_QUEUE"),CLASS_ROOM_SERVICE:Symbol.for("CLASS_ROOM_SERVICE"),DISCUSSION_SERVICE:Symbol.for("DISCUSSION_SERVICE"),SEGMENTATION_SERVICE:Symbol.for("SEGMENTATION_SERVICE"),DEBUGGING_SERVICE:Symbol.for("DEBUGGING_SERVICE"),NOTIFICATION_SERVICE_V2:Symbol.for("NOTIFICATION_SERVICE_V2"),CERTIFICATE_SERVICE:Symbol.for("CERTIFICATE_SERVICE")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0;var r=n(38);t.METADATA_KEY=r;var i=n(319);Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return i.Container}});var o=n(56);Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return o.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return o.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return o.TargetTypeEnum}});var a=n(335);Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return a.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return a.ContainerModule}});var c=n(336);Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return c.injectable}});var s=n(337);Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return s.tagged}});var u=n(338);Object.defineProperty(t,"named",{enumerable:!0,get:function(){return u.named}});var f=n(127);Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return f.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return f.LazyServiceIdentifer}});var l=n(339);Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return l.optional}});var p=n(340);Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return p.unmanaged}});var d=n(341);Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return d.multiInject}});var h=n(342);Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return h.targetName}});var E=n(343);Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return E.postConstruct}});var b=n(125);Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return b.MetadataReader}});var y=n(67);Object.defineProperty(t,"id",{enumerable:!0,get:function(){return y.id}});var v=n(58);Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return v.decorate}});var _=n(130);Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return _.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return _.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return _.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return _.typeConstraint}});var S=n(80);Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return S.getServiceIdentifierAsString}});var O=n(344);Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return O.multiBindToService}})},function(e,t,n){"use strict";n.r(t);var r=n(34);n.d(t,"HttpRequestType",(function(){return r.CsHttpRequestType})),n.d(t,"ResponseCode",(function(){return r.CsHttpResponseCode})),n.d(t,"HttpSerializer",(function(){return r.CsHttpSerializer})),n.d(t,"Request",(function(){return r.CsRequest})),n.d(t,"Response",(function(){return r.CsResponse})),n.d(t,"NetworkError",(function(){return r.CsNetworkError})),n.d(t,"HttpClientError",(function(){return r.CsHttpClientError})),n.d(t,"HttpServerError",(function(){return r.CsHttpServerError}));var i=n(131);for(var o in i)["default","HttpRequestType","ResponseCode","HttpSerializer","Request","Response","NetworkError","HttpClientError","HttpServerError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(132);for(var o in a)["default","HttpRequestType","ResponseCode","HttpSerializer","Request","Response","NetworkError","HttpClientError","HttpServerError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var c=n(133);for(var o in c)["default","HttpRequestType","ResponseCode","HttpSerializer","Request","Response","NetworkError","HttpClientError","HttpServerError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var s=n(306);n.d(t,"ApiServiceImpl",(function(){return s.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(91),i=n(16),o=n(2),a=n(33),c=n(14),s=n(41),u=n(64),f=n(65),l=function(){function e(){}return e.isAvailableLocally=function(e){return e===i.l.ARTIFACT_AVAILABLE},e.isUpdateAvailable=function(e,t){var n=-1,r=-1;return e&&e.pkgVersion&&(r=parseFloat(e.pkgVersion)),t&&t.pkgVersion&&(n=parseFloat(t.pkgVersion)),r>0&&n>0&&r>n},e.hasChildren=function(e){return!!e&&("string"==typeof e&&(e=JSON.parse(e)),e&&e.children)},e.getContentRollup=function(e,t){var n,r,i,o;if(t&&0!==t.length)for(var a=0;a<t.length;a++)if(0===a)n=t[a].identifier;else if(1===a)r=t[a].identifier;else if(2===a)i=t[a].identifier;else{if(3!==a)break;o=t[a].identifier}else n=e;return{l1:n,l2:r,l3:i,l4:o}},e.getChildContentsIdentifiers=function(e){var t=[],n=("string"==typeof e?JSON.parse(e):e).children;return n&&n.length&&n.forEach((function(e){t.push(e.identifier)})),t},e.getFirstPartOfThePathNameOnLastDelimiter=function(e){var t=e.lastIndexOf("/");if(t>0&&t<e.length)return e.substring(0,t)},e.hasPreRequisites=function(e){return JSON.parse(e).pre_requisites},e.readVisibility=function(e){var t=e.visibility;return t||i.m.DEFAULT},e.isCompatible=function(e,t){return t>=e.minCompatibilityLevel&&t<=e.maxCompatibilityLevel},e.readCompatibilityLevel=function(e){var t=e.compatibilityLevel;return t||this.defaultCompatibilityLevel},e.isDraftContent=function(e){return e&&e===i.f.DRAFT.valueOf()},e.isExpired=function(e){if(e){var t=new Date(e).getTime();if((new Date).getTime()>t)return!0}return!1},e.isDuplicateCheckRequired=function(e,t){return e&&0===t},e.isImportFileExist=function(t,n){if(!t||!n)return!1;var r=!1,i=t[o.b.COLUMN_NAME_IDENTIFIER],a=n.identifier,c=t[o.b.COLUMN_NAME_VISIBILITY],s=e.readVisibility(n);return i===a&&c===s&&(r=this.readPkgVersion(JSON.parse(t[o.b.COLUMN_NAME_LOCAL_DATA]))>=this.readPkgVersion(n)),r},e.readPkgVersion=function(e){return e.pkgVersion},e.readContentType=function(e){var t=e.contentType;return t&&(t=t.toLowerCase()),t},e.readPrimaryCategory=function(e){var t=e.primaryCategory;return t=t?t.toLowerCase():u.CsPrimaryCategoryMapper.getPrimaryCategory(e.contentType.toLowerCase(),e.mimeType,e.resourceType).toLowerCase()},e.readPrimaryCategoryServer=function(e){var t=e.primaryCategory;return t=t||u.CsPrimaryCategoryMapper.getPrimaryCategory(e.contentType.toLowerCase(),e.mimeType,e.resourceType)},e.readAudience=function(e){var t=e.audience,n=[];return"string"==typeof t&&n.push(t),n&&n.length||n.push("Learner"),n.sort(),n.join(",")},e.readPragma=function(e){var t=e.pragma;return t||(t=[]),t.join(",")},e.doesContentExist=function(t,n,r,a){if(!t)return!1;var c=!1,s=t[o.b.COLUMN_NAME_IDENTIFIER],u=JSON.parse(t[o.b.COLUMN_NAME_LOCAL_DATA]);if(s===n){var f=!1;a?f=!(e.readPkgVersion(u)<r):e.readPkgVersion(u)<r&&(f=!0),c=!(f||!a&&t[o.b.COLUMN_NAME_CONTENT_STATE]!==i.l.ARTIFACT_AVAILABLE.valueOf())}return c},e.getContentRootDir=function(e){return"ios"===window.device.platform.toLowerCase()?e.concat("content/"):e.concat("content")},e.addOrUpdateViralityMetadata=function(t,n){if(e.isContentMetadataAbsent(t)){(i={}).origin=n,i.transferCount=e.INITIAL_VALUE_FOR_TRANSFER_COUNT;var r={};r.virality=i,t.contentMetadata=r}else if(e.isContentMetadataPresentWithoutViralityMetadata(t)){(i={}).origin=n,i.transferCount=e.INITIAL_VALUE_FOR_TRANSFER_COUNT,t.contentMetaData.virality=i}else{var i;(i=t.contentMetaData.virality).transferCount=e.transferCount(i)+1}},e.addViralityMetadataIfMissing=function(t,n){t.contentMetaData||(t.contentMetaData={});var r=t.contentMetaData;r.virality||(r.virality={});var i=t.virality;i||(i={}),i.origin||(i.origin=n),i.transferCount||(i.transferCount=e.INITIAL_VALUE_FOR_TRANSFER_COUNT)},e.isInlineIdentity=function(e,t){return e&&t&&i.b.INLINE.valueOf()===e&&i.c.IDENTITY.valueOf()===t},e.isOnlineContent=function(e){var t=e.contentDisposition;return t&&i.b.ONLINE.valueOf()===t},e.addOrUpdateDialcodeMapping=function(e,t,n){var r;(r=e?JSON.parse(e):{}).hasOwnProperty("identifier")||(r.identifier=t);var i=new Set;return r.hasOwnProperty("rootNodes")&&r.forEach((function(e){i.add(e)})),i.add(n),r.rootNodes=i,JSON.stringify(r)},e.deDupe=function(e,t){return e.filter((function(e,n,r){return r.map((function(e){return e[t]})).indexOf(e[t])===n}))},e.getExportedFileName=function(t,n){var r,a="blank.ecar",c=0;t.length>0&&(r=t[0]);if(t.forEach((function(e){i.m.DEFAULT.valueOf()===e[o.b.COLUMN_NAME_VISIBILITY]&&c++})),c>1&&"".concat((c-1).toString()),r){var s=JSON.parse(r[o.b.COLUMN_NAME_LOCAL_DATA]),u=s.name;u&&u.length>e.MAX_CONTENT_NAME&&(u=u.substring(0,e.MAX_CONTENT_NAME-3)+"...");var f=s.pkgVersion;a=n.toLowerCase()+"_"+u+"-v"+f+".ecar"}return a},e.readOriginFromContentMap=function(e){var t=e.contentMetadata,n=t&&t.virality;return n?n.origin:""},e.readTransferCountFromContentMap=function(e){var t=e.contentMetadata,n=t&&t.virality;return n?a.a.parseInt(n.transferCount):0},e.readSizeFromContentMap=function(e){return e.size?e.size:""},e.getUidnIdentifierFiler=function(e,t){var n=e&&"uid = '"+e+"'",r=t&&"identifier = '"+t+"'",i="";return n&&r?i="WHERE ("+r+" AND "+n+")":r?i="WHERE ("+r+")":n&&(i="WHERE ("+n+")"),i},e.getBasePath=function(e){return e?e=-1!==e.indexOf("file://")?e.replace("file://",""):"file://".concat(e):""},e.getRollup=function(e,t){var n,r,i,o;if(t){var a=void 0;for(a=0;a<t.length;a++)switch(a){case 0:n=t[a].identifier;break;case 1:r=t[a].identifier;break;case 2:i=t[a].identifier;break;case 3:o=t[a].identifier}}else n=e;return{l1:n,l2:r,l3:i,l4:o}},e.addOrUpdateRefCount=function(e){return e<0&&(e=0),e},e.isNotUnit=function(e,t){return!(i.j.COLLECTION.valueOf()===e&&i.m.PARENT.valueOf()===t)},e.getContentAttribute=function(e){var t=[];if(e&&("string"==typeof e?t.push(e):t=e,t&&t.length)){t.sort();for(var n="",r=0;r<t.length;r++)n=r<t.length-1?n.concat("~",t[r]):n.concat("~",t[r],"~");return n.toLowerCase().trim()}return""},e.getFindAllContentsWithIdentifierQuery=function(e){var t=c.a.joinPreservingQuotes(e),n=" order by "+o.b.COLUMN_NAME_LOCAL_LAST_UPDATED_ON+" desc, "+o.b.COLUMN_NAME_SERVER_LAST_UPDATED_ON+" desc",r=" where "+o.b.COLUMN_NAME_IDENTIFIER+" in ("+t+") AND "+o.b.COLUMN_NAME_REF_COUNT+" > 0";return"select * from "+o.b.TABLE_NAME+" "+r+" "+n},e.getFindAllContentsQuery=function(){return"select * from "+o.b.TABLE_NAME+" where "+o.b.COLUMN_NAME_REF_COUNT+" > 0"},e.constructContentDBModel=function(t,n,r,i,a,c,u,f,l,p,d,h,E,b,y,v){var _;return(_={})[o.b.COLUMN_NAME_IDENTIFIER]=t,_[o.b.COLUMN_NAME_SERVER_DATA]="",_[o.b.COLUMN_NAME_PATH]=e.getBasePath(u),_[o.b.COLUMN_NAME_REF_COUNT]=f,_[o.b.COLUMN_NAME_CONTENT_STATE]=l,_[o.b.COLUMN_NAME_SIZE_ON_DEVICE]=h,_[o.b.COLUMN_NAME_MANIFEST_VERSION]=n,_[o.b.COLUMN_NAME_LOCAL_DATA]=r,_[o.b.COLUMN_NAME_MIME_TYPE]=i,_[o.b.COLUMN_NAME_CONTENT_TYPE]=a,_[o.b.COLUMN_NAME_VISIBILITY]=c,_[o.b.COLUMN_NAME_AUDIENCE]=p,_[o.b.COLUMN_NAME_PRAGMA]=d,_[o.b.COLUMN_NAME_LOCAL_LAST_UPDATED_ON]=s().format(),_[o.b.COLUMN_NAME_BOARD]=e.getContentAttribute(E),_[o.b.COLUMN_NAME_MEDIUM]=e.getContentAttribute(b),_[o.b.COLUMN_NAME_GRADE]=e.getContentAttribute(y),_[o.b.COLUMN_NAME_PRIMARY_CATEGORY]=v,_},e.getReferenceCount=function(e,t){var n;return e?(n=e[o.b.COLUMN_NAME_REF_COUNT],i.m.DEFAULT.valueOf()===e[o.b.COLUMN_NAME_VISIBILITY]&&i.m.DEFAULT.valueOf()===t||(n+=1)):n=1,n},e.getContentVisibility=function(e,t,n){var r;return"Library"===t?r=i.m.PARENT.valueOf():e&&!i.m.PARENT.valueOf()===e[o.b.COLUMN_NAME_VISIBILITY]&&(r=e[o.b.COLUMN_NAME_VISIBILITY]),r||n},e.getContentState=function(e,t){return e&&e[o.b.COLUMN_NAME_CONTENT_STATE]>t&&(t=e[o.b.COLUMN_NAME_CONTENT_STATE]),t},e.isFreeSpaceAvailable=function(e,t,n){var r=10240;return n>0&&(r=n),e>0&&e>t+r},e.transferCount=function(e){var t=e.transferCount;return parseInt(t,0)},e.isContentMetadataAbsent=function(e){return!Boolean(e.contentMetaData)},e.isContentMetadataPresentWithoutViralityMetadata=function(e){return!Boolean(e.contentMetaData.virality)},e.isTrackable=function(e){return e.trackable&&"string"==typeof e.trackable&&(e.trackable=JSON.parse(e.trackable)),e.trackable&&e.trackable.enabled?e.trackable.enabled===r.a.YES?1:e.mimeType===i.j.COLLECTION?0:-1:e.contentType.toLowerCase()===f.CsContentType.COURSE.toLowerCase()?1:e.mimeType===i.j.COLLECTION?0:-1},e.getParseErrorObject=function(e){try{return JSON.parse(e)}catch(e){return}},e.defaultCompatibilityLevel=1,e.DEFAULT_PACKAGE_VERSION=-1,e.INITIAL_VALUE_FOR_TRANSFER_COUNT=0,e.MAX_CONTENT_NAME=30,e}()},function(e,t,n){"use strict";n.r(t);var r=n(91);n.d(t,"TrackingEnabled",(function(){return r.a}));var i=n(161);n.d(t,"ContentDeleteStatus",(function(){return i.a}));var o=n(162);for(var a in o)["default","TrackingEnabled","ContentDeleteStatus"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);var c=n(163);n.d(t,"SortOrder",(function(){return c.b})),n.d(t,"MarkerType",(function(){return c.a}));var s=n(164);for(var a in s)["default","TrackingEnabled","ContentDeleteStatus","SortOrder","MarkerType"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);var u=n(165);for(var a in u)["default","TrackingEnabled","ContentDeleteStatus","SortOrder","MarkerType"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(a);var f=n(16);n.d(t,"SearchType",(function(){return f.k})),n.d(t,"ChildContents",(function(){return f.a})),n.d(t,"State",(function(){return f.l})),n.d(t,"MimeType",(function(){return f.j})),n.d(t,"Visibility",(function(){return f.m})),n.d(t,"ContentStatus",(function(){return f.f})),n.d(t,"ContentEncoding",(function(){return f.c})),n.d(t,"ContentDisposition",(function(){return f.b})),n.d(t,"FileExtension",(function(){return f.h})),n.d(t,"ContentImportStatus",(function(){return f.e})),n.d(t,"ContentErrorCode",(function(){return f.d})),n.d(t,"ErrorCode",(function(){return f.g})),n.d(t,"FileName",(function(){return f.i}));var l=n(166);n.d(t,"ContentEventType",(function(){return l.a}));var p=n(44);n.d(t,"ContentMapper",(function(){return p.a}))},function(e,t,n){"use strict";n.r(t);var r=n(138);n.d(t,"TelemetryDecorator",(function(){return r.a}));var i=n(139);n.d(t,"Actor",(function(){return i.a})),n.d(t,"Context",(function(){return i.c})),n.d(t,"DeviceSpecification",(function(){return i.e})),n.d(t,"Etags",(function(){return i.f})),n.d(t,"ExData",(function(){return i.g})),n.d(t,"GameData",(function(){return i.h})),n.d(t,"CorrelationData",(function(){return i.d})),n.d(t,"Rollup",(function(){return i.k})),n.d(t,"Visit",(function(){return i.o})),n.d(t,"ProducerData",(function(){return i.j})),n.d(t,"Search",(function(){return i.l})),n.d(t,"TelemetryObject",(function(){return i.n})),n.d(t,"ProcessedEventModel",(function(){return i.i})),n.d(t,"AuditState",(function(){return i.b})),n.d(t,"SunbirdTelemetry",(function(){return i.m}));var o=n(140);for(var a in o)["default","TelemetryDecorator","Actor","Context","DeviceSpecification","Etags","ExData","GameData","CorrelationData","Rollup","Visit","ProducerData","Search","TelemetryObject","ProcessedEventModel","AuditState","SunbirdTelemetry"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);var c=n(141);for(var a in c)["default","TelemetryDecorator","Actor","Context","DeviceSpecification","Etags","ExData","GameData","CorrelationData","Rollup","Visit","ProducerData","Search","TelemetryObject","ProcessedEventModel","AuditState","SunbirdTelemetry"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(a);var s=n(142);for(var a in s)["default","TelemetryDecorator","Actor","Context","DeviceSpecification","Etags","ExData","GameData","CorrelationData","Rollup","Visit","ProducerData","Search","TelemetryObject","ProcessedEventModel","AuditState","SunbirdTelemetry"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);var u=n(81);n.d(t,"ObjectType",(function(){return u.h})),n.d(t,"Mode",(function(){return u.g})),n.d(t,"LogType",(function(){return u.f})),n.d(t,"LogLevel",(function(){return u.d})),n.d(t,"ShareDirection",(function(){return u.i})),n.d(t,"ShareType",(function(){return u.k})),n.d(t,"ShareItemType",(function(){return u.j})),n.d(t,"LogMessage",(function(){return u.e})),n.d(t,"InteractType",(function(){return u.c})),n.d(t,"InteractSubType",(function(){return u.b})),n.d(t,"TelemetryErrorCode",(function(){return u.l})),n.d(t,"ErrorType",(function(){return u.a}));var f=n(143);n.d(t,"TelemetryInteractRequest",(function(){return f.e})),n.d(t,"TelemetryErrorRequest",(function(){return f.b})),n.d(t,"TelemetryInterruptRequest",(function(){return f.f})),n.d(t,"TelemetryImpressionRequest",(function(){return f.d})),n.d(t,"TelemetryStartRequest",(function(){return f.i})),n.d(t,"TelemetrySummaryRequest",(function(){return f.j})),n.d(t,"TelemetryEndRequest",(function(){return f.a})),n.d(t,"TelemetryFeedbackRequest",(function(){return f.c})),n.d(t,"TelemetryLogRequest",(function(){return f.g})),n.d(t,"TelemetryShareRequest",(function(){return f.h}));var l=n(144);for(var a in l)["default","TelemetryDecorator","Actor","Context","DeviceSpecification","Etags","ExData","GameData","CorrelationData","Rollup","Visit","ProducerData","Search","TelemetryObject","ProcessedEventModel","AuditState","SunbirdTelemetry","ObjectType","Mode","LogType","LogLevel","ShareDirection","ShareType","ShareItemType","LogMessage","InteractType","InteractSubType","TelemetryErrorCode","ErrorType","TelemetryInteractRequest","TelemetryErrorRequest","TelemetryInterruptRequest","TelemetryImpressionRequest","TelemetryStartRequest","TelemetrySummaryRequest","TelemetryEndRequest","TelemetryFeedbackRequest","TelemetryLogRequest","TelemetryShareRequest"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return l[e]}))}(a);var p=n(145);n.d(t,"TelemetryAutoSyncModes",(function(){return p.a}))},function(e,t,n){"use strict";var r,i,o,a,c,s,u,f,l,p,d,h,E,b,y;n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"k",(function(){return a})),n.d(t,"m",(function(){return c})),n.d(t,"j",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return f})),n.d(t,"n",(function(){return l})),n.d(t,"i",(function(){return p})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return E})),n.d(t,"o",(function(){return b})),n.d(t,"l",(function(){return y})),function(e){e.KEY_FIRST_ACCESS_TIMESTAMP="first_access_timestamp"}(r||(r={})),function(e){e.KEY_API_TOKEN="api_bearer_token_v2"}(i||(i={})),function(e){e.KEY_OAUTH_SESSION="oauth_token"}(o||(o={})),function(e){e.KEY_GROUP_SESSION="group_session"}(a||(a={})),function(e){e.KEY_USER_SESSION="session"}(c||(c={})),function(e){e.KEY_ACTIVE_CHANNEL_ID="channelId",e.KEY_ACTIVE_CHANNEL_ACTIVE_FRAMEWORK_ID="sunbirdcurrent_framework_id"}(s||(s={})),function(e){e.KEY_TO_DOWNLOAD_LIST="to_download_list"}(u||(u={})),function(e){e.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL="is_update_size_on_device_successful",e.KEY_CONTENT_DELETE_REQUEST_LIST="content_delete_request_list",e.KEY_LAST_MODIFIED="last_modified",e.UPDATE_CONTENT_STATE="update_content_state",e.COURSE_CONTEXT="sunbirdcontent_context"}(f||(f={})),function(e){e.KEY_STORAGE_DESTINATION="storage_destination",e.KEY_TO_TRANSFER_LIST="to_transfer_list"}(l||(l={})),function(e){e.KEY_ERROR_LOG_LAST_SYNCED_TIME_STAMP="error_log_last_synced_time_stamp"}(p||(p={})),function(e){e.DEPLOYMENT_KEY="deployment_key"}(d||(d={})),function(e){e.DEFAULT_DEPLOYMENT_KEY="default_deployment_key",e.EXPERIMENT_KEY="experiment_key",e.EXPERIMENT_APP_VERSION="emperiment_app_version"}(h||(h={})),function(e){e.DEVICE_LOCATION="device_location_new"}(E||(E={})),function(e){e.KEY_LAST_SYNCED_TIME_STAMP="telemetry_last_synced_time_stamp",e.KEY_AUTO_SYNC_MODE="telemetry_auto_sync_mode"}(b||(b={})),function(e){e.KEY_ORGANISATION_ID="page_assemble_organisation_id"}(y||(y={}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r,i,o=n(1);!function(e){e.TABLE_NAME="group_profile",e._ID="_id",e.COLUMN_NAME_UID="uid",e.COLUMN_NAME_GID="gid",e.COLUMN_NAME_EPOCH_TIMESTAMP="epoch_timestamp",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_GID+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_UID+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_EPOCH_TIMESTAMP+o.DbConstants.SPACE+o.DbConstants.INT_TYPE+o.DbConstants.COMMA_SEP+"UNIQUE ("+e.COLUMN_NAME_GID+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_UID+") ON CONFLICT REPLACE)"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(r||(r={})),function(e){e.TABLE_NAME="groups",e._ID="_id",e.COLUMN_NAME_GID="gid",e.COLUMN_NAME_NAME="name",e.COLUMN_NAME_SYLLABUS="syllabus",e.COLUMN_NAME_GRADE="grade",e.COLUMN_NAME_GRADE_VALUE="grade_value",e.COLUMN_NAME_CREATED_AT="created_at",e.COLUMN_NAME_UPDATED_AT="updated_at",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_GID+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_NAME+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_SYLLABUS+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+' DEFAULT ""'+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+' DEFAULT ""'+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_GRADE_VALUE+o.DbConstants.SPACE+o.DbConstants.TEXT_TYPE+' DEFAULT ""'+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_CREATED_AT+" INTEGER"+o.DbConstants.COMMA_SEP+e.COLUMN_NAME_UPDATED_AT+" INTEGER )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(i||(i={}))},function(e,t){e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.joinPreservingQuotes=function(e){return e.map((function(e){return"'"+e+"'"})).join(",")},e.isEmpty=function(e){return!e||0===e.length},e.contains=function(e,t){return e&&-1!==e.indexOf(t)},e.deDupe=function(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))},e}()},function(e,t,n){"use strict";n.r(t);var r=n(169);n.d(t,"UserFeedCategory",(function(){return r.c})),n.d(t,"UserFeedStatus",(function(){return r.d})),n.d(t,"ProfileType",(function(){return r.b})),n.d(t,"ProfileSource",(function(){return r.a}));var i=n(170);for(var o in i)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(171);for(var o in a)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var c=n(172);n.d(t,"ProfileSession",(function(){return c.a}));var s=n(173);n.d(t,"ContentAccess",(function(){return s.a})),n.d(t,"ContentAccessStatus",(function(){return s.b}));var u=n(302);n.d(t,"ProfileServiceImpl",(function(){return u.a}));var f=n(200);for(var o in f)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var l=n(201);for(var o in l)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return l[e]}))}(o);var p=n(202);for(var o in p)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return p[e]}))}(o);var d=n(203);n.d(t,"NoActiveSessionError",(function(){return d.a}));var h=n(204);n.d(t,"NoProfileFoundError",(function(){return h.a}));var E=n(205);for(var o in E)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return E[e]}))}(o);var b=n(206);for(var o in b)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return b[e]}))}(o);var y=n(207);for(var o in y)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return y[e]}))}(o);var v=n(208);for(var o in v)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return v[e]}))}(o);var _=n(209);for(var o in _)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return _[e]}))}(o);var S=n(210);for(var o in S)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return S[e]}))}(o);var O=n(211);for(var o in O)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return O[e]}))}(o);var g=n(212);for(var o in g)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return g[e]}))}(o);var C=n(213);for(var o in C)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return C[e]}))}(o);var m=n(214);for(var o in m)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return m[e]}))}(o);var A=n(215);for(var o in A)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return A[e]}))}(o);var T=n(216);for(var o in T)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return T[e]}))}(o);var N=n(217);for(var o in N)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return N[e]}))}(o);var I=n(218);for(var o in I)["default","UserFeedCategory","UserFeedStatus","ProfileType","ProfileSource","ProfileSession","ContentAccess","ContentAccessStatus","ProfileServiceImpl","NoActiveSessionError","NoProfileFoundError"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return I[e]}))}(o)},function(e,t,n){"use strict";var r,i,o,a,c,s,u,f,l,p,d,h,E;n.d(t,"k",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"l",(function(){return o})),n.d(t,"j",(function(){return a})),n.d(t,"m",(function(){return c})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return f})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return d})),n.d(t,"g",(function(){return h})),n.d(t,"i",(function(){return E})),function(e){e.SEARCH="search",e.FILTER="filter"}(r||(r={})),function(e){e[e.ALL=0]="ALL",e[e.DOWNLOADED=1]="DOWNLOADED",e[e.SPINE=2]="SPINE"}(i||(i={})),function(e){e[e.SEEN_BUT_NOT_AVAILABLE=0]="SEEN_BUT_NOT_AVAILABLE",e[e.ONLY_SPINE=1]="ONLY_SPINE",e[e.ARTIFACT_AVAILABLE=2]="ARTIFACT_AVAILABLE"}(o||(o={})),function(e){e.APK="application/vnd.android.package-archive",e.ECML="application/vnd.ekstep.ecml-archive",e.HTML="application/vnd.ekstep.html-archive",e.COLLECTION="application/vnd.ekstep.content-collection",e.H5P="application/vnd.ekstep.h5p-archive",e.VIDEO="video/mp4",e.YOUTUBE="video/x-youtube",e.WEBM="video/webm",e.QUESTION="application/vnd.sunbird.question",e.QUESTION_SET="application/vnd.sunbird.questionset",e.EPUB="application/epub",e.ZIP="application/zip",e.TXT="text/plain",e.ECAR="application/ecar",e.EPAR="application/epar"}(a||(a={})),function(e){e.DEFAULT="Default",e.PARENT="Parent"}(c||(c={})),function(e){e.LIVE="Live",e.DRAFT="Draft"}(s||(s={})),function(e){e.GZIP="gzip",e.IDENTITY="identity"}(u||(u={})),function(e){e.ATTACHMENT="attachment",e.INLINE="inline",e.ONLINE="online"}(f||(f={})),function(e){e.CONTENT="ecar",e.PROFILE="epar",e.TELEMETRY="gsa"}(l||(l={})),function(e){e[e.NOT_FOUND=-1]="NOT_FOUND",e[e.ENQUEUED_FOR_DOWNLOAD=0]="ENQUEUED_FOR_DOWNLOAD",e[e.DOWNLOAD_STARTED=1]="DOWNLOAD_STARTED",e[e.DOWNLOAD_FAILED=2]="DOWNLOAD_FAILED",e[e.DOWNLOAD_COMPLETED=3]="DOWNLOAD_COMPLETED",e[e.IMPORT_STARTED=4]="IMPORT_STARTED",e[e.IMPORT_FAILED=5]="IMPORT_FAILED",e[e.NOT_COMPATIBLE=6]="NOT_COMPATIBLE",e[e.CONTENT_EXPIRED=7]="CONTENT_EXPIRED",e[e.ALREADY_EXIST=8]="ALREADY_EXIST",e[e.IMPORT_COMPLETED=100]="IMPORT_COMPLETED"}(p||(p={})),function(e){e.NO_DATA_FOUND="NO_DATA_FOUND",e.INVALID_FILE="INVALID_FILE",e.ECAR_NOT_FOUND="ECAR_NOT_FOUND",e.IMPORT_FAILED_DEVICE_MEMORY_FULL="IMPORT_FAILED_DEVICE_MEMORY_FULL",e.IMPORT_FAILED_EXTRACT_ECAR="IMPORT_FAILED_EXTRACTION",e.IMPORT_FAILED_MANIFEST_FILE_NOT_FOUND="IMPORT_FAILED_MANIFEST_FILE_NOT_FOUND",e.IMPORT_FAILED_UNSUPPORTED_MANIFEST="IMPORT_FAILED_UNSUPPORTED_MANIFEST",e.IMPORT_FAILED_NO_CONTENT_METADATA="IMPORT_FAILED_NO_CONTENT_METADATA",e.DUPLICATE_CONTENT="DUPLICATE_CONTENT",e.IMPORT_FILE_EXIST="IMPORT_FILE_EXIST",e.ECAR_CLEANUP_FAILED="ECAR_CLEANUP_FAILED",e.EXPORT_FAILED_COPY_ASSET="EXPORT_FAILED_COPY_ASSET",e.EXPORT_FAILED_MEMORY_NOT_SUFFICIENT="EXPORT_FAILED_MEMORY_NOT_SUFFICIENT",e.EXPORT_FAILED_WRITING_MANIFEST="EXPORT_FAILED_WRITE_MANIFEST",e.EXPORT_FAILED_ECAR_BUNDLE="EXPORT_FAILED_ECAR_BUNDLE",e.EXPORT_FAILED_NOTHING_TO_EXPORT="EXPORT_FAILED_NOTHING_TO_EXPORT",e.EXPORT_FAILED_DELETING_ECAR="EXPORT_FAILED_DELETING_ECAR"}(d||(d={})),function(e){e.EXPORT_FAILED="EXPORT_FAILED",e.IMPORT_FAILED="IMPORT_FAILED"}(h||(h={})),function(e){e.MANIFEST="manifest.json",e.HIERARCHY="hierarchy.json"}(E||(E={}))},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"b",(function(){return c}));var r,i,o,a,c,s=n(1);!function(e){e._ID="_id",e.TABLE_NAME="telemetry",e.COLUMN_NAME_EVENT_TYPE="event_type",e.COLUMN_NAME_EVENT="event",e.COLUMN_NAME_TIMESTAMP="timestamp",e.COLUMN_NAME_PRIORITY="priority",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+s.DbConstants.SPACE+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_EVENT_TYPE+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_EVENT+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_TIMESTAMP+s.DbConstants.SPACE+s.DbConstants.INT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRIORITY+s.DbConstants.SPACE+s.DbConstants.INT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(r||(r={})),function(e){e._ID="_id",e.TABLE_NAME="processed_telemetry",e.COLUMN_NAME_MSG_ID="msg_id",e.COLUMN_NAME_DATA="data",e.COLUMN_NAME_NUMBER_OF_EVENTS="event_count",e.COLUMN_NAME_PRIORITY="priority",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_MSG_ID+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_DATA+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_NUMBER_OF_EVENTS+s.DbConstants.SPACE+s.DbConstants.INT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRIORITY+s.DbConstants.SPACE+s.DbConstants.INT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(i||(i={})),function(e){e._ID="_id",e.TABLE_NAME="event_priority",e.COLUMN_NAME_EVENT="event",e.COLUMN_NAME_PRIORITY="priority",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_EVENT+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRIORITY+s.DbConstants.SPACE+s.DbConstants.INT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(o||(o={})),function(e){e._ID="_id",e.TABLE_NAME="telemetry_tags",e.COLUMN_NAME_NAME="name",e.COLUMN_NAME_HASH="hash",e.COLUMN_NAME_DESCRIPTION="description",e.COLUMN_NAME_START_DATE="start_date",e.COLUMN_NAME_END_DATE="end_date",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_NAME+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_HASH+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_DESCRIPTION+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_START_DATE+s.DbConstants.SPACE+s.DbConstants.DATE_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_END_DATE+s.DbConstants.SPACE+s.DbConstants.DATE_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(a||(a={})),function(e){e._ID="_id",e.TABLE_NAME="meta_data",e.COLUMN_NAME_MSG_ID="key",e.COLUMN_NAME_DATA="value",e.getCreateEntry=function(){return"CREATE TABLE "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_MSG_ID+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+s.DbConstants.COMMA_SEP+e.COLUMN_NAME_DATA+s.DbConstants.SPACE+s.DbConstants.TEXT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(c||(c={}))},function(e,t,n){"use strict";n.r(t);var r=n(134);n.d(t,"EventNamespace",(function(){return r.a}));var i=n(135);for(var o in i)["default","EventNamespace"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(136);for(var o in a)["default","EventNamespace"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var c=n(137);n.d(t,"ErrorEventType",(function(){return c.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r,i=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=function(e){function t(n,r){var i=e.call(this,n)||this;return i._code=r,Object.setPrototypeOf(i,t.prototype),i}return i(t,e),Object.defineProperty(t.prototype,"code",{get:function(){return this._code},enumerable:!1,configurable:!0}),t}(Error)},function(e,t,n){"use strict";n.r(t);var r=n(238);n.d(t,"StorageDestination",(function(){return r.a}));var i=n(239);for(var o in i)["default","StorageDestination"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(240);n.d(t,"StorageEventType",(function(){return a.a}));var c=n(241);n.d(t,"ExistingContentAction",(function(){return c.a}));var s=n(242);n.d(t,"TransferFailedDuplicateContentError",(function(){return s.a}));var u=n(243);n.d(t,"TransferFailedError",(function(){return u.a}))},function(e,t,n){"use strict";n.r(t);var r=n(174);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(175);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(176);n.d(t,"CachedItemRequestSourceFrom",(function(){return a.a}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.DOCUMENTS="documents",e.CACHE="cache",e.EXTERNAL_STORAGE="external_storage",e.LIBRARY="library",e.EXTERNAL="external",e.DATA="data"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i.a})),n.d(t,"b",(function(){return r}));var r,i=n(73);!function(e){e.TELEMETRY="telemetry",e.COURSE_PROGRESS="course_progress",e.COURSE_ASSESMENT="course_assesment"}(r||(r={}))},function(e,t,n){"use strict";n.r(t);var r=n(177);n.d(t,"SummarizerServiceImpl",(function(){return r.a}));var i=n(178);for(var o in i)["default","SummarizerServiceImpl"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(179);n.d(t,"ContentCache",(function(){return a.a})),n.d(t,"ReportDetailPerUser",(function(){return a.b}));var c=n(180);for(var o in c)["default","SummarizerServiceImpl","ContentCache","ReportDetailPerUser"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var s=n(181);n.d(t,"SummarizerHandler",(function(){return s.a}));var u=n(182);n.d(t,"SummarizerQueries",(function(){return u.a}));var f=n(183);n.d(t,"SummaryTelemetryEventHandler",(function(){return f.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(1);!function(e){e._ID="_id",e.TABLE_NAME="no_sql",e.COLUMN_NAME_KEY="key",e.COLUMN_NAME_VALUE="value",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_KEY+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+" NOT NULL"+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_VALUE+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+" )"},e.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return gs}));var r,i,o=n(7),a=n(1),c=n(17),s=n(4),u=n(12);(i=r||(r={}))._ID="_id",i.TABLE_NAME="partners",i.COLUMN_NAME_PARTNER_ID="partnerID",i.COLUMN_NAME_KEY="publicKey",i.COLUMN_NAME_KEY_ID="publicKeyID",i.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+i.TABLE_NAME+" ("+i._ID+" INTEGER PRIMARY KEY,"+i.COLUMN_NAME_PARTNER_ID+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+" UNIQUE NOT NULL"+a.DbConstants.COMMA_SEP+i.COLUMN_NAME_KEY+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+" NOT NULL"+a.DbConstants.COMMA_SEP+i.COLUMN_NAME_KEY_ID+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+" NOT NULL )"},i.getDeleteEntry=function(){return"DROP TABLE IF EXISTS "+i.TABLE_NAME};var f,l,p=n(2);(l=f||(f={}))._ID="_id",l.TABLE_NAME="notifications",l.COLUMN_NAME_MESSAGE_ID="message_id",l.COLUMN_NAME_EXPIRY_TIME="expiry_time",l.COLUMN_NAME_NOTIFICATION_DISPLAY_TIME="display_time",l.COLUMN_NAME_NOTIFICATION_RECEIVED_AT="received_at",l.COLUMN_NAME_NOTIFICATION_JSON="notification_json",l.COLUMN_NAME_IS_READ="is_read",l.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+l.TABLE_NAME+" ("+l._ID+" INTEGER PRIMARY KEY,"+l.COLUMN_NAME_MESSAGE_ID+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+a.DbConstants.COMMA_SEP+l.COLUMN_NAME_EXPIRY_TIME+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+a.DbConstants.COMMA_SEP+l.COLUMN_NAME_NOTIFICATION_DISPLAY_TIME+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+a.DbConstants.COMMA_SEP+l.COLUMN_NAME_NOTIFICATION_RECEIVED_AT+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+a.DbConstants.COMMA_SEP+l.COLUMN_NAME_NOTIFICATION_JSON+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+a.DbConstants.COMMA_SEP+l.COLUMN_NAME_IS_READ+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+" )"},l.deleteTable=function(){return"DROP TABLE IF EXISTS "+l.TABLE_NAME};var d,h,E=n(25);(h=d||(d={})).TABLE_NAME="error_stack",h._ID="_id",h.COLUMN_NAME_APP_VERSION="app_version",h.COLUMN_NAME_PAGE_ID="page_id",h.COLUMN_NAME_TIME_STAMP="time_stamp",h.COLUMN_NAME_ERROR_LOG="error_log",h.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+h.TABLE_NAME+" ("+h._ID+" INTEGER PRIMARY KEY"+a.DbConstants.COMMA_SEP+h.COLUMN_NAME_APP_VERSION+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+a.DbConstants.COMMA_SEP+h.COLUMN_NAME_PAGE_ID+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+a.DbConstants.COMMA_SEP+h.COLUMN_NAME_TIME_STAMP+a.DbConstants.SPACE+a.DbConstants.INT_TYPE+a.DbConstants.COMMA_SEP+h.COLUMN_NAME_ERROR_LOG+a.DbConstants.SPACE+a.DbConstants.TEXT_TYPE+" )"},h.deleteTable=function(){return"DROP TABLE IF EXISTS"+h.TABLE_NAME};var b,y=n(28),v=n(29),_=n(23),S=n(30),O=n(55),g=(b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),C=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},m=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},A=function(e){function t(){return e.call(this,1,16)||this}return g(t,e),t.prototype.apply=function(e){return C(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return t.sent(),[2]}}))}))},t.prototype.queries=function(){return[c.c.getCreateEntry(),c.d.getCreateEntry(),c.e.getCreateEntry(),c.a.getCreateEntry(),s.g.getCreateEntry(),s.f.getCreateEntry(),s.c.getCreateEntry(),r.getCreateEntry(),p.b.getCreateEntry(),s.d.getCreateEntry(),s.e.getCreateEntry(),p.a.getCreateEntry(),p.c.getCreateEntry(),f.getCreateEntry(),u.a.getCreateEntry(),u.b.getCreateEntry(),E.a.getCreateEntry(),p.d.getCreateEntry(),d.getCreateEntry(),y.a.getCreateEntry(),v.a.getCreateEntry(),_.a.getCreateEntry(),S.a.getCreateEntry(),O.a.getCreateEntry()]},t}(a.Migration),T=function(){function e(){this.query=""}return e.prototype.where=function(t){return this.query+=t.trim(),new e.WhereDecorator(this)},e.prototype.build=function(){return this.query},e.ConstraintDecorator=function(){function e(e){this.queryBuilder=e}return e.prototype.and=function(){return this.queryBuilder.query+=" AND ",this.queryBuilder},e.prototype.or=function(){return this.queryBuilder.query+=" OR ",this.queryBuilder},e.prototype.end=function(){return this.queryBuilder},e}(),e.WhereDecorator=function(){function t(e){this.queryBuilder=e}return t.prototype.args=function(t){var n=this;return t.forEach((function(e){n.interpolate(e)})),new e.ConstraintDecorator(this.queryBuilder)},t.prototype.interpolate=function(e){isNaN(e)&&(e='"'+e+'"'),this.queryBuilder.query=this.queryBuilder.query.replace("?",e)},t}(),e}(),N=n(6),I=n(5),M=n(3),w=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e,t){return function(n,r){t(n,r,e)}},R=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},j=function(){function e(e,t,n){this.sdkConfig=e,this.dBVersion=t,this.appMigrationList=n,this.context=this.sdkConfig.dbConfig}return e.prototype.update=function(e){return new M.Observable((function(t){db.update(e.table,e.selection||"",e.selectionArgs||[],e.modelJson,e.useExternalDb||!1,(function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))},e.prototype.init=function(){return R(this,void 0,void 0,(function(){var e=this;return L(this,(function(t){return[2,new Promise((function(t){db.init(e.context.dbName,e.dBVersion,[],(function(t){return R(e,void 0,void 0,(function(){return L(this,(function(e){switch(e.label){case 0:return"onCreate"!==t.method?[3,2]:[4,this.onCreate()];case 1:return e.sent(),[3,4];case 2:return"onUpgrade"!==t.method?[3,4]:[4,this.onUpgrade(t.oldVersion,t.newVersion)];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))})),e.hasInitialized().subscribe((function(){t()}))}))]}))}))},e.prototype.hasInitialized=function(){return this.execute("DROP TABLE IF EXISTS dummy_init_table")},e.prototype.delete=function(e){var t="\n            DELETE FROM "+e.table+"\n            WHERE "+(new T).where(e.selection).args(e.selectionArgs).end().build()+"\n        ";return new M.Observable((function(n){db.execute(t,e.useExternalDb||!1,(function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.onCreate=function(){return R(this,void 0,void 0,(function(){return L(this,(function(e){return[2,(new A).apply(this)]}))}))},e.prototype.onUpgrade=function(e,t){return R(this,void 0,void 0,(function(){var n,r,i,o;return L(this,(function(c){switch(c.label){case 0:n=0,r=this.appMigrationList,c.label=1;case 1:return n<r.length?(i=r[n],o=void 0,o=i instanceof a.Migration?i:i(),console.log("Migration",o),o.required(e,t)?[4,o.apply(this)]:[3,3]):[3,4];case 2:c.sent(),c.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.execute=function(e,t){return new M.Observable((function(n){db.execute(e,t||!1,(function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.read=function(e){return new M.Observable((function(t){db.read(!!e.distinct,e.table,e.columns||[],e.selection||"",e.selectionArgs||[],e.groupBy||"",e.having||"",e.orderBy||"",e.limit||"",e.useExternalDb||!1,(function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))},e.prototype.insert=function(e){return new M.Observable((function(t){db.insert(e.table,e.modelJson,e.useExternalDb||!1,(function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))},e.prototype.beginTransaction=function(){db.beginTransaction()},e.prototype.endTransaction=function(e,t){db.endTransaction(e,t||!1)},e.prototype.copyDatabase=function(e){return new M.Observable((function(t){db.copyDatabase(e,(function(e){t.next(e),t.complete()}),(function(e){t.error(e)}))}))},e.prototype.open=function(e){return new Promise((function(t,n){db.open(e,(function(e){t()}),(function(e){n()}))}))},e=w([Object(N.injectable)(),P(0,Object(N.inject)(I.b.SDK_CONFIG)),P(1,Object(N.inject)(I.b.DB_VERSION)),P(2,Object(N.inject)(I.b.DB_MIGRATION_LIST)),D("design:paramtypes",[Object,Number,Array])],e)}(),U=n(10),k=n(31),x=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},B=function(e,t){return function(n,r){t(n,r,e)}},V=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},G=function(){function e(e,t,n,r){this.sdkConfig=e,this.deviceInfo=t,this.appInfo=n,this.codePushExperimentService=r,this.apiConfig=this.sdkConfig.apiConfig}return e.prototype.decorate=function(e,t,n,r,i,o,a){void 0===r&&(r=0);var c=t.uid,s=t.sid;return e.ets+=r,e.mid||(e.mid=k.a.generateUniqueId()),c?this.patchActor(e,c):this.patchActor(e,""),this.patchContext(e,s,i,o,a),e.context.cdata=V(e.context.cdata,[{id:t.managedSession?t.managedSession.sid:t.sid,type:"UserSession"}]),e},e.prototype.patchActor=function(e,t){e.actor||(e.actor=new U.Actor);var n=e.actor;n.id||(n.id=t),n.type||(n.type=U.Actor.TYPE_USER)},e.prototype.patchContext=function(e,t,n,r,i){e.context||(e.context=new U.Context),e.context=this.buildContext(t,n,e.context,r,i)},e.prototype.patchPData=function(e){e.pdata||(e.pdata=new U.ProducerData);var t=e.pdata;t.id||(t.id=this.apiConfig.api_authentication.producerId);var n=t.pid;n?t.pid=n:this.apiConfig.api_authentication.producerUniqueId?t.pid=this.apiConfig.api_authentication.producerUniqueId:t.pid="sunbird.android",t.ver||(t.ver=this.appInfo.getVersionName())},e.prototype.prepare=function(e,t){return{event:JSON.stringify(e),event_type:e.eid,timestamp:Date.now(),priority:1}},e.prototype.buildContext=function(e,t,n,r,i){n.channel=t,this.patchPData(n),n.env||(n.env="app");var o=this.codePushExperimentService.getExperimentKey();return"string"==typeof o&&(n.pdata.pid=n.pdata.pid+"-"+o),n.sid=e,n.did=this.deviceInfo.getDeviceID(),t!==this.apiConfig.api_authentication.channelId&&(n.rollup={l1:t}),n.cdata=n.cdata?n.cdata.concat(r||[]):r||[],n.cdata=n.cdata?n.cdata.concat(i||[]):i||[],n},e=x([Object(N.injectable)(),B(0,Object(N.inject)(I.b.SDK_CONFIG)),B(1,Object(N.inject)(I.b.DEVICE_INFO)),B(2,Object(N.inject)(I.b.APP_INFO)),B(3,Object(N.inject)(I.b.CODEPUSH_EXPERIMENT_SERVICE)),F("design:paramtypes",[Object,Object,Object,Object])],e)}(),Y=n(79),H=n(18),q=n(9),K=n(14),z=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new o.Response;return this.dbService.open(e.sourceDBFilePath).then((function(){return t.dbService.read({table:c.b.TABLE_NAME,useExternalDb:!0}).toPromise()})).then((function(r){if(!r||!r.length)throw n.errorMesg=q.ErrorCode.IMPORT_FAILED.valueOf(),n;var i={};r.forEach((function(e){i[e.key]=e.value})),e.metadata=i;var o=t.getImportTypes(i);if(o&&K.a.contains(o,"telemetry")){var a=i.export_id,c=i.did;return t.dbService.read({table:s.c.TABLE_NAME,selection:s.c.COLUMN_NAME_IMPORTED_ID+" = ?\n                    AND "+s.c.COLUMN_NAME_DEVICE_ID+" = ?",selectionArgs:[a,c]}).toPromise()}throw n.errorMesg=q.ErrorCode.IMPORT_FAILED.valueOf(),n})).then((function(t){if(t&&t.length)throw n.errorMesg=q.ErrorCode.IMPORT_FAILED.valueOf(),n;return n.body=e,n}))},e.prototype.getImportTypes=function(e){var t=[];return e.hasOwnProperty("types")&&(t=e.types),t},e}(),W=n(108),X=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},J=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Q=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new o.Response;return this.dbService.read({table:c.d.TABLE_NAME,useExternalDb:!0}).toPromise().then((function(e){return t.saveProccessedTelemetryToDB(e)})).then((function(){return n.body=e,n}))},e.prototype.saveProccessedTelemetryToDB=function(e){return X(this,void 0,void 0,(function(){var t=this;return J(this,(function(n){return e.forEach((function(e){return X(t,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return[4,this.dbService.insert({table:c.d.TABLE_NAME,modelJson:e})];case 1:return t.sent(),[2]}}))}))})),[2]}))}))},e}(),$=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new o.Response,r=e.metadata.export_id,i=e.metadata.did,a={imported_id:r,device_id:i,count:e.metadata.events_count};return this.dbService.read({table:s.c.TABLE_NAME,selection:s.c.COLUMN_NAME_IMPORTED_ID+" = ? AND "+s.c.COLUMN_NAME_DEVICE_ID+" = ?",selectionArgs:[r,i],limit:"1"}).toPromise().then((function(e){return e&&e.length?t.dbService.update({table:s.c.TABLE_NAME,modelJson:a}).toPromise():t.dbService.insert({table:s.c.TABLE_NAME,modelJson:a}).toPromise()})).then((function(){return n.body=e,n}))},e}(),Z=function(){function e(e,t){this.dbService=e,this.telemetryService=t}return e.prototype.execute=function(e){var t=this,n=new o.Response;return this.dbService.read({table:s.c.TABLE_NAME}).toPromise().then((function(e){var n=[];e.forEach((function(e){var t={type:U.ShareItemType.TELEMETRY,origin:e[s.c.COLUMN_NAME_DEVICE_ID],identifier:e[s.c.COLUMN_NAME_IMPORTED_ID],pkgVersion:0,transferCount:0,size:""};n.push(t)}));var r={dir:U.ShareDirection.IN,type:U.ShareType.FILE.valueOf(),items:n,env:"sdk"};return t.telemetryService.share(r).toPromise()})).then((function(){return n.body=e,n}))},e}(),ee=n(45),te=n(0),ne=n(11),re=n(35),ie=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},oe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ae=function(){function e(e,t){this.telemetryService=e,this.sharedPreferences=t,this.shouldSync=!1}return e.generateDownloadSpeedTelemetry=function(e){return ie(this,void 0,void 0,(function(){var t,n,r;return oe(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(e,t){downloadManager.fetchSpeedLog?downloadManager.fetchSpeedLog((function(t,n){return e(n)}),t):cordova.exec(e,t,"DownloadManagerPlugin","fetchSpeedLog",[])}))];case 1:return t=i.sent(),n={32:"0-32",64:"32-64",128:"64-128",256:"128-256",512:"256-512",1024:"512-1024",1536:"1024-1536",2048:"1536-2048",2560:"2048-2560",3072:"2560-3072",3584:"3072-3584",4096:"3584-above"},Object.keys(null==t?void 0:t.distributionInKBPS).length?(r={duration:e/1e3,totalKBDownloaded:null==t?void 0:t.totalKBdownloaded,distributionInKBPS:Object.keys(n).reduce((function(e,r){return(null==t?void 0:t.distributionInKBPS[r])?e[n[r]]=t.distributionInKBPS[r]:e[n[r]]=0,e}),{})},[2,re.a.log.interact({type:U.InteractType.OTHER,subType:U.InteractSubType.NETWORK_SPEED,env:"sdk",pageId:"sdk",id:"sdk",valueMap:r}).pipe(Object(te.mapTo)(void 0)).toPromise()]):[2,void 0]}}))}))},e.prototype.getSyncMode=function(){return this.sharedPreferences.getString(ne.o.KEY_AUTO_SYNC_MODE).pipe(Object(te.map)((function(e){return e})))},e.prototype.setSyncMode=function(e){return this.sharedPreferences.putString(ne.o.KEY_AUTO_SYNC_MODE,e)},e.prototype.start=function(t){var n=this;return this.shouldSync=!0,Object(M.interval)(t).pipe(Object(te.tap)((function(n){n*t%e.DOWNLOAD_SPEED_TELEMETRY_SYNC_INTERVAL==0&&"ios"!==window.device.platform.toLowerCase()&&e.generateDownloadSpeedTelemetry(t)})),Object(te.filter)((function(){return n.shouldSync})),Object(te.tap)((function(){return n.telemetryService.sync().pipe(Object(te.tap)((function(e){console.log("AUTO_SYNC_INVOKED_SYNC----------------------------------------------",e)})),Object(te.catchError)((function(e){return console.error(e),Object(M.of)(void 0)}))).toPromise()})),Object(te.mapTo)(void 0))},e.prototype.pause=function(){this.shouldSync=!1},e.prototype.continue=function(){this.shouldSync=!0},e.DOWNLOAD_SPEED_TELEMETRY_SYNC_INTERVAL=6e4,e}(),ce=n(76),se=n(15),ue=n(19),fe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),le=function(e){function t(n){var r=e.call(this,n,"AUTH_TOKEN_REFRESH_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return fe(t,e),t}(ue.a),pe=n(39),de=function(){return(de=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},he=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ee=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},be=function(){function e(e,t,n,r){this.apiConfig=e,this.apiService=t,this.sharedPreferences=n,this.eventsBusService=r}return e.prototype.refreshSession=function(){return he(this,void 0,void 0,(function(){var e,t,n,r=this;return Ee(this,(function(i){switch(i.label){case 0:return[4,this.getSessionData()];case 1:if(!(e=i.sent()))throw new se.NoActiveSessionError("No Active Sessions found");t="ios"===window.device.platform.toLowerCase()?(new o.Request.Builder).withPath("/auth/v1/refresh/token").withType(o.HttpRequestType.POST).withSerializer(o.HttpSerializer.URLENCODED).withHeaders({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}).withBearerToken(!0).withBody({refresh_token:e.refresh_token}).build():(new o.Request.Builder).withPath("/auth/v1/refresh/token").withType(o.HttpRequestType.POST).withSerializer(o.HttpSerializer.URLENCODED).withBearerToken(!0).withBody({refresh_token:e.refresh_token}).build(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.apiService.fetch(t).toPromise().catch((function(e){if(o.HttpClientError.isInstance(e)&&e.response.responseCode===o.ResponseCode.HTTP_BAD_REQUEST)throw new le(e.message);throw e})).then((function(t){return he(r,void 0,void 0,(function(){var n,r,i,o;return Ee(this,(function(a){switch(a.label){case 0:return t.body.result.access_token&&t.body.result.refresh_token?[4,pe.a.decodeJWT(t.body.result.access_token)]:[3,4];case 1:return n=a.sent(),r=JSON.parse(n),i=3===r.sub.split(":").length?r.sub.split(":").pop():r.sub,[4,this.getSessionData()];case 2:return o=a.sent(),e=de(de({},t.body.result),{userToken:o?o.userToken:i,managed_access_token:o?o.managed_access_token:void 0,accessTokenExpiresOn:1e3*r.exp}),[4,this.sharedPreferences.putString(ne.c.KEY_OAUTH_SESSION,JSON.stringify(e)).toPromise()];case 3:return[2,a.sent()];case 4:throw new le("No token found in server response")}}))}))}))];case 3:return i.sent(),[3,5];case 4:throw(n=i.sent())instanceof le&&this.eventsBusService.emit({namespace:H.EventNamespace.ERROR,event:{type:H.ErrorEventType.AUTH_TOKEN_REFRESH_ERROR,payload:n}}),n;case 5:return[2]}}))}))},e.prototype.startSession=function(e){return he(this,void 0,void 0,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,this.sharedPreferences.putString(ne.c.KEY_OAUTH_SESSION,JSON.stringify(e)).toPromise()];case 1:return t.sent(),[2]}}))}))},e.prototype.endSession=function(){return he(this,void 0,void 0,(function(){return Ee(this,(function(e){switch(e.label){case 0:return[4,this.sharedPreferences.putString(ne.c.KEY_OAUTH_SESSION,"").toPromise()];case 1:return e.sent(),[2]}}))}))},e.prototype.getSessionData=function(){return he(this,void 0,void 0,(function(){var e;return Ee(this,(function(t){switch(t.label){case 0:return[4,this.sharedPreferences.getString(ne.c.KEY_OAUTH_SESSION).toPromise()];case 1:return(e=t.sent())?[2,JSON.parse(e)]:[2,void 0]}}))}))},e}(),ye=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_e=function(e,t){return function(n,r){t(n,r,e)}},Se=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Oe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ge=function(){function e(e,t,n,r,i,o,a,c,s,u,f,l,p,d,h,E,b,y){this.dbService=e,this.decorator=t,this.profileService=n,this.groupService=r,this.keyValueStore=i,this.apiService=o,this.sdkConfig=a,this.deviceInfo=c,this.eventsBusService=s,this.fileService=u,this.frameworkService=f,this.networkInfoService=l,this.errorLoggerService=p,this.sharedPreferences=d,this.appInfoService=h,this.deviceRegisterService=E,this.courseService=b,this.networkQueue=y,this.campaignParameters=[],this.globalCdata=[],this.telemetryConfig=this.sdkConfig.telemetryConfig,this._lastSyncedTimestamp$=new M.BehaviorSubject(void 0)}return Object.defineProperty(e.prototype,"autoSync",{get:function(){return this.telemetryAutoSyncService||(this.telemetryAutoSyncService=new ae(this,this.sharedPreferences)),this.telemetryAutoSyncService},enumerable:!1,configurable:!0}),e.prototype.preInit=function(){var e=this;return Object(M.defer)((function(){return Se(e,void 0,void 0,(function(){var e=this;return Oe(this,(function(t){return this.getInitialUtmParameters().then((function(t){t&&t.length&&e.updateCampaignParameters(t)})),[2,void 0]}))}))}))},e.prototype.onInit=function(){var e=this;return Object(M.combineLatest)([Object(M.defer)((function(){return Se(e,void 0,void 0,(function(){var e;return Oe(this,(function(t){switch(t.label){case 0:return[4,this.sharedPreferences.getString(ne.o.KEY_LAST_SYNCED_TIME_STAMP).toPromise()];case 1:if(e=t.sent())try{this._lastSyncedTimestamp$.next(parseInt(e,10))}catch(e){console.error(e)}return[2,void 0]}}))}))})),new M.Observable((function(t){sbsync.onAuthorizationError((function(n){return Se(e,void 0,void 0,(function(){var e;return Oe(this,(function(r){return(e=n.network_queue_error)&&t.next(e),[2]}))}))}),(function(t){return Se(e,void 0,void 0,(function(){return Oe(this,(function(e){return[2]}))}))}))})).pipe(Object(te.mergeMap)((function(t){return"API_TOKEN_EXPIRED"===t?new ce.a(e.sdkConfig.apiConfig,e.apiService,e.deviceInfo).refreshAuthToken().pipe(Object(te.mergeMap)((function(t){return e.sharedPreferences.putString(ne.a.KEY_API_TOKEN,t)})),Object(te.catchError)((function(){return Object(M.of)(void 0)}))):Object(M.from)(new be(e.sdkConfig.apiConfig,e.apiService,e.sharedPreferences,e.eventsBusService).refreshSession()).pipe(Object(te.catchError)((function(){return Object(M.of)(void 0)})))})))]).pipe(Object(te.mapTo)(void 0))},e.prototype.saveTelemetry=function(e){var t=this;return Object(M.defer)((function(){try{var n=JSON.parse(e);return t.decorateAndPersist(n)}catch(e){return console.error(e),Object(M.of)(!1)}}))},e.prototype.audit=function(e){var t=e.env,n=e.actor,r=e.currentState,i=e.updatedProperties,o=e.type,a=e.objId,c=e.objType,s=e.objVer,u=e.correlationData,f=e.rollUp,l=new U.SunbirdTelemetry.Audit(t,n,r,i,o,a,c,s,u,f);return this.decorateAndPersist(l)},e.prototype.end=function(e){var t=e.type,n=e.mode,r=e.duration,i=e.pageId,o=e.summaryList,a=e.env,c=e.objId,s=e.objType,u=e.objVer,f=e.rollup,l=e.correlationData,p=new U.SunbirdTelemetry.End(t,n,r,i,o,a,c,s,u,f,l);return this.decorateAndPersist(p)},e.prototype.error=function(e){var t=new U.SunbirdTelemetry.Error(e.errorCode,e.errorType,e.stacktrace,e.pageId);return this.errorLoggerService.logError(e).toPromise().catch((function(e){return console.error(e)})),this.decorateAndPersist(t)},e.prototype.impression=function(e){var t=e.type,n=e.subType,r=e.pageId,i=e.visits,o=e.env,a=e.objId,c=e.objType,s=e.objVer,u=e.rollup,f=e.correlationData,l=new U.SunbirdTelemetry.Impression(t,n,r,i,o,a,c,s,u,f);return this.decorateAndPersist(l)},e.prototype.interact=function(e){var t=e.type,n=e.subType,r=e.id,i=e.pageId,o=e.pos,a=e.env,c=e.rollup,s=e.valueMap,u=e.correlationData,f=e.objId,l=e.objType,p=e.objVer,d=new U.SunbirdTelemetry.Interact(t,n,r,i,o,s,a,f,l,p,c,u);return this.decorateAndPersist(d)},e.prototype.log=function(e){var t=e.type,n=e.level,r=e.message,i=e.pageId,o=e.params,a=e.env,c=e.actorType,s=new U.SunbirdTelemetry.Log(t,n,r,i,o,a,c);return this.decorateAndPersist(s)},e.prototype.share=function(e){var t=e.dir,n=e.type,r=e.items,i=e.correlationData,o=e.objId,a=e.objType,c=e.objVer,s=e.rollUp,u=new U.SunbirdTelemetry.Share(t,n,[],i,o,a,c,s);return r.forEach((function(e){u.addItem(e.type,e.origin,e.identifier,e.pkgVersion,e.transferCount,e.size)})),this.decorateAndPersist(u)},e.prototype.feedback=function(e){var t=e.rating,n=e.comments,r=e.env,i=e.objId,o=e.objType,a=e.objVer,c=e.commentid,s=e.commenttxt,u=new U.SunbirdTelemetry.Feedback(t,n,r,i,o,a,c,s);return this.decorateAndPersist(u)},e.prototype.start=function(e){var t=e.type,n=e.deviceSpecification,r=e.loc,i=e.mode,o=e.duration,a=e.pageId,c=e.env,s=e.objId,u=e.objType,f=e.objVer,l=e.rollup,p=e.correlationData,d=new U.SunbirdTelemetry.Start(t,n,r,i,o,a,c,s,u,f,l,p);return this.decorateAndPersist(d)},e.prototype.summary=function(e){var t=e.type,n=e.starttime,r=e.endtime,i=e.timespent,o=e.pageviews,a=e.interactions,c=e.env,s=e.mode,u=e.envsummary,f=e.eventsummary,l=e.pagesummary,p=e.extra,d=e.correlationData,h=e.objId,E=e.objType,b=e.objVer,y=e.rollup,v=new U.SunbirdTelemetry.Summary(t,n,r,i,o,a,c,s,u,f,l,p,d,h,E,b,y);return this.decorateAndPersist(v)},e.prototype.interrupt=function(e){var t=e.type,n=e.pageId,r=new U.SunbirdTelemetry.Interrupt(t,n);return this.decorateAndPersist(r)},e.prototype.importTelemetry=function(e){var t=this,n={sourceDBFilePath:e.sourceFilePath};return Object(M.from)(new z(this.dbService).execute(n).then((function(e){return new Q(t.dbService).execute(e.body)})).then((function(e){return new $(t.dbService).execute(e.body)})).then((function(e){return new $(t.dbService).execute(e.body)})).then((function(e){return new Z(t.dbService,t).execute(e.body)})).then((function(e){return!0})).catch((function(e){return console.error(e),!1})))},e.prototype.getTelemetryStat=function(){var e="\n            SELECT COUNT(*) as TELEMETRY_COUNT\n            FROM "+c.c.TABLE_NAME+"\n        ",t="\n            SELECT SUM("+c.d.COLUMN_NAME_NUMBER_OF_EVENTS+") as PROCESSED_TELEMETRY_COUNT\n            FROM "+c.d.TABLE_NAME+"\n        ";return Object(M.zip)(this.dbService.execute(e),this.dbService.execute(t),this.keyValueStore.getValue(ne.o.KEY_LAST_SYNCED_TIME_STAMP)).pipe(Object(te.map)((function(e){return{unSyncedEventCount:e[0][0].TELEMETRY_COUNT+e[1][0].PROCESSED_TELEMETRY_COUNT,lastSyncTime:e[2]?parseInt(e[2],10):0}})))},e.prototype.resetDeviceRegisterTTL=function(){return new Y.a(this.dbService,this.sdkConfig,this.deviceInfo,this.sharedPreferences,this.appInfoService,this.deviceRegisterService,this.keyValueStore,this.apiService,this.networkQueue).resetDeviceRegisterTTL()},e.prototype.sync=function(e){var t=this;return void 0===e&&(e={ignoreSyncThreshold:!1,ignoreAutoSyncMode:!1}),this.networkInfoService.networkStatus$.pipe(Object(te.take)(1),Object(te.mergeMap)((function(t){return t===ee.NetworkStatus.ONLINE&&(e.ignoreSyncThreshold=!0),Object(M.of)(e)})),Object(te.mergeMap)((function(e){return new Y.a(t.dbService,t.sdkConfig,t.deviceInfo,t.sharedPreferences,t.appInfoService,t.deviceRegisterService,t.keyValueStore,t.apiService,t.networkQueue).handle(e).pipe(Object(te.tap)((function(e){if(!e.error&&e.syncedEventCount){var n=Date.now();t.sharedPreferences.putString(ne.o.KEY_LAST_SYNCED_TIME_STAMP,n+"").toPromise(),t._lastSyncedTimestamp$.next(n)}})))})))},e.prototype.lastSyncedTimestamp=function(){return this._lastSyncedTimestamp$.asObservable()},e.prototype.buildContext=function(){var e=this;return this.profileService.getActiveProfileSession().pipe(Object(te.map)((function(t){return e.decorator.buildContext(t.sid,e.frameworkService.activeChannelId,new U.Context)})))},e.prototype.decorateAndPersist=function(e){var t=this;return Object(M.zip)(this.profileService.getActiveProfileSession(),this.groupService.getActiveGroupSession()).pipe(Object(te.mergeMap)((function(n){var r=n[0],i=n[1];return t.keyValueStore.getValue(Y.a.TELEMETRY_LOG_MIN_ALLOWED_OFFSET_KEY).pipe(Object(te.mergeMap)((function(n){n=n||"0";var o={table:c.c.TABLE_NAME,modelJson:t.decorator.prepare(t.decorator.decorate(e,r,i&&i.gid,Number(n),t.frameworkService.activeChannelId,t.campaignParameters,t.globalCdata),1)};return t.dbService.insert(o).pipe(Object(te.tap)((function(){return t.eventsBusService.emit({namespace:H.EventNamespace.TELEMETRY,event:{type:W.a.SAVE,payload:e}})})),Object(te.map)((function(e){return e>1})))})))})))},e.prototype.updateCampaignParameters=function(e){this.campaignParameters=e},e.prototype.populateGlobalCorRelationData=function(e){this.globalCdata=e},e.prototype.getInitialUtmParameters=function(){return new Promise((function(e,t){try{sbutility.getUtmInfo((function(t){e(t.val)}),(function(e){t(e)}))}catch(e){t(e)}}))},e=ye([Object(N.injectable)(),_e(0,Object(N.inject)(I.b.DB_SERVICE)),_e(1,Object(N.inject)(I.b.TELEMETRY_DECORATOR)),_e(2,Object(N.inject)(I.b.PROFILE_SERVICE)),_e(3,Object(N.inject)(I.b.GROUP_SERVICE_DEPRECATED)),_e(4,Object(N.inject)(I.b.KEY_VALUE_STORE)),_e(5,Object(N.inject)(I.b.API_SERVICE)),_e(6,Object(N.inject)(I.b.SDK_CONFIG)),_e(7,Object(N.inject)(I.b.DEVICE_INFO)),_e(8,Object(N.inject)(I.b.EVENTS_BUS_SERVICE)),_e(9,Object(N.inject)(I.b.FILE_SERVICE)),_e(10,Object(N.inject)(I.b.FRAMEWORK_SERVICE)),_e(11,Object(N.inject)(I.b.NETWORKINFO_SERVICE)),_e(12,Object(N.inject)(I.b.ERROR_LOGGER_SERVICE)),_e(13,Object(N.inject)(I.b.SHARED_PREFERENCES)),_e(14,Object(N.inject)(I.b.APP_INFO)),_e(15,Object(N.inject)(I.b.DEVICE_REGISTER_SERVICE)),_e(16,Object(N.inject)(I.b.COURSE_SERVICE)),_e(17,Object(N.inject)(I.b.NETWORK_QUEUE)),ve("design:paramtypes",[a.DbService,U.TelemetryDecorator,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],e)}(),Ce=n(13),me=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Te=function(e,t){return function(n,r){t(n,r,e)}},Ne=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ie=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Me=function(){function e(e,t,n,r){this.sdkConfig=e,this.apiService=t,this.sharedPreferences=n,this.eventsBusService=r,this.apiConfig=this.sdkConfig.apiConfig,this.authUtil=new be(this.apiConfig,this.apiService,this.sharedPreferences,this.eventsBusService)}var t;return t=e,e.prototype.onInit=function(){var e=this;return this.sharedPreferences.addListener(ne.c.KEY_OAUTH_SESSION,(function(t){return Ne(e,void 0,void 0,(function(){var e,n,r,i,o;return Ie(this,(function(a){switch(a.label){case 0:if(!t)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),r=(n=JSON).parse,[4,this.sharedPreferences.getString(ne.m.KEY_USER_SESSION).toPromise()];case 2:return e=r.apply(n,[a.sent()]),i=JSON.parse(t),Ce.CsModule.instance.config.core.api.authentication.userToken=i.access_token,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=e.managedSession?i.managed_access_token:void 0,[3,4];case 3:return o=a.sent(),console.error(o),Ce.CsModule.instance.config.core.api.authentication.userToken=void 0,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=void 0,[3,4];case 4:return[3,6];case 5:Ce.CsModule.instance.config.core.api.authentication.userToken=void 0,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=void 0,a.label=6;case 6:return Ce.CsModule.instance.updateConfig(Ce.CsModule.instance.config),[2]}}))}))})),this.sharedPreferences.addListener(ne.m.KEY_USER_SESSION,(function(t){return Ne(e,void 0,void 0,(function(){var e,n,r,i,o;return Ie(this,(function(a){switch(a.label){case 0:if(!t)return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),e=JSON.parse(t),i=(r=JSON).parse,[4,this.sharedPreferences.getString(ne.c.KEY_OAUTH_SESSION).toPromise()];case 2:return n=i.apply(r,[a.sent()]),Ce.CsModule.instance.config.core.api.authentication.userToken=n.access_token,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=e.managedSession?n.managed_access_token:void 0,[3,4];case 3:return o=a.sent(),console.error(o),Ce.CsModule.instance.config.core.api.authentication.userToken=void 0,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=void 0,[3,4];case 4:return[3,6];case 5:Ce.CsModule.instance.config.core.api.authentication.userToken=void 0,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=void 0,a.label=6;case 6:return Ce.CsModule.instance.updateConfig(Ce.CsModule.instance.config),[2]}}))}))})),Object(M.combineLatest)([Object(M.defer)((function(){return e.getSession()})).pipe(Object(te.mergeMap)((function(t){return Ne(e,void 0,void 0,(function(){var e,n,r;return Ie(this,(function(i){switch(i.label){case 0:return t?(r=(n=JSON).parse,[4,this.sharedPreferences.getString(ne.m.KEY_USER_SESSION).toPromise()]):[2,void 0];case 1:return e=r.apply(n,[i.sent()]),Ce.CsModule.instance.config.core.api.authentication.userToken=t.access_token,Ce.CsModule.instance.config.core.api.authentication.managedUserToken=e.managedSession?t.managed_access_token:void 0,Ce.CsModule.instance.updateConfig(Ce.CsModule.instance.config),[2,void 0]}}))}))}))),Object(M.defer)((function(){return e.onAccessTokenNearingExpiry()})).pipe(Object(te.mergeMap)((function(t){return Ne(e,void 0,void 0,(function(){return Ie(this,(function(e){return t?[2,this.refreshSession().toPromise()]:[2,void 0]}))}))})))]).pipe(Object(te.mapTo)(void 0))},e.prototype.setSession=function(e){var t=this;return Object(M.from)(e.provide().then((function(e){if(!e.access_token)throw t.authUtil.endSession(),e;t.authUtil.startSession(e),t.authUtil.refreshSession()})))},e.prototype.getSession=function(){return Object(M.from)(this.authUtil.getSessionData())},e.prototype.resignSession=function(){return Object(M.from)(this.authUtil.endSession())},e.prototype.refreshSession=function(){return Object(M.from)(this.authUtil.refreshSession())},e.prototype.onAccessTokenNearingExpiry=function(){var e=this,n=Object(M.defer)((function(){return e.getSession()})),r=new M.Observable((function(e){document.addEventListener("resume",(function(){setTimeout((function(){e.next()}),0)}),!1)})).pipe(Object(te.mergeMap)((function(){return e.getSession()})));return Object(M.merge)(n,r).pipe(Object(te.map)((function(e){return!(!e||!e.accessTokenExpiresOn)&&e.accessTokenExpiresOn-Date.now()<t.ACCESS_TOKEN_NEARING_EXPIRY_DELTA})),Object(te.distinctUntilChanged)())},e.ACCESS_TOKEN_NEARING_EXPIRY_DELTA=36e5,e=t=me([Object(N.injectable)(),Te(0,Object(N.inject)(I.b.SDK_CONFIG)),Te(1,Object(N.inject)(I.b.API_SERVICE)),Te(2,Object(N.inject)(I.b.SHARED_PREFERENCES)),Te(3,Object(N.inject)(I.b.EVENTS_BUS_SERVICE)),Ae("design:paramtypes",[Object,Object,Object,Object])],e)}(),we=n(36),De=n(82),Pe=n(44),Re=n(8),Le=function(){function e(e){this.dbService=e}return e.prototype.getContentMarker=function(e,t){var n=this,r="SELECT * FROM "+p.d.TABLE_NAME+"\n                       "+Re.a.getUidnIdentifierFiler(t,e)+"\n                       ORDER BY "+p.d.COLUMN_NAME_EPOCH_TIMESTAMP+" DESC ";return this.dbService.execute(r).pipe(Object(te.map)((function(e){return n.mapDBEntriesToContentMarkerDetails(e)})))},e.prototype.mapDBEntriesToContentMarkerDetails=function(e){return e.map((function(e){return{contentId:e[p.d.COLUMN_NAME_CONTENT_IDENTIFIER],uid:e[p.d.COLUMN_NAME_UID],extraInfoMap:e[p.d.COLUMN_NAME_EXTRA_INFO]&&JSON.parse(e[p.d.COLUMN_NAME_EXTRA_INFO]),marker:e[p.d.COLUMN_NAME_MARKER]}}))},e}(),je=function(){return(je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ue=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ke=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},xe=p.b.COLUMN_NAME_MIME_TYPE,Fe=p.b.COLUMN_NAME_VISIBILITY,Be=function(){function e(e,t,n,r,i,o){this.contentFeedbackService=e,this.profileService=t,this.apiService=n,this.contentServiceConfig=r,this.dbService=i,this.eventsBusService=o,this.GET_CONTENT_DETAILS_ENDPOINT="/read"}return e.getReadContentQuery=function(e){return{table:p.b.TABLE_NAME,selection:(new T).where("? = ?").args([p.b.COLUMN_NAME_IDENTIFIER,e]).end().build(),limit:"1"}},e.isUnit=function(e){return e[xe]===q.MimeType.COLLECTION&&e[Fe]===q.Visibility.PARENT},e.prototype.handle=function(t){var n=this;return t.emitUpdateIfAny=void 0===t.emitUpdateIfAny||t.emitUpdateIfAny,this.fetchFromDB(t.contentId).pipe(Object(te.mergeMap)((function(r){return r?Object(M.of)(Pe.a.mapContentDBEntryToContent(r)).pipe(Object(te.mergeMap)((function(e){return"string"==typeof e.contentData.originData&&(e.contentData.originData=Re.a.getParseErrorObject(e.contentData.originData)),e.contentData.trackable&&"string"==typeof e.contentData.trackable&&(e.contentData.trackable=JSON.parse(e.contentData.trackable)),n.decorateContent({content:e,attachFeedback:t.attachFeedback,attachContentAccess:t.attachContentAccess,attachContentMarker:t.attachContentMarker})})),Object(te.tap)((function(i){return Ue(n,void 0,void 0,(function(){var n,o;return ke(this,(function(a){switch(a.label){case 0:return!t.emitUpdateIfAny||e.isUnit(r)?[2]:(!1,(n=r[p.b.COLUMN_NAME_SERVER_DATA]&&JSON.parse(r[p.b.COLUMN_NAME_SERVER_DATA]))&&n.streamingUrl||!0,[4,this.fetchFromServer(t).toPromise()]);case 1:return o=a.sent(),r[p.b.COLUMN_NAME_SERVER_DATA]=JSON.stringify(o),r[p.b.COLUMN_NAME_SERVER_LAST_UPDATED_ON]=o.lastUpdatedOn,r[p.b.COLUMN_NAME_AUDIENCE]=Re.a.readAudience(o),[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" =?",selectionArgs:[r[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:r}).toPromise()];case 2:return a.sent(),Re.a.isUpdateAvailable(o,i.contentData)&&this.eventsBusService.emit({namespace:H.EventNamespace.CONTENT,event:{type:q.ContentEventType.UPDATE,payload:{contentId:i.contentData.identifier,size:o.size}}}),o&&this.eventsBusService.emit({namespace:H.EventNamespace.CONTENT,event:{type:q.ContentEventType.SERVER_CONTENT_DATA,payload:{contentId:o.identifier,streamingUrl:o.streamingUrl,licenseDetails:o.licenseDetails,size:o.size,serverContentData:o}}}),[2]}}))}))}))):n.fetchAndDecorate(t)})))},e.prototype.fetchFromDB=function(e){return this.dbService.read({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[e],limit:"1"}).pipe(Object(te.map)((function(e){return e[0]})))},e.prototype.fetchFromDBForAll=function(e){return this.dbService.read({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" IN ("+e+")"})},e.prototype.fetchFromServer=function(e){switch(e.objectType){case"QuestionSet":return this.apiService.fetch((new o.Request.Builder).withHost(this.contentServiceConfig.host).withType(o.HttpRequestType.GET).withPath(this.contentServiceConfig.questionSetReadApiPath+this.GET_CONTENT_DETAILS_ENDPOINT+"/"+e.contentId).withBearerToken(!1).build()).pipe(Object(te.map)((function(e){return e.body.result.questionset})));case"Question":return this.apiService.fetch((new o.Request.Builder).withHost(this.contentServiceConfig.host).withType(o.HttpRequestType.GET).withPath(this.contentServiceConfig.questionReadApiPath+this.GET_CONTENT_DETAILS_ENDPOINT+"/"+e.contentId).withBearerToken(!1).build()).pipe(Object(te.map)((function(e){return e.body.result.question})));default:return this.apiService.fetch((new o.Request.Builder).withHost(this.contentServiceConfig.host).withType(o.HttpRequestType.GET).withPath(this.contentServiceConfig.apiPath+this.GET_CONTENT_DETAILS_ENDPOINT+"/"+e.contentId).withParameters({licenseDetails:"name,url,description"}).withBearerToken(!0).build()).pipe(Object(te.map)((function(e){return e.body.result.content})))}},e.prototype.fetchAndDecorate=function(e){var t=this;return this.fetchFromServer(e).pipe(Object(te.map)((function(e){return Pe.a.mapServerResponseToContent(e)})),Object(te.mergeMap)((function(n){return t.decorateContent({content:n,attachFeedback:e.attachFeedback,attachContentAccess:e.attachContentAccess,attachContentMarker:e.attachContentMarker})})))},e.prototype.decorateContent=function(e){var t=this;return Object(M.of)(e.content).pipe(Object(te.mergeMap)((function(n){return e.attachContentAccess?t.attachContentAccess(n):Object(M.of)(n)})),Object(te.mergeMap)((function(n){return e.attachFeedback?t.attachFeedback(n):Object(M.of)(n)})),Object(te.mergeMap)((function(n){return e.attachContentMarker?t.attachContentMarker(n):Object(M.of)(n)})))},e.prototype.attachContentAccess=function(e){var t=this;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(n){var r=n.uid;return t.profileService.getAllContentAccess({contentId:e.identifier,uid:r}).pipe(Object(te.map)((function(t){return je(je({},e),{contentAccess:t})})))})))},e.prototype.attachFeedback=function(e){var t=this;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(n){var r=n.uid;return t.contentFeedbackService.getFeedback({contentId:e.identifier,uid:r}).pipe(Object(te.map)((function(t){return je(je({},e),{contentFeedback:t})})))})))},e.prototype.attachContentMarker=function(e){var t=this;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(n){var r=n.uid;return new Le(t.dbService).getContentMarker(e.identifier,r).pipe(Object(te.map)((function(t){return je(je({},e),{contentMarkers:t})})))})))},e}(),Ve=n(16),Ge=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},Ye=function(){function e(e){this._stack=e||[]}return Object.defineProperty(e.prototype,"count",{get:function(){return this._stack.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this._stack.push(e)},e.prototype.pop=function(){return this._stack.pop()},e.prototype.clear=function(){this._stack=[]},e.prototype.isEmpty=function(){return 0===this._stack.length},e.prototype.addAll=function(e){this._stack=Ge(this._stack,e)},e}(),He=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},qe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ke=function(){function e(e,t,n,r){this.dbService=e,this.getContentDetailsHandler=t,this.appConfig=n,this.fileService=r}return e.prototype.fetchChildrenOfContent=function(e,t,n,r,i){return He(this,void 0,void 0,(function(){var o,a,c,s,u,f,l,d,h;return qe(this,(function(E){switch(E.label){case 0:return o=Pe.a.mapContentDBEntryToContent(e),[4,this.getSortedChildrenList(e[p.b.COLUMN_NAME_LOCAL_DATA],Ve.a.ALL,t)];case 1:if(!(a=E.sent())||!a.length)return[3,7];if((c=(c=[]).concat(i)).push({identifier:e[p.b.COLUMN_NAME_IDENTIFIER],contentType:e[p.b.COLUMN_NAME_CONTENT_TYPE],primaryCategory:e[p.b.COLUMN_NAME_PRIMARY_CATEGORY]}),o.hierarchyInfo=c,!(-1===r||n<=r))return[3,6];s=[],u=0,f=a,E.label=2;case 2:return u<f.length?(l=f[u],d=l,[4,this.fetchChildrenOfContent(d,t,n+1,r,c)]):[3,5];case 3:(h=E.sent()).contentData.appIcon&&!h.contentData.appIcon.startsWith("http")&&(h.contentData.appIcon="_app_file_".concat(h.basePath).concat(h.contentData.appIcon)),s.push(h),E.label=4;case 4:return u++,[3,2];case 5:o.children=s,E.label=6;case 6:return[3,8];case 7:o.hierarchyInfo=i,E.label=8;case 8:return[2,o]}}))}))},e.prototype.getContentsKeyList=function(e){return He(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s;return qe(this,(function(u){switch(u.label){case 0:t=[],n=new Ye,r=[],i="",n.push(e),u.label=1;case 1:return n.isEmpty()?[3,4]:(o=n.pop(),Re.a.hasChildren(o[p.b.COLUMN_NAME_LOCAL_DATA])?[4,this.getSortedChildrenListOld(o[p.b.COLUMN_NAME_LOCAL_DATA],Ve.a.ALL)]:[3,3]);case 2:u.sent().forEach((function(e){n.push(e),r.push(o[p.b.COLUMN_NAME_IDENTIFIER].concat("/",e[p.b.COLUMN_NAME_IDENTIFIER]))})),u.label=3;case 3:if(i){for(a=void 0,c=i.split("/").length-1;c>=0&&(s=i.split("/")[c],!K.a.contains(r,s.concat("/",o[p.b.COLUMN_NAME_IDENTIFIER])));c--)i=i.substring(0,i.lastIndexOf("/"));Ve.j.COLLECTION.valueOf()===o[p.b.COLUMN_NAME_MIME_TYPE]?i=i+"/"+o[p.b.COLUMN_NAME_IDENTIFIER]:(a=i+"/"+o[p.b.COLUMN_NAME_IDENTIFIER],t.push(a))}else i=o[p.b.COLUMN_NAME_IDENTIFIER];return[3,1];case 4:return[2,t]}}))}))},e.prototype.getContentFromDB=function(e,t,n){return He(this,void 0,void 0,(function(){var e,r,i,o,a,c,s,u,f,l,d,h,E,b,y,v,_;return qe(this,(function(S){switch(S.label){case 0:if(e=[],!t)return[3,7];i=t.split("/"),o=i.length,a=!0,E=0,S.label=1;case 1:return E<o-1?[4,this.getContentDetailsHandler.fetchFromDB(i[E]).toPromise()]:[3,4];case 2:if(!(c=S.sent()))return a=!1,[3,4];e.push({identifier:c[p.b.COLUMN_NAME_IDENTIFIER],contentType:c[p.b.COLUMN_NAME_CONTENT_TYPE],primaryCategory:c[p.b.COLUMN_NAME_PRIMARY_CATEGORY]}),S.label=3;case 3:return E++,[3,1];case 4:return a?[4,this.getContentDetailsHandler.fetchFromDB(i[o-1]).toPromise()]:[3,7];case 5:return(s=S.sent())?((r=Pe.a.mapContentDBEntryToContent(s,n)).hierarchyInfo=e,r.rollup=Re.a.getContentRollup(r.identifier,r.hierarchyInfo),u=Re.a.readCompatibilityLevel(r.contentData),f=Re.a.isCompatible(this.appConfig,u),r.isCompatible=f,l=e.map((function(e){return e.identifier})),d=K.a.joinPreservingQuotes(l),[4,this.getContentDetailsHandler.fetchFromDBForAll(d).toPromise()]):[3,7];case 6:for(h=(h=S.sent()).sort((function(e,t){return l.indexOf(e.identifier)-l.indexOf(t.identifier)})),E=0;E<h.length&&(b=h[E],y=JSON.parse(b[p.b.COLUMN_NAME_LOCAL_DATA]),v=Re.a.isTrackable(y),0!==E||1!==v);E++)if(1===v){b.identifier,(_=JSON.parse(JSON.stringify(e)))&&(_=_.slice(0,E),r.trackableParentInfo={identifier:b.identifier,hierarchyInfo:_});break}S.label=7;case 7:return[2,r]}}))}))},e.prototype.getNextContentIdentifier=function(e,t,n){var r,i="";e.forEach((function(e){i=i?i.concat("/",e.identifier):e.identifier})),i=i.concat("/",t);var o=n.indexOf(i);return o>0&&(r=n[o-1]),r},e.prototype.getPreviousContentIdentifier=function(e,t,n){var r,i="";e.forEach((function(e){i=i?i.concat("/",e.identifier):e.identifier})),i=i.concat("/",t);var o=n.indexOf(i);return-1!==o&&o<n.length-1&&(r=n[o+1]),r},e.prototype.getSortedChildrenListOld=function(e,t){return He(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u;return qe(this,(function(f){if(n=JSON.parse(e),!(r=n.children)||!r.length)return[2,[]];switch(r=r.sort((function(e,t){return e.index-t.index})),i=[],o="",a=0,r.forEach((function(e){i.push(e.identifier),o=o.concat(" WHEN '"+e.identifier+"' THEN "+a),a+=1})),c="",a>0&&(c=c.concat(" ORDER BY CASE  "+p.b.COLUMN_NAME_IDENTIFIER+"  "+o+"  END")),s="",t){case Ve.a.DOWNLOADED.valueOf():s=" AND "+p.b.COLUMN_NAME_CONTENT_STATE+"='"+Ve.l.ARTIFACT_AVAILABLE+"'";break;case Ve.a.SPINE.valueOf():s=" AND "+p.b.COLUMN_NAME_CONTENT_STATE+"='"+Ve.l.ONLY_SPINE+"'";break;case Ve.a.ALL.valueOf():default:s=""}return u="SELECT * FROM "+p.b.TABLE_NAME+"\n                        WHERE "+p.b.COLUMN_NAME_IDENTIFIER+"\n                        IN ("+K.a.joinPreservingQuotes(i)+") "+s+" "+c,[2,this.dbService.execute(u).toPromise()]}))}))},e.prototype.getSortedChildrenList=function(e,t,n){return He(this,void 0,void 0,(function(){var r,i,o,a,c,s,u,f,l;return qe(this,(function(d){switch(d.label){case 0:if(r=JSON.parse(e),!(i=r.children)||!i.length)return[2,[]];i=i.sort((function(e,t){return e.index-t.index})),o=[],a=0,c=i,d.label=1;case 1:return a<c.length?(s=c[a],(u=n.get(s.identifier))?(o.push(u),[3,4]):[3,2]):[3,5];case 2:return f="SELECT * FROM "+p.b.TABLE_NAME+"\n                 WHERE "+p.b.COLUMN_NAME_IDENTIFIER+" = '"+s.identifier+"'",[4,this.dbService.execute(f).toPromise()];case 3:(l=d.sent()).length&&o.push(l[0]),d.label=4;case 4:return a++,[3,1];case 5:switch(t){case Ve.a.DOWNLOADED.valueOf():o=o.filter((function(e){return e[p.b.COLUMN_NAME_CONTENT_STATE]=Ve.l.ARTIFACT_AVAILABLE}));break;case Ve.a.SPINE.valueOf():o=o.filter((function(e){return e[p.b.COLUMN_NAME_CONTENT_STATE]=Ve.l.ONLY_SPINE}));break;case Ve.a.ALL.valueOf():}return[2,o]}}))}))},e.prototype.getChildIdentifiersFromManifest=function(e){return He(this,void 0,void 0,(function(){var t,n,r=this;return qe(this,(function(i){switch(i.label){case 0:return t="file:///"+e,n=[],[4,this.fileService.readAsText(t,Ve.i.MANIFEST.valueOf()).then((function(e){return He(r,void 0,void 0,(function(){var t;return qe(this,(function(r){return console.log("fileContents",JSON.parse(e)),(t=JSON.parse(e).archive.items).shift(),t.forEach((function(e){n.push(e.identifier)})),[2,n]}))}))})).catch((function(e){console.log("getChildIdentifiersFromManifest err",e)}))];case 1:return i.sent(),[2,n]}}))}))},e}(),ze=function(){function e(){}return e.getFileExtension=function(e){var t=e.substring(e.lastIndexOf(".")+1,e.length);return t||""},e.getFileName=function(e){return console.log("fileName",e.substring(e.lastIndexOf("/")+1)),e.substring(e.lastIndexOf("/")+1)},e.getParentDir=function(e){return e.substr(0,e.lastIndexOf("/",e.length-2)).concat("/")},e.getDirectoryName=function(e){var t=e.split("/");return t[t.length-2]},e.getTempDirPath=function(e){return e+"/tmp"},e.isFreeSpaceAvailable=function(e,t,n){var r=10240;return n>0&&(r=n),e>0&&e>t+r},e.getDirecory=function(e){return console.log("directory",e.substr(0,e.lastIndexOf("/"))),e.substr(0,e.lastIndexOf("/"))},e}(),We=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Xe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Je=function(){function e(e,t,n){this.dbService=e,this.fileService=t,this.sharedPreferences=n,this.updateNewContentModels=[],this.fileMapList=[]}return e.prototype.deleteAllChildren=function(e,t){return We(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u,f,l=this;return Xe(this,(function(d){switch(d.label){case 0:return n=!1,r=Re.a.getBasePath(e[p.b.COLUMN_NAME_PATH]),[4,this.fileService.readAsText(r,q.FileName.MANIFEST.valueOf()).then((function(e){return We(l,void 0,void 0,(function(){var r,i,o=this;return Xe(this,(function(a){switch(a.label){case 0:return(r=JSON.parse(e).archive.items).shift(),i=[],r.forEach((function(e){i.push(e.identifier)})),[4,this.findAllContentsFromDbWithIdentifiers(i)];case 1:return a.sent().forEach((function(e){return We(o,void 0,void 0,(function(){var r;return Xe(this,(function(i){switch(i.label){case 0:return[4,this.deleteOrUpdateContent(e,!0,t)];case 1:if(i.sent(),n=!0,(r=e[p.b.COLUMN_NAME_PATH])&&n&&Re.a.getFirstPartOfThePathNameOnLastDelimiter(r))try{this.sharedPreferences.putString(ne.f.KEY_LAST_MODIFIED,(new Date).getMilliseconds()+"").toPromise()}catch(e){console.log("Error",e)}return[2]}}))}))})),[2]}}))}))})).catch((function(e){console.log("fileread err",e)}))];case 1:return d.sent(),[4,this.getMetaData(this.fileMapList)];case 2:if(i=d.sent(),!this.updateNewContentModels.length)return[3,7];this.dbService.beginTransaction(),o=0,a=this.updateNewContentModels,d.label=3;case 3:return o<a.length?(c=a[o],u=(s=c)[p.b.COLUMN_NAME_IDENTIFIER],f=0,i&&(f=i[u]?i[u].size:0),s[p.b.COLUMN_NAME_SIZE_ON_DEVICE]=f,[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[u],modelJson:s}).toPromise()]):[3,6];case 4:d.sent(),d.label=5;case 5:return o++,[3,3];case 6:this.dbService.endTransaction(!0),d.label=7;case 7:return[2]}}))}))},e.prototype.deleteOrUpdateContent=function(e,t,n){return We(this,void 0,void 0,(function(){var r,i,o,a,c,s,u,f,l,d;return Xe(this,(function(h){switch(h.label){case 0:return r=e[p.b.COLUMN_NAME_REF_COUNT],o=e[p.b.COLUMN_NAME_VISIBILITY],a=e[p.b.COLUMN_NAME_MIME_TYPE],c=e[p.b.COLUMN_NAME_PATH],n?(r>1&&o===q.Visibility.DEFAULT.valueOf()&&(r-=1,o=q.Visibility.PARENT.valueOf()),i=a===q.MimeType.COLLECTION?q.State.ARTIFACT_AVAILABLE.valueOf():q.State.ONLY_SPINE.valueOf()):(a===q.MimeType.COLLECTION.valueOf()&&r>1||r>1&&t?i=q.State.ARTIFACT_AVAILABLE.valueOf():(o===q.Visibility.DEFAULT.valueOf()&&(o=q.Visibility.PARENT.valueOf()),i=q.State.ONLY_SPINE.valueOf()),r-=1),c?(i===q.State.ONLY_SPINE.valueOf()&&(s=e[p.b.COLUMN_NAME_LOCAL_DATA],u=s&&JSON.parse(s),f="",l="",s&&(f=u.appIcon?ze.getFileName(u.appIcon):"",l=u.itemSetPreviewUrl?ze.getFileName(u.itemSetPreviewUrl):""),this.rm(Re.a.getBasePath(c),[f,l].join(":"))),e[p.b.COLUMN_NAME_VISIBILITY]=o,e[p.b.COLUMN_NAME_REF_COUNT]=Re.a.addOrUpdateRefCount(r),e[p.b.COLUMN_NAME_CONTENT_STATE]=i,t?[3,2]:(e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]=0,[4,this.dbService.update({table:p.b.TABLE_NAME,modelJson:e,selection:p.b.COLUMN_NAME_IDENTIFIER+" =?",selectionArgs:[e[p.b.COLUMN_NAME_IDENTIFIER]]}).pipe(Object(te.map)((function(e){return e>0}))).toPromise()])):[3,3];case 1:return h.sent(),[3,3];case 2:(d={}).identifier=e[p.b.COLUMN_NAME_IDENTIFIER],d.path=Re.a.getBasePath(c),this.fileMapList.push(d),this.updateNewContentModels.push(e),h.label=3;case 3:return[2]}}))}))},e.prototype.findAllContentsFromDbWithIdentifiers=function(e){var t=K.a.joinPreservingQuotes(e),n=" WHERE "+p.b.COLUMN_NAME_IDENTIFIER+" IN ("+t+") AND "+p.b.COLUMN_NAME_REF_COUNT+" > 0",r="SELECT * FROM "+p.b.TABLE_NAME+" "+n;return this.dbService.execute(r).toPromise()},e.prototype.rm=function(e,t){return new Promise((function(n,r){try{sbutility.rm(e,t,(function(e){n(e)}),(function(e){console.error(e),r(!1)}))}catch(e){console.error(e),r(!1)}}))},e.prototype.getMetaData=function(e){return We(this,void 0,void 0,(function(){return Xe(this,(function(t){return[2,new Promise((function(t,n){sbutility.getMetaData(e,(function(e){t(e)}),(function(e){console.error(e),n(e)}))}))]}))}))},e}(),Qe=n(33),$e=function(){return($e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ze=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},et=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},tt=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},nt=function(){function e(e,t,n){this.appConfig=e,this.contentServiceConfig=t,this.telemetryService=n}return e.prototype.getSearchCriteria=function(e){var t,n=this,r=e.request,i=r.query,o=r.exists,a=r.limit,c=r.offset;r.hasOwnProperty("mode")&&"soft"===r.mode&&(t="soft");var s=[];if(r.hasOwnProperty("sort_by")){var u=r.sort_by;Object.keys(u).forEach((function(e){var t={sortAttribute:e,sortOrder:n.getSortOrder(String(u[e]))};s.push(t)}))}var f,l,p,d,h=$e($e($e({},i?{query:i}:{}),o?{exists:o}:{}),{mode:t,sortCriteria:s,searchType:this.getSearchType(String(r.searchType)),offset:c||0,limit:a||100});if(r.hasOwnProperty("filters")){var E=r.filters;E.contentType&&(f=E.contentType),E.primaryCategory&&(l=E.primaryCategory),p=this.mapFilterValues(E,h),h.impliedFilters=p,h.contentTypes=f,h.primaryCategories=l}return r.hasOwnProperty("facets")&&(d=r.facets,h.facets=d),h},e.prototype.getSearchContentRequest=function(e){return{query:e.query,offset:e.offset,limit:e.limit,mode:e.mode,exists:e.exists&&e.exists.length>0?e.exists:[],facets:e.facets&&e.facets.length>0?e.facets:[],sort_by:this.getSortByRequest(e.sortCriteria),filters:this.getSearchFilter(e),fields:e.fields}},e.prototype.getSearchFilter=function(e){return e.searchType.valueOf()===q.SearchType.SEARCH.valueOf()?this.getSearchRequest(e):e.searchType.valueOf()===q.SearchType.FILTER.valueOf()?this.getFilterRequest(e):{}},e.prototype.getFilterRequest=function(e){var t={};return this.addFiltersToRequest(t,e.facetFilters),this.addFiltersToRequest(t,e.impliedFilters),e.impliedFiltersMap&&e.impliedFiltersMap.length>0&&e.impliedFiltersMap.forEach((function(e){t=$e($e({},t),e)})),t},e.prototype.addFiltersToRequest=function(e,t){t&&t.length&&t.forEach((function(t){var n=[];if(t.values.forEach((function(e){e.apply&&n.push(e.name)})),n.length){var r=t.name;if(t.alternative)switch(t.name){case"board":r="se_boards";break;case"medium":r="se_mediums";break;case"gradeLevel":case"grade":r="se_gradeLevels"}e[r]=n}}))},e.prototype.getSearchRequest=function(e){var t=this,n=$e($e($e($e($e({audience:e.audience&&e.audience.length>0?e.audience:[],status:e.contentStatusArray,objectType:["Content","QuestionSet"],contentType:e.contentTypes&&e.contentTypes.length>0?e.contentTypes:[],primaryCategory:e.primaryCategories&&e.primaryCategories.length>0?e.primaryCategories:[]},e.keywords&&e.keywords.length?{keywords:e.keywords}:{}),e.dialCodes&&e.dialCodes.length?{dialcodes:e.dialCodes}:{}),e.createdBy&&e.createdBy.length?{createdBy:e.createdBy}:{}),e.grade&&e.grade.length?{se_gradeLevels:e.grade}:{}),{se_mediums:e.medium&&e.medium.length>0?e.medium:[],se_boards:e.board&&e.board.length>0?e.board:[],language:e.language&&e.language.length>0?e.language:[],topic:e.topic&&e.topic.length>0?e.topic:[],purpose:e.purpose&&e.purpose.length>0?e.purpose:[],channel:e.channel&&e.channel.length>0?e.channel:[],mimeType:e.mimeType&&e.mimeType.length>0?e.mimeType:[],subject:e.subject&&e.subject.length>0?e.subject:[]});return e.impliedFiltersMap&&e.impliedFiltersMap.forEach((function(e){Object.keys(e).forEach((function(t){n[t]=e[t]}))})),e.impliedFilters&&e.impliedFilters.forEach((function(e){Object.keys(e).forEach((function(r){var i=e.values,o=e.name,a=t.getImpliedFilterValues(i);if(n[o]||(n[o]=[]),n[o]){var c=n[o].concat(a);c&&(n[o]=c.filter((function(e,t){return c.indexOf(e)===t})))}}))})),n},e.prototype.getImpliedFilterValues=function(e){var t=[];return e?(e.forEach((function(e){e.apply&&t.push(e.name)})),t):[]},e.prototype.getSortByRequest=function(e){return e?e.reduce((function(e,t){return e[t.sortAttribute]=t.sortOrder,e}),{}):{}},e.prototype.createFilterCriteria=function(e,t,n){var r=this,i=[],o={query:e.query,limit:e.limit,offset:e.offset,facets:e.facets,contentTypes:e.contentTypes,primaryCategories:e.primaryCategories,sortCriteria:e.sortCriteria&&e.sortCriteria.length?e.sortCriteria:[],mode:"soft"===e.mode?"soft":"hard"};return t?(t.forEach((function(e){var t=n?n[e.name]:[],o=e.values,a=r.getSortedFilterValuesWithAppliedFilters(o,t);if(e.name){var c={name:e.name,values:a};i.push(c)}delete n[e.name]})),o.facetFilters=i,o.impliedFilters=this.mapFilterValues(n,o),o):o},e.prototype.addFilterValue=function(e,t){e&&e.length>0&&e.forEach((function(e){var n=e.name;e.values,t[n]}))},e.prototype.getFilterValuesWithAppliedFilter=function(e,t){return e.forEach((function(e){var n=!1;t&&t.indexOf(name)>-1&&(n=!0),e.apply=n})),e},e.prototype.mapSearchResponse=function(e,t,n){var r=(t.result.content||[]).concat(t.result.QuestionSet||[]);return{id:t.id,responseMessageId:t.params.resmsgid,filterCriteria:this.createFilterCriteria(e,t.result.facets,n.filters),request:n,contentDataList:r,count:t.result.count,collectionDataList:t.result.collections?t.result.collections:[]}},e.prototype.getContentSearchFilter=function(e,t,n){return void 0===n&&(n=[]),{filters:{identifier:e.filter((function(t,n){return e.indexOf(t)===n})),status:t,objectType:["Content"]},fields:tt(n,["downloadUrl","variants","mimeType","contentType","primaryCategory","pkgVersion"])}},e.prototype.getDownloadUrl=function(e,t){return Ze(this,void 0,void 0,(function(){var n,r,i,o;return et(this,(function(a){switch(a.label){case 0:try{i=e.variants&&"string"==typeof e.variants?JSON.parse(e.variants):e.variants}catch(t){i=e.variants}return e.mimeType===q.MimeType.COLLECTION.valueOf()?i&&i.online?r="online":i&&i.spine&&(r="spine"):e.mimeType===q.MimeType.QUESTION_SET&&(i&&i.full?r="full":i&&i.online&&(r="online")),i&&r&&i[r]?(o=i[r],n=o&&o.ecarUrl,[4,this.buildContentLoadingEvent(r,t,e.primaryCategory||e.contentType,e.pkgVersion)]):[3,2];case 1:a.sent(),a.label=2;case 2:return n?[3,4]:(n=e.downloadUrl.trim(),[4,this.buildContentLoadingEvent("full",t,e.primaryCategory||e.contentType,e.pkgVersion)]);case 3:a.sent(),a.label=4;case 4:return[2,n]}}))}))},e.prototype.buildContentLoadingEvent=function(e,t,n,r){var i=new U.TelemetryInteractRequest;return i.type=U.InteractType.OTHER,i.subType=e,i.pageId="ImportContent",i.id="ImportContent",i.objId=t.contentId,i.objType=n,i.objVer=r,i.rollup=t.rollUp,i.correlationData=t.correlationData,this.telemetryService.interact(i).toPromise()},e.prototype.getSortOrder=function(e){return"asc"===e?q.SortOrder.ASC:q.SortOrder.DESC},e.prototype.getSearchType=function(e){return"search"===e?q.SearchType.SEARCH:"filter"===e?q.SearchType.FILTER:q.SearchType.SEARCH},e.prototype.getSortedFilterValuesWithAppliedFilters=function(e,t){return e.forEach((function(e){var n=!1;t&&t.forEach((function(t){t&&e.name&&e.name.toLowerCase()===t.toLowerCase()&&(n=!0)})),e.apply=n,e.count=Qe.a.parseInt(e.count)})),e},e.prototype.mapFilterValues=function(e,t){var n=[],r=[];return Object.keys(e).forEach((function(t){var i=e[t];if(Array.isArray(i)&&i.length){var o=[];i.forEach((function(e){var t={name:e,apply:!0};o.push(t)})),n.push({name:t,values:o})}else if(i){var a={};a[t]=i,r.push(a)}})),t.impliedFiltersMap=r,n},e}(),rt=function(){function e(){}return e.prototype.getAllLocalContentQuery=function(e){e.primaryCategories&&e.primaryCategories.length||(e.primaryCategories=["Course","Learning Resource","Explanation Content","Teacher Resource","Content Playlist","Digital Textbook","Practice Question Set","eTextBook","Course Assessment"]);var t=e.uid,n=e.resourcesOnly?"":"c."+p.b.COLUMN_NAME_VISIBILITY+" = '"+q.Visibility.DEFAULT.valueOf()+"' AND",r="c."+p.b.COLUMN_NAME_CONTENT_STATE+" = '"+q.State.ARTIFACT_AVAILABLE.valueOf()+"'",i=n+" "+r;if(e.resourcesOnly){i=i+"  AND ("+("c."+p.b.COLUMN_NAME_MIME_TYPE+" != '"+q.MimeType.COLLECTION.valueOf()+"'")+")"}else{var o=K.a.joinPreservingQuotes(e.primaryCategories);i=i+"  AND ("+("c."+p.b.COLUMN_NAME_PRIMARY_CATEGORY+" IN("+o.toLowerCase()+")")+")"}var a=this.getAudienceFilter(e.audience),c=this.getPragmaFilter(e.exclPragma,e.pragma),s=this.generateFieldMatchQuery(e);a&&(i=i+"  AND ("+a+")"),c&&(i=i+"  AND ("+c+")"),s&&(i=i+"  AND ("+s+")");var u="WHERE ("+i+")",f="",l=e.resourcesOnly?"":this.generateSortByQuery(e.sortCriteria,t);return e.recentlyViewed?t&&(u="WHERE ("+(i=e.localOnly?"ca."+p.a.COLUMN_NAME_UID+" = '"+t+"' AND "+r+"\n                    AND cm."+p.b.COLUMN_NAME_MIME_TYPE+" NOT IN ('"+q.MimeType.COLLECTION.valueOf()+"', '')":"ca."+p.a.COLUMN_NAME_UID+" = '"+t+"'\n                    AND cm."+p.b.COLUMN_NAME_MIME_TYPE+" NOT IN ('"+q.MimeType.COLLECTION.valueOf()+"', '')")+")",f=this.getRecentlyViewedQuery(u,l,e.limit)):f=t?this.getLocalOnlyQuery(u,l,t):"SELECT c.* FROM "+p.b.TABLE_NAME+" c "+u+" "+l,f},e.prototype.getAudienceFilter=function(e){var t="";return e&&e.forEach((function(e){t=t.concat(t.length>0?" OR ":"","c."+p.b.COLUMN_NAME_AUDIENCE+" LIKE '%%"+e+"%%'")})),t},e.prototype.getPragmaFilter=function(e,t){var n="";return e?e.forEach((function(e){n=n.concat(n.length>0?" OR ":"","c."+p.b.COLUMN_NAME_PRAGMA+" NOT LIKE '%%"+e+"%%'")})):t&&t.forEach((function(e){n=n.concat(n.length>0?" OR ":"","c."+p.b.COLUMN_NAME_PRAGMA+" LIKE '%%"+e+"%%'")})),n},e.prototype.getRecentlyViewedQuery=function(e,t,n){return"SELECT c.*, ca."+p.a.COLUMN_NAME_EPOCH_TIMESTAMP+",\n                cm."+p.d.COLUMN_NAME_DATA+" FROM "+p.a.TABLE_NAME+" ca LEFT JOIN\n                "+p.d.TABLE_NAME+" cm ON\n                (cm."+p.d.COLUMN_NAME_UID+" = ca."+p.a.COLUMN_NAME_UID+"\n                AND cm."+p.d.COLUMN_NAME_CONTENT_IDENTIFIER+" = ca."+p.a.COLUMN_NAME_CONTENT_IDENTIFIER+")\n                LEFT JOIN "+p.b.TABLE_NAME+"  c ON\n                c."+p.b.COLUMN_NAME_IDENTIFIER+" = ca."+p.a.COLUMN_NAME_CONTENT_IDENTIFIER+"\n                "+e+" "+t+" LIMIT "+n},e.prototype.getLocalOnlyQuery=function(e,t,n){var r="";return r=Array.isArray(n)?"ca."+p.a.COLUMN_NAME_UID+" IN ("+K.a.joinPreservingQuotes(n)+")":"ca."+p.a.COLUMN_NAME_UID+" ='"+n+"'","SELECT c.*, ca."+p.a.COLUMN_NAME_EPOCH_TIMESTAMP+"\n                FROM "+p.b.TABLE_NAME+" c LEFT JOIN "+p.a.TABLE_NAME+" ca\n                ON c."+p.b.COLUMN_NAME_IDENTIFIER+" = ca."+p.a.COLUMN_NAME_CONTENT_IDENTIFIER+"\n                AND "+r+"\n                "+e+" "+t},e.prototype.generateSortByQuery=function(e,t){var n=this,r="",i=0;return e||((e=[]).push({sortAttribute:"lastUsedOn",sortOrder:q.SortOrder.DESC}),e.push({sortAttribute:"localLastUpdatedOn",sortOrder:q.SortOrder.DESC})),e.forEach((function(e){e&&("lastUsedOn"===e.sortAttribute.valueOf()&&t?(r=n.generateOrderByQuery(i,r," ca."+p.a.COLUMN_NAME_EPOCH_TIMESTAMP,e.sortOrder.valueOf()),i++):"localLastUpdatedOn"===e.sortAttribute.valueOf()?(r=n.generateOrderByQuery(i,r," c."+p.b.COLUMN_NAME_LOCAL_LAST_UPDATED_ON,e.sortOrder.valueOf()),i++):"sizeOnDevice"===e.sortAttribute.valueOf()&&(r=n.generateOrderByQuery(i,r," c."+p.b.COLUMN_NAME_SIZE_ON_DEVICE,e.sortOrder.valueOf()),i++))})),r},e.prototype.generateOrderByQuery=function(e,t,n,r){return(e>0?t.concat(","):t.concat("ORDER BY")).concat(n+" "+r)},e.prototype.generateFieldMatchQuery=function(e){var t=this;return[{field:"board",column:p.b.COLUMN_NAME_BOARD},{field:"medium",column:p.b.COLUMN_NAME_MEDIUM},{field:"grade",column:p.b.COLUMN_NAME_GRADE},{field:"dialcodes",column:p.b.COLUMN_NAME_DIALCODES},{field:"childNodes",column:p.b.COLUMN_NAME_CHILD_NODES}].reduce((function(n,r){var i=r.field,o=r.column;return e[i]&&e[i].length&&n.push(t.generateLikeQuery(e[i],o)),n}),[]).join(" AND ")},e.prototype.generateLikeQuery=function(e,t){for(var n="",r=t+" LIKE ",i=0;i<e.length;i++)n=i<e.length-1?n.concat(r,"'%%~"+e[i].toLowerCase().trim()+"~%%' OR "):n.concat(r,"'%%~"+e[i].toLowerCase().trim()+"~%%' ");return"("+n+")"},e}(),it=n(41),ot=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},at=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ct=p.b.COLUMN_NAME_LOCAL_DATA,st=p.b.COLUMN_NAME_IDENTIFIER,ut=p.b.COLUMN_NAME_REF_COUNT,ft=function(){function e(e,t,n){this.deviceInfo=e,this.dbService=t,this.fileService=n}return e.prototype.populateItems=function(e){var t=this,n=[],r=[],i=[],o={};e.forEach((function(e){var n=JSON.parse(e[ct]);if(o[e[st]]=n,Re.a.addViralityMetadataIfMissing(n,t.deviceInfo.getDeviceID()),Re.a.hasChildren(n)){var a=Re.a.getChildContentsIdentifiers(n);i=i.concat(a)}r.push(e[st])}));try{r.forEach((function(e){var t=o[e];K.a.contains(i,e)&&(t.visibility=q.Visibility.PARENT.valueOf()),n.push(t)}))}catch(e){console.log(e)}return n},e.prototype.populateItemList=function(e){var t=this,n=[],r=[],i=[],o={};e.forEach((function(e){if(o[e.identifier]=e,Re.a.addViralityMetadataIfMissing(e,t.deviceInfo.getDeviceID()),Re.a.hasChildren(e)){var n=Re.a.getChildContentsIdentifiers(e);i=i.concat(n)}r.push(e.identifier)}));try{r.forEach((function(e){var t=o[e];K.a.contains(i,e)&&(t.visibility=q.Visibility.PARENT.valueOf()),n.push(t)}))}catch(e){console.log(e)}return n},e.prototype.getContentExportDBModelToExport=function(e){return ot(this,void 0,void 0,(function(){var t,n,r,i=this;return at(this,(function(o){switch(o.label){case 0:return t=[],[4,this.findAllContentsWithIdentifiers(e)];case 1:return n=o.sent(),r=Re.a.getBasePath(n[0][p.b.COLUMN_NAME_PATH]),[4,this.fileService.readAsText(r,q.FileName.MANIFEST.valueOf()).then((function(e){return ot(i,void 0,void 0,(function(){var n,r;return at(this,(function(i){switch(i.label){case 0:return n=JSON.parse(e).archive.items,r=[],n.forEach((function(e){r.push(e.identifier)})),[4,this.findAllContentsWithIdentifiers(r,!0)];case 1:return t=i.sent(),[2]}}))}))})).catch((function(e){console.log("fileRead error",e)}))];case 2:return o.sent(),[2,Promise.resolve(Re.a.deDupe(t,"identifier"))]}}))}))},e.prototype.generateManifestForArchive=function(t){var n={},r={ttl:24};return r.count=t.length,r.items=t,n.id=e.EKSTEP_CONTENT_ARCHIVE,n.ver=e.SUPPORTED_MANIFEST_VERSION,n.ts=it().format("YYYY-MM-DDTHH:mm:ss[Z]"),n.archive=r,n},e.prototype.findAllContentsWithIdentifiers=function(e,t){var n="";t&&e.length&&(n=e.reduce((function(e,t,n){return e+" WHEN '"+t+"' THEN "+n})," ORDER BY CASE "+st)+" END");var r=K.a.joinPreservingQuotes(e),i=" where "+st+" in ("+r+") AND "+ut+" > 0",o="select * from "+p.b.TABLE_NAME+" "+i+" "+n;return this.dbService.execute(o).toPromise()},e.EKSTEP_CONTENT_ARCHIVE="ekstep.content.archive",e.SUPPORTED_MANIFEST_VERSION="1.1",e}(),lt=function(){function e(e,t){this.dbService=e,this.exportHandler=t}return e.prototype.execute=function(t){var n=new o.Response,r=this.exportHandler.populateItems(t.contentModelsToExport);t.items=[],t.manifest={},t.items=t.items.concat(r);var i={ttl:24};return i.count=t.items.length,i.items=t.items,t.manifest.id=e.EKSTEP_CONTENT_ARCHIVE,t.manifest.ver=e.SUPPORTED_MANIFEST_VERSION,t.manifest.ts=it().format(),t.manifest.archive=i,n.body=t,Promise.resolve(n)},e.EKSTEP_CONTENT_ARCHIVE="ekstep.content.archive",e.SUPPORTED_MANIFEST_VERSION="1.1",e}(),pt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},dt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ht=function(){function e(e,t){this.fileService=e,this.deviceInfo=t}return e.prototype.execute=function(e){var t=this,n=new o.Response;return this.deviceInfo.getAvailableInternalMemorySize().toPromise().then((function(r){return pt(t,void 0,void 0,(function(){var t;return dt(this,(function(i){switch(i.label){case 0:if((t=Number(r))>0&&t<1048576)throw n.errorMesg=Ve.d.EXPORT_FAILED_MEMORY_NOT_SUFFICIENT,n;return[4,this.fileService.writeFile(e.tmpLocationPath,Ve.i.MANIFEST.valueOf(),JSON.stringify(e.manifest),{replace:!0})];case 1:return[2,i.sent()]}}))}))})).then((function(){return n.body=e,Promise.resolve(n)})).catch((function(){return n.errorMesg=Ve.d.EXPORT_FAILED_WRITING_MANIFEST,Promise.reject(n)}))},e}(),Et=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},bt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},yt=function(){function e(e){this.zipService=e}return e.prototype.execute=function(e){return Et(this,void 0,void 0,(function(){var t,n,r,i,a,c=this;return bt(this,(function(s){switch(s.label){case 0:t=new o.Response,n=function(t){var n,r,i,o,a,s,u;return bt(this,(function(f){switch(f.label){case 0:return n=t,r=JSON.parse(n[p.b.COLUMN_NAME_LOCAL_DATA]),!Re.a.isAvailableLocally(n[p.b.COLUMN_NAME_CONTENT_STATE])||Re.a.isOnlineContent(r)||Re.a.isInlineIdentity(r.contentDisposition,r.contentEncoding)?[2,"continue"]:(i=r.artifactUrl)?(o=e.tmpLocationPath.concat(i),a=n[p.b.COLUMN_NAME_PATH],u=[],(s=[]).push(n[p.b.COLUMN_NAME_IDENTIFIER]),u.push(n[p.b.COLUMN_NAME_IDENTIFIER].concat("/",q.FileName.MANIFEST.valueOf())),[4,new Promise((function(e,t){c.zipService.zip(a,{target:o},s,u,(function(){e()}),(function(){t()}))}))]):[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))},r=0,i=e.contentModelsToExport,s.label=1;case 1:return r<i.length?(a=i[r],[5,n(a)]):[3,4];case 2:s.sent(),s.label=3;case 3:return r++,[3,1];case 4:return t.body=e,[2,Promise.resolve(t)]}}))}))},e}(),vt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},_t=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},St=function(){function e(e){this.fileService=e}return e.prototype.execute=function(e){return vt(this,void 0,void 0,(function(){var t,n=this;return _t(this,(function(r){switch(r.label){case 0:return t=new o.Response,[4,this.fileService.getFreeDiskSpace().then((function(r){n.getFileSize(e.items);return t.body=e,t}))];case 1:return[2,r.sent()]}}))}))},e.prototype.getFileSize=function(e){var t=0;return e&&e.forEach((function(e){e.size&&(t+=Number(e.size))})),t},e}(),Ot=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},gt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ct=function(){function e(){}return e.prototype.execute=function(e){return Ot(this,void 0,void 0,(function(){var t,n,r,i,a,c,s,u,f,l,d,h,E,b,y,v,_,S,O;return gt(this,(function(g){switch(g.label){case 0:t=new o.Response,g.label=1;case 1:g.trys.push([1,15,,16]),n=0,r=[],null!=e.subContentIds&&e.subContentIds.length>0&&(r=this.excludeContentForSubModule(e.contentModelsToExport,e.subContentIds)),i=e.contentModelsToExport,r&&r.length>0&&(i=r),a=0,c=i,g.label=2;case 2:if(!(a<c.length))return[3,14];s=c[a],u=s,f=e.items[n],l=f.appIcon,d=f.itemSetPreviewUrl,h=0,E=[l,d],g.label=3;case 3:if(!(h<E.length))return[3,8];if(!(b=E[h])||b.startsWith("https:"))return[3,7];g.label=4;case 4:return g.trys.push([4,6,,7]),[4,this.copyFile(u[p.b.COLUMN_NAME_PATH],e.tmpLocationPath,b)];case 5:return g.sent(),[3,7];case 6:return y=g.sent(),console.error(y),[3,7];case 7:return h++,[3,3];case 8:if(v=f.contentDisposition,_=f.contentEncoding,!Re.a.isInlineIdentity(v,_))return[3,12];if(!(S=f.artifactUrl))return[3,12];g.label=9;case 9:return g.trys.push([9,11,,12]),[4,this.copyFile(u[p.b.COLUMN_NAME_PATH],e.tmpLocationPath,S)];case 10:return g.sent(),[3,12];case 11:return O=g.sent(),console.error(O),[3,12];case 12:n++,g.label=13;case 13:return a++,[3,2];case 14:return t.body=e,[2,t];case 15:throw g.sent(),t.errorMesg=q.ContentErrorCode.EXPORT_FAILED_COPY_ASSET,t;case 16:return[2]}}))}))},e.prototype.excludeContentForSubModule=function(e,t){var n=[];return e.forEach((function(e){var r=e.identifier;t&&t.indexOf(r)>-1&&n.push(e)})),n},e.prototype.copyFile=function(e,t,n){return Ot(this,void 0,void 0,(function(){return gt(this,(function(r){return[2,new Promise((function(r,i){sbutility.copyFile(e,t,n,(function(){r()}),(function(e){console.error(e),r(e)}))}))]}))}))},e}(),mt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},At=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Tt=function(){function e(e,t){this.fileService=e,this.zipService=t}return e.prototype.execute=function(t){return mt(this,void 0,void 0,(function(){var n,r,i=this;return At(this,(function(a){switch(a.label){case 0:return n=new o.Response,[4,new Promise((function(e,r){i.zipService.zip(t.tmpLocationPath,{target:t.ecarFilePath},[],[],(function(){e()}),(function(){throw n.errorMesg=Ve.d.EXPORT_FAILED_ECAR_BUNDLE,n}))}))];case 1:return a.sent(),[4,this.fileService.getMetaData(t.ecarFilePath).catch((function(e){throw new Error(e)}))];case 2:return r=a.sent(),t.metadata[e.FILE_SIZE]=r.size,n.body=t,[2,n]}}))}))},e.FILE_SIZE="FILE_SIZE",e}(),Nt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},It=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Mt=function(){function e(e,t){this.fileService=e,this.zipService=t,this.FILE_SIZE="FILE_SIZE"}return e.prototype.execute=function(e){return Nt(this,void 0,void 0,(function(){var t,n,r=this;return It(this,(function(i){switch(i.label){case 0:return t=new o.Response,[4,this.fileService.getMetaData(e.ecarFilePath).then((function(t){return Nt(r,void 0,void 0,(function(){return It(this,(function(r){switch(r.label){case 0:return n=t.size,[4,this.fileService.createDir(e.tmpLocation.concat(k.a.generateUniqueId()),!0).catch((function(e){throw new Error(e)}))];case 1:return[2,r.sent()]}}))}))})).then((function(i){return Nt(r,void 0,void 0,(function(){var r=this;return It(this,(function(o){switch(o.label){case 0:return e.tmpLocation=i.nativeURL,[4,new Promise((function(t,n){r.zipService.unzip(e.ecarFilePath,{target:i.nativeURL},(function(){t()}),(function(e){n(e)}))}))];case 1:return o.sent(),e.metadata={},e.metadata.FILE_SIZE=n,t.body=e,[2,Promise.resolve(t)]}}))}))})).catch((function(e){return t.errorMesg=Ve.d.IMPORT_FAILED_EXTRACT_ECAR.valueOf(),Promise.reject(t)}))];case 1:return[2,i.sent()]}}))}))},e}(),wt=function(){function e(){this.identifierList=new Set}return e.prototype.hierarchyToManifestConversion=function(e){this.identifierList=new Set,this.archive={count:0,items:[]};var t=this.reorderData(e,1);return t&&(this.archive.count+=1,this.archive.items.push(t)),e.children&&e.children.length&&this.recurssiveFunc(e.children,1),this.archive},e.prototype.recurssiveFunc=function(e,t){for(var n=0;n<e.length;n++){var r=this.reorderData(e[n],t+1,q.Visibility.PARENT.valueOf());r&&(this.archive.count+=1,this.archive.items.push(r)),e[n].children&&e[n].children.length&&this.recurssiveFunc(e[n].children,t+1)}},e.prototype.reorderData=function(e,t,n){if(this.identifierList.has(e.identifier))return null;var r=[],i=JSON.parse(JSON.stringify(e));if(i.children&&i.children.length){for(var o=0;o<i.children.length;o++)r.push({name:i.children[o].name,identifier:i.children[o].identifier,objectType:i.children[o].objectType,depth:t,index:o});i.children=r}return i.visibility=n||i.visibility,this.identifierList.add(i.identifier),i},e}(),Dt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Pt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Rt=function(){function e(e,t,n,r){this.fileService=e,this.dbService=t,this.appConfig=n,this.getContentDetailsHandler=r}return e.prototype.execute=function(e){return Dt(this,void 0,void 0,(function(){var t,n,r,i,a,c,s,u,f,l,d,h,E,b,y,v,_,S,O,g,C,m,A,T,N;return Pt(this,(function(I){switch(I.label){case 0:t=new o.Response,I.label=1;case 1:return I.trys.push([1,3,,5]),[4,this.fileService.readAsText(e.tmpLocation,q.FileName.HIERARCHY.valueOf())];case 2:return(n=I.sent())&&((r=JSON.parse(n)).archive=(new wt).hierarchyToManifestConversion(r.content),delete r.content,n=JSON.stringify(r)),[3,5];case 3:return I.sent(),[4,this.fileService.readAsText(e.tmpLocation,q.FileName.MANIFEST.valueOf()).catch((function(e){throw new Error(e)}))];case 4:return n=I.sent(),[3,5];case 5:return n?[3,7]:(t.errorMesg=q.ContentErrorCode.IMPORT_FAILED_MANIFEST_FILE_NOT_FOUND.valueOf(),[4,this.fileService.removeRecursively(e.tmpLocation).catch((function(e){throw new Error(e)}))]);case 6:throw I.sent(),t;case 7:return 1!==(i=JSON.parse(n)).ver?[3,9]:(t.errorMesg=q.ContentErrorCode.IMPORT_FAILED_UNSUPPORTED_MANIFEST.valueOf(),[4,this.fileService.removeRecursively(e.tmpLocation).catch((function(e){throw new Error(e)}))]);case 8:throw I.sent(),t;case 9:return(a=i.archive).items?[3,11]:(t.errorMesg=q.ContentErrorCode.IMPORT_FAILED_NO_CONTENT_METADATA.valueOf(),[4,this.fileService.removeRecursively(e.tmpLocation).catch((function(e){throw new Error(e)}))]);case 10:throw I.sent(),t;case 11:for(e.manifestVersion=i.ver,e.items=[],c=a.items,s=[],u=0,f=c;u<f.length;u++)v=f[u],S=(_=v).identifier,s.push(S);return l=K.a.joinPreservingQuotes(s),[4,this.getContentDetailsHandler.fetchFromDBForAll(l).toPromise()];case 12:for(d=I.sent(),h=d.reduce((function(e,t){return e[t.identifier]=t,e}),{}),E=!1,e.existedContentIdentifiers={},b=0,y=c;b<y.length;b++)v=y[b],S=(_=v).identifier,O=Re.a.readVisibility(_),g=_.status,(C=Re.a.isDraftContent(g))&&Re.a.isExpired(_.expires)?this.skipContent(e,S,O,q.ContentImportStatus.CONTENT_EXPIRED,c):(O===q.Visibility.DEFAULT.valueOf()&&(E=!1),m=h[S],A=void 0,m&&(T=m[p.b.COLUMN_NAME_REF_COUNT],(A=m[p.b.COLUMN_NAME_PATH])&&O===q.Visibility.DEFAULT.valueOf()&&T&&T>0&&(E=!0,(N=JSON.parse(m[p.b.COLUMN_NAME_LOCAL_DATA]))&&_.pkgVersion>N.pkgVersion&&N.childNodes&&N.childNodes.length>0&&(e.contentIdsToDelete=new Set(N.childNodes)))),A&&O===q.Visibility.DEFAULT.valueOf()&&!Re.a.isDuplicateCheckRequired(C,_.pkgVersion)&&Re.a.isImportFileExist(m,_)?(e.rootIdentifier=S,this.skipContent(e,S,O,q.ContentImportStatus.ALREADY_EXIST,c)):(E&&e.contentIdsToDelete.delete(S)&&(e.existedContentIdentifiers[S]=!0),e.items.push(_)));return t.body=e,[2,t]}}))}))},e.prototype.skipContent=function(e,t,n,r,i){n===q.Visibility.DEFAULT&&(r===q.ContentImportStatus.ALREADY_EXIST?i&&1===i.length&&e.contentImportResponseList.push({identifier:t,status:r}):e.contentImportResponseList.push({identifier:t,status:r})),e.skippedItemsIdentifier.push(t)},e}(),Lt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},jt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ut=function(){function e(e,t,n){this.dbService=e,this.sharedPreferences=t,this.fileService=n}return e.prototype.execute=function(){return this.updateAllRootContentSize().toPromise()},e.prototype.findAllChildContents=function(e){var t="SELECT * FROM "+p.b.TABLE_NAME+"\n                       WHERE "+p.b.COLUMN_NAME_IDENTIFIER+" IN ("+K.a.joinPreservingQuotes(e)+")\n                       AND "+p.b.COLUMN_NAME_REF_COUNT+" > 0";return this.dbService.execute(t).toPromise()},e.prototype.updateAllRootContentSize=function(){var e=this,t="SELECT * FROM "+p.b.TABLE_NAME+" WHERE "+p.b.COLUMN_NAME_REF_COUNT+" > 0\n        AND "+p.b.COLUMN_NAME_VISIBILITY+" = '"+q.Visibility.DEFAULT.valueOf()+"'";return this.dbService.execute(t).pipe(Object(te.tap)((function(){return Lt(e,void 0,void 0,(function(){return jt(this,(function(e){return[2,this.sharedPreferences.putBoolean(ne.f.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL,!1).toPromise()]}))}))})),Object(te.mergeMap)((function(t){return Lt(e,void 0,void 0,(function(){var e,n=this;return jt(this,(function(r){switch(r.label){case 0:return e=[],[4,Promise.all(t.map((function(t){return Lt(n,void 0,void 0,(function(){var n,r;return jt(this,(function(i){switch(i.label){case 0:return[4,this.getSizeOnDevice(t)];case 1:return n=i.sent(),(r=JSON.parse(t[p.b.COLUMN_NAME_LOCAL_DATA]).childNodes)?[4,this.findAllChildContents(r)]:[3,3];case 2:i.sent().forEach((function(e){n+=e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]||0})),t[p.b.COLUMN_NAME_SIZE_ON_DEVICE]=n,e.push(t),i.label=3;case 3:return[2]}}))}))})))];case 1:return r.sent(),this.updateInDb(e),[2]}}))}))})),Object(te.tap)((function(){return Lt(e,void 0,void 0,(function(){return jt(this,(function(e){return[2,this.sharedPreferences.putBoolean(ne.f.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL,!0).toPromise()]}))}))})))},e.prototype.getSizeOnDevice=function(e){return Lt(this,void 0,void 0,(function(){var t,n,r,i,o;return jt(this,(function(a){switch(a.label){case 0:return t=0,e[p.b.COLUMN_NAME_MIME_TYPE]!==q.MimeType.COLLECTION.valueOf()?[3,3]:e[p.b.COLUMN_NAME_VISIBILITY]!==q.Visibility.DEFAULT.valueOf()?[3,2]:(n=[],r={},i=e[p.b.COLUMN_NAME_IDENTIFIER],r.identifier=i,r.path=e[p.b.COLUMN_NAME_PATH],n.push(r),[4,this.getMetaData(n)]);case 1:o=a.sent(),t=o[i]?o[i].size:0,a.label=2;case 2:return[3,4];case 3:t=e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]?e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]:0,a.label=4;case 4:return[2,Promise.resolve(t||0)]}}))}))},e.prototype.updateInDb=function(e){return Lt(this,void 0,void 0,(function(){var t,n,r,i,o;return jt(this,(function(a){for(this.dbService.beginTransaction(),t=0,n=e;t<n.length;t++)r=n[t],o=(i=r)[p.b.COLUMN_NAME_IDENTIFIER],this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[o],modelJson:i}).toPromise();return this.dbService.endTransaction(!0),[2]}))}))},e.prototype.getMetaData=function(e){return Lt(this,void 0,void 0,(function(){return jt(this,(function(t){return[2,new Promise((function(t,n){sbutility.getMetaData(e,(function(e){t(e)}),(function(e){console.error(e),n(e)}))}))]}))}))},e.prototype.updateTextBookSize=function(e){var t=this;console.log("in updateAllRootContentSize");var n="SELECT * FROM "+p.b.TABLE_NAME+" WHERE "+p.b.COLUMN_NAME_IDENTIFIER+" == "+e;return this.dbService.execute(n).pipe(Object(te.tap)((function(){return Lt(t,void 0,void 0,(function(){return jt(this,(function(e){return[2,this.sharedPreferences.putBoolean(ne.f.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL,!1).toPromise()]}))}))})),Object(te.mergeMap)((function(e){return Lt(t,void 0,void 0,(function(){var t,n=this;return jt(this,(function(r){switch(r.label){case 0:return t=[],[4,Promise.all(e.map((function(e){return Lt(n,void 0,void 0,(function(){var n,r;return jt(this,(function(i){switch(i.label){case 0:return[4,this.getSizeOnDevice(e)];case 1:return n=i.sent(),(r=JSON.parse(e[p.b.COLUMN_NAME_LOCAL_DATA]).childNodes)?[4,this.findAllChildContents(r)]:[3,3];case 2:i.sent().forEach((function(e){n+=e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]||0})),e[p.b.COLUMN_NAME_SIZE_ON_DEVICE]=n,t.push(e),i.label=3;case 3:return[2]}}))}))})))];case 1:return r.sent(),this.updateInDb(t),[2]}}))}))})),Object(te.tap)((function(){return Lt(t,void 0,void 0,(function(){return jt(this,(function(e){return[2,this.sharedPreferences.putBoolean(ne.f.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL,!0).toPromise()]}))}))})))},e}(),kt=function(){return(kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},xt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ft=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Bt=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},Vt=p.b.COLUMN_NAME_VISIBILITY,Gt=function(){function e(e,t,n,r,i,o,a,c){this.fileService=e,this.zipService=t,this.appConfig=n,this.dbService=r,this.deviceInfo=i,this.getContentDetailsHandler=o,this.eventsBusService=a,this.sharedPreferences=c}return e.prototype.execute=function(e){return xt(this,void 0,void 0,(function(){var t,n,r,i,a,c,s,u,f,l,d,h,E,b,y,v,_,S,O,g,C,m,A,T,N,I,M,w,D=this;return Ft(this,(function(P){switch(P.label){case 0:for(t=new o.Response,e.identifiers=[],n=[],r=[],i=new Map,a=new Map,s=0,this.postImportProgressEvent(s,e.items.length),u=[],f=[],l=[],d=0,h=e.items;d<h.length;d++)I=h[d],b=(E=I).identifier,y=Re.a.readVisibility(E),v=E.appIcon,Re.a.isNotUnit(E.mimeType,y)&&(f.push(b),v&&!v.startsWith("https:")&&l.push(b+"/"+v.substring(0,v.lastIndexOf("/")))),u.push(b);return _=Re.a.getContentRootDir(e.destinationFolder),e.items[0].mimeType!==q.MimeType.QUESTION_SET?[3,2]:[4,this.segregateQuestions(_,JSON.parse(JSON.stringify(e.items)))];case 1:return S=P.sent(),[3,4];case 2:return[4,this.createDirectories(_,f)];case 3:S=P.sent(),P.label=4;case 4:return[4,this.createDirectories(_,l)];case 5:return P.sent(),O=K.a.joinPreservingQuotes(u),[4,this.getContentDetailsHandler.fetchFromDBForAll(O).toPromise()];case 6:g=P.sent(),C=g.reduce((function(e,t){return e[t.identifier]=t,e}),{}),m=function(t){var o,u,f,l,d,h,E,b,y,v,_,O,g,m,T,N,I,M,w,P,R,L,j,U,k,x,F,B,V,G,Y;return Ft(this,(function(H){switch(H.label){case 0:return u=(o=t).identifier,e.skippedItemsIdentifier&&e.skippedItemsIdentifier.indexOf(u)>-1?[2,"continue"]:(f=o.mimeType,l=o.contentEncoding,d=o.contentDisposition,h=Re.a.readContentType(o),E=Re.a.readPrimaryCategory(o),b=Re.a.readVisibility(o),y=Re.a.readAudience(o),v=Re.a.readPragma(o),_=o.pkgVersion,O=o.artifactUrl,g=o.appIcon,m=o.itemSetPreviewUrl,T=o.board,N=o.medium,I=o.gradeLevel,M=o.dialcodes,w=o.childNodes,P=q.State.ONLY_SPINE.valueOf(),L=C[u],j=void 0,L&&(j=Re.a.getBasePath(L[p.b.COLUMN_NAME_PATH])),void 0,b===q.Visibility.DEFAULT.valueOf()&&u,Re.a.isNotUnit(f,b)?S[u]&&S[u].path?(R="ios"===window.device.platform.toLowerCase()?S[u].path.concat("/"):S[u].path,[3,3]):[3,1]:[3,3]);case 1:return U="ios"===window.device.platform.toLowerCase()?Re.a.getContentRootDir(e.destinationFolder).concat(u):Re.a.getContentRootDir(e.destinationFolder).concat("/",u),[4,A.fileService.createDir(U,!1).catch((function(e){throw e}))];case 2:k=H.sent(),R=k.nativeURL,H.label=3;case 3:return x=!1,(F=Re.a.doesContentExist(L,u,_,!1))&&o.status!==q.ContentStatus.DRAFT.valueOf()?(L[Vt]===q.Visibility.DEFAULT.valueOf()&&(o=JSON.parse(L[p.b.COLUMN_NAME_LOCAL_DATA])),[3,17]):[3,4];case 4:if(F=!1,!O||O.startsWith("https:"))return[3,16];if(Re.a.isInlineIdentity(d,l)||f!==q.MimeType.EPUB)return[3,8];H.label=5;case 5:return H.trys.push([5,7,,8]),[4,A.copyAssets(e.tmpLocation,O,R)];case 6:return H.sent(),x=!0,[3,8];case 7:return H.sent(),x=!1,[3,8];case 8:return d&&l&&(d!==q.ContentDisposition.INLINE.valueOf()||l!==q.ContentEncoding.GZIP.valueOf())?[3,10]:(B=e.tmpLocation.concat(O),[4,new Promise((function(e,t){D.zipService.unzip(B,{target:R},(function(){x=!0,e()}),(function(){e()}))}))]);case 9:return H.sent(),[3,16];case 10:if(!Re.a.isInlineIdentity(d,l))return[3,15];H.label=11;case 11:return H.trys.push([11,13,,14]),[4,A.copyAssets(e.tmpLocation,O,R)];case 12:return H.sent(),x=!0,[3,14];case 13:return H.sent(),x=!1,[3,14];case 14:return[3,16];case 15:q.ContentDisposition.ONLINE.valueOf()===d&&(x=!0),H.label=16;case 16:if(P=x||A.shouldDownloadQuestionSet(e.items,o)||q.MimeType.COLLECTION.valueOf()===f?q.State.ARTIFACT_AVAILABLE.valueOf():q.State.ONLY_SPINE.valueOf(),Re.a.isNotUnit(f,b))try{g.startsWith("https:")||A.copyAssets(e.tmpLocation,g,R,!0)}catch(e){}try{m.startsWith("https:")||A.copyAssets(e.tmpLocation,m,R,!1)}catch(e){}H.label=17;case 17:return V=A.getBasePath(R,F,j),b===q.Visibility.DEFAULT.valueOf()?(c=V,e.rootIdentifier=u):Re.a.isNotUnit(f,b)&&e.identifiers.push(u),G=A.getReferenceCount(L,b,e.isChildContent,e.existedContentIdentifiers),b=A.getContentVisibility(L,o.objectType,e.isChildContent,b),Re.a.addOrUpdateViralityMetadata(o,A.deviceInfo.getDeviceID().toString()),0,Re.a.isNotUnit(f,b)&&a.set(u,R),Y=A.constructContentDBModel(u,e.manifestVersion,JSON.stringify(o),f,h,b,V,G,P,y,v,0,T,N,I,M,w,E),L?A.getContentState(L,P)===q.State.ONLY_SPINE.valueOf()||x||q.MimeType.COLLECTION.valueOf()===f?r.push(Y):Y[p.b.COLUMN_NAME_CONTENT_STATE]=A.getContentState(L,P):n.push(Y),i.set(u,Y),++s%20!=0&&s!==e.items.length||A.postImportProgressEvent(s,e.items.length),[2]}}))},A=this,T=0,N=e.items,P.label=7;case 7:return T<N.length?(I=N[T],[5,m(I)]):[3,10];case 8:P.sent(),P.label=9;case 9:return T++,[3,7];case 10:if(this.updateContentDB(n,r),M=setTimeout((function(){D.updateContentFileSizeInDB(e,i,a,C)}),5e3),!c)return[3,14];P.label=11;case 11:return P.trys.push([11,13,,14]),[4,this.fileService.copyFile(e.tmpLocation,q.FileName.MANIFEST.valueOf(),c,q.FileName.MANIFEST.valueOf())];case 12:return P.sent(),[3,14];case 13:throw w=P.sent(),console.log("Exception Raised During Import"),w;case 14:return t.body=e,[2,Promise.resolve([t,M])]}}))}))},e.prototype.updateContentFileSizeInDB=function(e,t,n,r){return xt(this,void 0,void 0,(function(){var i,o,a,c,s,u,f,l,p;return Ft(this,(function(d){switch(d.label){case 0:i=[],o=0,a=e.items,d.label=1;case 1:if(!(o<a.length))return[3,6];if(c=a[o],s=c.identifier,u=t.get(s).mimeType,f=t.get(s).visibility,l=n.get(s),p=0,r[s],!Re.a.isNotUnit(u,f))return[3,5];d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this.fileService.getDirectorySize(l)];case 3:return p=d.sent(),t.get(s).size_on_device=p,i.push(t.get(s)),[3,5];case 4:return d.sent(),[3,5];case 5:return o++,[3,1];case 6:return this.updateContentDB([],i,!0),[2]}}))}))},e.prototype.updateContentDB=function(e,t,n){return xt(this,void 0,void 0,(function(){var r,i,o,a,c,s;return Ft(this,(function(u){switch(u.label){case 0:if(e=e&&e.length?this.filterQuestionSetContent(e):e,t=t&&t.length?this.filterQuestionSetContent(t):t,!e.length&&!t.length)return[3,9];this.dbService.beginTransaction(),r=0,i=e,u.label=1;case 1:return r<i.length?(c=i[r],s=c,[4,this.dbService.insert({table:p.b.TABLE_NAME,modelJson:s}).toPromise()]):[3,4];case 2:u.sent(),u.label=3;case 3:return r++,[3,1];case 4:o=0,a=t,u.label=5;case 5:return o<a.length?(c=a[o],s=c,[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[s[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:s}).toPromise()]):[3,8];case 6:u.sent(),u.label=7;case 7:return o++,[3,5];case 8:this.dbService.endTransaction(!0),u.label=9;case 9:return n&&new Ut(this.dbService,this.sharedPreferences,this.fileService).execute(),[2]}}))}))},e.prototype.copyAssets=function(e,t,n,r){return xt(this,void 0,void 0,(function(){var i,o,a=this;return Ft(this,(function(c){switch(c.label){case 0:return c.trys.push([0,7,,8]),t?(i=t.substring(0,t.lastIndexOf("/")),r?[3,2]:[4,this.fileService.createDir(n.concat(i),!1).catch((function(e){throw e}))]):[3,6];case 1:c.sent(),c.label=2;case 2:return"ios"!==window.device.platform.toLowerCase()?[3,4]:[4,this.fileService.exists(n.concat("/",t)).then((function(e){return xt(a,void 0,void 0,(function(){return Ft(this,(function(r){switch(r.label){case 0:return e?[4,this.fileService.removeFile(n.concat("/",t)).then().catch((function(e){throw e}))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})).catch((function(e){throw console.log("Error =>",e),e}))];case 3:c.sent(),c.label=4;case 4:return[4,this.fileService.copyFile(e.concat(i),ze.getFileName(t),n.concat(i),ze.getFileName(t))];case 5:c.sent(),c.label=6;case 6:return[3,8];case 7:throw o=c.sent(),console.error("Cannot Copy Asset"),o;case 8:return[2]}}))}))},e.prototype.getContentVisibility=function(e,t,n,r){var i;return"Library"===t?i=q.Visibility.PARENT.valueOf():e&&(n||q.Visibility.PARENT.valueOf()!==e[Vt])&&(i=e[Vt]),i||r},e.prototype.getContentState=function(e,t){return e&&e[p.b.COLUMN_NAME_CONTENT_STATE]>t&&(t=e[p.b.COLUMN_NAME_CONTENT_STATE]),t},e.prototype.getBasePath=function(e,t,n){return e&&!t?e:n},e.prototype.getReferenceCount=function(e,t,n,r){var i;e?(i=e[p.b.COLUMN_NAME_REF_COUNT],(r?r[e[p.b.COLUMN_NAME_IDENTIFIER]]:void 0)||n||q.Visibility.DEFAULT.valueOf()===e[Vt]&&q.Visibility.DEFAULT.valueOf()===t||(i+=1)):i=1;return i},e.prototype.postImportProgressEvent=function(e,t){this.eventsBusService.emit({namespace:H.EventNamespace.CONTENT,event:{type:q.ContentEventType.IMPORT_PROGRESS,payload:{totalCount:t,currentCount:e}}})},e.prototype.constructContentDBModel=function(e,t,n,r,i,o,a,c,s,u,f,l,d,h,E,b,y,v){var _;return(_={})[p.b.COLUMN_NAME_IDENTIFIER]=e,_[p.b.COLUMN_NAME_SERVER_DATA]="",_[p.b.COLUMN_NAME_PATH]=Re.a.getBasePath(a),_[p.b.COLUMN_NAME_REF_COUNT]=c,_[p.b.COLUMN_NAME_CONTENT_STATE]=s,_[p.b.COLUMN_NAME_SIZE_ON_DEVICE]=l,_[p.b.COLUMN_NAME_MANIFEST_VERSION]=t,_[p.b.COLUMN_NAME_LOCAL_DATA]=n,_[p.b.COLUMN_NAME_MIME_TYPE]=r,_[p.b.COLUMN_NAME_CONTENT_TYPE]=i,_[p.b.COLUMN_NAME_VISIBILITY]=o,_[p.b.COLUMN_NAME_AUDIENCE]=u,_[p.b.COLUMN_NAME_PRAGMA]=f,_[p.b.COLUMN_NAME_LOCAL_LAST_UPDATED_ON]=it(Date.now()).format(),_[p.b.COLUMN_NAME_BOARD]=Re.a.getContentAttribute(d),_[p.b.COLUMN_NAME_MEDIUM]=Re.a.getContentAttribute(h),_[p.b.COLUMN_NAME_GRADE]=Re.a.getContentAttribute(E),_[p.b.COLUMN_NAME_DIALCODES]=Re.a.getContentAttribute(b),_[p.b.COLUMN_NAME_CHILD_NODES]=Re.a.getContentAttribute(y),_[p.b.COLUMN_NAME_PRIMARY_CATEGORY]=v,_},e.prototype.createDirectories=function(e,t){return xt(this,void 0,void 0,(function(){return Ft(this,(function(n){return[2,new Promise((function(n,r){e="ios"===window.device.platform.toLowerCase()?e.concat("/"):e,sbutility.createDirectories(Re.a.getBasePath(e),t,(function(e){n(e)}),(function(e){console.error(e),r(e)}))}))]}))}))},e.prototype.filterQuestionSetContent=function(e){return e.filter((function(e){return e.mimeType!==q.MimeType.QUESTION&&e.mime_type!==q.MimeType.QUESTION}))},e.prototype.segregateQuestions=function(e,t){var n,r;return xt(this,void 0,void 0,(function(){var i,o,a,c,s,u,f,l,p,d,h;return Ft(this,(function(E){switch(E.label){case 0:for(i={},o=0;o<t.length;o++)t[o].mimeType!==q.MimeType.QUESTION_SET||i[t[o].identifier]?t[o].mimeType===q.MimeType.QUESTION&&(i[t[o].parent]?i[t[o].parent].push(t[o].identifier):i[t[o].identifier]=[t[o].identifier]):i[t[o].identifier]=[];return a=Object.keys(i),[4,this.createDirectories(e,a)];case 1:for(u in c=E.sent(),s=[],i)s.push({idArr:i[u],dir:e+"/"+u});E.label=2;case 2:E.trys.push([2,8,9,14]),f=Bt(s),E.label=3;case 3:return[4,f.next()];case 4:return(l=E.sent()).done?[3,7]:(p=l.value,[4,this.createDirectories(p.dir,p.idArr)]);case 5:d=E.sent(),c=kt(kt({},c),d),E.label=6;case 6:return[3,3];case 7:return[3,14];case 8:return h=E.sent(),n={error:h},[3,14];case 9:return E.trys.push([9,,12,13]),l&&!l.done&&(r=f.return)?[4,r.call(f)]:[3,11];case 10:E.sent(),E.label=11;case 11:return[3,13];case 12:if(n)throw n.error;return[7];case 13:return[7];case 14:return[2,c]}}))}))},e.prototype.shouldDownloadQuestionSet=function(e,t){return t.mimeType===q.MimeType.QUESTION_SET&&Re.a.readVisibility(t)===q.Visibility.DEFAULT.valueOf()||this.checkParentQustionSet(e,t)},e.prototype.checkParentQustionSet=function(e,t){if(!t||!t.parent)return!1;var n=e.find((function(e){return e.identifier===t.parent}));return!(!n||n.mimeType!==q.MimeType.QUESTION_SET)&&(n.mimeType===q.MimeType.QUESTION_SET&&Re.a.readVisibility(n)===q.Visibility.DEFAULT.valueOf()||this.checkParentQustionSet(e,n))},e}(),Yt=n(314),Ht=n.n(Yt),qt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Kt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},zt=function(){function e(e,t,n){this.dbService=e,this.deviceInfo=t,this.fileService=n,this.contentDataMap={}}return e.prototype.execute=function(e){return qt(this,void 0,void 0,(function(){var t,n,r,i,a,c=this;return Kt(this,(function(s){switch(s.label){case 0:return[4,this.fileService.readAsText(e.tmpLocation,q.FileName.MANIFEST.valueOf()).catch((function(e){throw new Error(e)}))];case 1:t=s.sent(),n=JSON.parse(t),r=n.archive,r.items.forEach((function(e){c.contentDataMap[e.identifier]=e})),i=new o.Response,s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.createnWriteManifest(e.identifiers,e.destinationFolder)];case 3:return s.sent(),i.body=e,[2,Promise.resolve(i)];case 4:return a=s.sent(),console.error(a),[2,Promise.reject(i)];case 5:return[2]}}))}))},e.prototype.createnWriteManifest=function(e,t){return qt(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u=this;return Kt(this,(function(f){switch(f.label){case 0:for(n=new ft(this.deviceInfo),r=[],i=function(e){var i=o.contentDataMap[e],a=new Ht.a;a.add(i);var c=void 0,s=[];s.push(i);for(var f=function(){if(c=a.dequeue(),Re.a.hasChildren(c)){var e=Re.a.getChildContentsIdentifiers(c);if(e&&e.length){var t=[];e.forEach((function(e){var n=u.contentDataMap[e];n&&(a.add(n),t.push(n))})),s=s.concat(t)}}};!a.isEmpty();)f();var l=n.populateItemList(s),p=n.generateManifestForArchive(l),d={};l&&l[0]&&l[0].parent&&l[0].mimeType===Ve.j.QUESTION?d.path=Re.a.getBasePath(Re.a.getContentRootDir(t).concat("/",l[0].parent,"/",e,"/")):d.path=Re.a.getBasePath(Re.a.getContentRootDir(t).concat("/",e,"/")),d.fileName=q.FileName.MANIFEST.valueOf(),d.data=JSON.stringify(p),r.push(d)},o=this,a=0,c=e;a<c.length;a++)s=c[a],i(s);return[4,this.writeFile(r)];case 1:return f.sent(),[2]}}))}))},e.prototype.writeFile=function(e){return qt(this,void 0,void 0,(function(){return Kt(this,(function(t){return[2,new Promise((function(t,n){sbutility.writeFile(e,(function(e){t()}),(function(e){console.error(e),n(e)}))}))]}))}))},e}(),Wt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Xt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Jt=function(){function e(e){this.fileService=e}return e.prototype.execute=function(e){return Wt(this,void 0,void 0,(function(){var t;return Xt(this,(function(n){switch(n.label){case 0:return t=new o.Response,[4,this.fileService.removeRecursively(e.tmpLocation).then((function(){return t.body=e,Promise.resolve(t)})).catch((function(){return Promise.reject(t)}))];case 1:return[2,n.sent()]}}))}))},e}(),Qt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},$t=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Zt=function(){function e(e){this.fileService=e}return e.prototype.execute=function(e){return Qt(this,void 0,void 0,(function(){var t;return $t(this,(function(n){switch(n.label){case 0:return t=new o.Response,[4,this.fileService.createDir(e.tmpLocationPath.concat(k.a.generateUniqueId()),!1).then((function(n){return e.tmpLocationPath=n.nativeURL,t.body=e,Promise.resolve(t)})).catch((function(){return Promise.reject(t)}))];case 1:return[2,n.sent()]}}))}))},e}(),en=function(){function e(e,t,n,r){this.apiService=e,this.contentServiceConfig=t,this.framework=n,this.langCode=r,this.SEARCH_ENDPOINT="/search"}return e.prototype.handle=function(e){var t=this.framework&&this.langCode&&"?framework="+this.framework+"&lang="+this.langCode+"&orgdetails=orgName",n=(new o.Request.Builder).withHost(this.contentServiceConfig.host).withType(o.HttpRequestType.POST).withPath(this.contentServiceConfig.searchApiPath.concat(this.SEARCH_ENDPOINT).concat(t||"")).withBearerToken(!0).withBody({request:e}).build();return this.apiService.fetch(n).pipe(Object(te.map)((function(e){return e.body})))},e}(),tn=function(){function e(e){this.telemetryService=e}return e.prototype.execute=function(e){e.metadata;for(var t=[],n=0,r=e.items;n<r.length;n++){var i=r[n],a={type:Re.a.readPrimaryCategoryServer(i),origin:Re.a.readOriginFromContentMap(i),identifier:i.identifier,pkgVersion:Number(i.pkgVersion),transferCount:Re.a.readTransferCountFromContentMap(i),size:Re.a.readSizeFromContentMap(i)};t.push(a)}var c={dir:U.ShareDirection.IN,type:U.ShareType.FILE.valueOf(),items:t,env:"sdk",correlationData:e.correlationData,objId:e.items&&e.items.length?e.items[0].identifier:"",objType:e.items&&e.items.length?Re.a.readPrimaryCategoryServer(e.items[0]):"",objVer:e.items&&e.items.length?Re.a.readPkgVersion(e.items[0])+"":"",rollUp:e.rollUp},s=new o.Response;return this.telemetryService.share(c).toPromise().then((function(){return s.body=e,Promise.resolve(s)})).catch((function(){return Promise.reject(s)}))},e}(),nn=n(37),rn=n(22),on=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},an=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},cn=function(){function e(e){this.telemetryService=e}return e.prototype.execute=function(e,t,n){return on(this,void 0,void 0,(function(){var r,i,a,c,s,u,f,l,p,d,h;return an(this,(function(E){switch(E.label){case 0:for(r=new o.Response,i=[],a=0,c=e.items;a<c.length;a++)s=c[a],{type:U.ShareItemType.CONTENT,origin:Re.a.readOriginFromContentMap(s),identifier:s.identifier,pkgVersion:Number(s.pkgVersion),transferCount:Re.a.readTransferCountFromContentMap(s),size:Re.a.readSizeFromContentMap(s)};u={dir:U.ShareDirection.OUT,type:U.ShareType.FILE.valueOf(),items:i,env:"sdk"},f=window.device.platform.toLowerCase(),l="ios"===f?rn.a.DOCUMENTS:rn.a.CACHE,E.label=1;case 1:return E.trys.push([1,7,,9]),[4,this.telemetryService.share(u).toPromise()];case 2:return E.sent(),p=void 0,n.saveLocally?(p=n.destinationFolder.concat(t),[3,5]):[3,3];case 3:return[4,nn.a.getFilePath(l)];case 4:d=E.sent(),p=d.concat(t),E.label=5;case 5:return h={exportedFilePath:p},r.body=h,[4,Promise.resolve(r)];case 6:return[2,E.sent()];case 7:return E.sent(),[4,Promise.reject(r)];case 8:return[2,E.sent()];case 9:return[2]}}))}))},e}(),sn=function(){function e(e){this.telemetryService=e}return e.prototype.execute=function(e,t){var n=e.items&&e.items.length?e.items[0].identifier:"",r=new U.TelemetryInteractRequest;r.type=U.InteractType.OTHER,r.subType=t,r.pageId="ImportContent",r.id="ImportContent",r.env="sdk",r.objId=n||e.identifier,r.objType=e.items&&e.items.length?Re.a.readPrimaryCategoryServer(e.items[0]):"",r.objVer=e.items&&e.items.length?Re.a.readPkgVersion(e.items[0])+"":"",r.correlationData=e.correlationData;var i=new o.Response;return i.body=e,this.telemetryService.interact(r).pipe(Object(te.map)((function(){return i}))).toPromise()},e}(),un=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},fn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ln=function(){function e(e){this.dbService=e}return e.prototype.getUsgaeSpace=function(e){var t="SELECT SUM("+p.b.COLUMN_NAME_SIZE_ON_DEVICE+") as total_size\n                      FROM "+p.b.TABLE_NAME+"\n                      WHERE "+p.b.COLUMN_NAME_VISIBILITY+" = '"+q.Visibility.DEFAULT.valueOf()+"'\n                      AND  "+p.b.COLUMN_NAME_PATH+" LIKE '"+e.replace("file://","")+"%'";return this.dbService.execute(t).pipe(Object(te.map)((function(e){return e[0].total_size||0})))},e.prototype.getContentUsageSummary=function(e){return un(this,void 0,void 0,(function(){var t,n,r,i,o;return fn(this,(function(a){switch(a.label){case 0:t=[],n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],[4,this.getUsgaeSpace(i).toPromise()]):[3,4];case 2:o=a.sent(),t.push({path:i,sizeOnDevice:o}),a.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},e}(),pn=n(46),dn=n.n(pn),hn=function(){function e(e,t,n){this.sharedPreferences=e,this.key=t,this.toStringFunction=n,this.changes=new M.BehaviorSubject(void 0)}return e.prototype.addAll=function(e){var t=this;return this.asSet().pipe(Object(te.mergeMap)((function(n){return e.forEach((function(e){return n.add(e)})),t.sharedPreferences.putString(t.key,JSON.stringify(n.toArray())).pipe(Object(te.mapTo)(void 0))})),Object(te.tap)((function(){return t.changes.next(void 0)})))},e.prototype.add=function(e){var t=this;return this.asSet().pipe(Object(te.mergeMap)((function(n){return n.add(e),t.sharedPreferences.putString(t.key,JSON.stringify(n.toArray())).pipe(Object(te.mapTo)(void 0))})),Object(te.tap)((function(){return t.changes.next(void 0)})))},e.prototype.clear=function(){var e=this;return this.sharedPreferences.putString(this.key,"[]").pipe(Object(te.mapTo)(void 0),Object(te.tap)((function(){return e.changes.next(void 0)})))},e.prototype.remove=function(e){var t=this;return this.asSet().pipe(Object(te.mergeMap)((function(n){var r=n.remove(e);return t.sharedPreferences.putString(t.key,JSON.stringify(n.toArray())).pipe(Object(te.mapTo)(r))})),Object(te.tap)((function(){return t.changes.next(void 0)})))},e.prototype.contains=function(e){return this.asSet().pipe(Object(te.map)((function(t){return t.contains(e)})))},e.prototype.asList=function(){return this.sharedPreferences.getString(this.key).pipe(Object(te.map)((function(e){return e?JSON.parse(e):[]})))},e.prototype.asSet=function(){var e=this;return this.asList().pipe(Object(te.map)((function(t){return t.reduce((function(e,t){return e.add(t),e}),new dn.a(e.toStringFunction))})))},e.prototype.asListChanges=function(){var e=this;return this.changes.asObservable().pipe(Object(te.mergeMap)((function(){return e.asList()})))},e}(),En=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},bn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},yn=function(){function e(){}return e.prototype.execute=function(e,t){return En(this,void 0,void 0,(function(){var n,r,i;return bn(this,(function(o){switch(o.label){case 0:return n=window.device.platform.toLowerCase(),r="ios"===n?rn.a.DOCUMENTS:rn.a.CACHE,[4,nn.a.getFilePath(r)];case 1:return i=o.sent(),[2,new Promise((function(n,r){var o;o=t.saveLocally?t.destinationFolder:i,sbutility.copyFile(ze.getDirecory(e.body.ecarFilePath),o,ze.getFileName(e.body.ecarFilePath),(function(){n(e)}),(function(e){console.error(e),n(e)}))}))]}}))}))},e}(),vn=function(){return(vn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_n=function(){function e(e,t){this.apiService=e,this.contentServiceConfig=t,this.GET_CONTENT_HEIRARCHY_ENDPOINT="/hierarchy"}return e.prototype.handle=function(e){var t=this,n=(new o.Request.Builder).withType(o.HttpRequestType.GET).withPath(this.contentServiceConfig.contentHeirarchyAPIPath+this.GET_CONTENT_HEIRARCHY_ENDPOINT+"/"+e.contentId).withBearerToken(!0).build();return this.apiService.fetch(n).pipe(Object(te.map)((function(e){return t.mapContentFromContentHeirarchyData(e.body.result.content)})))},e.prototype.mapContentFromContentHeirarchyData=function(e){var t=this;return e.contentData=vn({},e),e.children&&e.children.length&&(e.children=e.children.map((function(e){return t.mapContentFromContentHeirarchyData(vn({},e))}))),e},e}(),Sn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},On=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},gn=function(){function e(){}return e.prototype.execute=function(e){return Sn(this,void 0,void 0,(function(){var t;return On(this,(function(n){return t=new o.Response,[2,new Promise((function(n,r){var i=e.destinationFolder.concat("tmp/");sbutility.rm(i,"",(function(){t.body=e,n(t)}),(function(r){t.body=e,n(t)}))}))]}))}))},e}(),Cn=n(115),mn=n(40),An=n(57),Tn=n(68),Nn=function(){return(Nn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},In=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Mn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},wn=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},Dn=function(){function e(e,t,n,r,i,o,a,c){this.searchContentHandler=e,this.formService=t,this.contentService=n,this.cachedItemStore=r,this.courseService=i,this.profileService=o,this.apiService=a,this.networkInfoService=c}return e.buildRequestHash=function(e){return An(JSON.stringify(mn.a.withDeeplyOrderedKeys(e))).toString()},e.prototype.aggregate=function(t,n,r,i,o){var a=this;return void 0===o&&(o=!1),Object(M.defer)((function(){return In(a,void 0,void 0,(function(){var a,c,s,u,f,l=this;return Mn(this,(function(p){switch(p.label){case 0:if(!r&&!i)throw new Error("formRequest or formFields required");return a=[],r?(r.from=t.from,[4,this.formService.getForm(r).toPromise().then((function(e){return e.form.data.fields}))]):[3,2];case 1:return a=p.sent(),[3,3];case 2:i&&(a=i,o=!1),p.label=3;case 3:return a=a.filter((function(e){return-1===n.indexOf(e.dataSrc.type)})),c=a.map((function(e){return In(l,void 0,void 0,(function(){return Mn(this,(function(n){switch(n.label){case 0:if(!e.dataSrc)throw new Error("INVALID_CONFIG");switch(e.dataSrc.type){case"CONTENT_FACETS":return[3,1];case"RECENTLY_VIEWED_CONTENTS":return[3,3];case"CONTENTS":return[3,5];case"TRACKABLE_COLLECTIONS":return[3,7];case"CONTENT_DISCOVERY_BANNER":return[3,9]}return[3,11];case 1:return[4,this.buildFacetsTask(e,t)];case 2:return[2,n.sent()];case 3:return[4,this.buildRecentlyViewedTask(e,t)];case 4:return[2,n.sent()];case 5:return[4,this.buildContentSearchTask(e,t)];case 6:return[2,n.sent()];case 7:return[4,this.buildTrackableCollectionsTask(e,t)];case 8:return[2,n.sent()];case 9:return[4,this.buildContentDiscoveryBannerTask(e)];case 10:return[2,n.sent()];case 11:return console.error("UNKNOWN_DATA_SRC"),[2,{requestHash:"",task:Object(M.of)([])}];case 12:return[2]}}))}))})),[4,Promise.all(c)];case 4:return s=p.sent(),u=s.map((function(e){return e.requestHash})).join("-"),f=Object(M.defer)((function(){return In(l,void 0,void 0,(function(){var e;return Mn(this,(function(t){switch(t.label){case 0:return[4,this.networkInfoService.networkStatus$.pipe(Object(te.take)(1)).toPromise()];case 1:if(e=t.sent(),o&&e===ee.NetworkStatus.OFFLINE)throw new Error("ContentAggregator: offline request");return[2,Promise.all(s.map((function(e){return e.task.toPromise()}))).then((function(e){return e.reduce((function(e,t){return wn(e,t)}),[]).sort((function(e,t){return e.index-t.index}))}))]}}))}))})),[2,Object(M.defer)((function(){return o?l.cachedItemStore.get(u,e.CONTENT_AGGREGATION_KEY,"ttl_"+e.CONTENT_AGGREGATION_KEY,(function(){return f})):f})).pipe(Object(te.map)((function(e){return{result:e}}))).toPromise()]}}))}))}))},e.prototype.buildRecentlyViewedTask=function(t,n){return In(this,void 0,void 0,(function(){var n,r,i=this;return Mn(this,(function(o){switch(o.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return n=o.sent(),r={uid:n.managedSession?n.managedSession.uid:n.uid,primaryCategories:[],recentlyViewed:!0,limit:20},[2,{requestHash:"RECENTLY_VIEWED_CONTENTS_"+e.buildRequestHash(r),task:Object(M.defer)((function(){return In(i,void 0,void 0,(function(){var e;return Mn(this,(function(n){switch(n.label){case 0:return[4,this.contentService.getContents(r).toPromise()];case 1:return e=n.sent(),[2,t.sections.map((function(n){return{index:n.index,title:n.title,data:{name:n.index+"",sections:[{name:n.index+"",count:e.length,contents:e.map((function(e){return e.contentData.cardImg=e.contentData.appIcon,e}))}]},dataSrc:t.dataSrc,theme:n.theme,description:n.description,landingDetails:n.landingDetails,isEnabled:n.isEnabled}}))]}}))}))}))}]}}))}))},e.prototype.buildContentDiscoveryBannerTask=function(t){return In(this,void 0,void 0,(function(){var n=this;return Mn(this,(function(r){return[2,{requestHash:"CONTENT_DISCOVERY_BANNER"+e.buildRequestHash(t.dataSrc.type),task:Object(M.defer)((function(){return In(n,void 0,void 0,(function(){return Mn(this,(function(e){return[2,t.sections.map((function(e){return{index:e.index,code:e.code,title:e.title,data:t.dataSrc.values.filter((function(e){return Number(e.expiry)>Math.floor(Date.now()/1e3)})),dataSrc:t.dataSrc,theme:e.theme,description:e.description,landingDetails:e.landingDetails,isEnabled:e.isEnabled}}))]}))}))}))}]}))}))},e.prototype.buildFacetsTask=function(t,n){return In(this,void 0,void 0,(function(){var r,i,o,a=this;return Mn(this,(function(c){return t.dataSrc.values?[2,{requestHash:"",task:Object(M.defer)((function(){return In(a,void 0,void 0,(function(){return Mn(this,(function(e){return[2,t.sections.map((function(e){return{index:e.index,code:e.code,title:e.title,data:t.dataSrc.values.sort((function(e,t){return e.index-t.index})),dataSrc:t.dataSrc,theme:e.theme,description:e.description,landingDetails:e.landingDetails,isEnabled:e.isEnabled}}))]}))}))}))}]:(r=this.buildSearchRequestAndCriteria(t,n),i=r.searchRequest,(o=r.searchCriteria).facets=t.dataSrc.mapping.map((function(e){return e.facet})),i.facets=o.facets,i.limit=0,i.offset=0,[2,{requestHash:"CONTENT_FACETS_"+e.buildRequestHash(i),task:Object(M.defer)((function(){return In(a,void 0,void 0,(function(){var e;return Mn(this,(function(r){switch(r.label){case 0:return[4,this.searchContents(t,o,i)];case 1:return e=r.sent(),[2,t.sections.map((function(r,i){var a,c,s,u=null!==(a=e.filterCriteria.facetFilters)&&void 0!==a?a:[],f=[];u.map((function(e){var n,r,i=null===(r=null===(n=t.dataSrc.params)||void 0===n?void 0:n.config)||void 0===r?void 0:r.find((function(t){return t.name===e.name}));i&&i.mergeableAttributes.map((function(t){f.push(t);var n=u.find((function(e){return e.name===t}));e.values=e.values.filter((function(e){return i.values.find((function(t){return t.code===e.name.replace(/\s+/g,"").toLowerCase()}))}));var r=i.values.filter((function(e){return e.type=t}));n&&(n.values=n.values.filter((function(e){return r.find((function(t){return t.code===e.name.replace(/\s+/g,"")}))})),e.values=e.values.concat(n.values))}))}));var l=(u=u.filter((function(e){return-1===f.indexOf(e.name)}))).find((function(e){var n;return e.name===(null===(n=t.dataSrc.mapping[i])||void 0===n?void 0:n.facet)}));if(l){var p=null===(s=null===(c=t.dataSrc.params)||void 0===c?void 0:c.config)||void 0===s?void 0:s.find((function(e){return e.name===l.name}));return{index:r.index,title:r.title,code:r.code,data:l.values.map((function(e){var n,r=p?p.values.find((function(t){return t.code===e.name.replace(/\s+/g,"").toLowerCase()})):[];return{facet:(null==r?void 0:r.name)?r.name:e.name,searchCriteria:Nn(Nn({},o),{primaryCategories:[],impliedFilters:(null===(n=null==r?void 0:r.searchCriteria)||void 0===n?void 0:n.impliedFilters)?r.searchCriteria.impliedFilters:[{name:l.name,values:[{name:e.name,apply:!0}]}]}),aggregate:t.dataSrc.mapping[i].aggregate,filterPillBy:t.dataSrc.mapping[i].filterPillBy}})).sort((function(e,t){if(n.userPreferences){var r=n.userPreferences[l.name];if(!r||Array.isArray(r)&&r.indexOf(e.facet)>-1&&r.indexOf(t.facet)>-1||r===e.facet&&r===t.facet)return e.facet.localeCompare(t.facet);if(Array.isArray(r)&&r.indexOf(e.facet)>-1||r===e.facet)return-1;if(Array.isArray(r)&&r.indexOf(t.facet)>-1||r===t.facet)return 1}return e.facet.localeCompare(t.facet)})),dataSrc:t.dataSrc,theme:r.theme,description:r.description,landingDetails:r.landingDetails,isEnabled:r.isEnabled}}return{index:r.index,title:r.title,code:r.code,data:[],dataSrc:t.dataSrc,theme:r.theme,description:r.description,isEnabled:r.isEnabled}}))]}}))}))}))}])}))}))},e.prototype.buildTrackableCollectionsTask=function(t,n){return In(this,void 0,void 0,(function(){var n,r,i=this;return Mn(this,(function(a){switch(a.label){case 0:return n=this.apiService,[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return r=a.sent(),[2,{requestHash:"TRACKABLE_COLLECTIONS_"+e.buildRequestHash({userId:r.managedSession?r.managedSession.uid:r.uid}),task:Object(M.defer)((function(){return In(i,void 0,void 0,(function(){var e,i=this;return Mn(this,(function(a){switch(a.label){case 0:return[4,this.courseService.getEnrolledCourses({userId:r.managedSession?r.managedSession.uid:r.uid,returnFreshCourses:!0},new(function(){function e(){}return e.prototype.handle=function(e){var r=e.userId;t.dataSrc.request.path&&(t.dataSrc.request.path=t.dataSrc.request.path.replace("${userId}",r));var i=o.Request.fromJSON(t.dataSrc.request);return n.fetch(i).pipe(Object(te.map)((function(e){return e.body})))},e}())).toPromise()];case 1:return e=a.sent(),[2,t.sections.map((function(n,r){if(t.dataSrc.mapping[r]&&t.dataSrc.mapping[r].aggregate){var o=t.dataSrc.mapping[r].aggregate;return{index:n.index,title:n.title,data:Cn.CsContentsGroupGenerator.generate({contents:e,groupBy:o.groupBy,sortBy:o.sortBy?i.buildSortByCriteria(o.sortBy):[],filterBy:o.filterBy?i.buildFilterByCriteria(o.filterBy):[],groupSortBy:o.groupSortBy?i.buildSortByCriteria(o.groupSortBy):[],groupFilterBy:o.groupFilterBy?i.buildFilterByCriteria(o.groupFilterBy):[],includeSearchable:!1}),dataSrc:t.dataSrc,theme:n.theme,description:n.description,landingDetails:n.landingDetails,isEnabled:n.isEnabled}}return{index:n.index,title:n.title,data:{name:n.index+"",sections:[{name:n.index+"",count:e.length,contents:e}]},dataSrc:t.dataSrc,theme:n.theme,description:n.description,landingDetails:n.landingDetails,isEnabled:n.isEnabled}}))]}}))}))}))}]}}))}))},e.prototype.buildContentSearchTask=function(t,n){return In(this,void 0,void 0,(function(){var r,i,o,a=this;return Mn(this,(function(c){return r=this.buildSearchRequestAndCriteria(t,n),i=r.searchRequest,o=r.searchCriteria,[2,{requestHash:"CONTENTS_"+e.buildRequestHash(i),task:Object(M.defer)((function(){return In(a,void 0,void 0,(function(){var e,r,a,c,s=this;return Mn(this,(function(u){switch(u.label){case 0:return[4,In(s,void 0,void 0,(function(){return Mn(this,(function(e){return i.filters&&i.filters.primaryCategory||o.primaryCategories&&0===o.primaryCategories.length?[2,[]]:[2,this.contentService.getContents({primaryCategories:o.primaryCategories&&o.primaryCategories.length&&o.primaryCategories||i.filters&&i.filters.primaryCategory||[],board:o.board,medium:o.medium,grade:o.grade}).pipe(Object(te.map)((function(e){return e.map((function(e){return e.contentData.appIcon&&!e.contentData.appIcon.startsWith("https://")&&(e.contentData.appIcon=e.basePath+e.contentData.appIcon),e.contentData}))}))).toPromise()]}))}))];case 1:return e=u.sent(),[4,this.searchContents(t,o,i)];case 2:return r=u.sent(),a=(r.contentDataList||[]).filter((function(t){return!e.find((function(e){return e.identifier===t.identifier}))})),(c=e.concat(a).map((function(e){return e.cardImg=e.appIcon,e}))).sort((function(e,t){return e.lastPublishedOn>t.lastPublishedOn?-1:1})),[2,t.sections.map((function(e,a){if(t.dataSrc.mapping[a]&&t.dataSrc.mapping[a].aggregate){var u=t.dataSrc.mapping[a].aggregate,f=function(){var e=Cn.CsContentsGroupGenerator.generate({contents:c,groupBy:u.groupBy,sortBy:u.sortBy?s.buildSortByCriteria(u.sortBy):[],filterBy:u.filterBy?s.buildFilterByCriteria(u.filterBy):[],groupSortBy:u.groupSortBy?s.buildSortByCriteria(u.groupSortBy):[],groupFilterBy:u.groupFilterBy?s.buildFilterByCriteria(u.groupFilterBy):[],combination:t.dataSrc.mapping[a].applyFirstAvailableCombination&&n.applyFirstAvailableCombination,includeSearchable:!1});(n.userPreferences&&n.userPreferences[u.groupBy]&&e.sections.sort((function(e,t){return n.userPreferences[u.groupBy].indexOf(e.name.replace(/[^A-Z0-9]/gi,"").toLocaleLowerCase())>-1&&n.userPreferences[u.groupBy].indexOf(t.name.replace(/[^A-Z0-9]/gi,"").toLocaleLowerCase())>-1?e.name.localeCompare(t.name):n.userPreferences[u.groupBy].indexOf(e.name.replace(/[^A-Z0-9]/gi,"").toLocaleLowerCase())>-1?-1:n.userPreferences[u.groupBy].indexOf(t.name.replace(/[^A-Z0-9]/gi,"").toLocaleLowerCase())>-1?1:0})),e.name)&&(r.filterCriteria.facetFilters||[]).map((function(t){var n=t.name==e.name?t.values:[];return e.sections.filter((function(e){return n.some((function(t){return e.name.toLocaleLowerCase()===t.name.toLowerCase()&&(e.totalCount=t.count),e.name===t.name}))}))}));return e}();return{index:e.index,title:e.title,meta:{searchCriteria:o,filterCriteria:r.filterCriteria,searchRequest:i},data:f,dataSrc:t.dataSrc,theme:e.theme,description:e.description,landingDetails:e.landingDetails,isEnabled:e.isEnabled}}return{index:e.index,title:e.title,meta:{searchCriteria:o,filterCriteria:r.filterCriteria,searchRequest:i},data:{name:e.index+"",sections:[{count:c.length,contents:c}]},dataSrc:t.dataSrc,theme:e.theme,description:e.description,landingDetails:e.landingDetails,isEnabled:e.isEnabled}}))]}}))}))}))}]}))}))},e.prototype.buildFilterByCriteria=function(e){return e.reduce((function(e,t){return Object.keys(t).forEach((function(n){return e.push({filterAttribute:n,filterCondition:{operation:t[n].operation,value:t[n].value}})})),e}),[])},e.prototype.buildSortByCriteria=function(e){return e.reduce((function(e,t){return Object.keys(t).forEach((function(n){return e.push({sortAttribute:n,sortOrder:t[n]})})),e}),[])},e.prototype.buildSearchRequestAndCriteria=function(e,t){var n,r=this,i=function(e){return r.searchContentHandler.getSearchCriteria(e)},o=e.dataSrc.request&&e.dataSrc.request.body?Nn({filters:{}},e.dataSrc.request.body.request):{filters:{}},a=t.interceptSearchCriteria?t.interceptSearchCriteria(i({request:o})):i({request:o});return{searchRequest:(n=a,r.searchContentHandler.getSearchContentRequest(n)),searchCriteria:a}},e.prototype.searchContents=function(t,n,r){var i=this.apiService;return this.contentService.searchContent(n,void 0,new(function(){function n(){}return n.prototype.handle=function(n){if(r&&r.filters&&r.filters.mimeType){r.filters.mimeType=r.filters.mimeType.reduce((function(e,t){return Tn.MimeTypeCategoryMapping[t]?e.concat(Tn.MimeTypeCategoryMapping[t]):e.concat([t])}),[])}t.dataSrc.request&&t.dataSrc.request.body&&t.dataSrc.request.body.request?t.dataSrc.request.body={request:Nn(Nn({},t.dataSrc.request.body.request),r)}:t.dataSrc.request.body={request:r};var a=JSON.stringify(mn.a.withDeeplyOrderedKeys(t.dataSrc.request));if(e.searchContentCache.has(a))return Object(M.of)(e.searchContentCache.get(a)).pipe(Object(te.map)((function(e){return e.body})));var c=o.Request.fromJSON(t.dataSrc.request);return i.fetch(c).pipe(Object(te.tap)((function(t){e.searchContentCache.set(a,t)})),Object(te.map)((function(e){return e.body})))},n}()),!0).pipe(Object(te.catchError)((function(e){return console.error(e),Object(M.of)({id:"OFFLINE_RESPONSE_ID",responseMessageId:"OFFLINE_RESPONSE_ID",filterCriteria:n,contentDataList:[]})}))).toPromise()},e.searchContentCache=new Map,e.CONTENT_AGGREGATION_KEY="content-aggregation",e}(),Pn=n(315),Rn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ln=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},jn=function(){function e(e,t){this.storageService=e,this.fileService=t}return e.prototype.getLocallyAvailableQuestion=function(e,t){var n=this,r=this.storageService.getStorageDestinationDirectoryPath(),i=[];return e.forEach((function(e){return Rn(n,void 0,void 0,(function(){var n;return Ln(this,(function(o){switch(o.label){case 0:return[4,this.fileService.readAsText("ios"===window.device.platform.toLowerCase()?r+"/content/"+t+"/"+e:r+"content/"+t+"/"+e,"index.json").catch((function(e){throw new Error(e)}))];case 1:return n=o.sent(),i.push(n),[2]}}))}))})),Object(M.from)(Promise.all(i)).pipe(Object(te.map)((function(e){return{questions:e.map((function(e){return e&&"string"==typeof e?JSON.parse(e).archive.items[0]:e})),count:e.length}})))},e}(),Un=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},kn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},xn=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},Fn=function(){function e(e,t,n,r){this.contentService=e,this.dbService=t,this.storageService=n,this.fileService=r}return e.prototype.handle=function(e){return Un(this,void 0,void 0,(function(){var t,n,r;return kn(this,(function(i){switch(i.label){case 0:return t=this.getQuery(e),[4,this.getQuestionSetFromQuery(t)];case 1:return(n=i.sent())&&n.isAvailableLocally?[3,3]:[4,this.fetchServerChildQuestions(e)];case 2:return[2,i.sent()];case 3:if(!n.children)return[2,[]];i.label=4;case 4:r=this.storageService.getStorageDestinationDirectoryPath(),i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.fetchDBChildQuestions(n,r)];case 6:return n=i.sent(),[3,8];case 7:return i.sent(),[2,n.children];case 8:return[2,n.children]}}))}))},e.prototype.fetchDBChildQuestions=function(e,t){var n,r;return Un(this,void 0,void 0,(function(){var i,o,a,c,s,u,f,l,p,d;return kn(this,(function(h){switch(h.label){case 0:if(!e||!e.children)return[2,e];i=[],h.label=1;case 1:h.trys.push([1,19,,20]),h.label=2;case 2:h.trys.push([2,12,13,18]),o=xn(e.children),h.label=3;case 3:return[4,o.next()];case 4:return(a=h.sent()).done?[3,11]:"QuestionSet"!==(c=a.value).objectType?[3,8]:(s=void 0,u=this.getQuery(c.identifier),[4,this.getQuestionSetFromQuery(u)]);case 5:return(s=h.sent())&&s.children?[4,this.fetchDBChildQuestions(s,t)]:[3,7];case 6:s=h.sent(),i.push(s),h.label=7;case 7:return[3,10];case 8:return"Question"!==c.objectType?[3,10]:[4,this.fileService.readAsText(t+"content/"+e.identifier+"/"+c.identifier,"index.json").catch((function(e){new Error(e)}))];case 9:(f=h.sent())&&"string"==typeof f&&(l=JSON.parse(f))&&l.archive&&l.archive.items.length&&i.push(l.archive.items[0]),h.label=10;case 10:return[3,3];case 11:return[3,18];case 12:return p=h.sent(),n={error:p},[3,18];case 13:return h.trys.push([13,,16,17]),a&&!a.done&&(r=o.return)?[4,r.call(o)]:[3,15];case 14:h.sent(),h.label=15;case 15:return[3,17];case 16:if(n)throw n.error;return[7];case 17:return[7];case 18:return[3,20];case 19:throw d=h.sent(),new Error("Failed to read question: "+d);case 20:return e.children=i,[2,e]}}))}))},e.prototype.getQuery=function(e){return"SELECT * FROM "+p.b.TABLE_NAME+" WHERE ("+p.b.COLUMN_NAME_IDENTIFIER+" = '"+e+"')"},e.prototype.getQuestionSetFromQuery=function(e){return Un(this,void 0,void 0,(function(){var t,n;return kn(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.dbService.execute(e).toPromise()];case 1:return(t=r.sent())&&t.length&&t[0][p.b.COLUMN_NAME_LOCAL_DATA]?((n=JSON.parse(t[0][p.b.COLUMN_NAME_LOCAL_DATA])).isAvailableLocally=Re.a.isAvailableLocally(t[0][p.b.COLUMN_NAME_CONTENT_STATE]),[2,n]):[2,null];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},e.prototype.fetchServerChildQuestions=function(e){return Un(this,void 0,void 0,(function(){var t;return kn(this,(function(n){switch(n.label){case 0:return[4,this.contentService.getQuestionSetHierarchy(e).toPromise()];case 1:return(t=n.sent())&&t.questionset&&t.questionset.children?[2,t.questionset.children]:[2,[]]}}))}))},e}(),Bn=function(){return(Bn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Gn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Yn=function(e,t){return function(n,r){t(n,r,e)}},Hn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},qn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Kn=function(){function e(e,n,r,i,o,a,c,s,u,f,l,p,d,h,E,b,y){this.sdkConfig=e,this.apiService=n,this.dbService=r,this.profileService=i,this.fileService=o,this.zipService=a,this.deviceInfo=c,this.telemetryService=s,this.contentFeedbackService=u,this.downloadService=f,this.sharedPreferences=l,this.eventsBusService=p,this.cachedItemStore=d,this.appInfo=h,this.networkInfoService=E,this.container=b,this.storageService=y,this.contentUpdateSizeOnDeviceTimeoutRef=new Map,this.contentServiceConfig=this.sdkConfig.contentServiceConfig,this.appConfig=this.sdkConfig.appConfig,this.getContentDetailsHandler=new Be(this.contentFeedbackService,this.profileService,this.apiService,this.contentServiceConfig,this.dbService,this.eventsBusService),this.getContentHeirarchyHandler=new _n(this.apiService,this.contentServiceConfig),this.questionSetFileReadHandler=new jn(this.storageService,this.fileService),this.getChildQuestionSetHandler=new Fn(this,this.dbService,this.storageService,this.fileService),this.contentDeleteRequestSet=new hn(this.sharedPreferences,t.KEY_CONTENT_DELETE_REQUEST_LIST,(function(e){return e.contentId}))}var t;return t=e,e.prototype.onInit=function(){return this.downloadService.registerOnDownloadCompleteDelegate(this),Object(M.combineLatest)([this.handleContentDeleteRequestSetChanges(),this.handleUpdateSizeOnDeviceFail()]).pipe(Object(te.mapTo)(void 0))},e.prototype.getContentDetails=function(e){return this.getContentDetailsHandler.handle(e)},e.prototype.getContentHeirarchy=function(e){return this.getContentHeirarchyHandler.handle(e)},e.prototype.getContents=function(e){var t=this,n=(new rt).getAllLocalContentQuery(e);return this.dbService.execute(n).pipe(Object(te.mergeMap)((function(n){return Object(M.defer)((function(){return Hn(t,void 0,void 0,(function(){var t,r,i,o,a,c,s;return qn(this,(function(u){switch(u.label){case 0:t=[],r=0,i=n,u.label=1;case 1:return r<i.length?(o=i[r],a=Pe.a.mapContentDBEntryToContent(o),[4,this.getContentDetailsHandler.decorateContent({content:a,attachContentAccess:e.attachContentAccess,attachContentMarker:e.attachContentAccess,attachFeedback:e.attachFeedback}).toPromise()]):[3,4];case 2:a=u.sent(),t.push(a),u.label=3;case 3:return r++,[3,1];case 4:return e.resourcesOnly?(c=e.uid,s="SELECT * FROM "+p.d.TABLE_NAME+"\n                                                    WHERE UID IN ("+K.a.joinPreservingQuotes(c)+")",[4,this.dbService.execute(s).toPromise()]):[3,6];case 5:u.sent().forEach((function(e){var n={identifier:e[p.d.COLUMN_NAME_CONTENT_IDENTIFIER],name:"",contentData:e[p.d.COLUMN_NAME_DATA]&&JSON.parse(e[p.d.COLUMN_NAME_DATA]),isUpdateAvailable:!1,mimeType:"",basePath:"",contentType:"",primaryCategory:"",isAvailableLocally:!1,referenceCount:0,sizeOnDevice:0,lastUsedTime:0,lastUpdatedTime:0};t.push(n)})),u.label=6;case 6:return[2,t]}}))}))}))})))},e.prototype.cancelImport=function(e){return this.downloadService.cancel({identifier:e})},e.prototype.deleteContent=function(e){var t=this;return Object(M.defer)((function(){return Hn(t,void 0,void 0,(function(){var t,n,r,i,o,a,c=this;return qn(this,(function(s){switch(s.label){case 0:e.contentDeleteList.forEach((function(e){var t=c.contentUpdateSizeOnDeviceTimeoutRef.get(e.contentId);t&&(clearTimeout(t),c.contentUpdateSizeOnDeviceTimeoutRef.delete(e.contentId))})),t=[],n=new Je(this.dbService,this.fileService,this.sharedPreferences),r=0,i=e.contentDeleteList,s.label=1;case 1:return r<i.length?(o=i[r],[4,this.getContentDetailsHandler.fetchFromDB(o.contentId).toPromise()]):[3,8];case 2:return(a=s.sent())?(t.push({identifier:o.contentId,status:q.ContentDeleteStatus.DELETED_SUCCESSFULLY}),Re.a.hasChildren(a[p.b.COLUMN_NAME_LOCAL_DATA])?[4,n.deleteAllChildren(a,o.isChildContent)]:[3,4]):[3,6];case 3:s.sent(),s.label=4;case 4:return[4,n.deleteOrUpdateContent(a,!1,o.isChildContent)];case 5:return s.sent(),[3,7];case 6:t.push({identifier:o.contentId,status:q.ContentDeleteStatus.NOT_FOUND}),s.label=7;case 7:return r++,[3,1];case 8:return new Ut(this.dbService,this.sharedPreferences,this.fileService).execute(),[2,t]}}))}))})).pipe(Object(te.tap)((function(){return e.contentDeleteList.forEach((function(e){t.downloadService.onContentDelete(e.contentId)}))})))},e.prototype.enqueueContentDelete=function(e){return this.contentDeleteRequestSet.addAll(e.contentDeleteList)},e.prototype.clearContentDeleteQueue=function(){return this.contentDeleteRequestSet.clear()},e.prototype.getContentDeleteQueue=function(){return this.contentDeleteRequestSet.asListChanges()},e.prototype.exportContent=function(e){var t=this,n=new ft(this.deviceInfo,this.dbService,this.fileService);return Object(M.from)(n.getContentExportDBModelToExport(e.contentIds).then((function(r){return Hn(t,void 0,void 0,(function(){var t=this;return qn(this,(function(i){switch(i.label){case 0:return[4,this.fileService.getTempLocation(e.destinationFolder).then((function(n){var i={},o=Re.a.getExportedFileName(r,t.appInfo.getAppName());i.content_count=r.length;var a={metadata:i,ecarFilePath:n.nativeURL.concat(o),destinationFolder:e.destinationFolder,contentModelsToExport:r,tmpLocationPath:n.nativeURL,subContentIds:e.subContentIds};return new Zt(t.fileService).execute(a)})).then((function(e){return new lt(t.dbService,n).execute(e.body)})).then((function(e){return new ht(t.fileService,t.deviceInfo).execute(e.body)})).then((function(e){return new yt(t.zipService).execute(e.body)})).then((function(e){return new St(t.fileService).execute(e.body)})).then((function(e){return(new Ct).execute(e.body)})).then((function(e){return new Tt(t.fileService,t.zipService).execute(e.body)})).then((function(t){return(new yn).execute(t,e)})).then((function(e){return(new gn).execute(e.body)})).then((function(n){var i=Re.a.getExportedFileName(r,t.appInfo.getAppName());return new cn(t.telemetryService).execute(n.body,i,e)})).then((function(e){return e.body})).catch((function(e){throw new Error(e)}))];case 1:return[2,i.sent()]}}))}))})))},e.prototype.getChildContents=function(e){var t=this;e.level||(e.level=-1);var n=new Ke(this.dbService,this.getContentDetailsHandler,this.appConfig),r=e.hierarchyInfo;if(r){if(r.length>0&&r[r.length-1].identifier===e.contentId){var i=r.length;r.splice(i-1,1)}}else r=[];return this.dbService.read(Be.getReadContentQuery(e.contentId)).pipe(Object(te.mergeMap)((function(i){return Hn(t,void 0,void 0,(function(){var t,o,a,c;return qn(this,(function(s){switch(s.label){case 0:return t=new Map,o=JSON.parse(i[0][p.b.COLUMN_NAME_LOCAL_DATA]),a=o.childNodes,console.log("childIdentifiers",a),a?(c="SELECT * FROM "+p.b.TABLE_NAME+"\n                                WHERE "+p.b.COLUMN_NAME_IDENTIFIER+"\n                                IN ("+K.a.joinPreservingQuotes(a)+")",[4,this.dbService.execute(c).toPromise()]):[3,2];case 1:s.sent().forEach((function(e){t.set(e.identifier,e)})),s.label=2;case 2:return[2,n.fetchChildrenOfContent(i[0],t,0,e.level,r)]}}))}))})))},e.prototype.getDownloadState=function(){throw new Error("Not Implemented yet")},e.prototype.importContent=function(e){var t=this,n=new nt(this.appConfig,this.contentServiceConfig,this.telemetryService),r=K.a.deDupe(e.contentImportArray.map((function(e){return e.contentId}))),i=n.getContentSearchFilter(r,e.contentStatusArray,e.fields);return new en(this.apiService,this.contentServiceConfig).handle(i).pipe(Object(te.map)((function(e){return e.result.content&&e.result.content.length&&e.result.QuestionSet&&e.result.QuestionSet.length?e.result.content.concat(e.result.QuestionSet):e.result.content||e.result.QuestionSet})),Object(te.mergeMap)((function(i){return Object(M.defer)((function(){return Hn(t,void 0,void 0,(function(){var t,o,a,c,s,u;return qn(this,(function(f){switch(f.label){case 0:if(t=[],!i||!i.length)return[3,5];o=[],a=function(r){var a,c,s,u,f;return qn(this,(function(l){switch(l.label){case 0:return(a=i.find((function(e){return e.identifier===r})))?(c=e.contentImportArray.find((function(e){return e.contentId===r})),[4,n.getDownloadUrl(a,c)]):[3,2];case 1:s=l.sent(),u=q.ContentImportStatus.NOT_FOUND,s&&ze.getFileExtension(s)===q.FileExtension.CONTENT.valueOf()&&(u=q.ContentImportStatus.ENQUEUED_FOR_DOWNLOAD,f={identifier:r,downloadUrl:s,mimeType:q.MimeType.ECAR,destinationFolder:c.destinationFolder,isChildContent:c.isChildContent,filename:r.concat(".",q.FileExtension.CONTENT),correlationData:c.correlationData,rollUp:c.rollUp,contentMeta:a,withPriority:e.withPriority||(a.mimeType===q.MimeType.COLLECTION.valueOf()?1:0),title:a.name?a.name.concat(".",q.FileExtension.CONTENT):r.concat(".",q.FileExtension.CONTENT)},o.push(f)),t.push({identifier:r,status:u}),l.label=2;case 2:return[2]}}))},c=0,s=r,f.label=1;case 1:return c<s.length?(u=s[c],[5,a(u)]):[3,4];case 2:f.sent(),f.label=3;case 3:return c++,[3,1];case 4:this.downloadService.download(o).toPromise().then(),f.label=5;case 5:return[2,t]}}))}))}))})))},e.prototype.importEcar=function(e){var t=this;return Object(M.from)(this.fileService.exists(e.sourceFilePath).then((function(n){return Hn(t,void 0,void 0,(function(){var t,n,r,i,a,c,s,u,f,l,p,d;return qn(this,(function(h){switch(h.label){case 0:return t={isChildContent:e.isChildContent,ecarFilePath:e.sourceFilePath,destinationFolder:e.destinationFolder,skippedItemsIdentifier:[],items:[],contentImportResponseList:[],correlationData:e.correlationData||[],rollUp:e.rollUp||new U.Rollup,contentIdsToDelete:new Set,identifier:e.identifier},[4,new sn(this.telemetryService).execute(t,"ContentImport-Initiated")];case 1:return h.sent(),[4,this.fileService.getTempLocation(e.destinationFolder)];case 2:return n=h.sent(),t.tmpLocation=n.nativeURL,[4,new Mt(this.fileService,this.zipService).execute(t)];case 3:return r=h.sent(),[4,new Rt(this.fileService,this.dbService,this.appConfig,this.getContentDetailsHandler).execute(r.body)];case 4:return i=h.sent(),[4,new Gt(this.fileService,this.zipService,this.appConfig,this.dbService,this.deviceInfo,this.getContentDetailsHandler,this.eventsBusService,this.sharedPreferences).execute(i.body)];case 5:return a=h.sent(),c=a[0],s=a[1],this.contentUpdateSizeOnDeviceTimeoutRef.set(t.rootIdentifier?t.rootIdentifier:t.identifiers[0],s),this.eventsBusService.emit({namespace:H.EventNamespace.CONTENT,event:{type:q.ContentEventType.CONTENT_EXTRACT_COMPLETED,payload:{contentId:t.rootIdentifier?t.rootIdentifier:t.identifiers[0]}}}),new o.Response,[4,new zt(this.dbService,this.deviceInfo,this.fileService).execute(c.body)];case 6:return u=h.sent(),[4,new Jt(this.fileService).execute(u.body)];case 7:h.sent(),f=new o.Response,h.label=8;case 8:return h.trys.push([8,11,,13]),[4,this.cleanupContent(t).toPromise()];case 9:return h.sent(),f.body=t,[4,Promise.resolve(f)];case 10:return l=h.sent(),[3,13];case 11:return h.sent(),[4,Promise.reject(f)];case 12:return l=h.sent(),[3,13];case 13:return[4,new tn(this.telemetryService).execute(l.body)];case 14:return p=h.sent(),[4,new sn(this.telemetryService).execute(p.body,"ContentImport-Success")];case 15:return d=h.sent(),this.eventsBusService.emit({namespace:H.EventNamespace.CONTENT,event:{type:q.ContentEventType.IMPORT_COMPLETED,payload:{contentId:t.rootIdentifier?t.rootIdentifier:t.identifiers[0]}}}),[2,d.body.contentImportResponseList]}}))}))})).catch((function(e){return console.log("error",e),[{identifier:"",status:q.ContentImportStatus.NOT_FOUND}]})))},e.prototype.nextContent=function(e,t,n){var r=this,i=new Ke(this.dbService,this.getContentDetailsHandler,this.appConfig);return this.dbService.read(Be.getReadContentQuery(e[0].identifier)).pipe(Object(te.mergeMap)((function(o){return Hn(r,void 0,void 0,(function(){var r,a;return qn(this,(function(c){switch(c.label){case 0:return[4,i.getContentsKeyList(o[0])];case 1:return r=c.sent(),a=i.getNextContentIdentifier(e,t,r),[2,i.getContentFromDB(e,a,n)]}}))}))})))},e.prototype.prevContent=function(e,t,n){var r=this,i=new Ke(this.dbService,this.getContentDetailsHandler,this.appConfig);return this.dbService.read(Be.getReadContentQuery(e[0].identifier)).pipe(Object(te.mergeMap)((function(o){return Hn(r,void 0,void 0,(function(){var r,a;return qn(this,(function(c){switch(c.label){case 0:return[4,i.getContentsKeyList(o[0])];case 1:return r=c.sent(),a=i.getPreviousContentIdentifier(e,t,r),[2,i.getContentFromDB(e,a,n)]}}))}))})))},e.prototype.getRelevantContent=function(e){var t=this,n={};return Object(M.of)(n).pipe(Object(te.mergeMap)((function(r){return e.next?t.nextContent(e.hierarchyInfo,e.contentIdentifier,e.shouldConvertBasePath).pipe(Object(te.map)((function(e){return n.nextContent=e,n}))):Object(M.of)(n)})),Object(te.mergeMap)((function(r){return e.prev?t.prevContent(e.hierarchyInfo,e.contentIdentifier,e.shouldConvertBasePath).pipe(Object(te.map)((function(e){return n.previousContent=e,n}))):Object(M.of)(n)})),Object(te.map)((function(e){var t={};return t.next=e.nextContent?{content:e.nextContent}:void 0,t.prev=e.previousContent?{content:e.previousContent}:void 0,t})))},e.prototype.subscribeForImportStatus=function(e){throw new Error("Not Implemented yet")},e.prototype.searchContent=function(e,t,n,r){var i=this;if((e=JSON.parse(JSON.stringify(e))).facetFilters){var o=e.facetFilters.find((function(e){return"mimeType"===e.name}));o&&(o.values=o.values.filter((function(e){return e.apply})).reduce((function(e,t){return e=e.concat(t.values.map((function(e){return Bn(Bn({},e),{apply:!0})})))}),[]))}var a=new nt(this.appConfig,this.contentServiceConfig,this.telemetryService),c=e.languageCode;t?(e=a.getSearchCriteria(t),c&&(e.languageCode=c)):(e.limit=e.limit?e.limit:100,e.offset=e.offset?e.offset:0);var s=a.getSearchContentRequest(e);return this.sharedPreferences.getString(ne.j.KEY_ACTIVE_CHANNEL_ACTIVE_FRAMEWORK_ID).pipe(Object(te.mergeMap)((function(t){return n||(n=new en(i.apiService,i.contentServiceConfig,t,e.languageCode)),n.handle(s).pipe(Object(te.map)((function(t){return e.facetFilters||e.searchType!==q.SearchType.SEARCH||(r||(s.filters.contentType=[],s.filters.primaryCategory=[]),s.filters.audience=[]),a.mapSearchResponse(e,t,s)})),Object(te.map)((function(t){if(!t.filterCriteria.facetFilters)return t;var n=t.filterCriteria.facetFilters.find((function(e){return"mimeType"===e.name}));return n&&(n.values=Pn.CsMimeTypeFacetToMimeTypeCategoryAggregator.aggregate(n.values,"filter"===e.searchType?[Tn.MimeTypeCategory.ALL]:[])),t})))})))},e.prototype.cancelDownload=function(e){return this.downloadService.cancel({identifier:e})},e.prototype.setContentMarker=function(e){var t=this,n="SELECT * FROM "+p.d.TABLE_NAME+"\n                       WHERE "+p.d.COLUMN_NAME_UID+" = '"+e.uid+"'\n                       AND "+p.d.COLUMN_NAME_CONTENT_IDENTIFIER+"='"+e.contentId+"'\n                       AND "+p.d.COLUMN_NAME_MARKER+" = "+e.marker;return this.dbService.execute(n).pipe(Object(te.mergeMap)((function(n){var r={uid:e.uid,identifier:e.contentId,epoch_timestamp:Date.now(),data:e.data,extra_info:JSON.stringify(e.extraInfo),marker:e.marker.valueOf(),mime_type:t.getMimeType(e.data)};return K.a.isEmpty(n)?t.dbService.insert({table:p.d.TABLE_NAME,modelJson:r}).pipe(Object(te.map)((function(e){return e>0}))):e.isMarked?t.dbService.update({table:p.d.TABLE_NAME,selection:p.d.COLUMN_NAME_UID+"= ? AND "+p.d.COLUMN_NAME_CONTENT_IDENTIFIER+"= ? AND "+p.d.COLUMN_NAME_MARKER+"= ?",selectionArgs:[e.uid,e.contentId,e.marker.valueOf().toString()],modelJson:r}).pipe(Object(te.map)((function(e){return e>0}))):t.dbService.delete({table:p.d.TABLE_NAME,selection:p.d.COLUMN_NAME_UID+" = ? AND "+p.d.COLUMN_NAME_CONTENT_IDENTIFIER+" = ? AND "+p.d.COLUMN_NAME_MARKER+" = ?",selectionArgs:[e.uid,e.contentId,""+e.marker]}).pipe(Object(te.map)((function(e){return e})))})))},e.prototype.onDownloadCompletion=function(e){var t=this,n={isChildContent:e.isChildContent,sourceFilePath:e.downloadedFilePath,destinationFolder:e.destinationFolder,correlationData:e.correlationData,rollUp:e.rollUp,identifier:e.identifier};return this.importEcar(n).pipe(Object(te.mergeMap)((function(){return t.downloadService.cancel({identifier:e.identifier},!1)})),Object(te.catchError)((function(){return t.downloadService.cancel({identifier:e.identifier},!1)})),Object(te.mapTo)(void 0))},e.prototype.getContentSpaceUsageSummary=function(e){var t=new ln(this.dbService);return Object(M.from)(t.getContentUsageSummary(e.paths))},e.prototype.buildContentAggregator=function(e,t,n){return new Dn(new nt(this.appConfig,this.contentServiceConfig,this.telemetryService),e,this,this.cachedItemStore,t,n,this.apiService,this.networkInfoService)},e.prototype.getQuestionList=function(e,t){var n=this;return this.getContentDetails({contentId:t,objectType:"QuestionSet"}).pipe(Object(te.switchMap)((function(r){return r.isAvailableLocally&&t?n.questionSetFileReadHandler.getLocallyAvailableQuestion(e,t):n.contentServiceDelegate.getQuestionList(e)})),Object(te.catchError)((function(t){return n.contentServiceDelegate.getQuestionList(e)})))},e.prototype.getQuestionSetHierarchy=function(e){return this.contentServiceDelegate.getQuestionSetHierarchy(e)},e.prototype.getQuestionSetRead=function(e,t){return this.contentServiceDelegate.getQuestionSetRead(e,t)},e.prototype.getQuestionSetChildren=function(e){return Hn(this,void 0,void 0,(function(){return qn(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getChildQuestionSetHandler.handle(e)];case 1:return[2,t.sent()];case 2:return t.sent(),[2,[]];case 3:return[2]}}))}))},e.prototype.formatSearchCriteria=function(e){return new nt(this.appConfig,this.contentServiceConfig,this.telemetryService).getSearchCriteria(e)},e.prototype.cleanupContent=function(e){for(var t=[],n=0,r=Array.from(e.contentIdsToDelete.values());n<r.length;n++){var i={contentId:r[n],isChildContent:!1};t.push(i)}return this.deleteContent({contentDeleteList:t}).pipe(Object(te.mapTo)(void 0))},e.prototype.getMimeType=function(e){var t="";e&&(t=JSON.parse(e).mimeType);return t},e.prototype.handleContentDeleteRequestSetChanges=function(){var e=this;return this.contentDeleteRequestSet.asListChanges().pipe(Object(te.mergeMap)((function(t){var n=t[0];return n?e.deleteContent({contentDeleteList:[n]}).pipe(Object(te.mergeMap)((function(){return e.contentDeleteRequestSet.remove(n)})),Object(te.mapTo)(void 0)):Object(M.of)(void 0)})))},e.prototype.handleUpdateSizeOnDeviceFail=function(){var e=this;return this.sharedPreferences.getBoolean(t.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL).pipe(Object(te.mergeMap)((function(t){return t?Object(M.of)(void 0):Object(M.from)(new Ut(e.dbService,e.sharedPreferences,e.fileService).execute()).pipe(Object(te.mapTo)(void 0))})))},Object.defineProperty(e.prototype,"contentServiceDelegate",{get:function(){return this.container.get(I.a.CONTENT_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.downloadTranscriptFile=function(e){return Hn(this,void 0,void 0,(function(){var n,r,i,o,a,c=this;return qn(this,(function(s){switch(s.label){case 0:return n=window.device.platform.toLowerCase(),r="ios"===n?rn.a.DOCUMENTS:rn.a.DATA,[4,nn.a.getFilePath(r)];case 1:return i=s.sent(),i="ios"===n?i:i+t.DOWNLOAD_DIR_NAME,[4,this.createTranscriptDir(e,i)];case 2:return s.sent(),o={uri:e.downloadUrl,title:e.fileName,description:"",mimeType:"",visibleInDownloadsUi:!0,notificationVisibility:1,destinationInExternalPublicDir:{dirType:"Download",subPath:e.fileName},headers:[],destinationUri:e.destinationUrl},[4,this.downloadTranscript(o).toPromise()];case 3:return(a=s.sent())&&a.path?(this.copyFile(a.path.split(/\/(?=[^\/]+$)/)[0],i.concat("/"+e.identifier),e.fileName).then((function(){c.deleteFolder(a.path)})),[2,a.path]):[2]}}))}))},e.prototype.createTranscriptDir=function(e,t){return Hn(this,void 0,void 0,(function(){return qn(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,5]),[4,this.fileService.exists(t.concat("/"+e.identifier,!1))];case 1:return[2,n.sent().nativeURL];case 2:return n.sent(),[4,this.fileService.createDir(t,!1).catch((function(){throw new Error("Error creating directory")}))];case 3:return n.sent(),[4,this.fileService.createDir(t.concat("/"+e.identifier),!1).then((function(e){return e.nativeURL})).catch((function(){throw new Error("Error creating directory")}))];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.downloadTranscript=function(e){return new M.Observable((function(t){downloadManager.enqueue(e,(function(e,n){if(e)return t.error(e);t.next(n),t.complete()}))})).pipe(Object(te.mergeMap)((function(e){return Object(M.interval)(1e3).pipe(Object(te.mergeMap)((function(){return new M.Observable((function(t){downloadManager.query({ids:[e]},(function(e,n){return e||16===n[0].status?t.error(e||new Error("Unknown Error")):t.next(n[0])}))}))})),Object(te.filter)((function(e){return 8===e.status})),Object(te.take)(1))})),Object(te.map)((function(e){return{path:e.localUri}})))},e.prototype.copyFile=function(e,t,n){return Hn(this,void 0,void 0,(function(){return qn(this,(function(r){return[2,new Promise((function(r,i){sbutility.copyFile(e,t,n,(function(){r()}),(function(e){console.error(e),r(e)}))}))]}))}))},e.prototype.deleteFolder=function(e){return Hn(this,void 0,void 0,(function(){return qn(this,(function(t){return e?[2,new Promise((function(t,n){sbutility.rm(e,"",(function(){t()}),(function(e){n(e)}))}))]:[2]}))}))},e.DOWNLOAD_DIR_NAME="transcript",e.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL=ne.f.KEY_IS_UPDATE_SIZE_ON_DEVICE_SUCCESSFUL,e.KEY_CONTENT_DELETE_REQUEST_LIST=ne.f.KEY_CONTENT_DELETE_REQUEST_LIST,e=t=Vn([Object(N.injectable)(),Yn(0,Object(N.inject)(I.b.SDK_CONFIG)),Yn(1,Object(N.inject)(I.b.API_SERVICE)),Yn(2,Object(N.inject)(I.b.DB_SERVICE)),Yn(3,Object(N.inject)(I.b.PROFILE_SERVICE)),Yn(4,Object(N.inject)(I.b.FILE_SERVICE)),Yn(5,Object(N.inject)(I.b.ZIP_SERVICE)),Yn(6,Object(N.inject)(I.b.DEVICE_INFO)),Yn(7,Object(N.inject)(I.b.TELEMETRY_SERVICE)),Yn(8,Object(N.inject)(I.b.CONTENT_FEEDBACK_SERVICE)),Yn(9,Object(N.inject)(I.b.DOWNLOAD_SERVICE)),Yn(10,Object(N.inject)(I.b.SHARED_PREFERENCES)),Yn(11,Object(N.inject)(I.b.EVENTS_BUS_SERVICE)),Yn(12,Object(N.inject)(I.b.CACHED_ITEM_STORE)),Yn(13,Object(N.inject)(I.b.APP_INFO)),Yn(14,Object(N.inject)(I.b.NETWORKINFO_SERVICE)),Yn(15,Object(N.inject)(I.b.CONTAINER)),Yn(16,Object(N.inject)(I.b.STORAGE_SERVICE)),Gn("design:paramtypes",[Object,Object,a.DbService,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,Object,N.Container,Object])],e)}(),zn=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Wn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xn=function(e,t){return function(n,r){t(n,r,e)}},Jn=function(){function e(e){this.dbService=e}return e.prototype.getValue=function(e){return this.dbService.read({table:E.a.TABLE_NAME,columns:[],selection:E.a.COLUMN_NAME_KEY+" = ?",selectionArgs:[e]}).pipe(Object(te.map)((function(e){return e[0]&&e[0].value})))},e.prototype.setValue=function(e,t){var n=this;return this.getValue(e).pipe(Object(te.mergeMap)((function(r){var i,o;return r?n.dbService.update({table:E.a.TABLE_NAME,selection:E.a.COLUMN_NAME_KEY+" = ?",selectionArgs:[e],modelJson:(i={},i[E.a.COLUMN_NAME_KEY]=e,i[E.a.COLUMN_NAME_VALUE]=t,i)}).pipe(Object(te.map)((function(e){return e>0}))):n.dbService.insert({table:E.a.TABLE_NAME,modelJson:(o={},o[E.a.COLUMN_NAME_KEY]=e,o[E.a.COLUMN_NAME_VALUE]=t,o)}).pipe(Object(te.map)((function(e){return e>0})))})))},e=zn([Object(N.injectable)(),Xn(0,Object(N.inject)(I.b.DB_SERVICE)),Wn("design:paramtypes",[a.DbService])],e)}(),Qn=n(21),$n=n(47),Zn=function(){function e(e,t,n,r){this.apiService=e,this.formServiceConfig=t,this.fileService=n,this.cachedItemStore=r,this.FORM_FILE_KEY_PREFIX="form-",this.FORM_LOCAL_KEY="form-",this.GET_FORM_DETAILS_ENDPOINT="/read"}return e.getIdForRequest=function(e){var t=e.type+"_"+e.subType+"_"+e.action;return e.rootOrgId&&"*"!==e.rootOrgId&&(t+="_"+e.rootOrgId),e.framework&&(t+="_"+e.framework),e.component&&(t+="_"+e.component),t},e.prototype.handle=function(t){var n=this;return this.cachedItemStore[t.from===Qn.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](e.getIdForRequest(t),this.FORM_LOCAL_KEY,"ttl_"+this.FORM_LOCAL_KEY,(function(){return n.fetchFormServer(t)}),(function(){return n.fetchFromFile(t)}))},e.prototype.fetchFormServer=function(e){var t=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(this.formServiceConfig.apiPath+this.GET_FORM_DETAILS_ENDPOINT).withBearerToken(!0).withHeaders({"X-Platform-Id":window.device.platform}).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(te.map)((function(e){return e.body.result})))},e.prototype.fetchFromFile=function(t){var n=this;return Object(M.defer)((function(){return $n.a.getAssetPath()})).pipe(Object(te.switchMap)((function(r){var i=r+n.formServiceConfig.formConfigDirPath+"/"+(n.FORM_FILE_KEY_PREFIX+e.getIdForRequest(t)+".json");return Object(M.from)(n.fileService.readFileFromAssets(i)).pipe(Object(te.map)((function(e){return JSON.parse(e).result})))})),Object(te.catchError)((function(e){return console.error("Error fetching form from file:",e),function(e){return Object(M.throwError)(e)}(e)})))},e}();var er,tr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},nr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},rr=function(e,t){return function(n,r){t(n,r,e)}},ir=function(){function e(e,t,n,r){this.sdkConfig=e,this.apiService=t,this.fileService=n,this.cachedItemStore=r,this.formServiceConfig=this.sdkConfig.formServiceConfig}return e.prototype.getForm=function(e){return new Zn(this.apiService,this.formServiceConfig,this.fileService,this.cachedItemStore).handle(e)},e=tr([Object(N.injectable)(),rr(0,Object(N.inject)(I.b.SDK_CONFIG)),rr(1,Object(N.inject)(I.b.API_SERVICE)),rr(2,Object(N.inject)(I.b.FILE_SERVICE)),rr(3,Object(N.inject)(I.b.CACHED_ITEM_STORE)),nr("design:paramtypes",[Object,Object,Object,Object])],e)}(),or=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cr=function(e,t){return function(n,r){t(n,r,e)}},sr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ur=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},fr=function(){function e(e,t,n){this.sdkConfig=e,this.keyValueStore=t,this.sharedPreferences=n,this.apiConfig=this.sdkConfig.apiConfig}var t;return t=e,e.isItemEmpty=function(e){return!(!Array.isArray(e)||0!==e.length)||"object"==typeof e&&0===Object.keys(e).length},e.prototype.get=function(e,t,n,r,i,o,a){var c=this;return r().pipe(Object(te.tap)((function(r){c.saveItemTTL(e,n).toPromise(),c.saveItemToDb(e,t,r).toPromise()})),Object(te.catchError)((function(){return c.getCached(e,t,n,r,i,o,a)})))},e.prototype.getCached=function(e,t,n,r,i,o,a){var c=this;return this.isItemCachedInDb(n,e).pipe(Object(te.mergeMap)((function(s){return s?c.isItemTTLExpired(n,e,isNaN(o)?c.apiConfig.cached_requests.timeToLive:o).pipe(Object(te.mergeMap)((function(i){return i?c.keyValueStore.getValue(t+"-"+e).pipe(Object(te.map)((function(e){return JSON.parse(e)})),Object(te.tap)((function(){return sr(c,void 0,void 0,(function(){var i,o=this;return ur(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,r().pipe(Object(te.switchMap)((function(r){return o.saveItem(e,n,t,r,a)}))).toPromise()];case 1:return c.sent(),[3,3];case 2:return i=c.sent(),console.error(i),[3,3];case 3:return[2]}}))}))}))):c.keyValueStore.getValue(t+"-"+e).pipe(Object(te.map)((function(e){return JSON.parse(e)})))}))):i?i().pipe(Object(te.switchMap)((function(r){return c.saveItem(e,n,t,r,a)})),Object(te.catchError)((function(i){return r().pipe(Object(te.switchMap)((function(r){return c.saveItem(e,n,t,r,a)})))}))):r().pipe(Object(te.switchMap)((function(r){return c.saveItem(e,n,t,r,a)})))})))},e.prototype.isItemCachedInDb=function(e,t){return this.sharedPreferences.getString(e+"-"+t).pipe(Object(te.mergeMap)((function(e){return Object(M.iif)((function(){return!!e}),Object(M.defer)((function(){return Object(M.of)(!0)})),Object(M.defer)((function(){return Object(M.of)(!1)})))})))},e.prototype.isItemTTLExpired=function(e,t,n){return this.sharedPreferences.getString(e+"-"+t).pipe(Object(te.map)((function(e){var t=Number(e);return!(Date.now()-t<n)})))},e.prototype.saveItem=function(e,n,r,i,o){return t.isItemEmpty(i)||o&&o(i)?Object(M.of)(i):Object(M.zip)(this.saveItemTTL(e,n),this.saveItemToDb(e,r,i)).pipe(Object(te.switchMap)((function(){return Object(M.of)(i)})))},e.prototype.saveItemTTL=function(e,t){return this.sharedPreferences.putString(t+"-"+e,Date.now()+"").pipe(Object(te.mergeMap)((function(e){return Object(M.of)(!0)})))},e.prototype.saveItemToDb=function(e,t,n){return this.keyValueStore.setValue(t+"-"+e,JSON.stringify(n))},e=t=or([Object(N.injectable)(),cr(0,Object(N.inject)(I.b.SDK_CONFIG)),cr(1,Object(N.inject)(I.b.KEY_VALUE_STORE)),cr(2,Object(N.inject)(I.b.SHARED_PREFERENCES)),ar("design:paramtypes",[Object,Object,Object])],e)}(),lr=n(61),pr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},dr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},hr=function(){function e(e,t,n,r,i,o,a,c){this.apiService=e,this.pageApiServiceConfig=t,this.sharedPreferences=n,this.cachedItemStore=r,this.keyValueStore=i,this.authService=o,this.profileService=a,this.systemSettingsService=c,this.PAGE_ASSEMBLE_LOCAL_KEY="page_assemble-",this.PAGE_ASSEMBLE_ENDPOINT="/page/assemble?orgdetails=orgName",this.DIALCODE_ASSEMBLE_ENDPOINT="/dial/assemble"}return e.getIdForDb=function(e){return e.name+"-"+(e.organisationId||"")+"-"+(e.source||"app")+"-"+(e.mode||"")+"-"+(e.filters?An(JSON.stringify(e.filters)).toString():"")+(e.sections?An(JSON.stringify(e.sections)).toString():"")},e.prototype.handle=function(t){var n=this;return t.from=t.from||Qn.CachedItemRequestSourceFrom.CACHE,Object(M.defer)((function(){return pr(n,void 0,void 0,(function(){var n,r,i,o=this;return dr(this,(function(a){switch(a.label){case 0:return t.name!==lr.PageName.COURSE?[2,t]:[4,this.sharedPreferences.getString(ne.l.KEY_ORGANISATION_ID).toPromise()];case 1:return(n=a.sent())?[4,function(){return pr(o,void 0,void 0,(function(){var e,t;return dr(this,(function(n){switch(n.label){case 0:return[4,this.authService.getSession().toPromise()];case 1:return e=!!n.sent(),[4,this.profileService.isDefaultChannelProfile().toPromise()];case 2:return t=n.sent(),[2,e&&!t]}}))}))}()]:[2,t];case 2:return a.sent()?[2,t]:[4,this.systemSettingsService.getSystemSettings({id:e.SYSTEM_SETTINGS_TENANT_COURSE_PAGE_ID}).toPromise().then((function(e){try{return JSON.parse(e.value)}catch(e){return console.error(e),[]}}))];case 3:return r=a.sent(),t.organisationId=n,(i=r.find((function(e){return e.channelId===n})))&&(t.name=i.page),[2,t]}}))}))})).pipe(Object(te.mergeMap)((function(e){return e.from===Qn.CachedItemRequestSourceFrom.SERVER?n.fetchFromServer(e).pipe(Object(te.catchError)((function(){return n.fetchFromCache(e)}))):n.fetchFromCache(e)})))},e.prototype.fetchFromServer=function(t){var n=this,r=t.name===lr.PageName.DIAL_CODE?this.DIALCODE_ASSEMBLE_ENDPOINT:this.PAGE_ASSEMBLE_ENDPOINT,i=(new o.Request.Builder).withHost(this.pageApiServiceConfig.host).withType(o.HttpRequestType.POST).withPath(this.pageApiServiceConfig.apiPath+r).withBearerToken(!0).withBody({request:t}).build();return this.apiService.fetch(i).pipe(Object(te.map)((function(e){return e.body.result.response})),Object(te.tap)((function(r){var i=JSON.stringify(r);n.sharedPreferences.putString("ttl_"+n.PAGE_ASSEMBLE_LOCAL_KEY+"-"+e.getIdForDb(t),Date.now()+"").toPromise(),n.keyValueStore.setValue(n.PAGE_ASSEMBLE_LOCAL_KEY+"-"+e.getIdForDb(t),i).toPromise()})))},e.prototype.fetchFromCache=function(t){var n=this;return this.cachedItemStore.getCached(e.getIdForDb(t),this.PAGE_ASSEMBLE_LOCAL_KEY,"ttl_"+this.PAGE_ASSEMBLE_LOCAL_KEY,(function(){return n.fetchFromServer(t)}))},e.SYSTEM_SETTINGS_TENANT_COURSE_PAGE_ID="tenantCoursePage",e}(),Er=function(){return(Er=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},br=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},yr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},vr=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},_r=function(){function e(e,t){this.defaultDelegate=e,this.dbService=t}return e.prototype.handle=function(e){var t=this;return Object(M.defer)((function(){return br(t,void 0,void 0,(function(){var t,n,r,i;return yr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.defaultDelegate.handle(e).toPromise()];case 1:return t=o.sent(),[3,3];case 2:return n=o.sent(),console.error(n),[3,3];case 3:return e.filters&&e.filters.dialcodes?(r="SELECT c.* FROM content c WHERE ref_count > 0 AND dialcodes LIKE '%%~"+e.filters.dialcodes+"~%%'",[4,this.dbService.execute(r).toPromise()]):[3,8];case 4:return i=o.sent().map((function(e){return Pe.a.mapContentDBEntryToContent(e).contentData})),t&&t.sections[0]&&i.length?[4,this.mergePageAssembleWithLocalContents(t,i)]:[3,6];case 5:return t=o.sent(),[3,8];case 6:return t||!i.length?[3,8]:[4,this.buildPageAssembleWithLocalContents(i)];case 7:t=o.sent(),o.label=8;case 8:if(!t)throw new Error("NO_DATA");return[2,t]}}))}))}))},e.prototype.buildPageAssembleWithLocalContents=function(e){return br(this,void 0,void 0,(function(){var t;return yr(this,(function(n){return t={name:"",id:"",sections:[{display:"",count:0,index:0,sectionDataType:"",resmsgId:"",searchQuery:"",name:"",id:"",apiId:"",group:0,contents:e}]},[2,this.mergePageAssembleWithLocalCollections(t,e)]}))}))},e.prototype.mergePageAssembleWithLocalContents=function(e,t){return br(this,void 0,void 0,(function(){var n,r;return yr(this,(function(i){switch(i.label){case 0:return(n=e.sections[0]).contents&&n.contents.length?(r=t.filter((function(e){return!n.contents.find((function(t){return t.identifier===e.identifier}))}))).length?(n.contents=vr(r,n.contents),[4,this.mergePageAssembleWithLocalCollections(e,r)]):[3,2]:[3,3];case 1:e=i.sent(),i.label=2;case 2:return[3,5];case 3:return n.contents=t,[4,this.mergePageAssembleWithLocalCollections(e,t)];case 4:e=i.sent(),i.label=5;case 5:return[2,e]}}))}))},e.prototype.mergePageAssembleWithLocalCollections=function(e,t){return br(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u,f,l;return yr(this,(function(p){switch(p.label){case 0:(n=e.sections[0]).collections||(n.collections=[]),r=0,i=t,p.label=1;case 1:return r<i.length?(o=i[r],a="SELECT c.* FROM content c WHERE c.visibility = 'Default' AND ref_count > 0 AND child_nodes LIKE '%%~"+o.identifier+"~%%'",[4,this.dbService.execute(a).toPromise()]):[3,4];case 2:if((c=p.sent().map((function(e){return Pe.a.mapContentDBEntryToContent(e).contentData}))).length)for(s=function(e){var t=n.collections.find((function(t){return t.identifier===e.identifier}));t?t.childNodes.indexOf(o.identifier)>=0||t.childNodes.push(o.identifier):n.collections.push(Er(Er({},e),{childNodes:[o.identifier]}))},u=0,f=c;u<f.length;u++)l=f[u],s(l);p.label=3;case 3:return r++,[3,1];case 4:return[2,e]}}))}))},e}(),Sr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Or=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},gr=function(){function e(e,t,n,r){this.defaultDelegate=e,this.authService=t,this.frameworkService=n,this.systemSettingsService=r,this.ssoSectionIdMap=new Map}return e.prototype.handle=function(t){var n=this;return Object(M.defer)((function(){return Sr(n,void 0,void 0,(function(){var n,r,i,o,a,c;return Or(this,(function(s){switch(s.label){case 0:return[4,this.authService.getSession().toPromise()];case 1:return!!s.sent()?[4,this.frameworkService.getDefaultChannelId().toPromise()]:[2,t];case 2:if(n=s.sent(),r=this.frameworkService.activeChannelId,r===n)return[3,7];i=void 0,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this.systemSettingsService.getSystemSettings({id:e.SSO_COURSE_SECTION_ID}).toPromise()];case 4:return o=s.sent(),i=o&&o.value,[3,6];case 5:return a=s.sent(),console.error(a),[3,6];case 6:i&&(t.sections=((c={})[i]={filters:{"batches.createdFor":[r]}},c),this.ssoSectionIdMap.set(t.name+"-"+r,i)),s.label=7;case 7:return[2,t]}}))}))})).pipe(Object(te.mergeMap)((function(e){return n.defaultDelegate.handle(e)})),Object(te.map)((function(e){var r=n.ssoSectionIdMap.get(t.name+"-"+n.frameworkService.activeChannelId);return r&&(e.ssoSectionId=r),e})))},e.SSO_COURSE_SECTION_ID="ssoCourseSection",e}(),Cr=function(){function e(e,t,n,r,i,o,a,c,s,u){this.apiService=e,this.pageApiServiceConfig=t,this.cachedItemStore=n,this.keyValueStore=r,this.sharedPreferences=i,this.frameworkService=o,this.authService=a,this.systemSettingsService=c,this.dbService=s,this.profileService=u,this.defaultRequestDelegate=new hr(e,t,i,n,r,a,u,c),this.dialcodeRequestDelegate=new _r(this.defaultRequestDelegate,s),this.courseRequestDelegate=new gr(this.defaultRequestDelegate,a,o,c)}return e.prototype.handle=function(e){switch(e.from=e.from||Qn.CachedItemRequestSourceFrom.CACHE,e.name){case lr.PageName.COURSE:return this.courseRequestDelegate.handle(e);case lr.PageName.DIAL_CODE:return this.dialcodeRequestDelegate.handle(e);default:return this.defaultRequestDelegate.handle(e)}},e}(),mr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Tr=function(e,t){return function(n,r){t(n,r,e)}},Nr=function(){function e(e,t,n,r,i,o,a,c,s,u){this.apiService=e,this.sdkConfig=t,this.cachedItemStore=n,this.keyValueStore=r,this.sharedPreferences=i,this.frameworkService=o,this.authService=a,this.systemSettingsService=c,this.dbService=s,this.profileService=u,this.pageAssembleServiceConfig=this.sdkConfig.pageServiceConfig}return e.prototype.setPageAssembleChannel=function(e){this.sharedPreferences.putString(ne.l.KEY_ORGANISATION_ID,e.channelId).toPromise()},e.prototype.getPageAssemble=function(e){return new Cr(this.apiService,this.pageAssembleServiceConfig,this.cachedItemStore,this.keyValueStore,this.sharedPreferences,this.frameworkService,this.authService,this.systemSettingsService,this.dbService,this.profileService).handle(e)},e=mr([Object(N.injectable)(),Tr(0,Object(N.inject)(I.b.API_SERVICE)),Tr(1,Object(N.inject)(I.b.SDK_CONFIG)),Tr(2,Object(N.inject)(I.b.CACHED_ITEM_STORE)),Tr(3,Object(N.inject)(I.b.KEY_VALUE_STORE)),Tr(4,Object(N.inject)(I.b.SHARED_PREFERENCES)),Tr(5,Object(N.inject)(I.b.FRAMEWORK_SERVICE)),Tr(6,Object(N.inject)(I.b.AUTH_SERVICE)),Tr(7,Object(N.inject)(I.b.SYSTEM_SETTINGS_SERVICE)),Tr(8,Object(N.inject)(I.b.DB_SERVICE)),Tr(9,Object(N.inject)(I.b.PROFILE_SERVICE)),Ar("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,a.DbService,Object])],e)}(),Ir=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mr=function(){function e(){this.listeners=new Map}return e.prototype.getString=function(e){return Object(M.defer)((function(){return Object(M.of)(localStorage.getItem(e)).pipe(Object(te.map)((function(e){return e||void 0})))}))},e.prototype.putString=function(e,t){return Object(M.defer)((function(){return Object(M.of)(localStorage.setItem(e,t)).pipe(Object(te.mapTo)(void 0))}))},e.prototype.putBoolean=function(e,t){return Object(M.defer)((function(){return Object(M.of)(localStorage.setItem(e,t+"")).pipe(Object(te.mapTo)(!0))}))},e.prototype.getBoolean=function(e){return Object(M.defer)((function(){return Object(M.of)("true"===localStorage.getItem(e))}))},e.prototype.addListener=function(e,t){var n=this.listeners.get(e)||[];n.push(t),this.listeners.set(e,n)},e.prototype.removeListener=function(e,t){var n=this.listeners.get(e)||[];this.listeners.set(e,n.filter((function(e){return e!==t})))},e=Ir([Object(N.injectable)()],e)}(),wr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Dr=function(){function e(){this.listeners=new Map,this.sharedPreferences=plugins.SharedPreferences.getInstance(t.sharedPreferncesName)}var t;return t=e,e.prototype.getString=function(e){var t=this,n=localStorage.getItem(e);return n?(localStorage.removeItem(e),this.putString(e,n).pipe(Object(te.mapTo)(n))):new M.Observable((function(n){t.sharedPreferences.getString(e,"",(function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.putString=function(e,t){var n=this;return new M.Observable((function(r){n.sharedPreferences.putString(e,t,(function(){(n.listeners.get(e)||[]).forEach((function(e){return e(t)})),r.next(void 0),r.complete()}),(function(e){r.error(e)}))}))},e.prototype.putBoolean=function(e,t){var n=this;return new M.Observable((function(r){n.sharedPreferences.putBoolean(e,t,(function(){(n.listeners.get(e)||[]).forEach((function(e){return e(t)})),r.next(!0),r.complete()}),(function(e){r.error(e)}))}))},e.prototype.getBoolean=function(e){var t=this,n=localStorage.getItem(e);return n?(localStorage.removeItem(e),this.putBoolean(e,"true"===n).pipe(Object(te.mapTo)("true"===n))):new M.Observable((function(n){t.sharedPreferences.getBoolean(e,!1,(function(e){n.next(e),n.complete()}),(function(e){n.error(e)}))}))},e.prototype.addListener=function(e,t){var n=this.listeners.get(e)||[];n.push(t),this.listeners.set(e,n)},e.prototype.removeListener=function(e,t){var n=this.listeners.get(e)||[];this.listeners.set(e,n.filter((function(e){return e!==t})))},e.sharedPreferncesName="org.ekstep.genieservices.preference_file",e=t=wr([Object(N.injectable)()],e)}(),Pr=n(27),Rr=n(92),Lr=function(){return(Lr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},jr=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ur=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},kr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},xr=Rr.a.DiskSpacePlugin,Fr=function(){function e(){this.initialized=!1}return e.prototype.init=function(){this.initialized=!0},e.prototype.readAsText=function(e,t){return Ur(this,void 0,void 0,(function(){var n,r,i,o;return kr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),console.log("path",e),console.log("fileName",t),n=e,e.endsWith("/")&&(n=e.slice(0,-1)),[4,Pr.c.readFile({path:n+"/"+t,encoding:Pr.b.UTF8})];case 1:if("string"==typeof(r=a.sent()).data)return[2,r.data];if(r.data instanceof Blob)return i=r.data,[2,new Promise((function(e,t){var n=new FileReader;n.onload=function(){console.log("Reader successfully read the file:",n.result),e(n.result)},n.onerror=function(){console.error("Error reading Blob:",n.error),t(new Error("Failed to read Blob"))},console.log("Starting to read Blob data..."),n.readAsText(i)}))];throw new Error("Expected a string or Blob");case 2:throw o=a.sent(),console.error("Error reading file as text:",o),o;case 3:return[2]}}))}))},e.prototype.readAsBinaryString=function(e,t){return Ur(this,void 0,void 0,(function(){var n,r;return kr(this,(function(i){switch(i.label){case 0:return console.log("read binary path",e),console.log("read binary filePath",t),[4,Pr.c.readFile({path:e.endsWith("/")?""+e+t:e+"/"+t})];case 1:return n=i.sent(),r=n.data,[2,atob(r)]}}))}))},e.prototype.readFileFromAssets=function(e){return new Promise((function(t,n){try{sbutility.readFromAssets(e,(function(e){t(e)}),(function(e){n(e)}))}catch(e){n(e)}}))},e.prototype.writeFile=function(e,t,n,r){return void 0===r&&(r={}),Ur(this,void 0,void 0,(function(){var i,o,a,c;return kr(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),i=r.replace,o=void 0!==i&&i,a=e+"/"+t,[4,Pr.c.writeFile(Lr({path:a,data:n,encoding:Pr.b.UTF8,recursive:!0},o&&{replace:!0}))];case 1:return s.sent(),[2,{success:!0}];case 2:throw c=s.sent(),console.error("Error writing file:",c),c;case 3:return[2]}}))}))},e.prototype.createFile=function(e,t,n){return Ur(this,void 0,void 0,(function(){var r,i,o;return kr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),r=e+"/"+t,[4,this.checkFileExists(r)];case 1:if(a.sent()&&!n)throw new Error("File already exists");return[4,Pr.c.writeFile({path:r,data:"",encoding:Pr.b.UTF8})];case 2:return i=a.sent(),[2,{success:!0,path:r,nativeURL:i.uri}];case 3:throw o=a.sent(),console.error("Error creating file:",o),o;case 4:return[2]}}))}))},e.prototype.getFile=function(e,t,n){return Ur(this,void 0,void 0,(function(){var n,r,i;return kr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=e.fullPath+"/"+t,[4,Pr.c.stat({path:n})];case 1:return r=o.sent(),[2,{isFile:!0,isDirectory:!1,name:t,fullPath:n,nativeURL:r.uri}];case 2:throw i=o.sent(),console.error("Error getting file:",i),i;case 3:return[2]}}))}))},e.prototype.removeFile=function(e){return Ur(this,void 0,void 0,(function(){var t;return kr(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Pr.c.deleteFile({path:e})];case 1:return n.sent(),[2,{success:!0}];case 2:throw t=n.sent(),console.error("Error removing file:",t),t;case 3:return[2]}}))}))},e.prototype.createDir=function(e,t){return Ur(this,void 0,void 0,(function(){var n,r;return kr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),console.log("path:",e),[4,this.checkFileExists(e)];case 1:return n=i.sent(),console.log("dirExists:",n),n&&!t?(console.log("returning:",e),[2,{isFile:!1,isDirectory:!0,name:e.split("/").pop()||"",fullPath:e,nativeURL:e+"/"}]):t&&n?[4,Pr.c.rmdir({path:e,recursive:!0})]:[3,3];case 2:i.sent(),i.label=3;case 3:return console.log("creating directory:",e),[4,Pr.c.mkdir({path:e,recursive:!0})];case 4:return i.sent(),console.log("returning path:",e),[2,{isFile:!1,isDirectory:!0,name:e.split("/").pop()||"",fullPath:e,nativeURL:e+"/"}];case 5:throw r=i.sent(),console.error("Error creating directory:",r),r;case 6:return[2]}}))}))},e.prototype.checkFileExists=function(e){return Ur(this,void 0,void 0,(function(){return kr(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Pr.c.stat({path:e})];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.listDir=function(e){return Ur(this,void 0,void 0,(function(){var t,n,r=this;return kr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,Pr.c.readdir({path:e})];case 1:return t=i.sent(),[4,Promise.all(t.files.map((function(t){return Ur(r,void 0,void 0,(function(){var n,r,i=this;return kr(this,(function(o){switch(o.label){case 0:return n=(e+"/"+t).replace(/\/\//g,"/"),[4,Pr.c.stat({path:n})];case 1:return[2,{isFile:"file"===(r=o.sent()).type,isDirectory:"directory"===r.type,name:t,fullPath:n,filesystem:"default",nativeURL:r.uri,remove:function(){return Ur(i,void 0,void 0,(function(){return kr(this,(function(e){switch(e.label){case 0:return"file"!==r.type?[3,2]:[4,Pr.c.deleteFile({path:n})];case 1:return e.sent(),[3,4];case 2:return[4,Pr.c.rmdir({path:n,recursive:!0})];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}}]}}))}))})))];case 2:return[2,i.sent()];case 3:throw n=i.sent(),console.error("Error listing directory:",n),n;case 4:return[2]}}))}))},e.prototype.removeDir=function(e,t){return Ur(this,void 0,void 0,(function(){var n,r;return kr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e.endsWith("/")&&(e=e.slice(0,-1)),n=e+"/"+t,[4,Pr.c.rmdir({path:n,recursive:!0})];case 1:return i.sent(),[2,{success:!0}];case 2:throw r=i.sent(),console.error("Error removing directory:",r),r;case 3:return[2]}}))}))},e.prototype.removeRecursively=function(e){return Ur(this,void 0,void 0,(function(){var t;return kr(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Pr.c.rmdir({path:e,recursive:!0})];case 1:return n.sent(),[2,{success:!0}];case 2:throw t=n.sent(),console.error("Error removing directory recursively:",t),t;case 3:return[2]}}))}))},e.prototype.copyDir=function(e,t,n,r){return Ur(this,void 0,void 0,(function(){var i,o,a,c;return kr(this,(function(s){switch(s.label){case 0:return i=e,o=n,e.endsWith("/")&&(i=e.slice(0,-1)),n.endsWith("/")&&(o=n.slice(0,-1)),a=i+"/"+t,c=o+"/"+r,[4,this.copyEntry(a,c,!1)];case 1:return[2,s.sent()]}}))}))},e.prototype.copyFile=function(e,t,n,r){return Ur(this,void 0,void 0,(function(){var i,o,a,c;return kr(this,(function(s){switch(s.label){case 0:return i=e,o=n,e.endsWith("/")&&(i=e.slice(0,-1)),n.endsWith("/")&&(o=n.slice(0,-1)),a=i+"/"+t,c=o+"/"+r,[4,this.copyEntry(a,c,!0)];case 1:return[2,s.sent()]}}))}))},e.prototype.copyEntry=function(e,t,n){return Ur(this,void 0,void 0,(function(){var r,i;return kr(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Pr.c.copy({from:e,to:t})];case 1:return r=o.sent(),[2,{isFile:n,isDirectory:!n,name:t.split("/").pop()||"",fullPath:t,nativeURL:r.uri}];case 2:throw i=o.sent(),console.error("Error copying "+(n?"file":"directory")+":",i),i;case 3:return[2]}}))}))},e.prototype.exists=function(e){return Ur(this,void 0,void 0,(function(){return kr(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Pr.c.stat({path:e})];case 1:return[2,{exists:!0,nativeURL:t.sent().uri}];case 2:throw t.sent();case 3:return[2]}}))}))},e.prototype.getTempLocation=function(e){return Ur(this,void 0,void 0,(function(){var t,n,r=this;return kr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=e.endsWith("/")?e+"tmp/":e+"/tmp/",[4,Pr.c.stat({path:t}).catch((function(e){return Ur(r,void 0,void 0,(function(){return kr(this,(function(n){switch(n.label){case 0:return console.info("Error getting temp location:",e,t),[4,Pr.c.mkdir({path:t,recursive:!0})];case 1:return n.sent(),[2]}}))}))}))];case 1:return i.sent(),[2,{path:t,nativeURL:t}];case 2:throw n=i.sent(),console.error("Error creating temp location:",n,e),n;case 3:return[2]}}))}))},e.prototype.getFreeDiskSpace=function(){return Ur(this,void 0,void 0,(function(){return kr(this,(function(e){return[2,xr.getFreeDiskSpace().then((function(e){return e.freeSpace})).catch((function(e){throw console.error("Error getting free disk space:",e),e}))]}))}))},e.prototype.getMetaData=function(e){return Ur(this,void 0,void 0,(function(){var t,n,r;return kr(this,(function(i){switch(i.label){case 0:t="string"==typeof e?e:e.fullPath,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Pr.c.stat({path:t})];case 2:return n=i.sent(),[2,{modificationTime:new Date(n.mtime),size:n.size}];case 3:throw r=i.sent(),console.error("Error retrieving metadata:",r),r;case 4:return[2]}}))}))},e.prototype.getDirectorySize=function(e){return Ur(this,void 0,void 0,(function(){var t,n;return kr(this,(function(r){switch(r.label){case 0:t=0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.size(e,t)];case 2:return[2,t=r.sent()];case 3:return n=r.sent(),console.error("Error getting directory size:",n),[2,0];case 4:return[2]}}))}))},e.prototype.size=function(e,t){return void 0===t&&(t=0),Ur(this,void 0,void 0,(function(){var n,r,i,o,a,c,s;return kr(this,(function(u){switch(u.label){case 0:if(!e)return[2,t];u.label=1;case 1:return u.trys.push([1,8,,9]),[4,Pr.c.readdir({path:e})];case 2:if(0===(n=u.sent()).files.length)return[3,7];r=0,i=n.files,u.label=3;case 3:return r<i.length?(o=i[r],a=e.endsWith("/")?""+e+o.name:e+"/"+o.name,"directory"!==o.type?[3,5]:(c=t,[4,this.size(a,t)])):[3,7];case 4:return t=c+u.sent(),[3,6];case 5:"file"===o.type&&(t+=o.size),u.label=6;case 6:return r++,[3,3];case 7:return[3,9];case 8:return s=u.sent(),console.error("Error reading directory '"+e+"':",s),[2,0];case 9:return[2,t]}}))}))},e=jr([Object(N.injectable)()],e)}(),Br=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Vr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Gr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Yr=function(e){function t(){return e.call(this,2,17)||this}return Br(t,e),t.prototype.apply=function(e){return Vr(this,void 0,void 0,(function(){var t=this;return Gr(this,(function(n){return this.queries().forEach((function(n){return Vr(t,void 0,void 0,(function(){return Gr(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[2,void 0]}))}))},t.prototype.queries=function(){return[s.f.getAlterEntryForProfileSyllabus()]},t}(a.Migration),Hr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Kr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},zr=function(e){function t(){return e.call(this,3,18)||this}return Hr(t,e),t.prototype.apply=function(e){return qr(this,void 0,void 0,(function(){var t=this;return Kr(this,(function(n){switch(n.label){case 0:return this.queries().forEach((function(n){return qr(t,void 0,void 0,(function(){return Kr(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[4,e.read({table:s.f.TABLE_NAME,columns:[]}).pipe(Object(te.map)((function(n){n.forEach((function(n){return qr(t,void 0,void 0,(function(){return Kr(this,(function(t){switch(t.label){case 0:return n[s.f.COLUMN_NAME_UID]===n[s.f.COLUMN_NAME_HANDLE]?n[s.f.COLUMN_NAME_SOURCE]=se.ProfileSource.SERVER.valueOf():n[s.f.COLUMN_NAME_SOURCE]=se.ProfileSource.LOCAL.valueOf(),[4,e.update({table:s.f.TABLE_NAME,modelJson:n}).toPromise()];case 1:return t.sent(),[2]}}))}))}))}))).toPromise()];case 1:return n.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[s.b.getCreateEntry(),s.a.getCreateEntry()]},t.prototype.updateProfileTable=function(){},t}(a.Migration),Wr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Jr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Qr=function(e){function t(){return e.call(this,4,19)||this}return Wr(t,e),t.prototype.apply=function(e){return Xr(this,void 0,void 0,(function(){var t=this;return Jr(this,(function(n){switch(n.label){case 0:return[4,e.read({table:s.d.TABLE_NAME,columns:[]}).pipe(Object(te.map)((function(n){n.forEach((function(n){return Xr(t,void 0,void 0,(function(){var t;return Jr(this,(function(r){switch(r.label){case 0:return t=Number(n[s.e.COLUMN_NAME_TOTAL_TS]),n[s.e.COLUMN_NAME_TOTAL_TS]=Math.round(t/1e3),[4,e.update({table:s.e.TABLE_NAME,modelJson:n}).toPromise()];case 1:return r.sent(),[2]}}))}))}))}))).toPromise()];case 1:return n.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[]},t}(a.Migration),$r=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ei=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ti=function(e){function t(){return e.call(this,7,22)||this}return $r(t,e),t.prototype.apply=function(e){return Zr(this,void 0,void 0,(function(){var t=this;return ei(this,(function(n){return this.queries().forEach((function(n){return Zr(t,void 0,void 0,(function(){return ei(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[2,void 0]}))}))},t.prototype.queries=function(){return[d.getCreateEntry()]},t}(a.Migration),ni=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ri=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ii=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},oi=function(e){function t(){return e.call(this,18,31)||this}return ni(t,e),t.prototype.apply=function(e){return ri(this,void 0,void 0,(function(){var t=this;return ii(this,(function(n){return this.queries().forEach((function(n){return ri(t,void 0,void 0,(function(){return ii(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),this.updateProfileDB(e),[2,void 0]}))}))},t.prototype.queries=function(){return[s.f.getAlterEntryForProfileCategories()]},t.prototype.updateProfileDB=function(e){return ri(this,void 0,void 0,(function(){var t,n=this;return ii(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.read({table:s.f.TABLE_NAME}).toPromise()];case 1:return r.sent().forEach((function(t){return ri(n,void 0,void 0,(function(){var n,r;return ii(this,(function(i){switch(i.label){case 0:return n=this.getUpdateQueries(t),(r={})[s.f.COLUMN_NAME_CATEGORIES]=JSON.stringify(n),[4,e.update({table:s.f.TABLE_NAME,selection:s.f.COLUMN_NAME_UID+" = ?",selectionArgs:[t.uid],modelJson:r}).toPromise()];case 1:return i.sent(),[2]}}))}))})),[3,3];case 2:return t=r.sent(),console.log("error",t),[3,3];case 3:return[2]}}))}))},t.prototype.getUpdateQueries=function(e){var t={};return t.fwCategory1=e.board,t.fwCategory2=e.medium,t.fwCategory3=e.grade,t.fwCategory4=e.subject,t},t}(a.Migration),ai=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ci=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},si=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ui=function(e){function t(){return e.call(this,5,20)||this}return ai(t,e),t.prototype.apply=function(e){return ci(this,void 0,void 0,(function(){var t=this;return si(this,(function(n){return this.queries().forEach((function(n){return ci(t,void 0,void 0,(function(){return si(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[2,void 0]}))}))},t.prototype.queries=function(){return[p.d.getCreateEntry()]},t}(a.Migration),fi=n(93),li=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},pi=function(){function e(){}return e.prototype.unzip=function(e,t,n,r){JJzip.unzip(e,t,(function(){n&&n()}),(function(e){r&&r(e)}))},e.prototype.zip=function(e,t,n,r,i,o){JJzip.zip(e,t,n,r,(function(){i&&i()}),(function(e){o&&o(e)}))},e=li([Object(N.injectable)()],e)}(),di=n(20),hi=function(){return(hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ei=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},bi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},yi=function(){function e(){this.deviceId=An(window.device.uuid).toString()}return e.prototype.getDeviceID=function(){return this.deviceId},e.prototype.getDeviceSpec=function(){var e=this;return this.deviceSpec?Object(M.of)(this.deviceSpec):new M.Observable((function(t){sbutility.getDeviceSpec((function(n){e.deviceSpec=n,t.next(n),t.complete()}))}))},e.prototype.getAvailableInternalMemorySize=function(){return new M.Observable((function(e){sbutility.getAvailableInternalMemorySize((function(t){e.next(t),e.complete()}),(function(t){e.error(t)}))}))},e.prototype.getStorageVolumes=function(){return M.Observable.create((function(e){sbutility.getStorageVolumes((function(t){e.next(t.map((function(e){return e.isRemovable?{storageDestination:di.StorageDestination.EXTERNAL_STORAGE,info:hi({},e)}:{storageDestination:di.StorageDestination.INTERNAL_STORAGE,info:hi({},e)}}))),e.complete()}),(function(t){e.error(t)}))}))},e.prototype.isKeyboardShown=function(){var e,t,n;return new M.Observable((function(r){e=function(){return r.next(!0)},t=function(){return r.next(!0)},n=function(){return r.next(!1)},function(){return r.next(!1)},window.addEventListener("native.keyboardshow",e),window.addEventListener("keyboardWillShow",t),window.addEventListener("native.keyboardhide",n),window.addEventListener("keyboardWillHide",n)})).pipe(Object(te.distinctUntilChanged)(),Object(te.tap)((function(){console.log("Subscribed isKeyboardShown event")})),Object(te.finalize)((function(){console.log("Unsubscribed isKeyboardShown event"),window.removeEventListener("native.keyboardshow",e),window.removeEventListener("keyboardWillShow",t),window.removeEventListener("native.keyboardhide",n),window.removeEventListener("keyboardWillHide",n)})))},e=Ei([Object(N.injectable)(),bi("design:paramtypes",[])],e)}(),vi=function(){function e(){}return e.mapFeedbackDBEntrytoResponseFeedback=function(e){return{contentId:e[p.c.COLUMN_NAME_CONTENT_ID],rating:Number(e[p.c.COLUMN_NAME_RATING]),comments:e[p.c.COLUMN_NAME_COMMENTS],createdAt:Number(e[p.c.COLUMN_NAME_CREATED_AT]),stageId:"",contentVersion:""}},e}(),_i=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Si=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Oi=function(e,t){return function(n,r){t(n,r,e)}},gi=function(){function e(e,t,n){this.dbService=e,this.profileService=t,this.telemetryService=n}return e.prototype.getFeedback=function(e){var t="SELECT * FROM "+p.c.TABLE_NAME+" "+Re.a.getUidnIdentifierFiler(e.uid,e.contentId);return this.dbService.execute(t).pipe(Object(te.map)((function(e){return e.map((function(e){return vi.mapFeedbackDBEntrytoResponseFeedback(e)}))})))},e.prototype.sendFeedback=function(e){var t=this;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(n){var r={table:p.c.TABLE_NAME,selection:(new T).where("? = ? AND ? = ?").args([p.c.COLUMN_NAME_CONTENT_ID,e.contentId,p.c.COLUMN_NAME_UID,n.uid]).end().build(),limit:"1"},i={uid:n.uid,identifier:e.contentId,rating:e.rating,comments:e.comments,createdAt:Date.now()};return t.telemetryService.feedback({env:"sdk",rating:e.rating,comments:e.comments,objId:e.contentId,objType:U.ShareItemType.CONTENT.valueOf(),objVer:e.contentVersion}).pipe(Object(te.mergeMap)((function(){return t.dbService.read(r).pipe(Object(te.mergeMap)((function(r){return r&&r.length?t.dbService.update({table:p.c.TABLE_NAME,selection:p.c.COLUMN_NAME_UID+"= ? AND "+p.c.COLUMN_NAME_CONTENT_ID+"= ?",selectionArgs:[n.uid,e.contentId],modelJson:i}).pipe(Object(te.map)((function(e){return e>0}))):t.dbService.insert({table:p.c.TABLE_NAME,modelJson:i}).pipe(Object(te.map)((function(e){return e>0})))})))})))})))},e=_i([Object(N.injectable)(),Oi(0,Object(N.inject)(I.b.DB_SERVICE)),Oi(1,Object(N.inject)(I.b.PROFILE_SERVICE)),Oi(2,Object(N.inject)(I.b.TELEMETRY_SERVICE)),Si("design:paramtypes",[a.DbService,Object,Object])],e)}(),Ci=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},mi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ai=function(e,t){return function(n,r){t(n,r,e)}},Ti=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ni=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ii=function(){function e(e){this.sdkConfig=e,this.eventsBus=new M.Subject,this.eventDelegates=[],this.eventsBusConfig=this.sdkConfig.eventsBusConfig}return e.prototype.onInit=function(){var e=this;return this.eventsBus.pipe(Object(te.tap)((function(t){e.eventsBusConfig.debugMode&&console.log("SDK Telemetry Events",t)})),Object(te.tap)((function(t){return Ti(e,void 0,void 0,(function(){var e,n;return Ni(this,(function(r){switch(r.label){case 0:e=this.eventDelegates.filter((function(e){return e.namespace===t.namespace})).map((function(e){return e.observer.onEvent(t.event).pipe(Object(te.take)(1),Object(te.catchError)((function(t){return console.error("Error: ",t,"EventObserver: ",e),Object(M.of)(void 0)})))})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,M.zip.apply(void 0,e).toPromise()];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),console.error("EVENT_BUS_DELEGATE_ERROR",n),[3,4];case 4:return[2]}}))}))})),Object(te.mapTo)(void 0))},e.prototype.events=function(e){return this.eventsBus.asObservable().pipe(Object(te.filter)((function(t){return!e||t.namespace===e})),Object(te.map)((function(e){return e.event})))},e.prototype.emit=function(e){var t=e.namespace,n=e.event;this.eventsBus.next({namespace:t,event:n})},e.prototype.registerObserver=function(e){var t=e.namespace,n=e.observer;this.eventDelegates.push({namespace:t,observer:n})},e=Ci([Object(N.injectable)(),Ai(0,Object(N.inject)(I.b.SDK_CONFIG)),mi("design:paramtypes",[Object])],e)}(),Mi=n(24),wi=n(42),Di=n(316),Pi=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ri=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Li=function(e,t){return function(n,r){t(n,r,e)}},ji=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ui=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ki=function(){function e(e,n){this.eventsBusService=e,this.sharedPreferences=n,this.currentDownloadRequest$=new M.BehaviorSubject(void 0),this.completedDownloadRequestsCache=new dn.a((function(e){return e.identifier})),window.downloadManager=Di,this.sharedPreferencesSetCollection=new hn(this.sharedPreferences,t.KEY_TO_DOWNLOAD_LIST,(function(e){return e.identifier}))}var t;return t=e,e.generateDownloadStartTelemetry=function(e){return ji(this,void 0,void 0,(function(){return Ui(this,(function(t){return[2,re.a.log.interact({type:U.InteractType.OTHER,subType:U.InteractSubType.CONTENT_DOWNLOAD_INITIATE,env:"sdk",pageId:"ContentDetail",id:"ContentDetail",objId:e.identifier,objType:e.contentMeta&&e.contentMeta.primaryCategory?Re.a.readPrimaryCategoryServer(e.contentMeta):"Content",objVer:e.contentMeta&&e.contentMeta.pkgVersion?e.contentMeta.pkgVersion:"",correlationData:e.correlationData||[]}).pipe(Object(te.mapTo)(void 0)).toPromise()]}))}))},e.generateDownloadCompleteTelemetry=function(e){return ji(this,void 0,void 0,(function(){return Ui(this,(function(t){return[2,re.a.log.interact({type:U.InteractType.OTHER,subType:U.InteractSubType.CONTENT_DOWNLOAD_SUCCESS,env:"sdk",pageId:"ContentDetail",id:"ContentDetail",objId:e.identifier,objType:e.contentMeta&&e.contentMeta.primaryCategory?Re.a.readPrimaryCategoryServer(e.contentMeta):"Content",objVer:e.contentMeta&&e.contentMeta.pkgVersion?e.contentMeta.pkgVersion:"",correlationData:e.correlationData||[]}).pipe(Object(te.mapTo)(void 0)).toPromise()]}))}))},e.generateDownloadCancelTelemetry=function(e){return ji(this,void 0,void 0,(function(){return Ui(this,(function(t){return[2,re.a.log.interact({type:U.InteractType.OTHER,subType:U.InteractSubType.CONTENT_DOWNLOAD_CANCEL,env:"sdk",pageId:"ContentDetail",id:"ContentDetail",objId:e.identifier,objType:e.contentMeta&&e.contentMeta.primaryCategory?Re.a.readPrimaryCategoryServer(e.contentMeta):"Content",objVer:e.contentMeta&&e.contentMeta.pkgVersion?e.contentMeta.pkgVersion:"",correlationData:e.correlationData||[]}).pipe(Object(te.mapTo)(void 0)).toPromise()]}))}))},e.prototype.onInit=function(){var e=this;return this.switchToNextDownloadRequest().pipe(Object(te.mergeMap)((function(){return e.listenForDownloadProgressChanges()})))},e.prototype.download=function(e){var t=this;return this.currentDownloadRequest$.pipe(Object(te.take)(1),Object(te.mergeMap)((function(n){return n?t.addToDownloadList(e):t.addToDownloadList(e).pipe(Object(te.tap)((function(){return t.switchToNextDownloadRequest().toPromise()})))})))},e.prototype.cancel=function(e,t){var n=this;return void 0===t&&(t=!0),this.currentDownloadRequest$.pipe(Object(te.take)(1),Object(te.mergeMap)((function(r){return r&&r.identifier===e.identifier?new M.Observable((function(e){downloadManager.remove([r.downloadId],(function(t,n){t&&e.error(t),e.next(!!n),e.complete()}))})).pipe(Object(te.mergeMap)((function(){return n.removeFromDownloadList(e,t)})),Object(te.tap)((function(){return n.switchToNextDownloadRequest().toPromise()}))):n.removeFromDownloadList(e,t)})))},e.prototype.cancelAll=function(){var e=this;return this.currentDownloadRequest$.pipe(Object(te.take)(1),Object(te.mergeMap)((function(t){return t?new M.Observable((function(e){downloadManager.remove([t.downloadId],(function(t,n){t&&e.error(t),e.next(!!n),e.complete()}))})).pipe(Object(te.mergeMap)((function(){return e.removeAllFromDownloadList()})),Object(te.mergeMap)((function(){return e.switchToNextDownloadRequest()}))):e.removeAllFromDownloadList()})))},e.prototype.registerOnDownloadCompleteDelegate=function(e){this.downloadCompleteDelegate=e},e.prototype.getActiveDownloadRequests=function(){return this.sharedPreferencesSetCollection.asListChanges().pipe(Object(te.map)((function(e){return e.sort((function(e,t){var n=e.withPriority||0;return(t.withPriority||0)-n}))})))},e.prototype.switchToNextDownloadRequest=function(){var e=this;return this.sharedPreferencesSetCollection.asSet().pipe(Object(te.mergeMap)((function(n){if(!n.size())return Object(M.of)(void 0).pipe(Object(te.tap)((function(){return e.currentDownloadRequest$.next(void 0)})));var r=n.toArray().sort((function(e,t){var n=e.withPriority||0;return(t.withPriority||0)-n})).shift();return new M.Observable((function(e){downloadManager.enqueue({uri:r.downloadUrl,title:r.filename,description:"",mimeType:r.mimeType,visibleInDownloadsUi:!0,notificationVisibility:1,destinationInExternalFilesDir:{dirType:t.DOWNLOAD_DIR_NAME,subPath:r.filename},headers:[]},(function(t,n){if(t)return e.error(t);e.next(n)}))})).pipe(Object(te.tap)((function(n){return ji(e,void 0,void 0,(function(){var e,i,o;return Ui(this,(function(a){switch(a.label){case 0:return e=window.device.platform.toLowerCase(),i="ios"===e?rn.a.DOCUMENTS:rn.a.EXTERNAL,[4,nn.a.getFilePath(i)];case 1:return o=a.sent(),r.downloadedFilePath=o+t.DOWNLOAD_DIR_NAME+"/"+r.filename,r.downloadId=n,this.currentDownloadRequest$.next(r),[2]}}))}))})),Object(te.tap)((function(){return ji(e,void 0,void 0,(function(){return Ui(this,(function(e){switch(e.label){case 0:return[4,t.generateDownloadStartTelemetry(r)];case 1:return[2,e.sent()]}}))}))})),Object(te.mapTo)(void 0),Object(te.catchError)((function(){return e.cancel({identifier:r.identifier})})))})))},e.prototype.addToDownloadList=function(e){return this.sharedPreferencesSetCollection.addAll(e).pipe(Object(te.mapTo)(void 0))},e.prototype.removeFromDownloadList=function(e,n){var r=this;return this.sharedPreferencesSetCollection.asList().pipe(Object(te.mergeMap)((function(i){var o=i.find((function(t){return t.identifier===e.identifier}));return o?r.sharedPreferencesSetCollection.remove(o).pipe(Object(te.mapTo)(void 0),Object(te.tap)((function(){return ji(r,void 0,void 0,(function(){var e;return Ui(this,(function(r){switch(r.label){case 0:return(e=n)?[4,t.generateDownloadCancelTelemetry(o)]:[3,2];case 1:e=r.sent(),r.label=2;case 2:return[2,e]}}))}))}))):Object(M.of)(void 0)})))},e.prototype.removeAllFromDownloadList=function(){var e=this;return this.sharedPreferencesSetCollection.asList().pipe(Object(te.take)(1),Object(te.mergeMap)((function(n){return e.sharedPreferencesSetCollection.clear().pipe(Object(te.mergeMap)((function(){return Object(M.from)(n).pipe(Object(te.tap)((function(n){return ji(e,void 0,void 0,(function(){return Ui(this,(function(e){switch(e.label){case 0:return[4,t.generateDownloadCancelTelemetry(n)];case 1:return[2,e.sent()]}}))}))})),Object(te.concatMapTo)(Object(M.of)(void 0)))})))})))},e.prototype.handleDownloadCompletion=function(e){var n=this;return this.currentDownloadRequest$.pipe(Object(te.take)(1),Object(te.mergeMap)((function(r){return e.payload.status===wi.DownloadStatus.STATUS_SUCCESSFUL?(n.completedDownloadRequestsCache.add(r),Object(M.iif)((function(){return!!n.downloadCompleteDelegate}),Object(M.defer)((function(){return ji(n,void 0,void 0,(function(){return Ui(this,(function(e){return t.generateDownloadCompleteTelemetry(r),this.downloadCompleteDelegate.onDownloadCompletion(r).toPromise(),[2]}))}))})),Object(M.defer)((function(){return Object(M.of)(void 0)}))).pipe(Object(te.mapTo)(void 0))):Object(M.of)(void 0)})))},e.prototype.emitProgressInEventBus=function(e){var t=this;return Object(M.defer)((function(){return Object(M.of)(t.eventsBusService.emit({namespace:H.EventNamespace.DOWNLOADS,event:e})).pipe(Object(te.mapTo)(void 0))}))},e.prototype.getDownloadProgress=function(e){var t=this;return new M.Observable((function(n){downloadManager.query({ids:[e.downloadId]},(function(r,i){if(r)return n.next({type:wi.DownloadEventType.PROGRESS,payload:{downloadId:e.downloadId,identifier:e.identifier,progress:-1,bytesDownloaded:0,totalSizeInBytes:0,status:wi.DownloadStatus.STATUS_FAILED}}),n.complete(),void t.cancel({identifier:e.identifier}).toPromise();var o=i[0];n.next({type:wi.DownloadEventType.PROGRESS,payload:{downloadId:e.downloadId,identifier:e.identifier,progress:Math.round(o.totalSizeBytes>=0?o.bytesDownloadedSoFar/o.totalSizeBytes*100:-1),bytesDownloaded:o.bytesDownloadedSoFar,totalSizeInBytes:o.totalSizeBytes,status:o.status}}),n.complete()}))}))},e.prototype.listenForDownloadProgressChanges=function(){var e=this;return this.currentDownloadRequest$.pipe(Object(te.switchMap)((function(t){return t?(e.eventsBusService.emit({namespace:H.EventNamespace.DOWNLOADS,event:{type:wi.DownloadEventType.START,payload:void 0}}),Object(M.interval)(1e3).pipe(Object(te.mergeMap)((function(){return e.getDownloadProgress(t)})),Object(te.distinctUntilChanged)((function(e,t){return JSON.stringify(e)===JSON.stringify(t)})),Object(te.mergeMap)((function(t){return Object(M.zip)(e.handleDownloadCompletion(t),e.emitProgressInEventBus(t)).pipe(Object(te.mapTo)(t))})),Object(te.tap)((function(t){t.payload.status!==wi.DownloadStatus.STATUS_FAILED&&t.payload.status!==wi.DownloadStatus.STATUS_SUCCESSFUL||e.eventsBusService.emit({namespace:H.EventNamespace.DOWNLOADS,event:{type:wi.DownloadEventType.END,payload:void 0}})})),Object(te.mapTo)(void 0))):Object(M.of)(void 0)})))},e.prototype.trackDownloads=function(e){var t=this;return e.groupBy.fieldPath&&e.groupBy.value?this.getActiveDownloadRequests().pipe(Object(te.map)((function(n){var r=function(t){return e.groupBy.value===e.groupBy.fieldPath.split(".").reduce((function(e,t){if(e&&e[t])return e[t]}),t)};return{completed:t.completedDownloadRequestsCache.size()?t.completedDownloadRequestsCache.toArray().filter(r):[],queued:n.length?n.filter(r):[]}}))):M.EMPTY},e.prototype.onContentDelete=function(e){this.completedDownloadRequestsCache.remove({identifier:e})},e.KEY_TO_DOWNLOAD_LIST=ne.h.KEY_TO_DOWNLOAD_LIST,e.DOWNLOAD_DIR_NAME="Download",e=t=Pi([Object(N.injectable)(),Li(0,Object(N.inject)(I.b.EVENTS_BUS_SERVICE)),Li(1,Object(N.inject)(I.b.SHARED_PREFERENCES)),Ri("design:paramtypes",[Object,Object])],e)}(),xi=function(){return(xi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Fi=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Bi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Vi=function(e,t){return function(n,r){t(n,r,e)}},Gi=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Yi=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Hi=function(){function e(e,t){var n=this;this.sdkConfig=e,this.sharedPreferences=t,"cordova"!==e.platform&&(this.versionName="sunbird-debug"),cordova.getAppVersion.getAppName((function(e){return n.appName=e}))}return e.prototype.getVersionName=function(){return this.versionName},e.prototype.getAppName=function(){return this.appName},e.prototype.init=function(){return Gi(this,void 0,void 0,(function(){var e,t=this;return Yi(this,(function(n){switch(n.label){case 0:return[4,this.setFirstAccessTimestamp()];case 1:return n.sent(),"cordova"!==this.sdkConfig.platform?[2,void 0]:(e=this.sdkConfig.appConfig.buildConfigPackage?this.sdkConfig.appConfig.buildConfigPackage:"org.sunbird.app",[2,this.getBuildConfigValue(e,"REAL_VERSION_NAME").then((function(e){t.versionName=e,Ce.CsModule.instance.isInitialised&&Ce.CsModule.instance.updateConfig(xi(xi({},Ce.CsModule.instance.config),{core:xi(xi({},Ce.CsModule.instance.config.core),{global:xi(xi({},Ce.CsModule.instance.config.core.global),{appVersion:e})})})),console.log("version name",t.versionName)}))])}}))}))},e.prototype.getBuildConfigValue=function(e,t){return new Promise((function(n,r){try{sbutility.getBuildConfigValue(e,t,(function(e){n(e)}),(function(e){console.error(e),r(e)}))}catch(e){console.error(e),r(e)}}))},e.prototype.getFirstAccessTimestamp=function(){return this.sharedPreferences.getString(ne.b.KEY_FIRST_ACCESS_TIMESTAMP).pipe(Object(te.map)((function(e){return e})))},e.prototype.setFirstAccessTimestamp=function(){return Gi(this,void 0,void 0,(function(){return Yi(this,(function(e){switch(e.label){case 0:return[4,this.sharedPreferences.getString(ne.b.KEY_FIRST_ACCESS_TIMESTAMP).toPromise()];case 1:return e.sent()?[3,3]:[4,this.sharedPreferences.putString(ne.b.KEY_FIRST_ACCESS_TIMESTAMP,Date.now()+"").toPromise()];case 2:return e.sent(),[2,!0];case 3:return[2,!1]}}))}))},e=Fi([Object(N.injectable)(),Vi(0,Object(N.inject)(I.b.SDK_CONFIG)),Vi(1,Object(N.inject)(I.b.SHARED_PREFERENCES)),Bi("design:paramtypes",[Object,Object])],e)}(),qi=n(94),Ki=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zi=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Wi=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Xi=function(e){function t(){return e.call(this,6,21)||this}return Ki(t,e),t.prototype.apply=function(e){return zi(this,void 0,void 0,(function(){var t=this;return Wi(this,(function(n){switch(n.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return n.sent(),[4,e.read({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_CONTENT_TYPE+" = ?",selectionArgs:["textbook"]}).pipe(Object(te.map)((function(n){n.forEach((function(n){return zi(t,void 0,void 0,(function(){var t,r;return Wi(this,(function(i){switch(i.label){case 0:return(t=n[p.b.COLUMN_NAME_LOCAL_DATA])?(r=JSON.parse(t),n[p.b.COLUMN_NAME_BOARD]=Re.a.getContentAttribute(r.board),n[p.b.COLUMN_NAME_MEDIUM]=Re.a.getContentAttribute(r.medium),n[p.b.COLUMN_NAME_GRADE]=Re.a.getContentAttribute(r.gradeLevel),[4,e.update({table:p.b.TABLE_NAME,modelJson:n,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[n[p.b.COLUMN_NAME_IDENTIFIER]]}).toPromise()]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}))}))).toPromise()];case 2:return n.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[p.b.getAlterEntryForBoard(),p.b.getAlterEntryForMedium(),p.b.getAlterEntryForGrade()]},t}(a.Migration),Ji=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qi=function(e){function t(n){var r=e.call(this,n,"LOW_MEMORY")||this;return Object.setPrototypeOf(r,t.prototype),r}return Ji(t,e),t}(ue.a),$i=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Zi=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},eo=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return $i(t,void 0,void 0,(function(){var t,n,r;return Zi(this,(function(i){switch(i.label){case 0:return[4,this.getFreeUsableSpace(e.destinationFolder)];case 1:return t=i.sent(),[4,new ln(this.dbService).getContentUsageSummary([e.sourceFolder])];case 2:if(n=i.sent(),r=0,n&&n.length&&(r=n[0].sizeOnDevice),Re.a.isFreeSpaceAvailable(t,r,0))return[2,e];throw new Qi("Available memory not sufficient for transfer operation")}}))}))}))},e.prototype.getFreeUsableSpace=function(e){return $i(this,void 0,void 0,(function(){return Zi(this,(function(t){return[2,new Promise((function(t,n){sbutility.getFreeUsableSpace(e,(function(e){t(Number(e))}),(function(e){n(e)}))}))]}))}))},e}(),to=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},no=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ro=function(){function e(e,t){this.fileService=e,this.appConfig=t}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return to(t,void 0,void 0,(function(){var t,n=this;return no(this,(function(r){switch(r.label){case 0:return t=e,[4,this.getSubdirectoriesEntries(e.destinationFolder).then((function(e){return n.extractValidContentIdsInDestination(e)}))];case 1:return t.validContentIdsInDestination=r.sent(),[2,e]}}))}))}))},e.prototype.getSubdirectoriesEntries=function(e){return to(this,void 0,void 0,(function(){return no(this,(function(t){switch(t.label){case 0:return[4,this.fileService.listDir(e.replace(/\/$/,"")).then((function(e){return e.filter((function(e){return e.isDirectory}))})).catch((function(){throw new Error("Error listing directory")}))];case 1:return[2,t.sent()]}}))}))},e.prototype.extractValidContentIdsInDestination=function(e){return to(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s,u;return no(this,(function(f){switch(f.label){case 0:t=[],n=0,r=e,f.label=1;case 1:if(!(n<r.length))return[3,7];if(!(i=r[n]).isDirectory)return[3,6];o=void 0,f.label=2;case 2:return f.trys.push([2,4,,5]),[4,this.extractManifest(i)];case 3:return o=f.sent(),[3,5];case 4:return f.sent(),[3,5];case 5:if(!o)return[3,6];for(a=o.archive.items,c=0,s=a;c<s.length;c++)u=s[c],Re.a.readVisibility(u)!==q.Visibility.PARENT&&(Re.a.isDraftContent(u.status)&&Re.a.isExpired(u.expires)||t.push(i.name));f.label=6;case 6:return n++,[3,1];case 7:return[2,t]}}))}))},e.prototype.extractManifest=function(e){return to(this,void 0,void 0,(function(){var t;return no(this,(function(n){switch(n.label){case 0:return[4,this.fileService.readAsText(e.nativeURL,q.FileName.MANIFEST.valueOf()).catch((function(){throw new Error("Manifest file not found")}))];case 1:return t=n.sent(),[2,JSON.parse(t)]}}))}))},e}(),io=function(){function e(){}return e.prototype.execute=function(e){return Object(M.of)(e)},e}(),oo=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ao=function(e){function t(n){var r=e.call(this,n,"DUPLICATE_CONTENT")||this;return Object.setPrototypeOf(r,t.prototype),r}return oo(t,e),t}(ue.a),co=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},so=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},uo=p.b.COLUMN_NAME_IDENTIFIER,fo=p.b.COLUMN_NAME_LOCAL_DATA,lo=function(){function e(e,t){this.dbService=e,this.fileService=t}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return co(t,void 0,void 0,(function(){var t,n,r;return so(this,(function(i){switch(i.label){case 0:return[4,this.getContentsInDb(e.contentIds)];case 1:return t=i.sent(),n=[],e.validContentIdsInDestination&&e.validContentIdsInDestination.length?[4,this.getContentsInDb(e.validContentIdsInDestination)]:[3,3];case 2:n=i.sent(),i.label=3;case 3:return[4,this.generateMoveContentResponses(e,n)];case 4:if(r=i.sent().moveContentDupContentList,e.contentsInSource=t,e.duplicateContents=r,e.duplicateContents.length&&!e.shouldMergeInDestination)throw new ao("context.shouldMergeInDestination is false");return[2]}}))}))})).pipe(Object(te.mapTo)(e))},e.prototype.getContentsInDb=function(e){return co(this,void 0,void 0,(function(){return so(this,(function(t){return e.length?[2,this.dbService.execute(Re.a.getFindAllContentsWithIdentifierQuery(e)).toPromise()]:[2,this.dbService.execute(Re.a.getFindAllContentsQuery()).toPromise()]}))}))},e.prototype.getPkgVersionFromFile=function(e,t){return co(this,void 0,void 0,(function(){return so(this,(function(n){switch(n.label){case 0:return[4,this.fileService.readAsText(e.concat(t),q.FileName.MANIFEST.valueOf()).then((function(e){var n=JSON.parse(e).archive.items;return n?n.find((function(e){return e.identifier===t})).pkgVersion:0})).catch((function(){return-1}))];case 1:return[2,n.sent()]}}))}))},e.prototype.generateMoveContentResponses=function(e,t){return co(this,void 0,void 0,(function(){var n,r,i,o,a,c,s,u;return so(this,(function(f){switch(f.label){case 0:n=[],r=[],i=0,o=t,f.label=1;case 1:return i<o.length?(a=o[i],[4,this.getPkgVersionFromFile(e.destinationFolder,a[uo])]):[3,4];case 2:c=f.sent(),s=Re.a.readPkgVersion(JSON.parse(a[fo])),-1!==c&&(c>s?(u={identifier:a[uo],status:er.HIGHER_VERSION_IN_DESTINATION},n.push(u),r.push(u)):c<s?(u={identifier:a[uo],status:er.LOWER_VERSION_IN_DESTINATION},n.push(u),r.push(u)):(u={identifier:a[uo],status:er.SAME_VERSION_IN_BOTH},r.push(u))),f.label=3;case 3:return i++,[3,1];case 4:return[2,{moveContentDiffPkgList:n,moveContentDupContentList:r}]}}))}))},e}(),po=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ho=function(e){function t(n){var r=e.call(this,n,"CANCELLED")||this;return Object.setPrototypeOf(r,t.prototype),r}return po(t,e),t}(ue.a),Eo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},bo=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},yo=p.b.COLUMN_NAME_IDENTIFIER,vo=p.b.COLUMN_NAME_PATH,_o=function(){function e(e){this.eventsBusService=e,this.contentsTransferred=0}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return Eo(t,void 0,void 0,(function(){var t,n,r,i,o;return bo(this,(function(a){switch(a.label){case 0:t=function(t){var r,i;return bo(this,(function(o){switch(o.label){case 0:return e.hasTransferCancelled?[4,n.deleteFolder(e.destinationFolder.concat("temp","/"))]:[3,2];case 1:throw o.sent(),new ho("CANCELLED");case 2:if((r=e.duplicateContents.find((function(e){return e.identifier===t[yo]})))&&!K.a.isEmpty(e.duplicateContents))return[3,7];i=e.destinationFolder.concat("temp","/"),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,n.copyFolder(t[vo],i+t[yo])];case 4:return o.sent(),[3,6];case 5:return o.sent(),[3,6];case 6:return n.emitContentTransferProgress(e),[2,"continue"];case 7:if(!e.existingContentAction)return n.emitContentTransferProgress(e),[2,"continue"];if(r.status===er.SAME_VERSION_IN_BOTH)return n.emitContentTransferProgress(e),[2,"continue"];switch(e.existingContentAction){case di.ExistingContentAction.KEEP_HIGER_VERSION:return[3,8];case di.ExistingContentAction.KEEP_LOWER_VERSION:return[3,11];case di.ExistingContentAction.KEEP_SOURCE:return[3,14];case di.ExistingContentAction.IGNORE:case di.ExistingContentAction.KEEP_DESTINATION:return[3,17]}return[3,17];case 8:return r.status===er.HIGHER_VERSION_IN_DESTINATION?[3,17]:[4,n.copyToTempDestination(e,t,r)];case 9:return o.sent(),[4,n.removeSourceAndDestination(e,t,r)];case 10:return o.sent(),[3,17];case 11:return r.status===er.LOWER_VERSION_IN_DESTINATION?[3,17]:[4,n.copyToTempDestination(e,t,r)];case 12:return o.sent(),[4,n.removeSourceAndDestination(e,t,r)];case 13:return o.sent(),[3,17];case 14:return[4,n.copyToTempDestination(e,t,r)];case 15:return o.sent(),[4,n.removeSourceAndDestination(e,t,r)];case 16:return o.sent(),[3,17];case 17:return n.emitContentTransferProgress(e),[2]}}))},n=this,r=0,i=e.contentsInSource,a.label=1;case 1:return r<i.length?(o=i[r],[5,t(o)]):[3,4];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2,e]}}))}))}))},e.prototype.emitContentTransferProgress=function(e){this.eventsBusService.emit({namespace:H.EventNamespace.STORAGE,event:{type:di.StorageEventType.TRANSFER_PROGRESS,payload:{progress:{transferredCount:++this.contentsTransferred,totalCount:e.contentsInSource.length}}}})},e.prototype.deleteFolder=function(e){return Eo(this,void 0,void 0,(function(){return bo(this,(function(t){return e?[2,new Promise((function(t,n){sbutility.rm(e,"",(function(){t()}),(function(e){n(e)}))}))]:[2]}))}))},e.prototype.copyFolder=function(e,t){return Eo(this,void 0,void 0,(function(){return bo(this,(function(n){return e&&t?[2,new Promise((function(n,r){sbutility.copyDirectory(e,t,(function(){n()}),(function(e){r(e)}))}))]:[2]}))}))},e.prototype.renameFolder=function(e,t){return Eo(this,void 0,void 0,(function(){return bo(this,(function(n){return e?[2,new Promise((function(n,r){sbutility.renameDirectory(e,t,(function(){n()}),(function(e){r(e)}))}))]:[2]}))}))},e.prototype.copyToTempDestination=function(e,t,n){return Eo(this,void 0,void 0,(function(){return bo(this,(function(r){switch(r.label){case 0:return[4,this.renameFolder(e.destinationFolder,n.identifier)];case 1:return r.sent(),[4,this.copyFolder(t[vo],e.destinationFolder+t[yo])];case 2:return r.sent(),[2]}}))}))},e.prototype.removeSourceAndDestination=function(e,t,n){return Eo(this,void 0,void 0,(function(){return bo(this,(function(r){switch(r.label){case 0:return[4,this.deleteFolder(e.destinationFolder.concat(n.identifier,"_temp"))];case 1:return r.sent(),[4,this.deleteFolder(t[vo])];case 2:return r.sent(),[2]}}))}))},e}(),So=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Oo=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},go=p.b.COLUMN_NAME_PATH,Co=p.b.COLUMN_NAME_IDENTIFIER,mo=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return So(t,void 0,void 0,(function(){var t,n,r;return Oo(this,(function(i){switch(i.label){case 0:this.dbService.beginTransaction(),i.label=1;case 1:i.trys.push([1,6,,7]),t=0,n=e.contentsInSource,i.label=2;case 2:return t<n.length?((r=n[t])[go]=Re.a.getBasePath(e.destinationFolder.concat(r[Co],"/")),[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[r[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:r}).toPromise()]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return this.dbService.endTransaction(!0),[3,7];case 6:return i.sent(),this.dbService.endTransaction(!1),[3,7];case 7:return[2]}}))}))})).pipe(Object(te.mapTo)(e))},e}(),Ao=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},To=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},No=function(){function e(e,t,n,r){this.appConfig=e,this.fileService=t,this.dbService=n,this.deviceInfo=r}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return Ao(t,void 0,void 0,(function(){var t,n,r,i,o,a,c;return To(this,(function(s){switch(s.label){case 0:for(n=0,r=e.duplicateContents;n<r.length;n++)switch(i=r[n],e.existingContentAction||di.ExistingContentAction.IGNORE){case di.ExistingContentAction.KEEP_HIGER_VERSION:i.status===er.HIGHER_VERSION_IN_DESTINATION&&this.addDestinationContentInDb(i.identifier,e.destinationFolder,!1);break;case di.ExistingContentAction.KEEP_LOWER_VERSION:i.status===er.LOWER_VERSION_IN_DESTINATION&&this.addDestinationContentInDb(i.identifier,e.destinationFolder,!0);break;case di.ExistingContentAction.KEEP_DESTINATION:case di.ExistingContentAction.IGNORE:i.status===er.LOWER_VERSION_IN_DESTINATION?this.addDestinationContentInDb(i.identifier,e.destinationFolder,!0):this.addDestinationContentInDb(i.identifier,e.destinationFolder,!1)}if(e.validContentIdsInDestination&&e.validContentIdsInDestination.length&&e.duplicateContents&&e.duplicateContents.length?t=this.getNewlyAddedContents(e.validContentIdsInDestination,e.duplicateContents.map((function(e){return e.identifier}))):e.validContentIdsInDestination&&e.duplicateContents.length||!e.validContentIdsInDestination||!e.validContentIdsInDestination.length||(t=e.validContentIdsInDestination),!t)return[3,4];o=0,a=t,s.label=1;case 1:return o<a.length?(c=a[o],[4,this.addDestinationContentInDb(c,e.destinationFolder,!1)]):[3,4];case 2:s.sent(),s.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))}))},e.prototype.getNewlyAddedContents=function(e,t){return e.filter((function(e){return t.find((function(t){return t!==e}))}))},e.prototype.addDestinationContentInDb=function(e,t,n){return Ao(this,void 0,void 0,(function(){var r,i,o,a,c;return To(this,(function(s){switch(s.label){case 0:r=t.concat(e),s.label=1;case 1:return s.trys.push([1,4,,5]),[4,this.fileService.readAsText(t.concat(e),q.FileName.MANIFEST.valueOf())];case 2:return i=s.sent(),o=JSON.parse(i),a=o.archive.items,[4,this.extractContentFromItem(a,r.concat("/"),o.ver,n)];case 3:return[2,s.sent()];case 4:throw c=s.sent(),console.error(c),new Error("Error while reading manifest file");case 5:return[2]}}))}))},e.prototype.extractContentFromItem=function(e,t,n,r){return Ao(this,void 0,void 0,(function(){var i,o,a,c,s,u,f,l,d,h,E,b,y,v,_,S,O,g,C,m,A,T,N,I,M,w,D,P,R;return To(this,(function(L){switch(L.label){case 0:i=[],o=[],a=0,c=e,L.label=1;case 1:return a<c.length?(P=c[a],u=(s=P).identifier,f=s.mimeType,l=Re.a.readContentType(s),d=Re.a.readPrimaryCategory(s),h=Re.a.readVisibility(s),E=Re.a.readAudience(s),b=Re.a.readPragma(s),y=s.pkgVersion,v=q.State.ONLY_SPINE.valueOf(),_=s.board,S=s.medium,O=s.gradeLevel,[4,this.dbService.read({table:p.b.TABLE_NAME,columns:[],selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[u]}).toPromise()]):[3,5];case 2:return g=L.sent()[0],C=g&&Re.a.getBasePath(g[p.b.COLUMN_NAME_PATH]),(m=Re.a.doesContentExist(g,u,y,r))&&s.status!==q.ContentStatus.DRAFT.valueOf()?g[p.b.COLUMN_NAME_VISIBILITY]===q.Visibility.DEFAULT.valueOf()&&(s=JSON.parse(g[p.b.COLUMN_NAME_LOCAL_DATA])):(m=!1,v=(q.MimeType.COLLECTION.valueOf(),q.State.ARTIFACT_AVAILABLE.valueOf())),A=Re.a.getReferenceCount(g,h),h=Re.a.getContentVisibility(g,s.objectType,h),v=Re.a.getContentState(g,v),T=m?C:t,[4,this.fileService.getDirectorySize(T)];case 3:N=L.sent(),Re.a.addOrUpdateViralityMetadata(s,this.deviceInfo.getDeviceID().toString()),R=Re.a.constructContentDBModel(u,n,JSON.stringify(s),f,l,h,T,A,v,E,b,N,_,S,O,d),g?o.push(R):i.push(R),L.label=4;case 4:return a++,[3,1];case 5:if(!i.length&&!o.length)return[3,14];this.dbService.beginTransaction(),I=0,M=i,L.label=6;case 6:return I<M.length?(P=M[I],R=P,[4,this.dbService.insert({table:p.b.TABLE_NAME,modelJson:R}).toPromise()]):[3,9];case 7:L.sent(),L.label=8;case 8:return I++,[3,6];case 9:w=0,D=o,L.label=10;case 10:return w<D.length?(P=D[w],R=P,[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[R[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:R}).toPromise()]):[3,13];case 11:L.sent(),L.label=12;case 12:return w++,[3,10];case 13:this.dbService.endTransaction(!0),L.label=14;case 14:return[2]}}))}))},e}(),Io=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Mo=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},wo=function(){function e(e){this.fileService=e}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return Io(t,void 0,void 0,(function(){var t,n=this;return Mo(this,(function(r){switch(r.label){case 0:return t=e,[4,this.validate(e.destinationFolder).then((function(e){return Io(n,void 0,void 0,(function(){return Mo(this,(function(t){switch(t.label){case 0:return[4,this.createDirectory(e)];case 1:return[2,t.sent()]}}))}))}))];case 1:return t.destinationFolder=r.sent(),[2,e]}}))}))}))},e.prototype.validate=function(e){return this.canWrite(e).then((function(){return e.endsWith("content/")||(e=e.concat("content")),e})).catch((function(){throw Error("Destination is not writable")}))},e.prototype.createDirectory=function(e){return Io(this,void 0,void 0,(function(){var t;return Mo(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),[4,this.fileService.exists(e)];case 1:if(!(t=n.sent()).nativeURL)throw new Error("Directory entry does not have a valid URL");return[2,t.nativeURL];case 2:return n.sent(),[4,this.fileService.createDir(e,!1).catch((function(e){throw new Error(e)}))];case 3:return[2,n.sent().nativeURL];case 4:return[2]}}))}))},e.prototype.canWrite=function(e){return Io(this,void 0,void 0,(function(){return Mo(this,(function(t){return[2,new Promise((function(t,n){sbutility.canWrite(e,(function(){t()}),(function(e){n(e)}))}))]}))}))},e}(),Do=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Po=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ro=p.b.COLUMN_NAME_IDENTIFIER,Lo=p.b.COLUMN_NAME_PATH,jo=function(){function e(e){this.eventsBusService=e}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return Do(t,void 0,void 0,(function(){var t,n,r;return Po(this,(function(i){switch(i.label){case 0:t=function(t){var r,i,o;return Po(this,(function(a){switch(a.label){case 0:if(r=e.contentsInSource[t],i=e.duplicateContents.find((function(e){return e.identifier===r[Ro]})),o=e.destinationFolder.concat("temp","/"),i&&!K.a.isEmpty(e.duplicateContents))return[3,9];a.label=1;case 1:return a.trys.push([1,7,,8]),[4,n.copyFolder(o.concat(r[Ro]),e.destinationFolder+r[Ro])];case 2:return a.sent(),[4,n.deleteFolder(o.concat(r[Ro]))];case 3:return a.sent(),[4,n.deleteFolder(r[Lo])];case 4:return a.sent(),t!==e.contentsInSource.length-1?[3,6]:[4,n.deleteFolder(o)];case 5:a.sent(),a.label=6;case 6:return[3,8];case 7:return a.sent(),[3,8];case 8:return[2,"continue"];case 9:if(!e.existingContentAction)return[2,"continue"];if(i.status===er.SAME_VERSION_IN_BOTH)return[2,"continue"];switch(e.existingContentAction){case di.ExistingContentAction.KEEP_HIGER_VERSION:return[3,10];case di.ExistingContentAction.KEEP_LOWER_VERSION:return[3,12];case di.ExistingContentAction.KEEP_SOURCE:return[3,14];case di.ExistingContentAction.IGNORE:case di.ExistingContentAction.KEEP_DESTINATION:return[3,16]}return[3,16];case 10:return i.status===er.HIGHER_VERSION_IN_DESTINATION?[3,16]:[4,n.removeSourceAndDestination(e,r,i)];case 11:return a.sent(),[3,16];case 12:return i.status===er.LOWER_VERSION_IN_DESTINATION?[3,16]:[4,n.removeSourceAndDestination(e,r,i)];case 13:return a.sent(),[3,16];case 14:return[4,n.removeSourceAndDestination(e,r,i)];case 15:return a.sent(),[3,16];case 16:return t!==e.contentsInSource.length-1?[3,18]:[4,n.deleteFolder(o)];case 17:a.sent(),a.label=18;case 18:return[2]}}))},n=this,r=0,i.label=1;case 1:return r<e.contentsInSource.length?[5,t(r)]:[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return[2,e]}}))}))}))},e.prototype.deleteFolder=function(e){return Do(this,void 0,void 0,(function(){return Po(this,(function(t){return e?[2,new Promise((function(t,n){sbutility.rm(e,"",(function(){t()}),(function(e){n(e)}))}))]:[2]}))}))},e.prototype.copyFolder=function(e,t){return Do(this,void 0,void 0,(function(){return Po(this,(function(n){return e&&t?[2,new Promise((function(n,r){sbutility.copyDirectory(e,t,(function(){n()}),(function(e){r(e)}))}))]:[2]}))}))},e.prototype.renameFolder=function(e,t){return Do(this,void 0,void 0,(function(){return Po(this,(function(n){return e?[2,new Promise((function(n,r){sbutility.renameDirectory(e,t,(function(){n()}),(function(e){r(e)}))}))]:[2]}))}))},e.prototype.removeSourceAndDestination=function(e,t,n){return Do(this,void 0,void 0,(function(){return Po(this,(function(r){switch(r.label){case 0:return[4,this.deleteFolder(e.destinationFolder.concat(n.identifier,"_temp"))];case 1:return r.sent(),[4,this.deleteFolder(t[Lo])];case 2:return r.sent(),[2]}}))}))},e}(),Uo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ko=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};!function(e){e.SAME_VERSION_IN_BOTH="SAME_VERSION_IN_BOTH",e.HIGHER_VERSION_IN_DESTINATION="HIGHER_VERSION_IN_DESTINATION",e.LOWER_VERSION_IN_DESTINATION="LOWER_VERSION_IN_DESTINATION"}(er||(er={}));var xo,Fo=function(){function e(e,t,n,r,i){this.sdkConfig=e,this.fileService=t,this.dbService=n,this.eventsBusService=r,this.deviceInfo=i,this.context={}}return e.prototype.transfer=function(e){var t=this,n=e.contentIds,r=e.existingContentAction,i=e.deleteDestination,o=e.destinationFolder,a=e.shouldMergeInDestination,c=e.sourceFolder;return this.context.hasTransferCancelled=!1,this.context.shouldMergeInDestination=a,this.context.contentIds=n,this.context.existingContentAction=r,this.context.deleteDestination=i,this.context.destinationFolder=o,this.context.sourceFolder=c,new wo(this.fileService).execute(this.context).pipe(Object(te.mergeMap)((function(e){return(new io).execute(e)})),Object(te.mergeMap)((function(e){return new eo(t.dbService).execute(e)})),Object(te.mergeMap)((function(e){return new ro(t.fileService,t.sdkConfig.appConfig).execute(e)})),Object(te.mergeMap)((function(e){return new lo(t.dbService,t.fileService).execute(e)})),Object(te.mergeMap)((function(e){return new _o(t.eventsBusService).execute(e)})),Object(te.mergeMap)((function(e){return new jo(t.eventsBusService).execute(e)})),Object(te.mergeMap)((function(e){return new mo(t.dbService).execute(e)})),Object(te.mergeMap)((function(e){return new No(t.sdkConfig.appConfig,t.fileService,t.dbService,t.deviceInfo).execute(e)}))).pipe(Object(te.tap)((function(){t.eventsBusService.emit({namespace:H.EventNamespace.STORAGE,event:{type:di.StorageEventType.TRANSFER_COMPLETED}})})),Object(te.mapTo)(void 0),Object(te.catchError)((function(e){return e instanceof ho?t.eventsBusService.emit({namespace:H.EventNamespace.STORAGE,event:{type:di.StorageEventType.TRANSFER_REVERT_COMPLETED}}):e instanceof ao?t.eventsBusService.emit({namespace:H.EventNamespace.STORAGE,event:{type:di.StorageEventType.TRANSFER_FAILED_DUPLICATE_CONTENT}}):e instanceof Qi&&t.eventsBusService.emit({namespace:H.EventNamespace.STORAGE,event:{type:di.StorageEventType.TRANSFER_FAILED_LOW_MEMORY}}),console.error("Error",e),Object(M.throwError)(e)})))},e.prototype.cancel=function(){var e=this;return Object(M.defer)((function(){return Uo(e,void 0,void 0,(function(){return ko(this,(function(e){return this.context.hasTransferCancelled=!0,[2]}))}))})).pipe(Object(te.mapTo)(void 0))},e}(),Bo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Vo=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Go=function(){function e(e,t){this.fileService=e,this.dbService=t}return e.prototype.execute=function(e){var t=this;return Object(M.defer)((function(){return Bo(t,void 0,void 0,(function(){var t,n,r,i,o;return Vo(this,(function(a){switch(a.label){case 0:return[4,this.getContentsInDb()];case 1:return t=a.sent(),e.currentStoragePath?(n=Re.a.getContentRootDir(e.currentStoragePath).concat("/"),"ios"===window.device.platform.toLowerCase()&&(n="file://"+n),[4,this.getFolderList(n)]):[3,5];case 2:return r=a.sent(),i=e,[4,this.getNewlyAddedContents(r,t)];case 3:return i.newlyAddedIdentifiers=a.sent(),o=e,[4,this.getDeletedContents(r,t)];case 4:return o.deletedIdentifiers=a.sent(),[3,6];case 5:e.newlyAddedIdentifiers=[],e.deletedIdentifiers=t,a.label=6;case 6:return[2]}}))}))})).pipe(Object(te.mapTo)(e))},e.prototype.doesDestinationStorageExist=function(e){return Bo(this,void 0,void 0,(function(){return Vo(this,(function(t){switch(t.label){case 0:return[4,this.fileService.exists(e).then((function(e){return!0})).catch((function(){return!1}))];case 1:return[2,t.sent()]}}))}))},e.prototype.getContentsInDb=function(){return Bo(this,void 0,void 0,(function(){return Vo(this,(function(e){return[2,this.dbService.execute(Re.a.getFindAllContentsQuery()).pipe(Object(te.map)((function(e){return e.filter((function(e){return"textbookunit"!==e[p.b.COLUMN_NAME_CONTENT_TYPE].toLowerCase()})).map((function(e){return e[p.b.COLUMN_NAME_IDENTIFIER]}))}))).toPromise()]}))}))},e.prototype.getNewlyAddedContents=function(e,t){return e.filter((function(e){return!K.a.contains(t,e)}))},e.prototype.getDeletedContents=function(e,t){return t.filter((function(t){return!K.a.contains(e,t)}))},e.prototype.getFolderList=function(e){return Bo(this,void 0,void 0,(function(){return Vo(this,(function(t){switch(t.label){case 0:return[4,this.fileService.listDir(e.replace(/\/$/,"")).then((function(e){return e.map((function(e){return e.name}))})).catch((function(){return[]}))];case 1:return[2,t.sent()]}}))}))},e}(),Yo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ho=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},qo=function(){function e(e){this.storageHandler=e}return e.prototype.exexute=function(e){var t=this;return Object(M.defer)((function(){return Yo(t,void 0,void 0,(function(){var t,n,r;return Ho(this,(function(i){switch(i.label){case 0:return e.deletedIdentifiers.length?[4,this.storageHandler.deleteContentsFromDb(e.deletedIdentifiers)]:[3,2];case 1:i.sent(),i.label=2;case 2:if(!e.newlyAddedIdentifiers.length)return[3,6];t=0,n=e.newlyAddedIdentifiers,i.label=3;case 3:return t<n.length?(r=n[t],[4,this.storageHandler.addDestinationContentInDb(r,Re.a.getContentRootDir(e.currentStoragePath).concat("/"),!1)]):[3,6];case 4:i.sent(),i.label=5;case 5:return t++,[3,3];case 6:return[2]}}))}))})).pipe(Object(te.mapTo)(e))},e}(),Ko=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},zo=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Wo=function(){function e(e,t,n,r){this.appConfig=e,this.fileService=t,this.dbService=n,this.deviceInfo=r}return e.prototype.addDestinationContentInDb=function(e,t,n){return Ko(this,void 0,void 0,(function(){var r,i=this;return zo(this,(function(o){switch(o.label){case 0:return r=t.concat(e),[4,this.fileService.readAsText(t.concat(e),q.FileName.MANIFEST.valueOf()).then((function(e){return Ko(i,void 0,void 0,(function(){var t,i;return zo(this,(function(o){switch(o.label){case 0:return t=JSON.parse(e),i=t.archive.items,[4,this.extractContentFromItem(i,r.concat("/"),t.ver,n)];case 1:return[2,o.sent()]}}))}))})).catch((function(e){console.error(e)}))];case 1:return o.sent(),[2]}}))}))},e.prototype.deleteContentsFromDb=function(e){return Ko(this,void 0,void 0,(function(){var t,n,r,i,o,a,c,s;return zo(this,(function(u){switch(u.label){case 0:return[4,this.dbService.execute(Re.a.getFindAllContentsWithIdentifierQuery(e)).toPromise()];case 1:for(t=u.sent(),n=0,r=t;n<r.length;n++)c=r[n],(s=c)[p.b.COLUMN_NAME_MIME_TYPE]===q.MimeType.COLLECTION&&s[p.b.COLUMN_NAME_REF_COUNT]>1?s[p.b.COLUMN_NAME_CONTENT_STATE]=q.State.ARTIFACT_AVAILABLE:s[p.b.COLUMN_NAME_CONTENT_STATE]=q.State.ONLY_SPINE,s[p.b.COLUMN_NAME_VISIBILITY]===q.Visibility.DEFAULT&&s[p.b.COLUMN_NAME_REF_COUNT]>0&&(i=s[p.b.COLUMN_NAME_REF_COUNT],s[p.b.COLUMN_NAME_REF_COUNT]=Re.a.addOrUpdateRefCount(i-1)),s[p.b.COLUMN_NAME_VISIBILITY]=q.Visibility.PARENT;this.dbService.beginTransaction(),o=0,a=t,u.label=2;case 2:return o<a.length?(c=a[o],s=c,[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[s[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:s}).toPromise()]):[3,5];case 3:u.sent(),u.label=4;case 4:return o++,[3,2];case 5:return this.dbService.endTransaction(!0),[2]}}))}))},e.prototype.extractContentFromItem=function(e,t,n,r){return Ko(this,void 0,void 0,(function(){var i,o,a,c,s,u,f,l,d,h,E,b,y,v,_,S,O,g,C,m,A,T,N,I,M,w,D,P,R;return zo(this,(function(L){switch(L.label){case 0:i=[],o=[],a=0,c=e,L.label=1;case 1:return a<c.length?(P=c[a],u=(s=P).identifier,f=s.mimeType,l=Re.a.readContentType(s),d=Re.a.readPrimaryCategory(s),h=Re.a.readVisibility(s),E=Re.a.readAudience(s),b=Re.a.readPragma(s),y=s.pkgVersion,v=q.State.ONLY_SPINE.valueOf(),_=s.board,S=s.medium,O=s.gradeLevel,[4,this.dbService.read({table:p.b.TABLE_NAME,columns:[],selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[u]}).toPromise()]):[3,5];case 2:return g=L.sent()[0],C=g&&Re.a.getBasePath(g[p.b.COLUMN_NAME_PATH]),(m=Re.a.doesContentExist(g,u,y,r))&&s.status!==q.ContentStatus.DRAFT.valueOf()?g[p.b.COLUMN_NAME_VISIBILITY]===q.Visibility.DEFAULT.valueOf()&&(s=JSON.parse(g[p.b.COLUMN_NAME_LOCAL_DATA])):(m=!1,v=(q.MimeType.COLLECTION.valueOf(),q.State.ARTIFACT_AVAILABLE.valueOf())),A=Re.a.getReferenceCount(g,h),h=Re.a.getContentVisibility(g,s.objectType,h),v=Re.a.getContentState(g,v),T=m?C:t,[4,this.fileService.getDirectorySize(T)];case 3:N=L.sent(),Re.a.addOrUpdateViralityMetadata(s,this.deviceInfo.getDeviceID().toString()),R=Re.a.constructContentDBModel(u,n,JSON.stringify(s),f,l,h,T,A,v,E,b,N,_,S,O,d),g?o.push(R):i.push(R),L.label=4;case 4:return a++,[3,1];case 5:if(!i.length&&!o.length)return[3,14];this.dbService.beginTransaction(),I=0,M=i,L.label=6;case 6:return I<M.length?(P=M[I],R=P,[4,this.dbService.insert({table:p.b.TABLE_NAME,modelJson:R}).toPromise()]):[3,9];case 7:L.sent(),L.label=8;case 8:return I++,[3,6];case 9:w=0,D=o,L.label=10;case 10:return w<D.length?(P=D[w],R=P,[4,this.dbService.update({table:p.b.TABLE_NAME,selection:p.b.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[R[p.b.COLUMN_NAME_IDENTIFIER]],modelJson:R}).toPromise()]):[3,13];case 11:L.sent(),L.label=12;case 12:return w++,[3,10];case 13:this.dbService.endTransaction(!0),L.label=14;case 14:return[2]}}))}))},e}(),Xo=function(){return(Xo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Jo=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Qo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},$o=function(e,t){return function(n,r){t(n,r,e)}},Zo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ea=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ta=function(){function e(e,t,n,r,i,o){this.eventsBusService=e,this.sharedPreferences=t,this.dbService=n,this.deviceInfo=r,this.fileService=i,this.sdkConfig=o,this.contentsToTransfer=new hn(this.sharedPreferences,ne.n.KEY_TO_TRANSFER_LIST,(function(e){return e})),this.transferContentHandler=new Fo(this.sdkConfig,this.fileService,this.dbService,this.eventsBusService,this.deviceInfo)}var t;return t=e,e.prototype.onInit=function(){var e=this;return Object(M.zip)(this.deviceInfo.getStorageVolumes(),this.getStorageDestination()).pipe(Object(te.tap)((function(t){e.availableStorageVolumes=t[0],e.currentStorageDestination=t[1],e.scanStorage().toPromise()})),Object(te.mapTo)(void 0))},e.prototype.getStorageDestinationDirectoryPath=function(){var e=this,t=this.availableStorageVolumes.find((function(t){return t.storageDestination===e.currentStorageDestination}));return t&&t.info.contentStoragePath},e.prototype.cancelTransfer=function(){return this.transferContentHandler.cancel()},e.prototype.getStorageDestination=function(){return this.sharedPreferences.getString(t.STORAGE_DESTINATION).pipe(Object(te.map)((function(e){return e||di.StorageDestination.INTERNAL_STORAGE})))},e.prototype.getStorageDestinationVolumeInfo=function(){var e=this;return this.getStorageDestination().pipe(Object(te.map)((function(t){return e.availableStorageVolumes.find((function(e){return e.storageDestination===t}))})))},e.prototype.getToTransferContents=function(){return Object(M.of)([])},e.prototype.getTransferringContent=function(){return Object(M.of)(void 0)},e.prototype.retryCurrentTransfer=function(){return this.lastTransferContentsRequest?this.transferContents(Xo(Xo({},this.lastTransferContentsRequest),{shouldMergeInDestination:!0})):Object(M.of)(void 0)},e.prototype.transferContents=function(e){var n=this;return this.lastTransferContentsRequest=e,e.sourceFolder=this.getStorageDestinationDirectoryPath(),this.transferContentHandler.transfer(e).pipe(Object(te.mergeMap)((function(){return n.getStorageDestination()})),Object(te.map)((function(e){return e===di.StorageDestination.EXTERNAL_STORAGE?di.StorageDestination.INTERNAL_STORAGE:di.StorageDestination.EXTERNAL_STORAGE})),Object(te.tap)((function(e){n.currentStorageDestination=e})),Object(te.mergeMap)((function(e){return n.sharedPreferences.putString(t.STORAGE_DESTINATION,e)})))},e.prototype.scanStorage=function(){var e=this,t=this.getStorageDestinationDirectoryPath(),n={currentStoragePath:t};return t||this.resetStorageDestination(),new Go(this.fileService,this.dbService).execute(n).pipe(Object(te.mergeMap)((function(t){var n=new Wo(e.sdkConfig.appConfig,e.fileService,e.dbService,e.deviceInfo);return new qo(n).exexute(t)})),Object(te.mapTo)(!0))},e.prototype.resetStorageDestination=function(){return Zo(this,void 0,void 0,(function(){return ea(this,(function(e){return this.currentStorageDestination=di.StorageDestination.INTERNAL_STORAGE,[2,this.sharedPreferences.putString(t.STORAGE_DESTINATION,di.StorageDestination.INTERNAL_STORAGE).toPromise()]}))}))},e.STORAGE_DESTINATION=ne.n.KEY_STORAGE_DESTINATION,e=t=Jo([Object(N.injectable)(),$o(0,Object(N.inject)(I.b.EVENTS_BUS_SERVICE)),$o(1,Object(N.inject)(I.b.SHARED_PREFERENCES)),$o(2,Object(N.inject)(I.b.DB_SERVICE)),$o(3,Object(N.inject)(I.b.DEVICE_INFO)),$o(4,Object(N.inject)(I.b.FILE_SERVICE)),$o(5,Object(N.inject)(I.b.SDK_CONFIG)),Qo("design:paramtypes",[Object,Object,a.DbService,Object,Object,Object])],e)}(),na=n(62),ra=function(){function e(){}return e.constructNotificationDBModel=function(e){return{message_id:e.id,expiry_time:e.expiry,display_time:e.displayTime,received_at:Date.now(),notification_json:JSON.stringify(e),is_read:e.isRead}},e.getFilterForNotification=function(e){switch(e.notificationStatus){case na.NotificationStatus.ALL:f.COLUMN_NAME_NOTIFICATION_DISPLAY_TIME+" <= ?\n                        AND "+f.COLUMN_NAME_EXPIRY_TIME+" > ?",[Date.now().toString(),Date.now().toString()];break;case na.NotificationStatus.UNREAD:f.COLUMN_NAME_NOTIFICATION_DISPLAY_TIME+" <= ?\n                        AND "+f.COLUMN_NAME_EXPIRY_TIME+" > ? AND\n                        AND "+f.COLUMN_NAME_IS_READ+" > ?",[Date.now().toString(),Date.now().toString(),0];break;case na.NotificationStatus.READ:default:f.COLUMN_NAME_NOTIFICATION_DISPLAY_TIME+" <= ?\n                        AND "+f.COLUMN_NAME_EXPIRY_TIME+" > ?\n                        AND "+f.COLUMN_NAME_IS_READ+" > ?",[Date.now().toString(),Date.now().toString(),1]}return{table:f.TABLE_NAME,orderBy:f.COLUMN_NAME_NOTIFICATION_RECEIVED_AT+" desc"}},e}(),ia=n(60),oa=n(77),aa=function(){return(aa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ca=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},sa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ua=function(e,t){return function(n,r){t(n,r,e)}},fa=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},la=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},pa=f.COLUMN_NAME_NOTIFICATION_JSON,da=function(){function e(e,t,n,r){this.dbService=e,this.sharedPreferences=t,this.profileService=n,this.keyValueStore=r,this._notifications$=new M.BehaviorSubject([]),this._notificationTrigger$=new M.Subject}var t;return t=e,Object.defineProperty(e.prototype,"notifications$",{get:function(){return this._notifications$},enumerable:!1,configurable:!0}),e.prototype.onInit=function(){var e=this,t=Object(M.interval)(36e5).pipe(Object(te.startWith)(null),Object(te.mapTo)(null)),n=this._notificationTrigger$.pipe(Object(te.startWith)(null),Object(te.throttleTime)(1e3));return Object(M.combineLatest)([t,n]).pipe(Object(te.switchMap)((function(){return Object(M.defer)((function(){return fa(e,void 0,void 0,(function(){var e,t;return la(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.fetchNotificationAndUserFeed()];case 1:return e=n.sent(),this._notifications$.next(e),[3,3];case 2:return t=n.sent(),console.error(t),[3,3];case 3:return[2]}}))}))}))})),Object(te.mapTo)(void 0))},e.prototype.addNotification=function(e){var t=this;return e.actionData&&"codePush"===e.actionData.actionType&&e.actionData.deploymentKey&&this.sharedPreferences.putString(ne.d.DEPLOYMENT_KEY,e.actionData.deploymentKey),this.dbService.read({table:f.TABLE_NAME,selection:f.COLUMN_NAME_MESSAGE_ID+"= ?",selectionArgs:[e.id.toString()],limit:"1"}).pipe(Object(te.mergeMap)((function(n){return n&&n.length?t.dbService.update({table:f.TABLE_NAME,selection:f.COLUMN_NAME_MESSAGE_ID+"= ?",selectionArgs:[e.id.toString()],modelJson:ra.constructNotificationDBModel(e)}).pipe(Object(te.mapTo)(!0)):t.dbService.insert({table:f.TABLE_NAME,modelJson:ra.constructNotificationDBModel(e)}).pipe(Object(te.mapTo)(!0))})),Object(te.tap)((function(){return t.triggerNotificationChange()})))},e.prototype.deleteNotification=function(e){var t=this;if("USER_FEED"===e.source)return this.profileService.deleteUserFeedEntry({feedEntryId:e.id,category:se.UserFeedCategory.NOTIFICATION}).pipe(Object(te.tap)((function(){return t.triggerNotificationChange()})));var n=("DELETE FROM "+f.TABLE_NAME+" ").concat(e.id?"WHERE "+f.COLUMN_NAME_MESSAGE_ID+" = "+e.id:"");return this.dbService.execute(n).pipe(Object(te.mapTo)(!0),Object(te.tap)((function(){return t.triggerNotificationChange()})))},e.prototype.getAllNotifications=function(e){return this.dbService.read(ra.getFilterForNotification(e)).pipe(Object(te.map)((function(e){return e.map((function(e){var t=JSON.parse(e[pa]);return t.isRead=e[f.COLUMN_NAME_IS_READ],t}))})))},e.prototype.updateNotification=function(e){var t=this;return"USER_FEED"===e.source?this.profileService.updateUserFeedEntry({feedEntryId:e.id,category:se.UserFeedCategory.NOTIFICATION,request:{status:e.isRead?se.UserFeedStatus.READ:se.UserFeedStatus.UNREAD}}).pipe(Object(te.tap)((function(){return t.triggerNotificationChange()}))):this.dbService.read({table:f.TABLE_NAME,selection:f.COLUMN_NAME_MESSAGE_ID+"= ?",selectionArgs:[e.id.toString()],limit:"1"}).pipe(Object(te.mergeMap)((function(n){return n&&n.length?t.dbService.update({table:f.TABLE_NAME,selection:f.COLUMN_NAME_MESSAGE_ID+"= ?",selectionArgs:[e.id.toString()],modelJson:ra.constructNotificationDBModel(e)}).pipe(Object(te.mapTo)(!0)):Object(M.of)(!1)})),Object(te.tap)((function(){return t.triggerNotificationChange()})))},e.prototype.deleteAllNotifications=function(){var e=this;return Object(M.defer)((function(){return fa(e,void 0,void 0,(function(){var e,t,n=this;return la(this,(function(r){switch(r.label){case 0:e=this._notifications$.getValue(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Promise.all(e.map((function(e){return n.deleteNotification(e).toPromise()})))];case 2:return r.sent(),[2,!0];case 3:return t=r.sent(),console.error(t),[2,!1];case 4:return[2]}}))}))}))},e.prototype.fetchNotificationAndUserFeed=function(){return fa(this,void 0,void 0,(function(){var e,n,r,i,o,a=this;return la(this,(function(c){switch(c.label){case 0:return e=function(){return fa(a,void 0,void 0,(function(){return la(this,(function(e){return[2,this.getAllNotifications({notificationStatus:na.NotificationStatus.ALL}).toPromise()]}))}))},n=function(){return fa(a,void 0,void 0,(function(){var e,n,r;return la(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,this.profileService.getActiveProfileSession().toPromise()];case 1:e=i.sent(),n=t.USER_NOTIFICATION_FEED_KEY+"_"+(e.managedSession?e.managedSession.uid:e.uid),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.profileService.getUserFeed().toPromise().then((function(e){return e.filter((function(e){return e.category===se.UserFeedCategory.NOTIFICATION}))}))];case 3:return r=i.sent(),this.keyValueStore.setValue(n,Object(ia.gzip)(JSON.stringify(r))).toPromise(),[2,r];case 4:return i.sent(),[2,this.keyValueStore.getValue(n).toPromise().then((function(e){return JSON.parse(Object(oa.ungzip)(e,{to:"string"}))})).catch((function(e){return console.error(e),[]}))];case 5:return[3,7];case 6:return i.sent(),[2,[]];case 7:return[2]}}))}))},[4,Promise.all([e(),n()])];case 1:return r=c.sent(),i=r[0],o=r[1],[2,i.concat(o.map((function(e){return aa({id:e.id,source:"USER_FEED",displayTime:new Date(e.createdOn).getTime(),expiry:e.expireOn?new Date(e.expireOn).getTime():0,isRead:"read"===e.status?1:0},e.data)}))).sort((function(e,t){return new Date(t.displayTime).getTime()-new Date(e.displayTime).getTime()}))]}}))}))},e.prototype.triggerNotificationChange=function(){return fa(this,void 0,void 0,(function(){return la(this,(function(e){return this._notificationTrigger$.next(null),[2]}))}))},e.USER_NOTIFICATION_FEED_KEY="user_notification_feed",e=t=ca([Object(N.injectable)(),ua(0,Object(N.inject)(I.b.DB_SERVICE)),ua(1,Object(N.inject)(I.b.SHARED_PREFERENCES)),ua(2,Object(N.inject)(I.b.PROFILE_SERVICE)),ua(3,Object(N.inject)(I.b.KEY_VALUE_STORE)),sa("design:paramtypes",[a.DbService,Object,Object,Object])],e)}();!function(e){e.CUSTODIAN_ORG_ID="custodianOrgId",e.COURSE_FRAMEWORK_ID="courseFrameworkId",e.ERROR_LOG_SYNC_SETTINGS="errorLogSyncSettings"}(xo||(xo={}));var ha=function(){function e(){}return e.mapErrorSatckDBEntryToErrorStack=function(e){return{appver:e[d.COLUMN_NAME_APP_VERSION],pageid:e[d.COLUMN_NAME_PAGE_ID],ts:e[d.COLUMN_NAME_TIME_STAMP],log:e[d.COLUMN_NAME_ERROR_LOG]}},e.mapErrorStackToErrorStackDBEntry=function(e){var t;return(t={})[d.COLUMN_NAME_APP_VERSION]=e.appver,t[d.COLUMN_NAME_PAGE_ID]=e.pageid,t[d.COLUMN_NAME_TIME_STAMP]=e.ts,t[d.COLUMN_NAME_ERROR_LOG]=e.log,t},e}(),Ea=d._ID,ba=function(){function e(e,t,n,r,i){this.apiService=e,this.dbService=t,this.errorLoggerConfig=n,this.networkInfoService=r,this.errorStackSyncRequestDecorator=i}return e.prototype.handle=function(e){var t=this;return this.processBatch(e).pipe(Object(te.expand)((function(n){return n>0?t.processBatch(e):M.EMPTY})),Object(te.mapTo)(void 0),Object(te.catchError)((function(){return Object(M.of)(void 0)})))},e.prototype.processBatch=function(e){var t=this;return this.getErrorStackBatch(e).pipe(Object(te.mergeMap)((function(e){return t.sync(e)})),Object(te.mergeMap)((function(e){return t.clearLogs(e)})),Object(te.map)((function(e){return e.length})))},e.prototype.getErrorStackBatch=function(e){return this.dbService.execute("\n                SELECT * FROM "+d.TABLE_NAME+"\n                LIMIT "+e+"\n            ")},e.prototype.clearLogs=function(e){return e.length?this.dbService.execute("\n                DELETE FROM "+d.TABLE_NAME+"\n                WHERE "+d._ID+" IN ("+e.map((function(e){return e[Ea]})).join(",")+")\n            ").pipe(Object(te.mapTo)(e)):Object(M.of)(e)},e.prototype.sync=function(e){var t=this;return e.length?this.networkInfoService.networkStatus$.pipe(Object(te.mergeMap)((function(n){if(n===ee.NetworkStatus.OFFLINE)return Object(M.throwError)(new Error("Fake Error"));var r={pdata:void 0,context:void 0,logs:e.map((function(e){return ha.mapErrorSatckDBEntryToErrorStack(e)}))};return t.errorStackSyncRequestDecorator.decorate(r).pipe(Object(te.mergeMap)((function(){var e=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(t.errorLoggerConfig.errorLoggerApiPath).withBearerToken(!0).withBody({request:r}).build();return t.apiService.fetch(e)})))})),Object(te.mapTo)(e)):Object(M.of)(e)},e}(),ya=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},va=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},_a=function(){function e(e,t,n){this.apiConfig=e,this.deviceInfo=t,this.appInfo=n}return e.prototype.decorate=function(e){var t=this;return Object(M.defer)((function(){return ya(t,void 0,void 0,(function(){return va(this,(function(t){switch(t.label){case 0:return this.patchPData(e),[4,this.patchContext(e)];case 1:return t.sent(),[2,e]}}))}))}))},e.prototype.patchContext=function(e){return ya(this,void 0,void 0,(function(){var t,n;return va(this,(function(r){switch(r.label){case 0:return t=e,n={did:this.deviceInfo.getDeviceID()},[4,this.deviceInfo.getDeviceSpec().toPromise()];case 1:return t.context=(n.spec=r.sent(),n),[2]}}))}))},e.prototype.patchPData=function(e){e.pdata=new U.ProducerData,e.pdata.id=this.apiConfig.api_authentication.producerId;var t=e.pdata.pid;t?e.pdata.pid=t:this.apiConfig.api_authentication.producerUniqueId?e.pdata.pid=this.apiConfig.api_authentication.producerUniqueId:e.pdata.pid="sunbird.android",e.pdata.ver||(e.pdata.ver=this.appInfo.getVersionName())},e}(),Sa=function(){return(Sa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Oa=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ga=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ca=function(e,t){return function(n,r){t(n,r,e)}},ma=function(){function e(e,t,n,r,i,o,a,c){this.systemSettingsService=e,this.dbService=t,this.appInfo=n,this.apiService=r,this.sdkConfig=i,this.errorLoggerService=o,this.deviceInfo=a,this.sharedPreferences=c,this.errorLoggerConfig=this.sdkConfig.errorLoggerConfig,this.errorStackSyncRequestDecorator=new _a(this.sdkConfig.apiConfig,this.deviceInfo,this.appInfo),this.errorStackSyncHandler=new ba(this.apiService,this.dbService,this.errorLoggerConfig,this.errorLoggerService,this.errorStackSyncRequestDecorator)}var t;return t=e,e.prototype.onInit=function(){var e=this;return this.sharedPreferences.getString(ne.i.KEY_ERROR_LOG_LAST_SYNCED_TIME_STAMP).pipe(Object(te.mergeMap)((function(t){return t?Object(M.of)(void 0):e.sharedPreferences.putString(ne.i.KEY_ERROR_LOG_LAST_SYNCED_TIME_STAMP,Date.now()+"")})))},e.prototype.logError=function(e){var t=this,n={appver:this.appInfo.getVersionName(),pageid:e.pageId,ts:Date.now(),log:e.stacktrace};return this.dbService.insert({table:d.TABLE_NAME,modelJson:ha.mapErrorStackToErrorStackDBEntry(n)}).pipe(Object(te.mergeMap)((function(){return t.getErrorCount()})),Object(te.mergeMap)((function(e){return t.getErrorLogSyncSettings().pipe(Object(te.map)((function(t){return Sa(Sa({},t),{errorCount:e})})))})),Object(te.map)((function(e){return{errorCount:e.errorCount,errorLogSyncFrequency:e.frequency,errorLogSyncBandwidth:e.bandwidth}})),Object(te.mergeMap)((function(e){var n=e.errorCount,r=e.errorLogSyncFrequency,i=e.errorLogSyncBandwidth;return t.hasErrorLogSyncFrequencyCrossed(n,r).pipe(Object(te.map)((function(e){return{shouldSync:e,errorLogSyncBandwidth:i}})))})),Object(te.mergeMap)((function(e){var n=e.shouldSync,r=e.errorLogSyncBandwidth;return n?t.errorStackSyncHandler.handle(r).pipe(Object(te.mergeMap)((function(){return t.sharedPreferences.putString(ne.i.KEY_ERROR_LOG_LAST_SYNCED_TIME_STAMP,Date.now()+"")}))):Object(M.of)(void 0)})))},e.prototype.hasErrorLogSyncFrequencyCrossed=function(e,t){return this.sharedPreferences.getString(ne.i.KEY_ERROR_LOG_LAST_SYNCED_TIME_STAMP).pipe(Object(te.map)((function(e){return parseInt(e,10)})),Object(te.map)((function(e){return e+t<Date.now()})))},e.prototype.getErrorCount=function(){return this.dbService.execute("SELECT COUNT(*) as count FROM "+d.TABLE_NAME).pipe(Object(te.map)((function(e){return e[0].count})))},e.prototype.getErrorLogSyncSettings=function(){var e={id:t.ERROR_LOG_SYNC_SETTINGS};return this.systemSettingsService.getSystemSettings(e).pipe(Object(te.map)((function(e){return JSON.parse(e.value)})))},e.ERROR_LOG_SYNC_SETTINGS=xo.ERROR_LOG_SYNC_SETTINGS,e=t=Oa([Object(N.injectable)(),Ca(0,Object(N.inject)(I.b.SYSTEM_SETTINGS_SERVICE)),Ca(1,Object(N.inject)(I.b.DB_SERVICE)),Ca(2,Object(N.inject)(I.b.APP_INFO)),Ca(3,Object(N.inject)(I.b.API_SERVICE)),Ca(4,Object(N.inject)(I.b.SDK_CONFIG)),Ca(5,Object(N.inject)(I.b.NETWORKINFO_SERVICE)),Ca(6,Object(N.inject)(I.b.DEVICE_INFO)),Ca(7,Object(N.inject)(I.b.SHARED_PREFERENCES)),ga("design:paramtypes",[Object,a.DbService,Object,Object,Object,Object,Object,Object])],e)}(),Aa=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Ta=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Na=function(){function e(){var e=this;navigator.connection.type===Connection.NONE?this.networkStatusSource=new M.BehaviorSubject(ee.NetworkStatus.OFFLINE):this.networkStatusSource=new M.BehaviorSubject(ee.NetworkStatus.ONLINE),window.addEventListener("online",(function(){e.networkStatusSource.next(ee.NetworkStatus.ONLINE)}),!1),window.addEventListener("offline",(function(){e.networkStatusSource.next(ee.NetworkStatus.OFFLINE)}),!1),this.networkStatus$=this.networkStatusSource.asObservable()}return e=Aa([Object(N.injectable)(),Ta("design:paramtypes",[])],e)}(),Ia=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ma=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},wa=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Da=function(e){function t(){return e.call(this,8,23)||this}return Ia(t,e),t.prototype.apply=function(e){return Ma(this,void 0,void 0,(function(){var t=this;return wa(this,(function(n){return this.queries().forEach((function(n){return Ma(t,void 0,void 0,(function(){return wa(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[2,void 0]}))}))},t.prototype.queries=function(){return[y.a.getCreateEntry()]},t}(a.Migration),Pa=y.a.COLUMN_NAME_USER_ID,Ra=y.a.COLUMN_NAME_QUERY,La=y.a.COLUMN_NAME_TIME_STAMP,ja=function(){function e(){}return e.mapSearchHistoryDbEntryToSearchEntry=function(e){return{uid:e[Pa],query:e[Ra],timestamp:e[La]}},e}(),Ua=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ka=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xa=function(e,t){return function(n,r){t(n,r,e)}},Fa=function(){function e(e,t){this.dbService=e,this.profileService=t}var t;return t=e,e.prototype.addEntry=function(e){var n=this,r=e.query,i=e.namespace;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(e){var t,o=e.uid;return n.dbService.insert({table:y.a.TABLE_NAME,modelJson:(t={},t[y.a.COLUMN_NAME_QUERY]=r.trim(),t[y.a.COLUMN_NAME_NAMESPACE]=i,t[y.a.COLUMN_NAME_USER_ID]=o,t[y.a.COLUMN_NAME_TIME_STAMP]=Date.now(),t)}).pipe(Object(te.mapTo)(o))})),Object(te.mergeMap)((function(e){return n.dbService.execute("\n                        DELETE FROM "+y.a.TABLE_NAME+" WHERE\n                        "+y.a._ID+" IN (SELECT "+y.a._ID+" FROM "+y.a.TABLE_NAME+" WHERE\n                        "+y.a.COLUMN_NAME_USER_ID+' = "'+e+'" AND\n                        '+y.a.COLUMN_NAME_NAMESPACE+' = "'+i+'"\n                        ORDER BY '+y.a.COLUMN_NAME_TIME_STAMP+" DESC\n                        LIMIT -1 OFFSET "+t.MAX_USER_SEARCH_HISTORY_ENTRIES+")\n                    ")})),Object(te.mapTo)(void 0))},e.prototype.getEntries=function(e){var t=this,n=e.like,r=e.limit,i=e.namespace;return this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(e){var o=e.uid,a="";return n&&(a="AND "+y.a.COLUMN_NAME_QUERY+' LIKE "%'+n.trim()+'%"'),t.dbService.execute("\n                        SELECT * FROM "+y.a.TABLE_NAME+" WHERE\n                        "+y.a.COLUMN_NAME_USER_ID+' = "'+o+'" AND\n                        '+y.a.COLUMN_NAME_NAMESPACE+' = "'+i+'"\n                        '+a+"\n                        ORDER BY "+y.a.COLUMN_NAME_TIME_STAMP+" DESC\n                        LIMIT "+r+"\n                    ")})),Object(te.map)((function(e){return e.map((function(e){return ja.mapSearchHistoryDbEntryToSearchEntry(e)}))})))},e.MAX_USER_SEARCH_HISTORY_ENTRIES=10,e=t=Ua([Object(N.injectable)(),xa(0,Object(N.inject)(I.b.DB_SERVICE)),xa(1,Object(N.inject)(I.b.PROFILE_SERVICE)),ka("design:paramtypes",[a.DbService,Object])],e)}(),Ba=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Va=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ga=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ya=function(e){function t(){return e.call(this,9,24)||this}return Ba(t,e),t.prototype.apply=function(e){return Va(this,void 0,void 0,(function(){var t=this;return Ga(this,(function(n){switch(n.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return n.sent(),[4,e.read({table:p.d.TABLE_NAME}).pipe(Object(te.map)((function(n){n.forEach((function(n){return Va(t,void 0,void 0,(function(){var t,r;return Ga(this,(function(i){switch(i.label){case 0:return(t=n[p.d.COLUMN_NAME_DATA])?(r=JSON.parse(t),n[p.b.COLUMN_NAME_MIME_TYPE]=r.mimeType,[4,e.update({table:p.d.TABLE_NAME,modelJson:n,selection:p.d.COLUMN_NAME_CONTENT_IDENTIFIER+" = ?",selectionArgs:[n[p.d.COLUMN_NAME_CONTENT_IDENTIFIER]]}).toPromise()]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}))}))).toPromise()];case 2:return n.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[p.d.getAlterEntryForMimeType()]},t}(a.Migration),Ha=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qa=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ka=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},za=function(e){function t(){return e.call(this,10,25)||this}return Ha(t,e),t.prototype.apply=function(e){return qa(this,void 0,void 0,(function(){var t,n,r;return Ka(this,(function(i){switch(i.label){case 0:t=0,n=this.queries(),i.label=1;case 1:return t<n.length?(r=n[t],[4,e.execute(r).toPromise()]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return[2,void 0]}}))}))},t.prototype.queries=function(){return[v.a.getCreateEntry()]},t}(a.Migration),Wa=n(95),Xa=n(96),Ja=n(89),Qa=n(32),$a=n(97),Za=function(){return(Za=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ec=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},tc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},nc=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},rc=function(){function e(e,t){this.dbService=e,this.fileService=t}return e.prototype.export=function(e,t){var n=this;return new M.Observable((function(e){ec(n,void 0,void 0,(function(){var n,r,i,o,a;return tc(this,(function(c){switch(c.label){case 0:n={task:"",completed:[]},e.next(n=Za(Za({},n),{task:"VALIDATING"})),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.validate()];case 2:return c.sent(),[3,4];case 3:return r=c.sent(),e.error(r),[2];case 4:return e.next(n=Za(Za({},n),{task:"PREPARING"})),[4,this.prepare(t)];case 5:return c.sent(),e.next(n=Za(Za({},n),{task:"INITIALIZING"})),[4,this.createWorkspace().catch((function(e){throw new Error(e)}))];case 6:return c.sent(),[4,this.getMessageIds()];case 7:i=c.sent(),c.label=8;case 8:c.trys.push([8,12,,13]),c.label=9;case 9:return i.length?(o=i.pop(),[4,this.processBatch(o).then((function(t){if(t){var r=t.file,i=t.mid,o=t.eventsCount,a=t.size;e.next(n=Za(Za({},n),{task:"BUILDING_BATCH",completed:nc(n.completed,[{file:r,mid:i,eventsCount:o,size:a,objectType:Qa.a.TELEMETRY,contentEncoding:"gzip",explodedSize:-1}])}))}else e.next(n=Za(Za({},n),{task:"SKIPPING_BATCH"}))}))]):[3,11];case 10:return c.sent(),[3,9];case 11:return[3,13];case 12:return a=c.sent(),e.error(a),[2];case 13:return e.next(n=Za(Za({},n),{task:"OBJECT_ARCHIVE_COMPLETE"})),e.complete(),[2]}}))}))}))},e.prototype.validate=function(){return ec(this,void 0,void 0,(function(){return tc(this,(function(e){switch(e.label){case 0:return[4,this.dbService.execute(("\n            SELECT count(*) as COUNT FROM "+_.a.TABLE_NAME+" WHERE "+_.a.COLUMN_NAME_TYPE+" = '"+_.b.TELEMETRY+"'\n        ").trim()).pipe(Object(te.map)((function(e){return e&&e[0]&&e[0].COUNT}))).toPromise()];case 1:if(!e.sent())throw new $a.a("No telemetry to export");return[2]}}))}))},e.prototype.prepare=function(e){return ec(this,void 0,void 0,(function(){return tc(this,(function(t){return this.workspaceSubPath=""+e.workspacePath,[2]}))}))},e.prototype.createWorkspace=function(){return ec(this,void 0,void 0,(function(){return tc(this,(function(e){switch(e.label){case 0:return[4,this.fileService.createDir(this.workspaceSubPath,!1)];case 1:return[2,e.sent()]}}))}))},e.prototype.getMessageIds=function(){return ec(this,void 0,void 0,(function(){return tc(this,(function(e){switch(e.label){case 0:return[4,this.dbService.read({table:_.a.TABLE_NAME,columns:[_.a.COLUMN_NAME_MSG_ID],selection:_.a.COLUMN_NAME_TYPE+" = ?",selectionArgs:[_.b.TELEMETRY],distinct:!0}).toPromise()];case 1:return[2,e.sent().map((function(e){return e[_.a.COLUMN_NAME_MSG_ID]}))]}}))}))},e.prototype.processBatch=function(e){return ec(this,void 0,void 0,(function(){var t;return tc(this,(function(n){switch(n.label){case 0:return[4,this.dbService.read({table:_.a.TABLE_NAME,selection:_.a.COLUMN_NAME_MSG_ID+" = ? AND "+_.a.COLUMN_NAME_TYPE+" = ?",selectionArgs:[e,_.b.TELEMETRY]}).toPromise()];case 1:return(t=n.sent()[0])?[4,this.fileService.writeFile(this.workspaceSubPath,t[_.a.COLUMN_NAME_MSG_ID],t[_.a.COLUMN_NAME_DATA],{replace:!0}).catch((function(e){throw new Error(e)}))]:[2];case 2:return n.sent(),[2,{size:[_.a.COLUMN_NAME_DATA].length,eventsCount:t[_.a.COLUMN_NAME_NUMBER_OF_ITEM],mid:t[_.a.COLUMN_NAME_MSG_ID],file:""+t[_.a.COLUMN_NAME_MSG_ID]}]}}))}))},e}(),ic=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),oc=function(e){function t(n,r){var i=e.call(this,n,"ASSERTION_ERROR_"+r)||this;return Object.setPrototypeOf(i,t.prototype),i}return ic(t,e),t}(ue.a),ac=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cc=function(e){function t(n){var r=e.call(this,n,"UNKNOWN_OBJECT_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return ac(t,e),t}(oc),sc=n(52),uc=function(){return(uc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},fc=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},lc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},pc=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},dc=function(){function e(e,t,n,r){this.dbService=e,this.fileService=t,this.networkQueue=n,this.sdkConfig=r}return e.prototype.import=function(e,t){var n=this;return console.log("context",t),new M.Observable((function(e){fc(n,void 0,void 0,(function(){var n,r,i,o;return lc(this,(function(a){switch(a.label){case 0:return n={task:"",pending:[]},r=t.items,console.log("items",r),e.next({task:"PREPARING",pending:pc(r)}),[4,this.prepare(t)];case 1:a.sent(),a.label=2;case 2:a.trys.push([2,6,,7]),a.label=3;case 3:return r.length?(console.log("items",r),"gzip"!==(i=r.pop()).contentEncoding?(e.error(new cc("Unknown content encoding "+i.contentEncoding)),[2]):(console.log("currentItem",i),[4,this.processBatch(i).then((function(){e.next(n=uc(uc({},n),{task:"IMPORTING_BATCH",pending:pc(r)}))}))])):[3,5];case 4:return a.sent(),[3,3];case 5:return[3,7];case 6:return o=a.sent(),e.error(o),[2];case 7:return e.next(n=uc(uc({},n),{task:"OBJECT_IMPORT_COMPLETE"})),e.complete(),[2]}}))}))}))},e.prototype.prepare=function(e){return fc(this,void 0,void 0,(function(){return lc(this,(function(t){return this.workspaceSubPath=""+e.workspacePath,[2]}))}))},e.prototype.processBatch=function(e){return fc(this,void 0,void 0,(function(){var t=this;return lc(this,(function(n){return console.log("messageId",e.mid),[2,this.fileService.readAsBinaryString(this.workspaceSubPath,e.file).then((function(n){t.networkQueue.enqueue(new sc.a(t.sdkConfig).generateNetworkQueueRequest(_.b.TELEMETRY,n,e.mid,e.eventsCount,!1),!1).toPromise()}))]}))}))},e}(),hc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ec=function(e){function t(n){var r=e.call(this,n,"INVALID_ARCHIVE")||this;return Object.setPrototypeOf(r,t.prototype),r}return hc(t,e),t}(oc),bc=function(){return(bc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},yc=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},vc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_c=function(e,t){return function(n,r){t(n,r,e)}},Sc=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Oc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},gc=function(){function e(e,t,n,r,i,o,a){this.fileService=e,this.dbService=t,this.telemetryService=n,this.zipService=r,this.deviceInfo=i,this.networkQueue=o,this.sdkConfig=a}var t;return t=e,e.reduceObjectProgressToArchiveObjectExportProgress=function(e){return e.reduce((function(e,t){var n=t.type,r=t.progress;return e.set(n,r),e}),new Map)},e.reduceObjectProgressToArchiveObjectImportProgress=function(e){return e.reduce((function(e,t){var n=t.type,r=t.progress;return e.set(n,r),e}),new Map)},e.prototype.export=function(e){var n=this;return Object(M.defer)((function(){return Sc(n,void 0,void 0,(function(){var e,t;return Oc(this,(function(n){switch(n.label){case 0:return e=window.device.platform.toLowerCase(),t="ios"===e?rn.a.DOCUMENTS:rn.a.CACHE,[4,nn.a.getFilePath(t)];case 1:return[2,{folderUri:n.sent()}]}}))}))})).pipe(Object(te.mergeMap)((function(r){var i,o=""+r.folderUri+k.a.generateUniqueId();return e.objects.length?Object(M.concat)(Object(M.defer)((function(){return Object(M.from)(n.fileService.createDir(o,!1))})).pipe(Object(te.concatMap)((function(){return Object(M.combineLatest)(e.objects.map((function(t){switch(t.type){case Qa.a.CONTENT:case Qa.a.PROFILE:throw new Error("To be implemented");case Qa.a.TELEMETRY:return new rc(n.dbService,n.fileService).export({filePath:e.filePath},{workspacePath:o}).pipe(Object(te.map)((function(e){return{type:Qa.a.TELEMETRY,progress:e}})))}})))})),Object(te.map)((function(e){return{task:"BUILDING",progress:t.reduceObjectProgressToArchiveObjectExportProgress(e)}})),Object(te.tap)((function(e){return i=e}))),Object(M.defer)((function(){return n.generateManifestFile(i,o)})),Object(M.defer)((function(){return n.generateZipArchive(i,o)})),Object(M.defer)((function(){return n.generateExportTelemetries(i,o)}))).pipe(Object(te.tap)((function(e){return i=e}))):Object(M.throwError)(new Qa.c("No archive objects to export"))})),Object(te.catchError)((function(e){return console.error("Error getting filesystem URI:",e),Object(M.throwError)(e)})))},e.prototype.generateExportTelemetries=function(e,t){var n=this;return e.progress.forEach((function(e,t){switch(t){case Qa.a.CONTENT:case Qa.a.PROFILE:throw new Error("To be implemented");case Qa.a.TELEMETRY:var r={dir:U.ShareDirection.OUT,type:U.ShareType.FILE,items:[],env:"sdk"};n.telemetryService.share(r).toPromise()}})),Object(M.of)(bc({},e))},e.prototype.generateZipArchive=function(e,t){var n=this;return Object(M.defer)((function(){return Sc(n,void 0,void 0,(function(){var e,t,n;return Oc(this,(function(r){switch(r.label){case 0:return e=window.device.platform.toLowerCase(),t="ios"===e?rn.a.DOCUMENTS:rn.a.CACHE,[4,nn.a.getFilePath(t)];case 1:return n=r.sent(),[2,{zipFilePath:n+"archive-"+(new Date).toISOString()+".zip"}]}}))}))})).pipe(Object(te.mergeMap)((function(r){var i=r.zipFilePath;return new M.Observable((function(r){n.zipService.zip(t,{target:i},[],[],(function(){r.next(bc(bc({},e),{task:"COMPLETE",filePath:i})),r.complete()}),(function(e){r.error(e)}))}))})),Object(te.map)((function(e){return e})),Object(te.catchError)((function(e){return console.error("Error creating zip archive:",e),Object(M.throwError)(e)})))},e.prototype.generateManifestFile=function(e,n){var r=this,i=e.progress;return this.telemetryService.buildContext().pipe(Object(te.map)((function(e){return e.pdata})),Object(te.mergeMap)((function(e){var o=Array.from(i.entries()).reduce((function(e,t){t[0];var n=t[1];return e.concat(n.completed)}),[]);return Object(M.from)(r.fileService.writeFile(n,"manifest.json",JSON.stringify({id:t.ARCHIVE_ID,ver:t.ARCHIVE_VERSION,ts:(new Date).toISOString(),producer:e,archive:{count:o.length,items:o}}),{replace:!0})).pipe(Object(te.catchError)((function(e){return console.error("Error writing manifest file:",e),Object(M.throwError)(new Error("Failed to write manifest: "+e.message))})))})),Object(te.mapTo)({progress:i,task:"BUILDING_MANIFEST"}),Object(te.catchError)((function(e){return console.error("Error in manifest generation:",e),Object(M.throwError)(e)})))},e.prototype.import=function(e){var t=this;if(console.log("importRequest",e),!e.objects.length)return Object(M.throwError)(new Qa.c("No archive objects to export"));var n={task:"",progress:new Map,filePath:e.filePath};return Object(M.defer)((function(){return Sc(t,void 0,void 0,(function(){var e,t,n;return Oc(this,(function(r){switch(r.label){case 0:return e=window.device.platform.toLowerCase(),t="ios"===e?rn.a.DOCUMENTS:rn.a.CACHE,[4,nn.a.getFilePath(t)];case 1:return n=r.sent(),[2,{workspacePath:""+n+k.a.generateUniqueId()}]}}))}))})).pipe(Object(te.mergeMap)((function(r){var i=r.workspacePath;return Object(M.concat)(Object(M.defer)((function(){return Object(M.from)(t.fileService.createDir(i,!1))})).pipe(Object(te.concatMap)((function(){return t.extractZipArchive(n,i)}))),Object(M.defer)((function(){var r=ze.getFileName(e.filePath).replace(".zip",""),o=i+"/"+r;return t.readManifestFile(n,o,e.objects.map((function(e){return e.type})))})),Object(M.defer)((function(){return t.generateImportTelemetries(n,i)})),Object(M.defer)((function(){return Object(M.combineLatest)(e.objects.map((function(r){switch(r.type){case Qa.a.CONTENT:case Qa.a.PROFILE:throw new Error("To be implemented");case Qa.a.TELEMETRY:console.log("telemetry",n);var o=n.progress.get(Qa.a.TELEMETRY).pending;console.log("Telemetry items to import:",o);var a=ze.getFileName(e.filePath).replace(".zip",""),c=i+"/"+a;return console.log("extractedFolderPath",c),new dc(t.dbService,t.fileService,t.networkQueue,t.sdkConfig).import({filePath:e.filePath},{workspacePath:c,items:n.progress.get(Qa.a.TELEMETRY).pending}).pipe(Object(te.tap)((function(){return console.log("Started importing telemetry data...")})),Object(te.map)((function(e){return console.log("Telemetry import progress:",e),console.log("tele obj",{type:Qa.a.TELEMETRY,progress:e}),{type:Qa.a.TELEMETRY,progress:e}})),Object(te.tap)((function(){return console.log("Telemetry import completed!")})))}})))})))})),Object(te.filter)((function(e){return void 0!==e.task})),Object(te.tap)((function(e){return n=e})),Object(te.catchError)((function(e){return console.error("Import error:",e),Object(M.throwError)(e)})))},e.prototype.generateImportTelemetries=function(e,t){var n=this;return e.progress.forEach((function(e,t){switch(t){case Qa.a.CONTENT:case Qa.a.PROFILE:throw new Error("To be implemented");case Qa.a.TELEMETRY:var r={dir:U.ShareDirection.IN,type:U.ShareType.FILE.valueOf(),items:[],env:"sdk"};n.telemetryService.share(r).toPromise()}})),Object(M.of)(bc({},e))},e.prototype.extractZipArchive=function(e,t){var n=this;console.log("progress",e),console.log("workspacePath",t);var r=e.filePath;return new M.Observable((function(e){sbutility.copyFile(ze.getDirecory(r),t+"/",ze.getFileName(r),(function(){n.zipService.unzip(t+"/"+ze.getFileName(r),{target:t+"/"},(function(){e.next(),e.complete()}),(function(t){return e.error(t)}))}),(function(t){console.error(t),e.error(t)}))})).pipe(Object(te.mapTo)(bc(bc({},e),{task:"EXTRACTING"})))},e.prototype.readManifestFile=function(e,t,n){return console.log("workspacePath readManifestFile",t),Object(M.from)(this.fileService.readAsText(t,"manifest.json")).pipe(Object(te.map)((function(e){try{return JSON.parse(e)}catch(e){throw new Ec("Invalid manfiest.json")}})),Object(te.map)((function(t){return bc(bc({},e),{progress:(n.forEach((function(n){var r=t.archive.items.filter((function(e){return e.objectType===n}));if(!r.length)throw new Ec("Nothing to import");e.progress.set(n,{task:"INITIALISING",pending:r})})),e.progress),task:"VALIDATING"})})))},e.ARCHIVE_ID="sunbird.data.archive",e.ARCHIVE_VERSION="1.0",e=t=yc([Object(N.injectable)(),_c(0,Object(N.inject)(I.b.FILE_SERVICE)),_c(1,Object(N.inject)(I.b.DB_SERVICE)),_c(2,Object(N.inject)(I.b.TELEMETRY_SERVICE)),_c(3,Object(N.inject)(I.b.ZIP_SERVICE)),_c(4,Object(N.inject)(I.b.DEVICE_INFO)),_c(5,Object(N.inject)(I.b.NETWORK_QUEUE)),_c(6,Object(N.inject)(I.b.SDK_CONFIG)),vc("design:paramtypes",[Object,a.DbService,Object,Object,Object,Object,Object])],e)}(),Cc=n(73),mc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ac=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Tc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Nc=function(e){function t(t,n){var r=e.call(this,14,27)||this;return r.sdkConfig=t,r.networkQueue=n,r}return mc(t,e),t.prototype.apply=function(e){return Ac(this,void 0,void 0,(function(){var t=this;return Tc(this,(function(n){switch(n.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return n.sent(),[4,e.read({table:c.d.TABLE_NAME,selection:"",selectionArgs:[]}).pipe(Object(te.map)((function(n){var r=new sc.a(t.sdkConfig);n.forEach((function(n){return Ac(t,void 0,void 0,(function(){var t,i,o;return Tc(this,(function(a){switch(a.label){case 0:return n?(t=n[c.d.COLUMN_NAME_MSG_ID],i=n[c.d.COLUMN_NAME_DATA],o=n[c.d.COLUMN_NAME_NUMBER_OF_EVENTS],[4,this.networkQueue.enqueue(r.generateNetworkQueueRequest(_.b.TELEMETRY,i,t,o,!1),!1).toPromise()]):[3,3];case 1:return a.sent(),[4,e.execute("DELETE FROM "+c.d.TABLE_NAME+" WHERE "+c.d.COLUMN_NAME_MSG_ID+"='"+t+"'").toPromise()];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}))}))).toPromise()];case 2:return n.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[Cc.a.getCreateEntry()]},t}(a.Migration),Ic=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Mc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wc=function(e,t){return function(n,r){t(n,r,e)}},Dc=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Pc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Rc=function(){function e(e,t,n,r){this.dbService=e,this.sharedPreferences=t,this.deviceInfo=n,this.sdkConfig=r}return e.prototype.enqueue=function(e,t){var n=this,r="Uint8Array"===this.getTypeOf(e.networkRequest.body)?e.networkRequest.body.buffer:e.networkRequest.body;return new M.Observable((function(i){Dc(n,void 0,void 0,(function(){var n;return Pc(this,(function(o){switch(o.label){case 0:return n=e,[4,this.interceptRequest(e.networkRequest).toPromise()];case 1:return n.networkRequest=o.sent(),sbsync.enqueue(r,Cc.a.Mapper.networkQueueRequestToEntry(e),t,(function(){i.next(void 0),i.complete()}),(function(e){i.error(e)})),[2]}}))}))}))},e.prototype.interceptRequest=function(e){var t=this;return this.sharedPreferences.getString(ne.a.KEY_API_TOKEN).pipe(Object(te.map)((function(t){if(t){var n=e.headers;n.Authorization="Bearer "+t,e.headers=n}return e})),Object(te.mergeMap)((function(){return t.sharedPreferences.getString(ne.c.KEY_OAUTH_SESSION).pipe(Object(te.map)((function(t){if(t){var n=JSON.parse(t),r=e.headers;r["X-Authenticated-User-Token"]=n.access_token,n.managed_access_token&&(r["X-Authenticated-For"]=n.managed_access_token),e.headers=r}return e})))})),Object(te.map)((function(){return e.headers["X-Channel-Id"]=t.sdkConfig.apiConfig.api_authentication.channelId,e.headers["X-App-Id"]=t.sdkConfig.apiConfig.api_authentication.producerId,e.headers["X-Device-Id"]=t.deviceInfo.getDeviceID(),e.headers.Accept="application/json",e.headers["Content-Type"]="application/json",e.headers["Access-Control-Allow-Origin"]="*",e.body={},(new o.Request.Builder).withSerializer(e.serializer).withHost(t.sdkConfig.apiConfig.host).withType(e.type).withPath(e.path).withHeaders(e.headers).withBody({}).withBearerToken(!0).build()})))},e.prototype.getTypeOf=function(e){switch(Object.prototype.toString.call(e)){case"[object Uint8Array]":return"Uint8Array";default:return"Unknown"}},e=Ic([Object(N.injectable)(),wc(0,Object(N.inject)(I.b.DB_SERVICE)),wc(1,Object(N.inject)(I.b.SHARED_PREFERENCES)),wc(2,Object(N.inject)(I.b.DEVICE_INFO)),wc(3,Object(N.inject)(I.b.SDK_CONFIG)),Mc("design:paramtypes",[a.DbService,Object,Object,Object])],e)}(),Lc=function(){function e(e,t){this.groupActivityService=e,this.cachedItemStore=t}return e.prototype.getDataAggregation=function(t){var n=this;return this.cachedItemStore[t.from===Qn.CachedItemRequestSourceFrom.SERVER?"get":"getCached"]("group-"+t.groupId+"-activity-"+t.activity.id+"-"+t.activity.type,e.GROUP_ACTIVITY_DATA_AGGREGATION_KEY,"ttl_"+e.GROUP_ACTIVITY_DATA_AGGREGATION_KEY,(function(){return n.groupActivityService.getDataAggregation(t.groupId,t.activity,t.mergeGroup,t.leafNodesCount)}))},e.prototype.getDataForDashlets=function(e,t){return this.groupActivityService.getDataForDashlets(e,t)},e.GROUP_ACTIVITY_DATA_AGGREGATION_KEY="GROUP_ACTIVITY_DATA_AGGREGATION-",e}(),jc=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Uc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},kc=function(e,t){return function(n,r){t(n,r,e)}},xc=function(){function e(e,t){this.container=e,this.cachedItemStore=t}var t;return t=e,Object.defineProperty(e.prototype,"activityService",{get:function(){return this._groupActivityService||(this._groupActivityService=new Lc(this.groupServiceDelegate.activityService,this.cachedItemStore)),this._groupActivityService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupServiceDelegate",{get:function(){return this.container.get(I.a.GROUP_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.create=function(e){return this.groupServiceDelegate.create(e)},e.prototype.getById=function(e){var n=this;return this.cachedItemStore[e.from===Qn.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](e.id+"-"+e.userId+(e.options&&e.options.includeMembers?"-includeMembers:"+e.options.includeMembers:"")+(e.options&&e.options.includeActivities?"-includeActivities:"+e.options.includeActivities:"")+(e.options&&e.options.groupActivities?"-groupActivities:"+e.options.groupActivities:""),t.GROUP_LOCAL_KEY,"ttl_"+t.GROUP_LOCAL_KEY,(function(){return n.groupServiceDelegate.getById(e.id,e.options)}))},e.prototype.search=function(e){var n=this,r=e.request,i=e.from;return this.cachedItemStore[i===Qn.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](""+r.filters.userId,t.GROUP_SEARCH_LOCAL_KEY,"ttl_"+t.GROUP_SEARCH_LOCAL_KEY,(function(){return n.groupServiceDelegate.search(r)}))},e.prototype.updateById=function(e){return this.groupServiceDelegate.updateById(e.id,e.updateRequest)},e.prototype.deleteById=function(e){return this.groupServiceDelegate.deleteById(e.id)},e.prototype.addMembers=function(e){return this.groupServiceDelegate.addMembers(e.groupId,e.addMembersRequest)},e.prototype.updateMembers=function(e){return this.groupServiceDelegate.updateMembers(e.groupId,e.updateMembersRequest)},e.prototype.removeMembers=function(e){return this.groupServiceDelegate.removeMembers(e.groupId,e.removeMembersRequest)},e.prototype.addActivities=function(e){return this.groupServiceDelegate.addActivities(e.groupId,e.addActivitiesRequest)},e.prototype.updateActivities=function(e){return this.groupServiceDelegate.updateActivities(e.groupId,e.updateActivitiesRequest)},e.prototype.removeActivities=function(e){return this.groupServiceDelegate.removeActivities(e.groupId,e.removeActivitiesRequest)},e.prototype.getSupportedActivities=function(){return this.groupServiceDelegate.getSupportedActivities()},e.prototype.suspendById=function(e){return this.groupServiceDelegate.suspendById(e.id)},e.prototype.reactivateById=function(e){return this.groupServiceDelegate.reactivateById(e.id)},e.prototype.updateGroupGuidelines=function(e){return this.groupServiceDelegate.updateGroupGuidelines(e)},e.GROUP_LOCAL_KEY="GROUP-",e.GROUP_SEARCH_LOCAL_KEY="GROUP_SEARCH-",e=t=jc([Object(N.injectable)(),kc(0,Object(N.inject)(I.b.CONTAINER)),kc(1,Object(N.inject)(I.b.CACHED_ITEM_STORE)),Uc("design:paramtypes",[N.Container,Object])],e)}(),Fc=n(70),Bc=function(){function e(){}return e.mapGroupDBEntryToGroup=function(e){return{gid:e[u.a.COLUMN_NAME_GID],name:e[u.a.COLUMN_NAME_NAME],syllabus:e[u.a.COLUMN_NAME_SYLLABUS].split(","),grade:e[u.a.COLUMN_NAME_GRADE].split(","),gradeValue:JSON.parse(e[u.a.COLUMN_NAME_GRADE_VALUE]),createdAt:e[u.a.COLUMN_NAME_CREATED_AT],updatedAt:e[u.a.COLUMN_NAME_UPDATED_AT]}},e.mapGroupToGroupDBEntry=function(e){var t;return(t={})[u.a.COLUMN_NAME_GID]=e.gid,t[u.a.COLUMN_NAME_SYLLABUS]=e.syllabus?e.syllabus.join(","):"",t[u.a.COLUMN_NAME_GRADE]=e.grade?e.grade.join(","):"",t[u.a.COLUMN_NAME_NAME]=e.name,t[u.a.COLUMN_NAME_GRADE_VALUE]=JSON.stringify(e.gradeValue),t[u.a.COLUMN_NAME_CREATED_AT]=e.createdAt,t[u.a.COLUMN_NAME_UPDATED_AT]=e.updatedAt,t},e}(),Vc=function(){return(Vc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Gc=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Yc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Hc=function(e,t){return function(n,r){t(n,r,e)}},qc=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Kc=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},zc=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},Wc=function(){function e(e,t,n,r){this.container=e,this.dbService=t,this.profileService=n,this.sharedPreferences=r}var t;return t=e,Object.defineProperty(e.prototype,"telemetryService",{get:function(){return this.container.get(I.b.TELEMETRY_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.createGroup=function(e){var t=this;return e.gid=k.a.generateUniqueId(),e.createdAt=Date.now(),e.updatedAt=Date.now(),this.dbService.insert({table:u.a.TABLE_NAME,modelJson:Bc.mapGroupToGroupDBEntry(e)}).pipe(Object(te.tap)((function(){return qc(t,void 0,void 0,(function(){var t=this;return Kc(this,(function(n){switch(n.label){case 0:return[4,this.profileService.getActiveProfileSession().pipe(Object(te.map)((function(e){return e.uid})),Object(te.mergeMap)((function(n){var r=new U.Actor;r.id=n,r.type=U.Actor.TYPE_SYSTEM;var i={env:"sdk",actor:r,currentState:U.AuditState.AUDIT_CREATED,updatedProperties:mn.a.getTruthyProps(e),objId:e.gid,objType:U.ObjectType.GROUP};return t.telemetryService.audit(i)}))).toPromise()];case 1:return n.sent(),[2]}}))}))})),Object(te.map)((function(){return e})))},e.prototype.deleteGroup=function(e){var t=this;return Object(M.defer)((function(){return Object(M.of)(t.dbService.beginTransaction())})).pipe(Object(te.mergeMap)((function(){return Object(M.zip)(t.dbService.delete({table:u.a.TABLE_NAME,selection:u.a.COLUMN_NAME_GID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:u.b.TABLE_NAME,selection:u.b.COLUMN_NAME_GID+" = ?",selectionArgs:[e]})).pipe(Object(te.mapTo)(void 0))})),Object(te.tap)((function(){t.dbService.endTransaction(!0)})),Object(te.tap)((function(){return qc(t,void 0,void 0,(function(){var t=this;return Kc(this,(function(n){switch(n.label){case 0:return[4,this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(n){var r=new U.Actor;r.id=n.uid,r.type=U.Actor.TYPE_SYSTEM;var i={env:"sdk",actor:r,currentState:U.AuditState.AUDIT_DELETED,objId:e,objType:U.ObjectType.GROUP};return t.telemetryService.audit(i)}))).toPromise()];case 1:return n.sent(),[2]}}))}))})),Object(te.catchError)((function(e){return t.dbService.endTransaction(!1),M.Observable.throw(e)})))},e.prototype.updateGroup=function(e){var t=this;return this.dbService.read({table:u.a.TABLE_NAME,selection:"gid = ?",selectionArgs:[e.gid]}).pipe(Object(te.map)((function(t){return t&&t[0]?Bc.mapGroupDBEntryToGroup(t[0]):M.Observable.throw(new Fc.NoGroupFoundError("No Group found with ID "+e.gid))})),Object(te.tap)((function(n){return qc(t,void 0,void 0,(function(){var t=this;return Kc(this,(function(r){switch(r.label){case 0:return[4,this.profileService.getActiveProfileSession().pipe(Object(te.mergeMap)((function(r){var i=new U.Actor;i.id=r.uid,i.type=U.Actor.TYPE_SYSTEM;var o={env:"sdk",actor:i,currentState:U.AuditState.AUDIT_UPDATED,updatedProperties:mn.a.getPropDiff(e,n),objId:e.gid,objType:U.ObjectType.GROUP};return t.telemetryService.audit(o)}))).toPromise()];case 1:return r.sent(),[2]}}))}))})),Object(te.mergeMap)((function(){var n;return t.dbService.update({table:u.a.TABLE_NAME,selection:"gid = ?",selectionArgs:[e.gid],modelJson:(n={},n[u.a.COLUMN_NAME_NAME]=e.name,n[u.a.COLUMN_NAME_SYLLABUS]=e.syllabus.join(","),n[u.a.COLUMN_NAME_UPDATED_AT]=Date.now(),n[u.a.COLUMN_NAME_GRADE]=e.grade.join(","),n[u.a.COLUMN_NAME_GRADE_VALUE]=JSON.stringify(e.gradeValue),n)}).pipe(Object(te.mapTo)(e))})))},e.prototype.getActiveSessionGroup=function(){var e=this;return this.getActiveGroupSession().pipe(Object(te.map)((function(e){if(!e)throw new Fc.NoActiveGroupSessionError("No active session available");return e})),Object(te.mergeMap)((function(t){return e.dbService.read({table:u.a.TABLE_NAME,selection:u.a.COLUMN_NAME_GID+" = ?",selectionArgs:[t.gid]}).pipe(Object(te.map)((function(e){return e&&e[0]})))})))},e.prototype.setActiveSessionForGroup=function(e){var n=this;return this.dbService.read({table:u.a.TABLE_NAME,selection:u.a.COLUMN_NAME_GID+" = ?",selectionArgs:[e]}).pipe(Object(te.map)((function(e){return e&&e[0]&&Bc.mapGroupDBEntryToGroup(e[0])})),Object(te.map)((function(e){if(!e)throw new Fc.NoGroupFoundError("No Profile found");return e})),Object(te.mergeMap)((function(e){var r=new Fc.GroupSessionDeprecated(e.gid);return n.sharedPreferences.putString(t.KEY_GROUP_SESSION,JSON.stringify({gid:r.gid,sid:r.sid,createdTime:r.createdTime})).pipe(Object(te.mapTo)(!0))})))},e.prototype.getActiveGroupSession=function(){return this.sharedPreferences.getString(t.KEY_GROUP_SESSION).pipe(Object(te.map)((function(e){if(e)return JSON.parse(e)})))},e.prototype.getAllGroups=function(e){var t=this;return Object(M.defer)((function(){return e?t.dbService.execute("\n                    SELECT * FROM "+u.a.TABLE_NAME+"\n                    LEFT JOIN "+u.b.TABLE_NAME+" ON\n                    "+u.a.TABLE_NAME+"."+u.a.COLUMN_NAME_GID+" =\n                    "+u.b.TABLE_NAME+"."+u.b.COLUMN_NAME_GID+"\n                    WHERE "+u.b.COLUMN_NAME_UID+' = "'+e.uid+'"').pipe(Object(te.map)((function(e){return e.map((function(e){return Bc.mapGroupDBEntryToGroup(e)}))}))):t.dbService.read({table:u.a.TABLE_NAME,columns:[]}).pipe(Object(te.map)((function(e){return e.map((function(e){return Bc.mapGroupDBEntryToGroup(e)}))})))})).pipe(Object(te.mergeMap)((function(e){return Object(M.from)(e)})),Object(te.mergeMap)((function(e){return t.profileService.getAllProfiles({groupId:e.gid}).pipe(Object(te.map)((function(t){return Vc(Vc({},e),{profilesCount:t.length})})))})),Object(te.reduce)((function(e,t){return zc(e,[t])}),[]))},e.prototype.addProfilesToGroup=function(e){var t=this;return Object(M.defer)((function(){return Object(M.of)(t.dbService.beginTransaction())})).pipe(Object(te.mergeMap)((function(){return t.dbService.delete({table:u.b.TABLE_NAME,selection:u.b.COLUMN_NAME_GID+" = ?",selectionArgs:[e.groupId]})})),Object(te.mergeMap)((function(){return e.uidList.length?M.zip.apply(void 0,e.uidList.map((function(n){var r;return t.dbService.insert({table:u.b.TABLE_NAME,modelJson:(r={},r[u.b.COLUMN_NAME_GID]=e.groupId,r[u.b.COLUMN_NAME_UID]=n,r)})}))).pipe(Object(te.mapTo)(e.uidList.length)):Object(M.of)(0)})),Object(te.tap)((function(){t.dbService.endTransaction(!0)})),Object(te.catchError)((function(e){return t.dbService.endTransaction(!1),Object(M.throwError)(e)})))},e.prototype.removeActiveGroupSession=function(){var e=this;return this.getActiveGroupSession().pipe(Object(te.mergeMap)((function(n){return n?e.sharedPreferences.putString(t.KEY_GROUP_SESSION,""):Object(M.of)(void 0)})))},e.KEY_GROUP_SESSION=ne.k.KEY_GROUP_SESSION,e=t=Gc([Object(N.injectable)(),Hc(0,Object(N.inject)(I.b.CONTAINER)),Hc(1,Object(N.inject)(I.b.DB_SERVICE)),Hc(2,Object(N.inject)(I.b.PROFILE_SERVICE)),Hc(3,Object(N.inject)(I.b.SHARED_PREFERENCES)),Yc("design:paramtypes",[N.Container,a.DbService,Object,Object])],e)}(),Xc=n(64),Jc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qc=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},$c=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Zc=function(e){function t(){return e.call(this,15,28)||this}return Jc(t,e),t.prototype.apply=function(e){return Qc(this,void 0,void 0,(function(){return $c(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return t.sent(),[4,this.updateContentTable(e)];case 2:return t.sent(),[2,void 0]}}))}))},t.prototype.updateContentTable=function(e){return Qc(this,void 0,void 0,(function(){var t,n,r,i,o;return $c(this,(function(a){switch(a.label){case 0:e.beginTransaction(),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,e.read({table:p.b.TABLE_NAME}).toPromise()];case 2:return t=a.sent(),(n=t.reduce((function(e,t){var n;t[p.b.COLUMN_NAME_LOCAL_DATA]&&Re.a.isAvailableLocally(t[p.b.COLUMN_NAME_CONTENT_STATE])?n=JSON.parse(t[p.b.COLUMN_NAME_LOCAL_DATA]):t[p.b.COLUMN_NAME_SERVER_DATA]&&(n=JSON.parse(t[p.b.COLUMN_NAME_SERVER_DATA]));var r=n?n.resourceType:void 0,i=Xc.CsPrimaryCategoryMapper.getPrimaryCategory(t[p.b.COLUMN_NAME_CONTENT_TYPE],t[p.b.COLUMN_NAME_MIME_TYPE],r).toLowerCase();return e.set(t[p.b.COLUMN_NAME_IDENTIFIER],i),e}),new Map)).size?(r=this.buildPrimaryCategoryCases(n),i=("UPDATE "+p.b.TABLE_NAME+" SET "+r+";").trim(),[4,e.execute(i).toPromise()]):(e.endTransaction(!0),[2]);case 3:return a.sent(),e.endTransaction(!0),[3,5];case 4:throw o=a.sent(),console.error(o),e.endTransaction(!1),o;case 5:return[2]}}))}))},t.prototype.buildPrimaryCategoryCases=function(e){return Array.from(e.entries()).reduce((function(e,t){var n=t[0],r=t[1];return r?e.concat(" WHEN '"+n+"' THEN '"+r+"' "):e})," "+p.b.COLUMN_NAME_PRIMARY_CATEGORY+" = CASE "+p.b.COLUMN_NAME_IDENTIFIER+" ").concat(" ELSE '' END ")},t.prototype.queries=function(){return[p.b.getAlterEntryForPrimaryCategory()]},t}(a.Migration),es=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ts=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ns=function(e,t){return function(n,r){t(n,r,e)}},rs=function(){function e(e){this.container=e}return Object.defineProperty(e.prototype,"discussionServiceDelegate",{get:function(){return this.container.get(I.a.DISCUSSION_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.getForumIds=function(e){return this.discussionServiceDelegate.getForumIds(e)},e.prototype.createUser=function(e){return this.discussionServiceDelegate.createUser(e)},e.prototype.attachForum=function(e){return this.discussionServiceDelegate.attachForum(e)},e.prototype.removeForum=function(e){return this.discussionServiceDelegate.removeForum(e)},e.prototype.createForum=function(e){return this.discussionServiceDelegate.createForum(e)},e=es([Object(N.injectable)(),ns(0,Object(N.inject)(I.b.CONTAINER)),ts("design:paramtypes",[N.Container])],e)}(),is=n(98),os=n(103),as=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},cs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ss=function(e,t){return function(n,r){t(n,r,e)}},us=function(){function e(e){this.container=e}return Object.defineProperty(e.prototype,"NotificationServiceV2Delegate",{get:function(){return this.container.get(I.a.NOTIFICATION_SERVICE_V2)},enumerable:!1,configurable:!0}),e.prototype.notificationRead=function(e){return this.NotificationServiceV2Delegate.notificationRead(e)},e.prototype.notificationUpdate=function(e){return this.NotificationServiceV2Delegate.notificationUpdate(e)},e.prototype.notificationDelete=function(e){return this.NotificationServiceV2Delegate.notificationDelete(e)},e=as([Object(N.injectable)(),ss(0,Object(N.inject)(I.b.CONTAINER)),cs("design:paramtypes",[N.Container])],e)}(),fs=n(88),ls=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ps=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ds=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},hs=function(e){function t(){return e.call(this,16,29)||this}return ls(t,e),t.prototype.apply=function(e){return ps(this,void 0,void 0,(function(){var t=this;return ds(this,(function(n){return this.queries().forEach((function(n){return ps(t,void 0,void 0,(function(){return ds(this,(function(t){switch(t.label){case 0:return[4,e.execute(n).toPromise()];case 1:return t.sent(),[2]}}))}))})),[2,void 0]}))}))},t.prototype.queries=function(){return[S.a.getAlterEntryForPlayerConfig()]},t}(fs.a),Es=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bs=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ys=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},vs=function(e){function t(){return e.call(this,17,30)||this}return Es(t,e),t.prototype.apply=function(e){return bs(this,void 0,void 0,(function(){return ys(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.queries().map((function(t){return e.execute(t).toPromise()})))];case 1:return t.sent(),[2,void 0]}}))}))},t.prototype.queries=function(){return[O.a.getCreateEntry()]},t}(a.Migration),_s=n(105),Ss=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Os=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},gs=function(){function e(){this._isInitialised=!1}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInitialised",{get:function(){return this._isInitialised},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sdkConfig",{get:function(){return this._container.get(I.b.SDK_CONFIG)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appInfo",{get:function(){return this._container.get(I.b.APP_INFO)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageAssembleService",{get:function(){return this._container.get(I.b.PAGE_ASSEMBLE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dbService",{get:function(){return this._container.get(I.b.DB_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"telemetryService",{get:function(){return this._container.get(I.b.TELEMETRY_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authService",{get:function(){return this._container.get(I.b.AUTH_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"apiService",{get:function(){return this._container.get(I.b.API_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keyValueStore",{get:function(){return this._container.get(I.b.KEY_VALUE_STORE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"profileService",{get:function(){return this._container.get(I.b.PROFILE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupService",{get:function(){return this._container.get(I.b.GROUP_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groupServiceDeprecated",{get:function(){return this._container.get(I.b.GROUP_SERVICE_DEPRECATED)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentService",{get:function(){return this._container.get(I.b.CONTENT_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentFeedbackService",{get:function(){return this._container.get(I.b.CONTENT_FEEDBACK_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"courseService",{get:function(){return this._container.get(I.b.COURSE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"formService",{get:function(){return this._container.get(I.b.FORM_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameworkService",{get:function(){return this._container.get(I.b.FRAMEWORK_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameworkUtilService",{get:function(){return this._container.get(I.b.FRAMEWORK_UTIL_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sharedPreferences",{get:function(){return this._container.get(I.b.SHARED_PREFERENCES)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"systemSettingsService",{get:function(){return this._container.get(I.b.SYSTEM_SETTINGS_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eventsBusService",{get:function(){return this._container.get(I.b.EVENTS_BUS_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"summarizerService",{get:function(){return this._container.get(I.b.SUMMARIZER_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"downloadService",{get:function(){return this._container.get(I.b.DOWNLOAD_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerService",{get:function(){return this._container.get(I.b.PLAYER_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceInfo",{get:function(){return this._container.get(I.b.DEVICE_INFO)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storageService",{get:function(){return this._container.get(I.b.STORAGE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notificationService",{get:function(){return this._container.get(I.b.NOTIFICATION_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"errorLoggerService",{get:function(){return this._container.get(I.b.ERROR_LOGGER_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"networkInfoService",{get:function(){return this._container.get(I.b.NETWORKINFO_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchHistoryService",{get:function(){return this._container.get(I.b.SEARCH_HISTORY_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"codePushExperimentService",{get:function(){return this._container.get(I.b.CODEPUSH_EXPERIMENT_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"faqService",{get:function(){return this._container.get(I.b.FAQ_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceRegisterService",{get:function(){return this._container.get(I.b.DEVICE_REGISTER_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"archiveService",{get:function(){return this._container.get(I.b.ARCHIVE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"networkQueueService",{get:function(){return this._container.get(I.b.NETWORK_QUEUE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"discussionService",{get:function(){return this._container.get(I.b.DISCUSSION_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"segmentationService",{get:function(){return this._container.get(I.b.SEGMENTATION_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debuggingService",{get:function(){return this._container.get(I.b.DEBUGGING_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notificationServiceV2",{get:function(){return this._container.get(I.b.NOTIFICATION_SERVICE_V2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"certificateService",{get:function(){return this._container.get(I.b.CERTIFICATE_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.init=function(e){return Ss(this,void 0,void 0,(function(){var t,n=this;return Os(this,(function(r){switch(r.label){case 0:switch(this._container=new N.Container,this._container.bind(I.b.CONTAINER).toConstantValue(this._container),this._container.bind(I.b.DB_VERSION).toConstantValue(31),this._container.bind(I.b.DB_MIGRATION_LIST).toConstantValue([new Yr,new zr,new Qr,new ui,new Xi,new ti,new Da,new Ya,new za,function(){return new Nc(e,n._container.get(I.b.NETWORK_QUEUE))},new Zc,new hs,new vs,new oi]),e.platform){case"cordova":this._container.bind(I.b.SHARED_PREFERENCES).to(Dr).inSingletonScope();break;case"web":this._container.bind(I.b.SHARED_PREFERENCES).to(Mr).inSingletonScope();break;default:throw new Error("FATAL_ERROR: Invalid platform")}return this._container.bind(I.b.DB_SERVICE).to(j).inSingletonScope(),this._container.bind(I.b.FILE_SERVICE).to(Fr).inSingletonScope(),this._container.bind(I.b.SDK_CONFIG).toConstantValue(e),this._container.bind(I.b.DEVICE_INFO).to(yi).inSingletonScope(),this._container.bind(I.b.EVENTS_BUS_SERVICE).to(Ii).inSingletonScope(),this._container.bind(I.b.APP_INFO).to(Hi).inSingletonScope(),this._container.bind(I.b.API_SERVICE).to(o.ApiServiceImpl).inSingletonScope(),this._container.bind(I.b.AUTH_SERVICE).to(Me).inSingletonScope(),this._container.bind(I.b.KEY_VALUE_STORE).to(Jn).inSingletonScope(),this._container.bind(I.b.SYSTEM_SETTINGS_SERVICE).to(fi.SystemSettingsServiceImpl).inSingletonScope(),this._container.bind(I.b.FRAMEWORK_SERVICE).to(De.FrameworkServiceImpl).inSingletonScope(),this._container.bind(I.b.PROFILE_SERVICE).to(se.ProfileServiceImpl).inSingletonScope(),this._container.bind(I.b.GROUP_SERVICE).to(xc).inSingletonScope(),this._container.bind(I.b.GROUP_SERVICE_DEPRECATED).to(Wc).inSingletonScope(),this._container.bind(I.b.ERROR_LOGGER_SERVICE).to(ma).inSingletonScope(),this._container.bind(I.b.ZIP_SERVICE).to(pi).inSingletonScope(),this._container.bind(I.b.TELEMETRY_SERVICE).to(ge).inSingletonScope(),this._container.bind(I.b.CONTENT_FEEDBACK_SERVICE).to(gi).inSingletonScope(),this._container.bind(I.b.FORM_SERVICE).to(ir).inSingletonScope(),this._container.bind(I.b.PAGE_ASSEMBLE_SERVICE).to(Nr).inSingletonScope(),this._container.bind(I.b.FRAMEWORK_UTIL_SERVICE).to(De.FrameworkUtilServiceImpl).inSingletonScope(),this._container.bind(I.b.DOWNLOAD_SERVICE).to(ki).inSingletonScope(),this._container.bind(I.b.CONTENT_SERVICE).to(Kn).inSingletonScope(),this._container.bind(I.b.COURSE_SERVICE).to(we.CourseServiceImpl).inSingletonScope(),this._container.bind(I.b.SUMMARIZER_SERVICE).to(Mi.SummarizerServiceImpl).inSingletonScope(),this._container.bind(I.b.PLAYER_SERVICE).to(qi.PlayerServiceImpl).inSingletonScope(),this._container.bind(I.b.CACHED_ITEM_STORE).to(fr).inSingletonScope(),this._container.bind(I.b.TELEMETRY_DECORATOR).to(G).inSingletonScope(),this._container.bind(I.b.STORAGE_SERVICE).to(ta).inSingletonScope(),this._container.bind(I.b.NOTIFICATION_SERVICE).to(da).inSingletonScope(),this._container.bind(I.b.NETWORKINFO_SERVICE).to(Na).inSingletonScope(),this._container.bind(I.b.SEARCH_HISTORY_SERVICE).to(Fa).inSingletonScope(),this._container.bind(I.b.CODEPUSH_EXPERIMENT_SERVICE).to(Wa.CodePUshExperimentServiceImpl).inSingletonScope(),this._container.bind(I.b.DEVICE_REGISTER_SERVICE).to(Ja.DeviceRegisterServiceImpl).inSingletonScope(),this._container.bind(I.b.FAQ_SERVICE).to(Xa.FaqServiceImpl).inSingletonScope(),this._container.bind(I.b.ARCHIVE_SERVICE).to(gc).inSingletonScope(),this._container.bind(I.b.NETWORK_QUEUE).to(Rc).inSingletonScope(),this._container.bind(I.b.DISCUSSION_SERVICE).to(rs).inSingletonScope(),this._container.bind(I.b.SEGMENTATION_SERVICE).to(is.SegmentationServiceImpl).inSingletonScope(),this._container.bind(I.b.DEBUGGING_SERVICE).to(os.DebuggingServiceImpl).inSingletonScope(),this._container.bind(I.b.NOTIFICATION_SERVICE_V2).to(us).inSingletonScope(),this._container.bind(I.b.CERTIFICATE_SERVICE).to(_s.CertificateServiceImpl).inSingletonScope(),t=this.sharedPreferences,[4,Ce.CsModule.instance.init({core:{httpAdapter:"web"===e.platform?"HttpClientBrowserAdapter":"HttpClientCordovaAdapter",global:{channelId:e.apiConfig.api_authentication.channelId,producerId:e.apiConfig.api_authentication.producerId,deviceId:An(window.device.uuid).toString()},api:{host:e.apiConfig.host,authentication:{}}},services:{contentServiceConfig:{hierarchyApiPath:"/api/questionset/v2",questionListApiPath:"/api/question/v2"},courseServiceConfig:{apiPath:"/api/course/v1",certRegistrationApiPath:"/api/certreg/v2/certs"},groupServiceConfig:{apiPath:"/api/group/v1",dataApiPath:"/api/data/v1/group",updateGroupGuidelinesApiPath:"/api/group/membership/v1"},userServiceConfig:{apiPath:"/api/user/v2"},formServiceConfig:{apiPath:"/api/data/v1/form"},discussionServiceConfig:{apiPath:"/discussion"},notificationServiceConfig:{apiPath:"/api/notification/v1/feed"},certificateServiceConfig:{apiPath:e.certificateServiceConfig.apiPath,apiPathLegacy:e.certificateServiceConfig.apiPathLegacy,rcApiPath:e.certificateServiceConfig.rcApiPath},frameworkServiceConfig:{apiPath:"/api/framework/v1"}}},function(){n._container.rebind(I.a.HTTP_SERVICE).toConstantValue(Ce.CsModule.instance.httpService),n._container.rebind(I.a.GROUP_SERVICE).toConstantValue(Ce.CsModule.instance.groupService),n._container.rebind(I.a.COURSE_SERVICE).toConstantValue(Ce.CsModule.instance.courseService),n._container.rebind(I.a.USER_SERVICE).toConstantValue(Ce.CsModule.instance.userService),n._container.rebind(I.a.DISCUSSION_SERVICE).toConstantValue(Ce.CsModule.instance.discussionService),n._container.rebind(I.a.CONTENT_SERVICE).toConstantValue(Ce.CsModule.instance.contentService),n._container.rebind(I.a.NOTIFICATION_SERVICE_V2).toConstantValue(Ce.CsModule.instance.notificationService),n._container.rebind(I.a.CERTIFICATE_SERVICE).toConstantValue(Ce.CsModule.instance.certificateService),n._container.rebind(I.a.FRAMEWORK_SERVICE).toConstantValue(Ce.CsModule.instance.frameworkService)}.bind(this),new(function(){function e(){}return e.prototype.setItem=function(e,n){return t.putString(e,n).toPromise()},e.prototype.getItem=function(e){return t.getString(e).toPromise()},e}()))];case 1:return r.sent(),this._container.bind(I.a.HTTP_SERVICE).toConstantValue(Ce.CsModule.instance.httpService),this._container.bind(I.a.GROUP_SERVICE).toConstantValue(Ce.CsModule.instance.groupService),this._container.bind(I.a.COURSE_SERVICE).toConstantValue(Ce.CsModule.instance.courseService),this._container.bind(I.a.USER_SERVICE).toConstantValue(Ce.CsModule.instance.userService),this._container.bind(I.a.DISCUSSION_SERVICE).toConstantValue(Ce.CsModule.instance.discussionService),this._container.bind(I.a.CONTENT_SERVICE).toConstantValue(Ce.CsModule.instance.contentService),this._container.bind(I.a.NOTIFICATION_SERVICE_V2).toConstantValue(Ce.CsModule.instance.notificationService),this._container.bind(I.a.CERTIFICATE_SERVICE).toConstantValue(Ce.CsModule.instance.certificateService),this._container.bind(I.a.FRAMEWORK_SERVICE).toConstantValue(Ce.CsModule.instance.frameworkService),[4,this.dbService.init()];case 2:return r.sent(),[4,this.appInfo.init()];case 3:return r.sent(),[4,this.preInit().toPromise()];case 4:return r.sent(),this._isInitialised=!0,this.postInit().subscribe(),[2]}}))}))},e.prototype.updateTelemetryConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.sdkConfig.telemetryConfig[t]=e[t])},e.prototype.updateDeviceRegisterConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.sdkConfig.deviceRegisterConfig[t]=e[t],"fcmToken"===t&&this.telemetryService.resetDeviceRegisterTTL())},e.prototype.updateContentServiceConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.sdkConfig.contentServiceConfig[t]=e[t])},e.prototype.updatePageServiceConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.sdkConfig.pageServiceConfig[t]=e[t])},e.prototype.preInit=function(){var e=this;return this.telemetryService.preInit().pipe(Object(te.concatMap)((function(){return e.frameworkService.preInit().pipe(Object(te.concatMap)((function(){return e.profileService.preInit()})))})))},e.prototype.postInit=function(){return Object(M.combineLatest)([this.apiService.onInit(),this.authService.onInit(),this.summarizerService.onInit(),this.errorLoggerService.onInit(),this.eventsBusService.onInit(),this.downloadService.onInit(),this.contentService.onInit(),this.storageService.onInit(),this.telemetryService.onInit(),this.notificationService.onInit()])},e}()},function(e,t,n){"use strict";n.d(t,"c",(function(){return o}));var r=n(92),i=n(116);n.d(t,"a",(function(){return i.a})),n.d(t,"b",(function(){return i.b}));const o=Object(r.d)("Filesystem",{web:()=>n.e(1).then(n.bind(null,381)).then(e=>new e.FilesystemWeb)})},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(1);!function(e){e.TABLE_NAME="search_history",e._ID="_id",e.COLUMN_NAME_USER_ID="uid",e.COLUMN_NAME_QUERY="query",e.COLUMN_NAME_TIME_STAMP="time_stamp",e.COLUMN_NAME_NAMESPACE="namespace",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_USER_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_QUERY+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_TIME_STAMP+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_NAMESPACE+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+"UNIQUE ("+e.COLUMN_NAME_USER_ID+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_QUERY+") ON CONFLICT REPLACE )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(1);!function(e){e.TABLE_NAME="course_assessment",e._ID="_id",e.COLUMN_NAME_ASSESSMENT_EVENT="assessment_event",e.COLUMN_NAME_CREATED_AT="created_at",e.COLUMN_NAME_USER_ID="user_id",e.COLUMN_NAME_CONTENT_ID="content_id",e.COLUMN_NAME_COURSE_ID="course_id",e.COLUMN_NAME_BATCH_ID="batch_id",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS"+i.DbConstants.SPACE+e.TABLE_NAME+i.DbConstants.SPACE+"("+e._ID+i.DbConstants.SPACE+"INTEGER PRIMARY KEY,"+e.COLUMN_NAME_ASSESSMENT_EVENT+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+","+e.COLUMN_NAME_CREATED_AT+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+","+e.COLUMN_NAME_USER_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+","+e.COLUMN_NAME_CONTENT_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+","+e.COLUMN_NAME_COURSE_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+","+e.COLUMN_NAME_BATCH_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+")"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME}}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var r,i=n(1);!function(e){e.TABLE_NAME="player_data",e._ID="_id",e.COLUMN_NAME_USER_ID="user_id",e.COLUMN_PARENT_IDENTIFIER="parent_identifier",e.COLUMN_IDENTIFIER="identifier",e.COLUMN_PLAYER_CONFIG="player_config",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_USER_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_PARENT_IDENTIFIER+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_IDENTIFIER+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_PLAYER_CONFIG+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+")"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME},e.getAlterEntryForPlayerConfig=function(){return"ALTER TABLE "+e.TABLE_NAME+" ADD COLUMN "+e.COLUMN_PLAYER_CONFIG+" TEXT DEFAULT ''"}}(r||(r={}));var o=function(){function e(){}return e.mapPlayerDbEntryToPlayer=function(e){return{userId:e[r.COLUMN_NAME_USER_ID],parentId:e[r.COLUMN_PARENT_IDENTIFIER],contentId:e[r.COLUMN_IDENTIFIER],saveState:e[r.COLUMN_PLAYER_CONFIG]}},e.mapPlayerStateToPlayerDbEntry=function(e,t,n,i){var o;return(o={})[r.COLUMN_NAME_USER_ID]=e,o[r.COLUMN_PARENT_IDENTIFIER]=t,o[r.COLUMN_IDENTIFIER]=n,o[r.COLUMN_PLAYER_CONFIG]=i,o},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(311),i=function(){function e(){}return e.generateUniqueId=function(){return r()},e}()},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o.a})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return s.a})),function(e){e.CONTENT="content",e.PROFILE="profile",e.TELEMETRY="telemetry"}(r||(r={}));var i,o=n(74),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e){function t(n){var r=e.call(this,n,"INVALID_REQUEST")||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(o.a),s=n(97)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.toFixed=function(e){return Number(e.toFixed(2))},e.parseInt=function(e){return e?parseInt(e,10):0},e.round=function(e){return Number(Math.round(parseFloat(e+"e4"))+"e-4")},e}()},function(e,t){e.exports=r},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(26),i=function(){function e(){}return Object.defineProperty(e,"log",{get:function(){return r.a.instance.telemetryService},enumerable:!1,configurable:!0}),e}()},function(e,t,n){"use strict";n.r(t);var r=n(184);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(303);n.d(t,"CourseServiceImpl",(function(){return o.a}));var a=n(191);for(var i in a)["default","CourseServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(192);for(var i in c)["default","CourseServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(193);for(var i in s)["default","CourseServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);var u=n(194);for(var i in u)["default","CourseServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(i);var f=n(195);n.d(t,"UpdateContentStateTarget",(function(){return f.c})),n.d(t,"CourseEnrollmentType",(function(){return f.b})),n.d(t,"CourseBatchStatus",(function(){return f.a}));var l=n(196);for(var i in l)["default","CourseServiceImpl","UpdateContentStateTarget","CourseEnrollmentType","CourseBatchStatus"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return l[e]}))}(i);var p=n(197);n.d(t,"CertificateAlreadyDownloaded",(function(){return p.a}));var d=n(198);for(var i in d)["default","CourseServiceImpl","UpdateContentStateTarget","CourseEnrollmentType","CourseBatchStatus","CertificateAlreadyDownloaded"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return d[e]}))}(i);var h=n(199);for(var i in h)["default","CourseServiceImpl","UpdateContentStateTarget","CourseEnrollmentType","CourseBatchStatus","CertificateAlreadyDownloaded"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return h[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(27),i=n(22),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},c=function(){function e(){}return e.getFilePath=function(e){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(o){switch(o.label){case 0:switch(e){case i.a.DOCUMENTS:t=r.a.Documents;break;case i.a.CACHE:t=r.a.Cache;break;case i.a.DATA:t=r.a.Data;break;case i.a.EXTERNAL_STORAGE:t=r.a.ExternalStorage;break;case i.a.EXTERNAL:t=r.a.External;break;case i.a.LIBRARY:t=r.a.Library;break;default:throw new Error("Unsupported directory")}o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r.c.getUri({path:"",directory:t})];case 2:return[2,o.sent().uri+"/"];case 3:throw n=o.sent(),console.error("Error getting file path:",n),new Error(n instanceof Error?n.message:"Error getting file path");case 4:return[2]}}))}))},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.decodeJWT=function(e){return new Promise((function(t,n){return sbutility.decodeJWTToken(e,(function(e){t(e)}),(function(e){n(e)}))}))},e.createJWTToken=function(e,t){return new Promise((function(n,r){sbutility.getJWTToken(e,t,(function(e){n(e)}),(function(e){r(e)}))}))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.equals=function(e,t){var n=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},r=function(e,t){if(typeof e!=typeof t)return!1;if("function"==typeof e)return e.toString()===t.toString();if(e instanceof Object&&t instanceof Object){if(n(e)!==n(t))return!1;for(var i in e)if(!r(e[i],t[i]))return!1;return!0}return e===t};return r(e,t)},e.getPropDiff=function(t,n){return Object.keys(t).reduce((function(r,i){return e.equals(t[i],n[i])||r.push(i),r}),[])},e.getTruthyProps=function(e){return Object.keys(e).filter((function(t){return!!e[t]}))},e.toOrderedString=function(e){return JSON.stringify(Object.keys(e).sort().reduce((function(t,n){return t[n]=e[n],t}),{}))},e.withDeeplyOrderedKeys=function(t){return Object.keys(t).sort().reduce((function(n,r){return"object"!=typeof t[r]||Array.isArray(t[r])?n[r]=t[r]:n[r]=e.withDeeplyOrderedKeys(t[r]),n}),{})},e}()},function(e,t,n){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",r="second",i="minute",o="hour",a="day",c="week",s="month",u="quarter",f="year",l="date",p="Invalid Date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,E={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},b=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},y={s:b,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+b(r,2,"0")+":"+b(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,s),o=n-i<0,a=t.clone().add(r+(o?-1:1),s);return+(-(r+(n-i)/(o?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:s,y:f,w:c,d:a,D:l,h:o,m:i,s:r,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},v="en",_={};_[v]=E;var S="$isDayjsObject",O=function(e){return e instanceof A||!(!e||!e[S])},g=function e(t,n,r){var i;if(!t)return v;if("string"==typeof t){var o=t.toLowerCase();_[o]&&(i=o),n&&(_[o]=n,i=o);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var c=t.name;_[c]=t,i=c}return!r&&i&&(v=i),i||!r&&v},C=function(e,t){if(O(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new A(n)},m=y;m.l=g,m.i=O,m.w=function(e,t){return C(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var A=function(){function E(e){this.$L=g(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[S]=!0}var b=E.prototype;return b.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(m.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(d);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},b.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},b.$utils=function(){return m},b.isValid=function(){return!(this.$d.toString()===p)},b.isSame=function(e,t){var n=C(e);return this.startOf(t)<=n&&n<=this.endOf(t)},b.isAfter=function(e,t){return C(e)<this.startOf(t)},b.isBefore=function(e,t){return this.endOf(t)<C(e)},b.$g=function(e,t,n){return m.u(e)?this[t]:this.set(n,e)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(e,t){var n=this,u=!!m.u(t)||t,p=m.p(e),d=function(e,t){var r=m.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?r:r.endOf(a)},h=function(e,t){return m.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},E=this.$W,b=this.$M,y=this.$D,v="set"+(this.$u?"UTC":"");switch(p){case f:return u?d(1,0):d(31,11);case s:return u?d(1,b):d(0,b+1);case c:var _=this.$locale().weekStart||0,S=(E<_?E+7:E)-_;return d(u?y-S:y+(6-S),b);case a:case l:return h(v+"Hours",0);case o:return h(v+"Minutes",1);case i:return h(v+"Seconds",2);case r:return h(v+"Milliseconds",3);default:return this.clone()}},b.endOf=function(e){return this.startOf(e,!1)},b.$set=function(e,t){var c,u=m.p(e),p="set"+(this.$u?"UTC":""),d=(c={},c[a]=p+"Date",c[l]=p+"Date",c[s]=p+"Month",c[f]=p+"FullYear",c[o]=p+"Hours",c[i]=p+"Minutes",c[r]=p+"Seconds",c[n]=p+"Milliseconds",c)[u],h=u===a?this.$D+(t-this.$W):t;if(u===s||u===f){var E=this.clone().set(l,1);E.$d[d](h),E.init(),this.$d=E.set(l,Math.min(this.$D,E.daysInMonth())).$d}else d&&this.$d[d](h);return this.init(),this},b.set=function(e,t){return this.clone().$set(e,t)},b.get=function(e){return this[m.p(e)]()},b.add=function(n,u){var l,p=this;n=Number(n);var d=m.p(u),h=function(e){var t=C(p);return m.w(t.date(t.date()+Math.round(e*n)),p)};if(d===s)return this.set(s,this.$M+n);if(d===f)return this.set(f,this.$y+n);if(d===a)return h(1);if(d===c)return h(7);var E=(l={},l[i]=e,l[o]=t,l[r]=1e3,l)[d]||1,b=this.$d.getTime()+n*E;return m.w(b,this)},b.subtract=function(e,t){return this.add(-1*e,t)},b.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=m.z(this),o=this.$H,a=this.$m,c=this.$M,s=n.weekdays,u=n.months,f=n.meridiem,l=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},d=function(e){return m.s(o%12||12,e,"0")},E=f||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return m.s(t.$y,4,"0");case"M":return c+1;case"MM":return m.s(c+1,2,"0");case"MMM":return l(n.monthsShort,c,u,3);case"MMMM":return l(u,c);case"D":return t.$D;case"DD":return m.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return l(n.weekdaysMin,t.$W,s,2);case"ddd":return l(n.weekdaysShort,t.$W,s,3);case"dddd":return s[t.$W];case"H":return String(o);case"HH":return m.s(o,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return E(o,a,!0);case"A":return E(o,a,!1);case"m":return String(a);case"mm":return m.s(a,2,"0");case"s":return String(t.$s);case"ss":return m.s(t.$s,2,"0");case"SSS":return m.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(n,l,p){var d,h=this,E=m.p(l),b=C(n),y=(b.utcOffset()-this.utcOffset())*e,v=this-b,_=function(){return m.m(h,b)};switch(E){case f:d=_()/12;break;case s:d=_();break;case u:d=_()/3;break;case c:d=(v-y)/6048e5;break;case a:d=(v-y)/864e5;break;case o:d=v/t;break;case i:d=v/e;break;case r:d=v/1e3;break;default:d=v}return p?d:m.a(d)},b.daysInMonth=function(){return this.endOf(s).$D},b.$locale=function(){return _[this.$L]},b.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=g(e,t,!0);return r&&(n.$L=r),n},b.clone=function(){return m.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},E}(),T=A.prototype;return C.prototype=T,[["$ms",n],["$s",r],["$m",i],["$H",o],["$W",a],["$M",s],["$y",f],["$D",l]].forEach((function(e){T[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),C.extend=function(e,t){return e.$i||(e(t,A,C),e.$i=!0),C},C.locale=g,C.isDayjs=O,C.unix=function(e){return C(1e3*e)},C.en=_[v],C.Ls=_,C.p={},C}()},function(e,t,n){"use strict";n.r(t);var r=n(185);n.d(t,"DownloadEventType",(function(){return r.a}));var i=n(186);for(var o in i)["default","DownloadEventType"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var a=n(187);n.d(t,"DownloadStatus",(function(){return a.a}));var c=n(188);for(var o in c)["default","DownloadEventType","DownloadStatus"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var s=n(189);for(var o in s)["default","DownloadEventType","DownloadStatus"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(2),i=n(8),o=n(65),a=n(71),c=n(64),s=function(){function e(){}return e.mapContentDataToContentDBEntry=function(e,t){var n,o,a,c;return t?c=JSON.stringify(e):(o=e.lastUpdatedOn,a=JSON.stringify(e)),(n={})[r.b.COLUMN_NAME_IDENTIFIER]=e.identifier,n[r.b.COLUMN_NAME_SERVER_DATA]=a,n[r.b.COLUMN_NAME_SERVER_LAST_UPDATED_ON]=o,n[r.b.COLUMN_NAME_MANIFEST_VERSION]=t,n[r.b.COLUMN_NAME_LOCAL_DATA]=c,n[r.b.COLUMN_NAME_MIME_TYPE]=e.mimeType,n[r.b.COLUMN_NAME_CONTENT_TYPE]=i.a.readContentType(e),n[r.b.COLUMN_NAME_VISIBILITY]=i.a.readVisibility(e),n[r.b.COLUMN_NAME_AUDIENCE]=i.a.readAudience(e),n[r.b.COLUMN_NAME_PRAGMA]=i.a.readPragma(e),n[r.b.COLUMN_NAME_PRIMARY_CATEGORY]=i.a.readPrimaryCategory(e),n},e.mapServerResponseToContent=function(e,t){var n,r;t?r=e:(e.lastUpdatedOn,n=e),!e.primaryCategory&&e.contentType&&e.mimeType&&(e.primaryCategory=c.CsPrimaryCategoryMapper.getPrimaryCategory(e.contentType.toLowerCase(),e.mimeType,e.resourceType));var s=e.primaryCategory?e.primaryCategory:e.contentType;return!e.trackable&&s&&s.toLowerCase()===o.CsContentType.COURSE.toLowerCase()&&(e.trackable={enabled:a.TrackingEnabled.YES}),e.trackable||(e.trackable={enabled:a.TrackingEnabled.NO}),{identifier:e.identifier,name:e.name,contentData:e,isUpdateAvailable:i.a.isUpdateAvailable(n,r),mimeType:e.mimeType,basePath:"",contentType:i.a.readContentType(e),primaryCategory:i.a.readPrimaryCategory(e),isAvailableLocally:!1,referenceCount:0,sizeOnDevice:0,lastUsedTime:0,lastUpdatedTime:0}},e.mapContentDBEntryToContent=function(e,t){var n,s,u=e[r.b.COLUMN_NAME_SERVER_DATA],f=e[r.b.COLUMN_NAME_LOCAL_DATA],l=u&&JSON.parse(u),p=f&&JSON.parse(f),d=e[r.b.COLUMN_NAME_IDENTIFIER],h=e[r.b.COLUMN_NAME_MIME_TYPE],E=(e[r.b.COLUMN_NAME_VISIBILITY],e[r.b.COLUMN_NAME_CONTENT_TYPE]),b=e[r.b.COLUMN_NAME_PRIMARY_CATEGORY],y=0;e.hasOwnProperty(r.a.COLUMN_NAME_EPOCH_TIMESTAMP)&&(y=e[r.a.COLUMN_NAME_EPOCH_TIMESTAMP]),e.hasOwnProperty(r.d.COLUMN_NAME_DATA)&&(p||(p=JSON.parse(e[r.d.COLUMN_NAME_DATA])),p&&(d=p.identifier,h=p.mimeType,s=p.resourceType,i.a.readVisibility(p),E=i.a.readContentType(p),b=i.a.readPrimaryCategory(p))),p&&(n=p),l&&(p&&i.a.isAvailableLocally(e[r.b.COLUMN_NAME_CONTENT_STATE])?(p.streamingUrl||(p.streamingUrl=l.streamingUrl),p.previewUrl||(p.previewUrl=l.previewUrl),l.me_totalRatingsCount&&(p.me_totalRatingsCount=l.me_totalRatingsCount),l.me_averageRating&&(p.me_averageRating=l.me_averageRating),p.size||(p.size=l.size),l.licenseDetails&&(p.licenseDetails=l.licenseDetails),l.forumId&&(p.forumId=l.forumId)):n=l);var v=0,_=e[r.b.COLUMN_NAME_LOCAL_LAST_UPDATED_ON];_&&(v=new Date(_).getTime());var S=Number(e[r.b.COLUMN_NAME_SIZE_ON_DEVICE]),O=S||Number(l?l.size:0);!n.trackable&&b&&b.toLowerCase()===o.CsContentType.COURSE.toLowerCase()&&(n.trackable={enabled:a.TrackingEnabled.YES}),n.trackable||(n.trackable={enabled:a.TrackingEnabled.NO}),s=n.resourceType,!n.primaryCategory&&E&&(n.primaryCategory=c.CsPrimaryCategoryMapper.getPrimaryCategory(E.toLowerCase(),h,s));var g=e[r.b.COLUMN_NAME_PATH]||"";return"string"==typeof n.originData&&(n.originData=i.a.getParseErrorObject(n.originData)),n.trackable&&"string"==typeof n.trackable&&(n.trackable=JSON.parse(n.trackable)),{identifier:d,name:n.name,contentData:n,isUpdateAvailable:i.a.isUpdateAvailable(l,p),mimeType:h,basePath:t?"/_app_file_"+g:g,primaryCategory:b,contentType:E,isAvailableLocally:i.a.isAvailableLocally(e[r.b.COLUMN_NAME_CONTENT_STATE]),referenceCount:Number(e[r.b.COLUMN_NAME_REF_COUNT])||0,sizeOnDevice:O,lastUsedTime:y||0,lastUpdatedTime:v}},e}()},function(e,t,n){"use strict";n.r(t);var r=n(167);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(168);n.d(t,"NetworkStatus",(function(){return o.a}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(53),i=n(228),o=n(378),a=function(){function e(e){this.dictionary=new o.default(e)}return e.prototype.contains=function(e){return this.dictionary.containsKey(e)},e.prototype.add=function(e){return!this.contains(e)&&!r.isUndefined(e)&&(this.dictionary.setValue(e,e),!0)},e.prototype.intersection=function(e){var t=this;this.forEach((function(n){return e.contains(n)||t.remove(n),!0}))},e.prototype.union=function(e){var t=this;e.forEach((function(e){return t.add(e),!0}))},e.prototype.difference=function(e){var t=this;e.forEach((function(e){return t.remove(e),!0}))},e.prototype.isSubsetOf=function(e){if(this.size()>e.size())return!1;var t=!0;return this.forEach((function(n){return!!e.contains(n)||(t=!1,!1)})),t},e.prototype.remove=function(e){return!!this.contains(e)&&(this.dictionary.remove(e),!0)},e.prototype.forEach=function(e){this.dictionary.forEach((function(t,n){return e(n)}))},e.prototype.toArray=function(){return this.dictionary.values()},e.prototype.isEmpty=function(){return this.dictionary.isEmpty()},e.prototype.size=function(){return this.dictionary.size()},e.prototype.clear=function(){this.dictionary.clear()},e.prototype.toString=function(){return i.toString(this.toArray())},e}();t.default=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},i=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},o=function(){function e(){}return e.dirPathFromFilePath=function(e){return e.substring(0,e.lastIndexOf("/"))},e.fileNameFromFilePath=function(e){return e.substring(e.lastIndexOf("/")+1)},e.getAssetPath=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,"ios"===window.device.platform.toLowerCase()?"www/assets":e.ASSETS_PATH]}))}))},e.ASSETS_PATH="file:///android_asset/www/assets",e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"SIGN_IN_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(38),i=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=i},function(e,t,n){"use strict";n.r(t);var r=n(146);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(147);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(148);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(48);n.d(t,"SignInError",(function(){return c.a}));var s=n(149);n.d(t,"AuthEventType",(function(){return s.a}));var u=n(150);for(var i in u)["default","SignInError","AuthEventType"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(i);var f=n(151);n.d(t,"WebviewLoginSessionProvider",(function(){return f.a}));var l=n(267);n.d(t,"WebviewManualMergeSessionProvider",(function(){return l.a}));var p=n(75);n.d(t,"WebviewAutoMergeSessionProvider",(function(){return p.a}));var d=n(51);n.d(t,"WebviewRunnerError",(function(){return d.a}));var h=n(268);n.d(t,"InterruptError",(function(){return h.a}));var E=n(69);n.d(t,"NoInappbrowserSessionAssertionFailError",(function(){return E.a}));var b=n(90);n.d(t,"ParamNotCapturedError",(function(){return b.a}));var y=n(269);n.d(t,"NativeGoogleSessionProvider",(function(){return y.a}));var v=n(270);n.d(t,"NativeAppleSessionProvider",(function(){return v.a}));var _=n(271);n.d(t,"WebviewStateSessionProvider",(function(){return _.a}));var S=n(272);for(var i in S)["default","SignInError","AuthEventType","WebviewLoginSessionProvider","WebviewManualMergeSessionProvider","WebviewAutoMergeSessionProvider","WebviewRunnerError","InterruptError","NoInappbrowserSessionAssertionFailError","ParamNotCapturedError","NativeGoogleSessionProvider","NativeAppleSessionProvider","WebviewStateSessionProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return S[e]}))}(i);var O=n(273);for(var i in O)["default","SignInError","AuthEventType","WebviewLoginSessionProvider","WebviewManualMergeSessionProvider","WebviewAutoMergeSessionProvider","WebviewRunnerError","InterruptError","NoInappbrowserSessionAssertionFailError","ParamNotCapturedError","NativeGoogleSessionProvider","NativeAppleSessionProvider","WebviewStateSessionProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return O[e]}))}(i);var g=n(274);n.d(t,"NativeKeycloakSessionProvider",(function(){return g.a}));var C=n(275);n.d(t,"NativeCustomBrowserSessionProvider",(function(){return C.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n,r){var i=e.call(this,n,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(7),i=n(23),o=n(79),a=n(107),c=function(){function e(e){this.config=e}return e.prototype.generateNetworkQueueRequest=function(e,t,n,c,s){var u,f;if(e===i.b.TELEMETRY){var l=t.split("").map((function(e){return e.charCodeAt(0)}));u=new Uint8Array(l),f=(new r.Request.Builder).withSerializer(r.HttpSerializer.RAW).withHost(this.config.telemetryConfig.host).withType(r.HttpRequestType.POST).withPath(this.config.telemetryConfig.apiPath+o.a.TELEMETRY_ENDPOINT).withHeaders({"Content-Type":"application/json","Content-Encoding":"gzip"}).withBody(u).withBearerToken(!0).build()}else u=t,f=(new r.Request.Builder).withType(r.HttpRequestType.PATCH).withPath(this.config.courseServiceConfig.apiPath+a.a.UPDATE_CONTENT_STATE_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody(u).build();console.log("inNetworkRequest",n);var p={msgId:n,data:e===i.b.TELEMETRY?t:JSON.stringify(t),networkRequest:f,priority:e===i.b.TELEMETRY?2:1,itemCount:c,type:e,config:JSON.stringify({shouldPublishResult:s}),ts:Date.now()};return console.log("networkQueueRequest",p.msgId),p},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function i(e){return"function"==typeof e}function o(e){return void 0===e}function a(e){return"[object String]"===Object.prototype.toString.call(e)}t.has=function(e,t){return r.call(e,t)},t.defaultCompare=function(e,t){return e<t?-1:e===t?0:1},t.defaultEquals=function(e,t){return e===t},t.defaultToString=function(e){return null===e?"COLLECTION_NULL":o(e)?"COLLECTION_UNDEFINED":a(e)?"$s"+e:"$o"+e.toString()},t.makeString=function(e,n){if(void 0===n&&(n=","),null===e)return"COLLECTION_NULL";if(o(e))return"COLLECTION_UNDEFINED";if(a(e))return e.toString();var r="{",i=!0;for(var c in e)t.has(e,c)&&(i?i=!1:r+=n,r=r+c+":"+e[c]);return r+"}"},t.isFunction=i,t.isUndefined=o,t.isString=a,t.reverseCompareFunction=function(e){return o(e)||!i(e)?function(e,t){return e<t?1:e===t?0:-1}:function(t,n){return-1*e(t,n)}},t.compareToEquals=function(e){return function(t,n){return 0===e(t,n)}}},function(e,t,n){"use strict";var r=n(345),i=n(374),o=n(113);e.exports={formats:o,parse:i,stringify:r}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(1);!function(e){e._ID="_id",e.TABLE_NAME="certificate_public_key",e.COLUMN_NAME_IDENTIFIER="identifier",e.COLUMN_NAME_PUBLIC_KEY="public_key",e.COLUMN_NAME_ALGORITHM="alg",e.COLUMN_NAME_OWNER="owner",e.COLUMN_NAME_EXPIRY_TIME="expiry_time",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY,"+e.COLUMN_NAME_IDENTIFIER+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_PUBLIC_KEY+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_ALGORITHM+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_OWNER+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_EXPIRY_TIME+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+" )"},e.deleteTable=function(){return"DROP TABLE IF EXISTS "+e.TABLE_NAME}}(r||(r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}},function(e,t,n){var r,i,o,a,c,s,u,f;e.exports=(f=n(190),i=(r=f).lib,o=i.WordArray,a=i.Hasher,c=r.algo,s=[],u=c.SHA1=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],c=n[4],u=0;u<80;u++){if(u<16)s[u]=0|e[t+u];else{var f=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=f<<1|f>>>31}var l=(r<<5|r>>>27)+c+s[u];l+=u<20?1518500249+(i&o|~i&a):u<40?1859775393+(i^o^a):u<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,c=a,a=o,o=i<<30|i>>>2,i=r,r=l}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=a._createHelper(u),r.HmacSHA1=a._createHmacHelper(u),f.SHA1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0;var r=n(43),i=n(38);function o(e,t,n,i,o){var a={},c="number"==typeof o,s=void 0!==o&&c?o.toString():n;if(c&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var u=a[s];if(Array.isArray(u))for(var f=0,l=u;f<l.length;f++){var p=l[f];if(p.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+p.key.toString())}else u=[];u.push(i),a[s]=u,Reflect.defineMetadata(e,a,t)}function a(e,t){Reflect.decorate(e,t)}function c(e,t){return function(n,r){t(n,r,e)}}t.tagParameter=function(e,t,n,r){o(i.TAGGED,e,t,r,n)},t.tagProperty=function(e,t,n){o(i.TAGGED_PROP,e.constructor,t,n)},t.decorate=function(e,t,n){"number"==typeof n?a([c(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):a([e],t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(54),i=n(3),o=n(69),a=n(90),c=n(0),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=function(){function e(){this.extras={},this.captured={}}return e.buildUrl=function(e,t,n){return""+e+t+"?"+r.stringify(n)},e.prototype.resetInAppBrowserEventListeners=function(){var e=this;if(!this.inAppBrowser)throw new o.a("InAppBrowser Session not found when resetInAppBrowserEventListeners()");var t=function(t){n.inAppBrowser.listeners.hasOwnProperty(t)&&(n.inAppBrowser.listeners[t].forEach((function(n){e.inAppBrowser.ref.removeEventListener(t,n)})),n.inAppBrowser.listeners[t].clear())},n=this;for(var r in this.inAppBrowser.listeners)t(r)},e.prototype.launchWebview=function(t){var n=t.host,r=t.path,i=t.params;return u(this,void 0,void 0,(function(){var t,o=this;return f(this,(function(a){return this.inAppBrowser={ref:cordova.InAppBrowser.open(e.buildUrl(n,r,i),"_blank","zoom=no,clearcache=yes,clearsessioncache=yes,cleardata=yes"),listeners:{loadstart:new Set,exit:new Set}},t=function(){o.resetInAppBrowserEventListeners(),o.inAppBrowser=void 0},this.inAppBrowser.listeners.exit.add(t),this.inAppBrowser.ref.addEventListener("exit",t),[2]}))}))},e.prototype.closeWebview=function(){return u(this,void 0,void 0,(function(){return f(this,(function(e){if(!this.inAppBrowser)throw new o.a("InAppBrowser Session not found");return this.inAppBrowser.ref.close(),[2]}))}))},e.prototype.any=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.race.apply(void 0,e).pipe(Object(c.take)(1)).toPromise()},e.prototype.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.zip.apply(void 0,e).pipe(Object(c.take)(1),Object(c.mapTo)(void 0)).toPromise()},e.prototype.launchCustomTab=function(t){var n=this,i=t.host,o=t.path,a=t.params,c=t.extraParams,u=e.buildUrl(i,o,a);return new Promise((function(e,t){customtabs.isAvailable((function(){customtabs.launch(u,(function(t){n.captured=s(s({},n.captured),r.parse(t)),e()}),(function(e){t(e)}))}),(function(){customtabs.launchInBrowser(u,c,(function(t){n.captured=s(s({},n.captured),r.parse(t)),e()}),(function(e){t(e)}))}))}))},e.prototype.capture=function(e){var t=this,n=e.host,r=e.path,i=e.params;if(!this.inAppBrowser)throw new o.a("InAppBrowser Session not found");return new Promise((function(e){var o=function(a){if(a.url){var c=new URL(a.url);c.origin===n&&function(e){return e.pathname===r}(c)&&function(e){return i.map((function(e){return e})).every((function(t){return"false"===t.exists?!e.searchParams.has(t.key):t.match?e.searchParams.has(t.key)&&e.searchParams.get(t.key)===t.match:e.searchParams.has(t.key)}))}(c)&&(t.captured=s(s({},t.captured),i.reduce((function(e,t){return e[t.resolveTo]=c.searchParams.get(t.key),e}),{})),t.extras={},i.map((function(e){return e.key})).forEach((function(e){return c.searchParams.delete(e)})),c.searchParams.forEach((function(e,n){t.extras[n]=e})),t.inAppBrowser&&(t.inAppBrowser.listeners.loadstart.delete(o),t.inAppBrowser.ref.removeEventListener("loadstart",o)),e())}};t.inAppBrowser&&(t.inAppBrowser.listeners.loadstart.add(o),t.inAppBrowser.ref.addEventListener("loadstart",o))}))},e.prototype.resolveCaptured=function(e){return u(this,void 0,void 0,(function(){return f(this,(function(t){if(!this.captured[e])throw new a.a(e+" was not captured");return[2,this.captured[e]]}))}))},e.prototype.clearCapture=function(){return u(this,void 0,void 0,(function(){return f(this,(function(e){return this.captured={},[2]}))}))},e.prototype.redirectTo=function(t){var n=t.host,r=t.path,i=t.params;return u(this,void 0,void 0,(function(){return f(this,(function(t){if(!this.inAppBrowser)throw new o.a("InAppBrowser Session not found");return this.inAppBrowser.ref.executeScript({code:"(() => {\n                        window.location.href = `"+e.buildUrl(n,r,i)+"`;\n                    })()"}),[2]}))}))},e.prototype.success=function(){return u(this,void 0,void 0,(function(){return f(this,(function(e){return[2,s({},this.captured)]}))}))},e.prototype.fail=function(){return u(this,void 0,void 0,(function(){return f(this,(function(e){throw s({},this.captured)}))}))},e.prototype.getCaptureExtras=function(){return u(this,void 0,void 0,(function(){return f(this,(function(e){return[2,s({},this.extras)]}))}))},e}()},function(e,t,n){e.exports=function e(t,n,r){function i(a,c){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[a]={exports:{}};t[a][0].call(u.exports,(function(e){return i(t[a][1][e]||e)}),u,u.exports,e,t,n,r)}return n[a].exports}for(var o=!1,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},a={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],2:[function(e,t,n){"use strict";var r=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),c=0;c<256;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;function s(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,i,o,a,c=e.length,s=0;for(o=0;o<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<c&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(s),a=0,o=0;a<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<c&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return s(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,o,c=t||e.length,u=new Array(2*c);for(r=0,n=0;n<c;)if((i=e[n++])<128)u[r++]=i;else if((o=a[i])>4)u[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<c;)i=i<<6|63&e[n++],o--;o>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return s(u,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":1}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var c=i;c<a;c++)e=e>>>8^o[255&(e^t[c])];return-1^e}},{}],5:[function(e,t,n){"use strict";var r,i=e("../utils/common"),o=e("./trees"),a=e("./adler32"),c=e("./crc32"),s=e("./messages");function u(e,t){return e.msg=s[t],t}function f(e){return(e<<1)-(e>4?9:0)}function l(e){for(var t=e.length;--t>=0;)e[t]=0}function p(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function d(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,p(e.strm)}function h(e,t){e.pending_buf[e.pending++]=t}function E(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function b(e,t){var n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,c=e.nice_match,s=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,f=e.w_mask,l=e.prev,p=e.strstart+258,d=u[o+a-1],h=u[o+a];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do{if(u[(n=t)+a]===h&&u[n+a-1]===d&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<p);if(r=258-(p-o),o=p-258,r>a){if(e.match_start=t,a=r,r>=c)break;d=u[o+a-1],h=u[o+a]}}}while((t=l[t&f])>s&&0!=--i);return a<=e.lookahead?a:e.lookahead}function y(e){var t,n,r,o,s,u,f,l,p,d,h=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-262)){i.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=h?r-h:0}while(--n);t=n=h;do{r=e.prev[--t],e.prev[t]=r>=h?r-h:0}while(--n);o+=h}if(0===e.strm.avail_in)break;if(u=e.strm,f=e.window,l=e.strstart+e.lookahead,p=o,d=void 0,(d=u.avail_in)>p&&(d=p),n=0===d?0:(u.avail_in-=d,i.arraySet(f,u.input,u.next_in,d,l),1===u.state.wrap?u.adler=a(u.adler,f,d,l):2===u.state.wrap&&(u.adler=c(u.adler,f,d,l)),u.next_in+=d,u.total_in+=d,d),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+3-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function v(e,t){for(var n,r;;){if(e.lookahead<262){if(y(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=b(e,n)),e.match_length>=3)if(r=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function _(e,t){for(var n,r,i;;){if(e.lookahead<262){if(y(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=b(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(d(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=o._tr_tally(e,0,e.window[e.strstart-1]))&&d(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}function S(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function O(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),l(this.dyn_ltree),l(this.dyn_dtree),l(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),l(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),l(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function g(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):u(e,-2)}function C(e){var t,n=g(e);return 0===n&&((t=e.state).window_size=2*t.w_size,l(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function m(e,t,n,r,o,a){if(!e)return-2;var c=1;if(-1===t&&(t=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),o<1||o>9||8!==n||r<8||r>15||t<0||t>9||a<0||a>4)return u(e,-2);8===r&&(r=9);var s=new O;return e.state=s,s.strm=e,s.wrap=c,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new i.Buf8(2*s.w_size),s.head=new i.Buf16(s.hash_size),s.prev=new i.Buf16(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new i.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,C(e)}r=[new S(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(y(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,d(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(d(e,!1),e.strm.avail_out),1)})),new S(4,4,8,4,v),new S(4,5,16,8,v),new S(4,6,32,32,v),new S(4,4,16,16,_),new S(8,16,32,32,_),new S(8,16,128,128,_),new S(8,32,128,256,_),new S(32,128,258,1024,_),new S(32,258,258,4096,_)],n.deflateInit=function(e,t){return m(e,t,8,15,8,0)},n.deflateInit2=m,n.deflateReset=C,n.deflateResetKeep=g,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},n.deflate=function(e,t){var n,i,a,s;if(!e||!e.state||t>5||t<0)return e?u(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return u(e,0===e.avail_out?-5:-2);if(i.strm=e,n=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,h(i,31),h(i,139),h(i,8),i.gzhead?(h(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),h(i,255&i.gzhead.time),h(i,i.gzhead.time>>8&255),h(i,i.gzhead.time>>16&255),h(i,i.gzhead.time>>24&255),h(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),h(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(h(i,255&i.gzhead.extra.length),h(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=c(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(h(i,0),h(i,0),h(i,0),h(i,0),h(i,0),h(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),h(i,3),i.status=113);else{var b=8+(i.w_bits-8<<4)<<8;b|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(b|=32),b+=31-b%31,i.status=113,E(i,b),0!==i.strstart&&(E(i,e.adler>>>16),E(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),p(e),a=i.pending,i.pending!==i.pending_buf_size));)h(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),p(e),a=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,h(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),0===s&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),p(e),a=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,h(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>a&&(e.adler=c(e.adler,i.pending_buf,i.pending-a,a)),0===s&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&p(e),i.pending+2<=i.pending_buf_size&&(h(i,255&e.adler),h(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(p(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&f(t)<=f(n)&&4!==t)return u(e,-5);if(666===i.status&&0!==e.avail_in)return u(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var v=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(y(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var n,r,i,a,c=e.window;;){if(e.lookahead<=258){if(y(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=c[i=e.strstart-1])===c[++i]&&r===c[++i]&&r===c[++i]){a=e.strstart+258;do{}while(r===c[++i]&&r===c[++i]&&r===c[++i]&&r===c[++i]&&r===c[++i]&&r===c[++i]&&r===c[++i]&&r===c[++i]&&i<a);e.match_length=258-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(d(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(d(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(d(e,!1),0===e.strm.avail_out)?1:2}(i,t):r[i.level].func(i,t);if(3!==v&&4!==v||(i.status=666),1===v||3===v)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===v&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(l(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),p(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(h(i,255&e.adler),h(i,e.adler>>8&255),h(i,e.adler>>16&255),h(i,e.adler>>24&255),h(i,255&e.total_in),h(i,e.total_in>>8&255),h(i,e.total_in>>16&255),h(i,e.total_in>>24&255)):(E(i,e.adler>>>16),E(i,65535&e.adler)),p(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},n.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?u(e,-2):(e.state=null,113===t?u(e,-3):0):-2},n.deflateSetDictionary=function(e,t){var n,r,o,c,s,u,f,p,d=t.length;if(!e||!e.state)return-2;if(2===(c=(n=e.state).wrap)||1===c&&42!==n.status||n.lookahead)return-2;for(1===c&&(e.adler=a(e.adler,t,d,0)),n.wrap=0,d>=n.w_size&&(0===c&&(l(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new i.Buf8(n.w_size),i.arraySet(p,t,d-n.w_size,n.w_size,0),t=p,d=n.w_size),s=e.avail_in,u=e.next_in,f=e.input,e.avail_in=d,e.next_in=0,e.input=t,y(n);n.lookahead>=3;){r=n.strstart,o=n.lookahead-2;do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+3-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=2,y(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=u,e.input=f,e.avail_in=s,n.wrap=c,0},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":4,"./messages":6,"./trees":7}],6:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],7:[function(e,t,n){"use strict";var r=e("../utils/common");function i(e){for(var t=e.length;--t>=0;)e[t]=0}var o=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],s=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var f=new Array(60);i(f);var l=new Array(512);i(l);var p=new Array(256);i(p);var d=new Array(29);i(d);var h,E,b,y=new Array(30);function v(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function S(e){return e<256?l[e]:l[256+(e>>>7)]}function O(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function g(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,O(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function C(e,t,n){g(e,n[2*t],n[2*t+1])}function m(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function A(e,t,n){var r,i,o=new Array(16),a=0;for(r=1;r<=15;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=t;i++){var c=e[2*i+1];0!==c&&(e[2*i]=m(o[c]++,c))}}function T(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function N(e){e.bi_valid>8?O(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,n,r){var i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]}function M(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function w(e,t,n){var r,i,c,s,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===r?C(e,i,t):(C(e,(c=p[i])+256+1,t),0!==(s=o[c])&&g(e,i-=d[c],s),C(e,c=S(--r),n),0!==(s=a[c])&&g(e,r-=y[c],s))}while(u<e.last_lit);C(e,256,t)}function D(e,t){var n,r,i,o=t.dyn_tree,a=t.stat_desc.static_tree,c=t.stat_desc.has_stree,s=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<s;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,c&&(e.static_len-=a[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)M(e,o,n);i=s;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],M(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*i]=o[2*n]+o[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=i,e.heap[1]=i++,M(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,o,a,c,s=t.dyn_tree,u=t.max_code,f=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,h=t.stat_desc.max_length,E=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(s[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=s[2*s[2*(r=e.heap[n])+1]+1]+1)>h&&(o=h,E++),s[2*r+1]=o,r>u||(e.bl_count[o]++,a=0,r>=d&&(a=p[r-d]),c=s[2*r],e.opt_len+=c*(o+a),l&&(e.static_len+=c*(f[2*r+1]+a)));if(0!==E){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,E-=2}while(E>0);for(o=h;0!==o;o--)for(r=e.bl_count[o];0!==r;)(i=e.heap[--n])>u||(s[2*i+1]!==o&&(e.opt_len+=(o-s[2*i+1])*s[2*i],s[2*i+1]=o),r--)}}(e,t),A(o,u,e.bl_count)}function P(e,t,n){var r,i,o=-1,a=t[1],c=0,s=7,u=4;for(0===a&&(s=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++c<s&&i===a||(c<u?e.bl_tree[2*i]+=c:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):c<=10?e.bl_tree[34]++:e.bl_tree[36]++,c=0,o=i,0===a?(s=138,u=3):i===a?(s=6,u=3):(s=7,u=4))}function R(e,t,n){var r,i,o=-1,a=t[1],c=0,s=7,u=4;for(0===a&&(s=138,u=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++c<s&&i===a)){if(c<u)do{C(e,i,e.bl_tree)}while(0!=--c);else 0!==i?(i!==o&&(C(e,i,e.bl_tree),c--),C(e,16,e.bl_tree),g(e,c-3,2)):c<=10?(C(e,17,e.bl_tree),g(e,c-3,3)):(C(e,18,e.bl_tree),g(e,c-11,7));c=0,o=i,0===a?(s=138,u=3):i===a?(s=6,u=3):(s=7,u=4)}}i(y);var L=!1;function j(e,t,n,i){g(e,0+(i?1:0),3),function(e,t,n,i){N(e),i&&(O(e,n),O(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}n._tr_init=function(e){L||(function(){var e,t,n,r,i,s=new Array(16);for(n=0,r=0;r<28;r++)for(d[r]=n,e=0;e<1<<o[r];e++)p[n++]=r;for(p[n-1]=r,i=0,r=0;r<16;r++)for(y[r]=i,e=0;e<1<<a[r];e++)l[i++]=r;for(i>>=7;r<30;r++)for(y[r]=i<<7,e=0;e<1<<a[r]-7;e++)l[256+i++]=r;for(t=0;t<=15;t++)s[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,s[8]++;for(;e<=255;)u[2*e+1]=9,e++,s[9]++;for(;e<=279;)u[2*e+1]=7,e++,s[7]++;for(;e<=287;)u[2*e+1]=8,e++,s[8]++;for(A(u,287,s),e=0;e<30;e++)f[2*e+1]=5,f[2*e]=m(e,5);h=new v(u,o,257,286,15),E=new v(f,a,0,30,15),b=new v(new Array(0),c,0,19,7)}(),L=!0),e.l_desc=new _(e.dyn_ltree,h),e.d_desc=new _(e.dyn_dtree,E),e.bl_desc=new _(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,T(e)},n._tr_stored_block=j,n._tr_flush_block=function(e,t,n,r){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),a=function(e){var t;for(P(e,e.dyn_ltree,e.l_desc.max_code),P(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*s[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?j(e,t,n,r):4===e.strategy||o===i?(g(e,2+(r?1:0),3),w(e,u,f)):(g(e,4+(r?1:0),3),function(e,t,n,r){var i;for(g(e,t-257,5),g(e,n-1,5),g(e,r-4,4),i=0;i<r;i++)g(e,e.bl_tree[2*s[i]+1],3);R(e,e.dyn_ltree,t-1),R(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),w(e,e.dyn_ltree,e.dyn_dtree)),T(e),r&&N(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(p[n]+256+1)]++,e.dyn_dtree[2*S(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){g(e,2,3),C(e,256,u),function(e){16===e.bi_valid?(O(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":1}],8:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/deflate.js":[function(e,t,n){"use strict";var r=e("./zlib/deflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),c=e("./zlib/zstream"),s=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==n)throw new Error(a[n]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===s.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(n=r.deflateSetDictionary(this.strm,f)))throw new Error(a[n]);this._dict_set=!0}}function f(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}u.prototype.push=function(e,t){var n,a,c=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?c.input=o.string2buf(e):"[object ArrayBuffer]"===s.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new i.Buf8(u),c.next_out=0,c.avail_out=u),1!==(n=r.deflate(c,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==c.avail_out&&(0!==c.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(c.output,c.next_out))):this.onData(i.shrinkBuf(c.output,c.next_out)))}while((c.avail_in>0||0===c.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),c.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=u,n.deflate=f,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},{"./utils/common":1,"./utils/strings":2,"./zlib/deflate":5,"./zlib/messages":6,"./zlib/zstream":8}]},{},[])("/lib/deflate.js")},function(e,t,n){"use strict";n.r(t);var r=n(230);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(231);n.d(t,"PageName",(function(){return o.a}));var a=n(232);for(var i in a)["default","PageName"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(233);for(var i in c)["default","PageName"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i)},function(e,t,n){"use strict";n.r(t);var r=n(246);n.d(t,"NotificationType",(function(){return r.b})),n.d(t,"NotificationStatus",(function(){return r.a}));var i=n(247);for(var o in i)["default","NotificationType","NotificationStatus"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(7),i=n(54),o=n(48),a=n(39),c=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},u=function(){function e(e,t,n){this.apiConfig=e,this.apiService=t,this.eventsBusService=n}return e.parseAccessToken=function(e){return c(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,a.a.decodeJWT(e)];case 1:return t=r.sent(),[2,{userToken:3===(n=JSON.parse(t)).sub.split(":").length?n.sub.split(":").pop():n.sub,accessTokenExpiresOn:1e3*n.exp}]}}))}))},e.prototype.buildGoogleTargetUrl=function(e,t){var n=new URL(e.googleRedirectUrl);return delete t.redirect_uri,n.searchParams.set("redirect_uri",this.apiConfig.user_authentication.redirectUrl),delete t.error_callback,n.searchParams.set("error_callback",this.apiConfig.user_authentication.redirectUrl),Object.keys(t).forEach((function(e){return n.searchParams.set(e,t[e])})),n},e.prototype.buildPasswordSessionProvider=function(e,t){var n=this;return e.capture({host:t.when.host,path:t.when.path,params:t.when.params}).then((function(){return e.closeWebview()})).then((function(){return e.success()})).then((function(e){return n.resolvePasswordSession(e)}))},e.prototype.buildStateSessionProvider=function(e,t){var n=this;return e.capture({host:t.when.host,path:t.when.path,params:t.when.params}).then((function(){return e.closeWebview()})).then((function(){return e.success()})).then((function(e){return n.resolveStateSession(e)}))},e.prototype.buildGoogleSessionProvider=function(e,t,n){var r=this;return e.capture({host:t.when.host,path:t.when.path,params:t.when.params}).then((function(){return e.closeWebview()})).then((function(){return e.success()})).then((function(t){return e.getCaptureExtras().then((function(o){var a=r.buildGoogleTargetUrl(t,o);return e.launchCustomTab({host:a.origin,path:a.pathname,params:i.parse(a.searchParams.toString(),{ignoreQueryPrefix:!0}),extraParams:n.get("extraParam")}).then((function(){return e.success()})).then((function(e){return r.resolveGoogleSession(e)}))}))}))},e.prototype.resolvePasswordSession=function(t){var n=this,i=(new r.Request.Builder).withType(r.HttpRequestType.POST).withPath(this.apiConfig.user_authentication.authUrl+"/token").withBody({redirect_uri:this.apiConfig.host+"/oauth2callback",code:t.code,grant_type:"authorization_code",client_id:"android"}).withHeaders({"Content-Type":"application/x-www-form-urlencoded"}).withSerializer(r.HttpSerializer.URLENCODED).withBearerToken(!1).withUserToken(!1).build();return this.apiService.fetch(i).toPromise().then((function(t){return c(n,void 0,void 0,(function(){var n,r,i;return s(this,(function(a){switch(a.label){case 0:return t.body.access_token&&t.body.refresh_token?[4,e.parseAccessToken(t.body.access_token)]:[3,2];case 1:return n=a.sent(),r=n.userToken,i=n.accessTokenExpiresOn,[2,{access_token:t.body.access_token,refresh_token:t.body.refresh_token,accessTokenExpiresOn:i,userToken:r}];case 2:throw new o.a("Server Error")}}))}))})).catch((function(){throw new o.a("Server Error")}))},e.prototype.resolveStateSession=function(t){var n=this,i="/v1/sso/create/session?id="+("ios"===window.device.platform.toLowerCase()?encodeURIComponent(t.id):t.id),a=(new r.Request.Builder).withType(r.HttpRequestType.GET).withPath(i).withUserToken(!1).withBearerToken(!1).build();return this.apiService.fetch(a).toPromise().then((function(t){return c(n,void 0,void 0,(function(){var n,r,i;return s(this,(function(a){switch(a.label){case 0:return t.body.access_token&&t.body.refresh_token?[4,e.parseAccessToken(t.body.access_token)]:[3,2];case 1:return n=a.sent(),r=n.userToken,i=n.accessTokenExpiresOn,[2,{access_token:t.body.access_token,refresh_token:t.body.refresh_token,accessTokenExpiresOn:i,userToken:r}];case 2:throw new o.a("Server Error")}}))}))})).catch((function(){throw new o.a("Server Error")}))},e.prototype.resolveGoogleSession=function(t){return c(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(a){switch(a.label){case 0:return t.access_token&&t.refresh_token?[4,e.parseAccessToken(t.access_token)]:[3,2];case 1:return n=a.sent(),r=n.userToken,i=n.accessTokenExpiresOn,[2,{access_token:t.access_token,refresh_token:t.refresh_token,accessTokenExpiresOn:i,userToken:r}];case 2:if(t.error_message)throw new o.a(t.error_message);a.label=3;case 3:throw new o.a("Server Error")}}))}))},e}()},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=function(){function e(){}return e.prepareFrameworkCategoryAssociations=function(e){return e.categories?(e.categories=e.categories.map((function(t,n){return t.terms?r(r({},t),{terms:t.terms.map((function(t){return t.associations?(t.associations.length&&(t.associations=t.associations.filter((function(t){return n>=e.categories.length-1||t.category===e.categories[n+1].code}))),t):t}))}):t})),r({},e)):e},e.prepareFrameworkTranslations=function(t,n){return t.name=e.getTranslatedValue(t.translations,n,t.name),t.categories&&(t.categories=t.categories.map((function(t){return t.name=e.getTranslatedValue(t.translations,n,t.name),t.terms&&(t.terms=t.terms.map((function(t){return t.name=e.getTranslatedValue(t.translations,n,t.name),t}))),t}))),t},e.prepareFrameworkCategoryTranslations=function(t,n){return t.name=e.getTranslatedValue(t.translations,n,t.name),t.terms&&(t.terms=t.terms.map((function(t){return t.name=e.getTranslatedValue(t.translations,n,t.name),t}))),t},e.getTranslatedValue=function(e,t,n){return e&&JSON.parse(e)[t]||n},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var r=0;t.id=function(){return r++}},function(e,t){e.exports=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(51),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(t){var n=e.call(this,t,"NO_INAPPBROWSER_SESSION_ASSERTION_FAIL")||this;return Object.setPrototypeOf(n,i.a.prototype),n}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.r(t);var r=n(254);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(255);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(256);n.d(t,"GroupSessionDeprecated",(function(){return a.a}));var c=n(257);for(var i in c)["default","GroupSessionDeprecated"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(258);for(var i in s)["default","GroupSessionDeprecated"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);var u=n(259);n.d(t,"NoGroupFoundError",(function(){return u.a}));var f=n(260);n.d(t,"NoActiveGroupSessionError",(function(){return f.a}))},function(e,t){e.exports=c},function(e,t,n){"use strict";e.exports=TypeError},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,i=n(1);!function(e){e.TABLE_NAME="network_queue",e._ID="_id",e.COLUMN_NAME_MSG_ID="msg_id",e.COLUMN_NAME_PRIORITY="priority",e.COLUMN_NAME_TIMESTAMP="timestamp",e.COLUMN_NAME_DATA="data",e.COLUMN_NAME_REQUEST="request",e.COLUMN_NAME_NUMBER_OF_ITEM="item_count",e.COLUMN_NAME_CONFIG="config",e.COLUMN_NAME_TYPE="type",e.getCreateEntry=function(){return"CREATE TABLE IF NOT EXISTS "+e.TABLE_NAME+" ("+e._ID+" INTEGER PRIMARY KEY"+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_MSG_ID+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_PRIORITY+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_TIMESTAMP+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_DATA+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_NUMBER_OF_ITEM+i.DbConstants.SPACE+i.DbConstants.INT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_CONFIG+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_TYPE+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+i.DbConstants.COMMA_SEP+e.COLUMN_NAME_REQUEST+i.DbConstants.SPACE+i.DbConstants.TEXT_TYPE+")"},e.deleteTable=function(){return"DROP TABLE IF EXISTS"+e.TABLE_NAME};var t=function(){function t(){}return t.networkQueueRequestToEntry=function(t){var n;return(n={})[e.COLUMN_NAME_MSG_ID]=t.msgId,n[e.COLUMN_NAME_PRIORITY]=t.priority,n[e.COLUMN_NAME_TIMESTAMP]=t.ts,n[e.COLUMN_NAME_DATA]=t.data,n[e.COLUMN_NAME_NUMBER_OF_ITEM]=t.itemCount,n[e.COLUMN_NAME_CONFIG]=t.config,n[e.COLUMN_NAME_TYPE]=t.type,n[e.COLUMN_NAME_REQUEST]=t.networkRequest.toJSON(),n},t}();e.Mapper=t}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n,r){var i=e.call(this,n,"ASSERTION_ERROR_"+r)||this;return Object.setPrototypeOf(i,t.prototype),i}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n(50),o=n(63),a=n(26),c=n(7),s=n(18),u=n(0),f=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},d=function(e){function t(t,n,r){var i=e.call(this,a.a.instance.sdkConfig.apiConfig,a.a.instance.apiService,a.a.instance.eventsBusService)||this;return i.autoMergeConfig=t,i.webviewRunner=n,i.captured=r,i.telemetryService=a.a.instance.telemetryService,i}return f(t,e),t.prototype.provide=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return p(this,(function(r){switch(r.label){case 0:return e=this.webviewRunner,[4,this.telemetryService.buildContext().toPromise()];case 1:return t=r.sent(),this.autoMergeConfig.target.params.push({key:"pdata",value:JSON.stringify(t.pdata)}),Object.keys(this.captured).forEach((function(e){n.autoMergeConfig.target.params.push({key:e,value:n.captured[e]})})),[2,e.redirectTo({host:this.autoMergeConfig.target.host,path:this.autoMergeConfig.target.path,params:this.autoMergeConfig.target.params.reduce((function(e,t){return e[t.key]=t.value,e}),{})}).then((function(){return e.any.apply(e,n.autoMergeConfig.return.reduce((function(t,r){switch(r.type){case"password":t.push(n.buildPasswordSessionProvider(e,r).then((function(e){return n.performAutoMerge({payload:n.captured.payload,session:e})})));break;case"state":t.push(n.buildStateSessionProvider(e,r));break;case"google":t.push(n.buildGoogleSessionProvider(e,r).then((function(e){return n.performAutoMerge({payload:n.captured.payload,session:e})})))}return t}),[]))}))]}}))}))},t.prototype.performAutoMerge=function(e){var t=this,n=e.payload,r=e.session,o=(new c.Request.Builder).withType(c.HttpRequestType.GET).withPath(this.apiConfig.user_authentication.autoMergeApiPath).withParameters({client_id:"android"}).withHeaders({"x-authenticated-user-token":r.access_token,"x-authenticated-user-data":n}).build();return this.apiService.fetch(o).pipe(Object(u.mapTo)(void 0)).toPromise().then((function(){return t.eventsBusService.emit({namespace:s.EventNamespace.AUTH,event:{type:i.AuthEventType.AUTO_MIGRATE_SUCCESS,payload:void 0}}),r})).catch((function(e){return console.error(e),t.eventsBusService.emit({namespace:s.EventNamespace.AUTH,event:{type:i.AuthEventType.AUTO_MIGRATE_FAIL,payload:void 0}}),r}))},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(7),i=n(3),o=n(41),a=n(34),c=n(39),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},f=function(){function e(e,t,n){this.config=e,this.apiService=t,this.deviceInfo=n}return e.prototype.refreshAuthToken=function(){return Object(i.from)(this.getBearerTokenFromKongV2())},e.prototype.getMobileDeviceConsumerKey=function(){return this.config.api_authentication.producerId+"-"+this.deviceInfo.getDeviceID()},e.prototype.buildGetMobileDeviceConsumerSecretAPIRequest=function(t){return s(this,void 0,void 0,(function(){var n,r,i,c,s;return u(this,(function(u){switch(u.label){case 0:return r=(n=(new a.CsRequest.Builder).withPath(t).withType(a.CsHttpRequestType.POST)).withHeaders,i={"Content-Encoding":"gzip"},c="Authorization",s="Bearer ",[4,this.generateMobileAppConsumerBearerToken()];case 1:return[2,r.apply(n,[(i[c]=s+u.sent(),i)]).withBody({id:e.ID,ver:e.VERSION,ts:o().format(),request:{key:this.getMobileDeviceConsumerKey()}}).build()]}}))}))},e.prototype.getBearerTokenFromKongV2=function(){return s(this,void 0,void 0,(function(){var e,t,n=this;return u(this,(function(i){switch(i.label){case 0:return e="/api/api-manager/v2/consumer/"+this.config.api_authentication.mobileAppConsumer+"/credential/register",[4,this.buildGetMobileDeviceConsumerSecretAPIRequest(e)];case 1:return t=i.sent(),[2,this.apiService.fetch(t).toPromise().then((function(e){return e.body.result.token})).catch((function(e){if(!a.CsNetworkError.isInstance(e)){var t="/api/api-manager/v1/consumer/"+n.config.api_authentication.mobileAppConsumer+"/credential/register";if(e.response.responseCode===r.ResponseCode.HTTP_KONG_FAILURE){var i=e.response.headers,o=i?i.location:t;return n.getBearerTokenFromFallback(o||t)}return n.getBearerTokenFromFallback(t)}throw e}))]}}))}))},e.prototype.getBearerTokenFromFallback=function(e){return s(this,void 0,void 0,(function(){var t,n=this;return u(this,(function(r){switch(r.label){case 0:return[4,this.buildGetMobileDeviceConsumerSecretAPIRequest(e)];case 1:return t=r.sent(),[2,this.apiService.fetch(t).toPromise().then((function(e){return s(n,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return(t=e.body.result).token?[3,2]:[4,c.a.createJWTToken(this.getMobileDeviceConsumerKey(),t.secret)];case 1:return[2,n.sent()];case 2:return[2,t.token]}}))}))})).catch((function(e){console.log("e ",e)}))]}}))}))},e.prototype.generateMobileAppConsumerBearerToken=function(){return s(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return e=this.config.api_authentication.mobileAppKey,t=this.config.api_authentication.mobileAppSecret,[4,c.a.createJWTToken(e,t)];case 1:return[2,n.sent()]}}))}))},e.VERSION="1.0",e.ID="ekstep.genie.device.register",e}()},function(e,t,n){e.exports=function e(t,n,r){function i(a,c){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[a]={exports:{}};t[a][0].call(u.exports,(function(e){return i(t[a][1][e]||e)}),u,u.exports,e,t,n,r)}return n[a].exports}for(var o=!1,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){var t,n,r,i,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,i),i+=o.length;return a}},a={arraySet:function(e,t,n,r,i){for(var o=0;o<r;o++)e[i+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],2:[function(e,t,n){"use strict";var r=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new r.Buf8(256),c=0;c<256;c++)a[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;function s(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,i,o,a,c=e.length,s=0;for(o=0;o<c;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<c&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(s),a=0,o=0;a<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<c&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return s(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,o,c=t||e.length,u=new Array(2*c);for(r=0,n=0;n<c;)if((i=e[n++])<128)u[r++]=i;else if((o=a[i])>4)u[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<c;)i=i<<6|63&e[n++],o--;o>1?u[r++]=65533:i<65536?u[r++]=i:(i-=65536,u[r++]=55296|i>>10&1023,u[r++]=56320|1023&i)}return s(u,r)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":1}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+t[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,n){"use strict";var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var o=r,a=i+n;e^=-1;for(var c=i;c<a;c++)e=e>>>8^o[255&(e^t[c])];return-1^e}},{}],6:[function(e,t,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(e,t,n){"use strict";t.exports=function(e,t){var n,r,i,o,a,c,s,u,f,l,p,d,h,E,b,y,v,_,S,O,g,C,m,A,T;n=e.state,r=e.next_in,A=e.input,i=r+(e.avail_in-5),o=e.next_out,T=e.output,a=o-(t-e.avail_out),c=o+(e.avail_out-257),s=n.dmax,u=n.wsize,f=n.whave,l=n.wnext,p=n.window,d=n.hold,h=n.bits,E=n.lencode,b=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{h<15&&(d+=A[r++]<<h,h+=8,d+=A[r++]<<h,h+=8),_=E[d&y];t:for(;;){if(d>>>=S=_>>>24,h-=S,0==(S=_>>>16&255))T[o++]=65535&_;else{if(!(16&S)){if(0==(64&S)){_=E[(65535&_)+(d&(1<<S)-1)];continue t}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}O=65535&_,(S&=15)&&(h<S&&(d+=A[r++]<<h,h+=8),O+=d&(1<<S)-1,d>>>=S,h-=S),h<15&&(d+=A[r++]<<h,h+=8,d+=A[r++]<<h,h+=8),_=b[d&v];n:for(;;){if(d>>>=S=_>>>24,h-=S,!(16&(S=_>>>16&255))){if(0==(64&S)){_=b[(65535&_)+(d&(1<<S)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(g=65535&_,h<(S&=15)&&(d+=A[r++]<<h,(h+=8)<S&&(d+=A[r++]<<h,h+=8)),(g+=d&(1<<S)-1)>s){e.msg="invalid distance too far back",n.mode=30;break e}if(d>>>=S,h-=S,g>(S=o-a)){if((S=g-S)>f&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,m=p,0===l){if(C+=u-S,S<O){O-=S;do{T[o++]=p[C++]}while(--S);C=o-g,m=T}}else if(l<S){if(C+=u+l-S,(S-=l)<O){O-=S;do{T[o++]=p[C++]}while(--S);if(C=0,l<O){O-=S=l;do{T[o++]=p[C++]}while(--S);C=o-g,m=T}}}else if(C+=l-S,S<O){O-=S;do{T[o++]=p[C++]}while(--S);C=o-g,m=T}for(;O>2;)T[o++]=m[C++],T[o++]=m[C++],T[o++]=m[C++],O-=3;O&&(T[o++]=m[C++],O>1&&(T[o++]=m[C++]))}else{C=o-g;do{T[o++]=T[C++],T[o++]=T[C++],T[o++]=T[C++],O-=3}while(O>2);O&&(T[o++]=T[C++],O>1&&(T[o++]=T[C++]))}break}}break}}while(r<i&&o<c);r-=O=h>>3,d&=(1<<(h-=O<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=o<c?c-o+257:257-(o-c),n.hold=d,n.bits=h}},{}],8:[function(e,t,n){"use strict";var r=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),c=e("./inftrees");function s(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(852),t.distcode=t.distdyn=new r.Buf32(592),t.sane=1,t.back=-1,0):-2}function l(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):-2}function p(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,l(e))):-2}function d(e,t){var n,r;return e?(r=new u,e.state=r,r.window=null,0!==(n=p(e,t))&&(e.state=null),n):-2}var h,E,b=!0;function y(e){if(b){var t;for(h=new r.Buf32(512),E=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(c(1,e.lens,0,288,h,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;c(2,e.lens,0,32,E,0,e.work,{bits:5}),b=!1}e.lencode=h,e.lenbits=9,e.distcode=E,e.distbits=5}function v(e,t,n,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,t,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}n.inflateReset=l,n.inflateReset2=p,n.inflateResetKeep=f,n.inflateInit=function(e){return d(e,15)},n.inflateInit2=d,n.inflate=function(e,t){var n,u,f,l,p,d,h,E,b,_,S,O,g,C,m,A,T,N,I,M,w,D,P,R,L=0,j=new r.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),p=e.next_out,f=e.output,h=e.avail_out,l=e.next_in,u=e.input,d=e.avail_in,E=n.hold,b=n.bits,_=d,S=h,D=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(2&n.wrap&&35615===E){n.check=0,j[0]=255&E,j[1]=E>>>8&255,n.check=o(n.check,j,2,0),E=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&E)){e.msg="unknown compression method",n.mode=30;break}if(b-=4,w=8+(15&(E>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<w,e.adler=n.check=1,n.mode=512&E?10:12,E=0,b=0;break;case 2:for(;b<16;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(n.flags=E,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=E>>8&1),512&n.flags&&(j[0]=255&E,j[1]=E>>>8&255,n.check=o(n.check,j,2,0)),E=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.head&&(n.head.time=E),512&n.flags&&(j[0]=255&E,j[1]=E>>>8&255,j[2]=E>>>16&255,j[3]=E>>>24&255,n.check=o(n.check,j,4,0)),E=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.head&&(n.head.xflags=255&E,n.head.os=E>>8),512&n.flags&&(j[0]=255&E,j[1]=E>>>8&255,n.check=o(n.check,j,2,0)),E=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.length=E,n.head&&(n.head.extra_len=E),512&n.flags&&(j[0]=255&E,j[1]=E>>>8&255,n.check=o(n.check,j,2,0)),E=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((O=n.length)>d&&(O=d),O&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,u,l,O,w)),512&n.flags&&(n.check=o(n.check,u,O,l)),d-=O,l+=O,n.length-=O),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===d)break e;O=0;do{w=u[l+O++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&O<d);if(512&n.flags&&(n.check=o(n.check,u,O,l)),d-=O,l+=O,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===d)break e;O=0;do{w=u[l+O++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&O<d);if(512&n.flags&&(n.check=o(n.check,u,O,l)),d-=O,l+=O,w)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(E!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}E=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;b<32;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}e.adler=n.check=s(E),E=0,b=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=p,e.avail_out=h,e.next_in=l,e.avail_in=d,n.hold=E,n.bits=b,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){E>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}switch(n.last=1&E,b-=1,3&(E>>>=1)){case 0:n.mode=14;break;case 1:if(y(n),n.mode=20,6===t){E>>>=2,b-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}E>>>=2,b-=2;break;case 14:for(E>>>=7&b,b-=7&b;b<32;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&E,E=0,b=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(O=n.length){if(O>d&&(O=d),O>h&&(O=h),0===O)break e;r.arraySet(f,u,l,O,p),d-=O,l+=O,h-=O,p+=O,n.length-=O;break}n.mode=12;break;case 17:for(;b<14;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(n.nlen=257+(31&E),E>>>=5,b-=5,n.ndist=1+(31&E),E>>>=5,b-=5,n.ncode=4+(15&E),E>>>=4,b-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.lens[U[n.have++]]=7&E,E>>>=3,b-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},D=c(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,D){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;A=(L=n.lencode[E&(1<<n.lenbits)-1])>>>16&255,T=65535&L,!((m=L>>>24)<=b);){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(T<16)E>>>=m,b-=m,n.lens[n.have++]=T;else{if(16===T){for(R=m+2;b<R;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(E>>>=m,b-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}w=n.lens[n.have-1],O=3+(3&E),E>>>=2,b-=2}else if(17===T){for(R=m+3;b<R;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}b-=m,w=0,O=3+(7&(E>>>=m)),E>>>=3,b-=3}else{for(R=m+7;b<R;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}b-=m,w=0,O=11+(127&(E>>>=m)),E>>>=7,b-=7}if(n.have+O>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;O--;)n.lens[n.have++]=w}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,P={bits:n.lenbits},D=c(1,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,D){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},D=c(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,D){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(d>=6&&h>=258){e.next_out=p,e.avail_out=h,e.next_in=l,e.avail_in=d,n.hold=E,n.bits=b,a(e,S),p=e.next_out,f=e.output,h=e.avail_out,l=e.next_in,u=e.input,d=e.avail_in,E=n.hold,b=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;A=(L=n.lencode[E&(1<<n.lenbits)-1])>>>16&255,T=65535&L,!((m=L>>>24)<=b);){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(A&&0==(240&A)){for(N=m,I=A,M=T;A=(L=n.lencode[M+((E&(1<<N+I)-1)>>N)])>>>16&255,T=65535&L,!(N+(m=L>>>24)<=b);){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}E>>>=N,b-=N,n.back+=N}if(E>>>=m,b-=m,n.back+=m,n.length=T,0===A){n.mode=26;break}if(32&A){n.back=-1,n.mode=12;break}if(64&A){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&A,n.mode=22;case 22:if(n.extra){for(R=n.extra;b<R;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.length+=E&(1<<n.extra)-1,E>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;A=(L=n.distcode[E&(1<<n.distbits)-1])>>>16&255,T=65535&L,!((m=L>>>24)<=b);){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(0==(240&A)){for(N=m,I=A,M=T;A=(L=n.distcode[M+((E&(1<<N+I)-1)>>N)])>>>16&255,T=65535&L,!(N+(m=L>>>24)<=b);){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}E>>>=N,b-=N,n.back+=N}if(E>>>=m,b-=m,n.back+=m,64&A){e.msg="invalid distance code",n.mode=30;break}n.offset=T,n.extra=15&A,n.mode=24;case 24:if(n.extra){for(R=n.extra;b<R;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}n.offset+=E&(1<<n.extra)-1,E>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===h)break e;if(O=S-h,n.offset>O){if((O=n.offset-O)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}O>n.wnext?(O-=n.wnext,g=n.wsize-O):g=n.wnext-O,O>n.length&&(O=n.length),C=n.window}else C=f,g=p-n.offset,O=n.length;O>h&&(O=h),h-=O,n.length-=O;do{f[p++]=C[g++]}while(--O);0===n.length&&(n.mode=21);break;case 26:if(0===h)break e;f[p++]=n.length,h--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===d)break e;d--,E|=u[l++]<<b,b+=8}if(S-=h,e.total_out+=S,n.total+=S,S&&(e.adler=n.check=n.flags?o(n.check,f,S,p-S):i(n.check,f,S,p-S)),S=h,(n.flags?E:s(E))!==n.check){e.msg="incorrect data check",n.mode=30;break}E=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===d)break e;d--,E+=u[l++]<<b,b+=8}if(E!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}E=0,b=0}n.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=p,e.avail_out=h,e.next_in=l,e.avail_in=d,n.hold=E,n.bits=b,(n.wsize||S!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,S-e.avail_out)?(n.mode=31,-4):(_-=e.avail_in,S-=e.avail_out,e.total_in+=_,e.total_out+=S,n.total+=S,n.wrap&&S&&(e.adler=n.check=n.flags?o(n.check,f,S,e.next_out-S):i(n.check,f,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===_&&0===S||4===t)&&0===D&&(D=-5),D)},n.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},n.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&i(1,t,r,0)!==n.check?-3:v(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,n){"use strict";var r=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,s,u,f,l,p){var d,h,E,b,y,v,_,S,O,g=p.bits,C=0,m=0,A=0,T=0,N=0,I=0,M=0,w=0,D=0,P=0,R=null,L=0,j=new r.Buf16(16),U=new r.Buf16(16),k=null,x=0;for(C=0;C<=15;C++)j[C]=0;for(m=0;m<s;m++)j[t[n+m]]++;for(N=g,T=15;T>=1&&0===j[T];T--);if(N>T&&(N=T),0===T)return u[f++]=20971520,u[f++]=20971520,p.bits=1,0;for(A=1;A<T&&0===j[A];A++);for(N<A&&(N=A),w=1,C=1;C<=15;C++)if(w<<=1,(w-=j[C])<0)return-1;if(w>0&&(0===e||1!==T))return-1;for(U[1]=0,C=1;C<15;C++)U[C+1]=U[C]+j[C];for(m=0;m<s;m++)0!==t[n+m]&&(l[U[t[n+m]]++]=m);if(0===e?(R=k=l,v=19):1===e?(R=i,L-=257,k=o,x-=257,v=256):(R=a,k=c,v=-1),P=0,m=0,C=A,y=f,I=N,M=0,E=-1,b=(D=1<<N)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){_=C-M,l[m]<v?(S=0,O=l[m]):l[m]>v?(S=k[x+l[m]],O=R[L+l[m]]):(S=96,O=0),d=1<<C-M,A=h=1<<I;do{u[y+(P>>M)+(h-=d)]=_<<24|S<<16|O|0}while(0!==h);for(d=1<<C-1;P&d;)d>>=1;if(0!==d?(P&=d-1,P+=d):P=0,m++,0==--j[C]){if(C===T)break;C=t[n+l[m]]}if(C>N&&(P&b)!==E){for(0===M&&(M=N),y+=A,w=1<<(I=C-M);I+M<T&&!((w-=j[I+M])<=0);)I++,w<<=1;if(D+=1<<I,1===e&&D>852||2===e&&D>592)return 1;u[E=P&b]=N<<24|I<<16|y-f|0}}return 0!==P&&(u[y+P]=C-M<<24|64<<16|0),p.bits=N,0}},{"../utils/common":1}],10:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(e,t,n){"use strict";var r=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),c=e("./zlib/messages"),s=e("./zlib/zstream"),u=e("./zlib/gzheader"),f=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(c[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===f.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(c[n])}function p(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||c[n.err];return n.result}l.prototype.push=function(e,t){var n,c,s,u,l,p=this.strm,d=this.options.chunkSize,h=this.options.dictionary,E=!1;if(this.ended)return!1;c=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===f.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new i.Buf8(d),p.next_out=0,p.avail_out=d),(n=r.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&h&&(n=r.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===E&&(n=a.Z_OK,E=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||c!==a.Z_FINISH&&c!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(s=o.utf8border(p.output,p.next_out),u=p.next_out-s,l=o.buf2string(p.output,s),p.next_out=u,p.avail_out=d-u,u&&i.arraySet(p.output,p.output,s,u,0),this.onData(l)):this.onData(i.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(E=!0)}while((p.avail_in>0||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(c=a.Z_FINISH),c===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):c!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=l,n.inflate=p,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},n.ungzip=p},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(e,t){e.exports=s},function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r,i=n(10),o=n(19),a=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e){function t(n){var r=e.call(this,n,"INVALID_INPUT_FOR_SYNC_PREPROCESSOR")||this;return Object.setPrototypeOf(r,t.prototype),r}return a(t,e),t}(o.a),s=n(60),u=function(){function e(){}return e.prototype.process=function(e){if("string"!=typeof e)throw new c('StringToGzippedString expects input of type "string"');return Object(s.gzip)(e,{to:"string"})},e}(),f=function(){function e(){}return e.prototype.process=function(e){if("object"!=typeof e)throw new c('TelemetryEntriesToStringPreprocessor expects input of type "object"');return JSON.stringify(e)},e}(),l=n(17),p=n(31),d=n(41),h=n.n(d),E=n(35),b=n(11),y=n(3),v=n(0),_=n(23),S=n(52),O=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},g=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},C=function(){function e(e,t,n,r,i,o,a,c,s){this.dbService=e,this.sdkConfig=t,this.deviceInfo=n,this.sharedPreferences=r,this.appInfoService=i,this.deviceRegisterService=o,this.keyValueStore=a,this.apiService=c,this.networkQueue=s,this.preprocessors=[new f,new u],this.telemetryConfig=this.sdkConfig.telemetryConfig,this.apiConfig=this.sdkConfig.apiConfig}return e.prototype.resetDeviceRegisterTTL=function(){return Object(y.zip)(this.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_IS_SUCCESSFUL_KEY,""),this.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_ATTEMPT_TIME_STAMP_KEY,"")).pipe(Object(v.mapTo)(void 0))},e.prototype.handle=function(e){var t=this,n=e.ignoreSyncThreshold,r=e.ignoreAutoSyncMode,o=!(!n||!r);return this.registerDevice().pipe(Object(v.catchError)((function(){return n=!0,Object(y.of)(void 0)})),Object(v.mergeMap)((function(){return t.hasTelemetryThresholdCrossed().pipe(Object(v.mergeMap)((function(e){return e||n?Object(y.defer)((function(){return O(t,void 0,void 0,(function(){var e,t,n;return g(this,(function(r){switch(r.label){case 0:return[4,this.sharedPreferences.getString(b.o.KEY_AUTO_SYNC_MODE).toPromise()];case 1:switch(r.sent()){case i.TelemetryAutoSyncModes.OFF:return[2,{syncedEventCount:0,syncTime:Date.now(),syncedFileSize:0,error:new Error("AUTO_SYNC_MODE: "+i.TelemetryAutoSyncModes.OFF)}];case i.TelemetryAutoSyncModes.OVER_WIFI:if(navigator.connection.type!==Connection.WIFI)return[2,{syncedEventCount:0,syncTime:Date.now(),syncedFileSize:0,error:new Error("AUTO_SYNC_MODE: "+i.TelemetryAutoSyncModes.OVER_WIFI)}];break;case i.TelemetryAutoSyncModes.ALWAYS_ON:}e={syncedEventCount:0,syncTime:Date.now(),syncedFileSize:0},r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.processEventsBatch(o).toPromise()];case 3:return t=r.sent(),e={syncedEventCount:e.syncedEventCount+t,syncTime:Date.now(),syncedFileSize:0},[3,5];case 4:return n=r.sent(),e={syncedEventCount:e.syncedEventCount,syncTime:Date.now(),syncedFileSize:0,error:n},[3,5];case 5:if(t&&!e.error)return[3,2];r.label=6;case 6:return[2,e]}}))}))})):Object(y.of)({syncedEventCount:0,syncTime:Date.now(),syncedFileSize:0})})))})))},e.prototype.processEventsBatch=function(e){var t=this;return this.fetchEvents().pipe(Object(v.mergeMap)((function(n){return t.processEvents(n).pipe(Object(v.mergeMap)((function(r){return t.persistinNetworkQueue(r,r.processedEventsSize,e).pipe(Object(v.mergeMap)((function(){return t.deleteEvents(n)})),Object(v.mapTo)(n.length))})))})))},e.prototype.registerDevice=function(){var t=this;return Object(y.zip)(this.keyValueStore.getValue(e.LAST_SYNCED_DEVICE_REGISTER_ATTEMPT_TIME_STAMP_KEY),this.keyValueStore.getValue(e.LAST_SYNCED_DEVICE_REGISTER_IS_SUCCESSFUL_KEY)).pipe(Object(v.mergeMap)((function(n){var r=n[0],o=n[1];if(r&&o){var a="false"===o?e.REGISTER_API_FAILURE_TTL:e.REGISTER_API_SUCCESS_TTL;if(Math.abs(parseInt(r,10)-Date.now())<a)return Object(y.of)(void 0)}return t.deviceRegisterService.registerDevice().pipe(Object(v.tap)((function(n){return O(t,void 0,void 0,(function(){var t,r,o,a,c=this;return g(this,(function(s){switch(s.label){case 0:return n.result.actions.forEach((function(e){"experiment"===e.type&&e.key&&c.sharedPreferences.putString(b.d.DEPLOYMENT_KEY,e.data.key).toPromise()})),t=new Date(n.ts).getTime(),r=Date.now(),o=t-r,(a=Math.abs(o)>this.telemetryConfig.telemetryLogMinAllowedOffset?o:0)?[4,E.a.log.interact({type:i.InteractType.OTHER,subType:i.InteractSubType.DEVICE_TIME_OFFSET_FOUND,env:"sdk",pageId:"sdk",id:"sdk",valueMap:{deviceTime:r,offsetTime:a}}).toPromise()]:[3,3];case 1:return s.sent(),[4,this.keyValueStore.setValue(e.TELEMETRY_LOG_MIN_ALLOWED_OFFSET_KEY,a+"").toPromise()];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))})),Object(v.mergeMap)((function(){return Object(y.zip)(t.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_ATTEMPT_TIME_STAMP_KEY,Date.now()+""),t.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_IS_SUCCESSFUL_KEY,"true")).pipe(Object(v.mapTo)(void 0))})),Object(v.catchError)((function(n){return Object(y.zip)(t.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_ATTEMPT_TIME_STAMP_KEY,Date.now()+""),t.keyValueStore.setValue(e.LAST_SYNCED_DEVICE_REGISTER_IS_SUCCESSFUL_KEY,"false")).pipe(Object(v.mergeMap)((function(){throw console.error(n),new Error("Device Registration Failed")})))})))})))},e.prototype.hasTelemetryThresholdCrossed=function(){var e=this;return this.dbService.execute("\n            SELECT count(*) as COUNT FROM "+l.c.TABLE_NAME).pipe(Object(v.map)((function(t){return!!(t&&t[0]&&t[0].COUNT>=e.telemetryConfig.telemetrySyncThreshold)})))},e.prototype.fetchEvents=function(){return this.dbService.execute("\n            SELECT * FROM "+l.c.TABLE_NAME+"\n            WHERE "+l.c.COLUMN_NAME_PRIORITY+" = (SELECT MIN ("+l.c.COLUMN_NAME_PRIORITY+")\n            FROM "+l.c.TABLE_NAME+")\n            ORDER BY "+l.c.COLUMN_NAME_TIMESTAMP+"\n            LIMIT "+this.telemetryConfig.telemetrySyncBandwidth)},e.prototype.processEvents=function(e){if(!e.length)return Object(y.of)({processedEventsSize:0});var t=p.a.generateUniqueId();return Object(y.of)({processedEvents:this.preprocessors.reduce((function(e,t){return t.process(e)}),{id:"ekstep.telemetry",ver:"1.0",ts:h()().format("YYYY-MM-DDTHH:mm:ss[Z]"),events:e.map((function(e){return JSON.parse(e[l.c.COLUMN_NAME_EVENT])})),params:{did:this.deviceInfo.getDeviceID(),msgid:t,key:"",requesterId:""}}),processedEventsSize:e.length,messageId:t})},e.prototype.persistinNetworkQueue=function(e,t,n){var r=e.processedEvents,i=e.messageId;return r?this.networkQueue.enqueue(new S.a(this.sdkConfig).generateNetworkQueueRequest(_.b.TELEMETRY,r,i,t,n),!0).pipe(Object(v.mapTo)(void 0)):Object(y.of)(void 0)},e.prototype.deleteEvents=function(e){return e.length?this.dbService.execute("\n            DELETE FROM "+l.c.TABLE_NAME+"\n            WHERE "+l.c._ID+" IN ("+e.map((function(e){return e[l.c._ID]})).join(",")+")\n        "):Object(y.of)(void 0)},e.TELEMETRY_LOG_MIN_ALLOWED_OFFSET_KEY="telemetry_log_min_allowed_offset_key",e.LAST_SYNCED_DEVICE_REGISTER_ATTEMPT_TIME_STAMP_KEY="last_synced_device_register_attempt_time_stamp",e.LAST_SYNCED_DEVICE_REGISTER_IS_SUCCESSFUL_KEY="last_synced_device_register_is_successful",e.TELEMETRY_ENDPOINT="/telemetry",e.REGISTER_API_SUCCESS_TTL=864e5,e.REGISTER_API_FAILURE_TTL=36e5,e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0;var r=n(43);function i(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function o(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}t.getServiceIdentifierAsString=i,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=o(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var n=function(e){return function e(t,n){void 0===n&&(n=[]);var r=i(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e).reverse().join(" --\x3e ")}(t);throw new Error(r.CIRCULAR_DEPENDENCY+" "+n)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=o},function(e,t,n){"use strict";var r,i,o,a,c,s,u;n.d(t,"h",(function(){return r})),n.d(t,"g",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"i",(function(){return c})),n.d(t,"k",(function(){return s})),n.d(t,"j",(function(){return u})),n.d(t,"e",(function(){return h})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return l})),n.d(t,"l",(function(){return p})),n.d(t,"a",(function(){return d})),function(e){e.NOTIFICATION="notification",e.USER="User",e.GROUP="Group",e.CONTENT="Content",e.QUESTION="Question"}(r||(r={})),function(e){e.PLAY="play"}(i||(i={})),function(e){e.NOTIFICATION="notification"}(o||(o={})),function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(a||(a={})),function(e){e.IN="In",e.OUT="Out"}(c||(c={})),function(e){e.FILE="File",e.MESSAGE="Message",e.LINK="Link"}(s||(s={})),function(e){e.CONTENT="CONTENT",e.EXPLODEDCONTENT="EXPLODEDCONTENT",e.TELEMETRY="TELEMETRY",e.PROFILE="PROFILE"}(u||(u={}));var f,l,p,d,h=function(){this.RECEIVED="Received",this.DISPLAYED="Displayed"};!function(e){e.TOUCH="TOUCH",e.OTHER="OTHER"}(f||(f={})),function(e){e.NETWORK_SPEED="network-speed",e.SUBTYPE_SPINE="spine",e.ONLINE="online",e.FULL="full",e.CONTENT_VARIANT="content-variant-download",e.DEVICE_TIME_OFFSET_FOUND="device-time-offset-found",e.CONTENT_DOWNLOAD_INITIATE="ContentDownload-Initiate",e.CONTENT_DOWNLOAD_SUCCESS="ContentDownload-Success",e.CONTENT_DOWNLOAD_CANCEL="ContentDownload-Cancel"}(l||(l={})),function(e){e.ERR_DOWNLOAD_FAILED="ERR_DOWNLOAD_FAILED"}(p||(p={})),function(e){e.SYSTEM="SYSTEM"}(d||(d={}))},function(e,t,n){"use strict";n.r(t);var r=n(219);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(304);n.d(t,"FrameworkServiceImpl",(function(){return o.a}));var a=n(220);for(var i in a)["default","FrameworkServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(221);for(var i in c)["default","FrameworkServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(222);for(var i in s)["default","FrameworkServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);var u=n(223);for(var i in u)["default","FrameworkServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(i);var f=n(224);for(var i in f)["default","FrameworkServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return f[e]}))}(i);var l=n(225);n.d(t,"FrameworkCategoryCode",(function(){return l.a})),n.d(t,"FrameworkCategoryCodesGroup",(function(){return l.b}));var p=n(226);for(var i in p)["default","FrameworkServiceImpl","FrameworkCategoryCode","FrameworkCategoryCodesGroup"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return p[e]}))}(i);var d=n(227);for(var i in d)["default","FrameworkServiceImpl","FrameworkCategoryCode","FrameworkCategoryCodesGroup"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return d[e]}))}(i);var h=n(307);n.d(t,"FrameworkUtilServiceImpl",(function(){return h.a}));var E=n(229);for(var i in E)["default","FrameworkServiceImpl","FrameworkCategoryCode","FrameworkCategoryCodesGroup","FrameworkUtilServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return E[e]}))}(i)},function(e,t){e.exports=u},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&i&&"function"==typeof i.get?i.get:null,a=r&&Map.prototype.forEach,c="function"==typeof Set&&Set.prototype,s=Object.getOwnPropertyDescriptor&&c?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,u=c&&s&&"function"==typeof s.get?s.get:null,f=c&&Set.prototype.forEach,l="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,d="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,h=Boolean.prototype.valueOf,E=Object.prototype.toString,b=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,_=String.prototype.replace,S=String.prototype.toUpperCase,O=String.prototype.toLowerCase,g=RegExp.prototype.test,C=Array.prototype.concat,m=Array.prototype.join,A=Array.prototype.slice,T=Math.floor,N="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,w="function"==typeof Symbol&&"object"==typeof Symbol.iterator,D="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===w||"symbol")?Symbol.toStringTag:null,P=Object.prototype.propertyIsEnumerable,R=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function L(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||g.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-T(-e):T(e);if(r!==e){var i=String(r),o=v.call(t,i.length+1);return _.call(i,n,"$&_")+"."+_.call(_.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _.call(t,n,"$&_")}var j=n(347),U=j.custom,k=H(U)?U:null,x={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function B(e,t,n){var r=n.quoteStyle||t,i=x[r];return i+e+i}function V(e){return _.call(String(e),/"/g,"&quot;")}function G(e){return!("[object Array]"!==z(e)||D&&"object"==typeof e&&D in e)}function Y(e){return!("[object RegExp]"!==z(e)||D&&"object"==typeof e&&D in e)}function H(e){if(w)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!M)return!1;try{return M.call(e),!0}catch(e){}return!1}e.exports=function e(n,r,i,c){var s=r||{};if(K(s,"quoteStyle")&&!K(x,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(K(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var E=!K(s,"customInspect")||s.customInspect;if("boolean"!=typeof E&&"symbol"!==E)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(K(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(K(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var S=s.numericSeparator;if(void 0===n)return"undefined";if(null===n)return"null";if("boolean"==typeof n)return n?"true":"false";if("string"==typeof n)return function e(t,n){if(t.length>n.maxStringLength){var r=t.length-n.maxStringLength,i="... "+r+" more character"+(r>1?"s":"");return e(v.call(t,0,n.maxStringLength),n)+i}var o=F[n.quoteStyle||"single"];return o.lastIndex=0,B(_.call(_.call(t,o,"\\$1"),/[\x00-\x1f]/g,X),"single",n)}(n,s);if("number"==typeof n){if(0===n)return 1/0/n>0?"0":"-0";var g=String(n);return S?L(n,g):g}if("bigint"==typeof n){var T=String(n)+"n";return S?L(n,T):T}var I=void 0===s.depth?5:s.depth;if(void 0===i&&(i=0),i>=I&&I>0&&"object"==typeof n)return G(n)?"[Array]":"[Object]";var U=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=m.call(Array(e.indent+1)," ")}return{base:n,prev:m.call(Array(t+1),n)}}(s,i);if(void 0===c)c=[];else if(W(c,n)>=0)return"[Circular]";function q(t,n,r){if(n&&(c=A.call(c)).push(n),r){var o={depth:s.depth};return K(s,"quoteStyle")&&(o.quoteStyle=s.quoteStyle),e(t,o,i+1,c)}return e(t,s,i+1,c)}if("function"==typeof n&&!Y(n)){var te=function(e){if(e.name)return e.name;var t=y.call(b.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(n),ne=ee(n,q);return"[Function"+(te?": "+te:" (anonymous)")+"]"+(ne.length>0?" { "+m.call(ne,", ")+" }":"")}if(H(n)){var re=w?_.call(String(n),/^(Symbol\(.*\))_[^)]*$/,"$1"):M.call(n);return"object"!=typeof n||w?re:J(re)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(n)){for(var ie="<"+O.call(String(n.nodeName)),oe=n.attributes||[],ae=0;ae<oe.length;ae++)ie+=" "+oe[ae].name+"="+B(V(oe[ae].value),"double",s);return ie+=">",n.childNodes&&n.childNodes.length&&(ie+="..."),ie+="</"+O.call(String(n.nodeName))+">"}if(G(n)){if(0===n.length)return"[]";var ce=ee(n,q);return U&&!function(e){for(var t=0;t<e.length;t++)if(W(e[t],"\n")>=0)return!1;return!0}(ce)?"["+Z(ce,U)+"]":"[ "+m.call(ce,", ")+" ]"}if(function(e){return!("[object Error]"!==z(e)||D&&"object"==typeof e&&D in e)}(n)){var se=ee(n,q);return"cause"in Error.prototype||!("cause"in n)||P.call(n,"cause")?0===se.length?"["+String(n)+"]":"{ ["+String(n)+"] "+m.call(se,", ")+" }":"{ ["+String(n)+"] "+m.call(C.call("[cause]: "+q(n.cause),se),", ")+" }"}if("object"==typeof n&&E){if(k&&"function"==typeof n[k]&&j)return j(n,{depth:I-i});if("symbol"!==E&&"function"==typeof n.inspect)return n.inspect()}if(function(e){if(!o||!e||"object"!=typeof e)return!1;try{o.call(e);try{u.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(n)){var ue=[];return a&&a.call(n,(function(e,t){ue.push(q(t,n,!0)+" => "+q(e,n))})),$("Map",o.call(n),ue,U)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e);try{o.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(n)){var fe=[];return f&&f.call(n,(function(e){fe.push(q(e,n))})),$("Set",u.call(n),fe,U)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e,l);try{p.call(e,p)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(n))return Q("WeakMap");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{p.call(e,p);try{l.call(e,l)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(n))return Q("WeakSet");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{return d.call(e),!0}catch(e){}return!1}(n))return Q("WeakRef");if(function(e){return!("[object Number]"!==z(e)||D&&"object"==typeof e&&D in e)}(n))return J(q(Number(n)));if(function(e){if(!e||"object"!=typeof e||!N)return!1;try{return N.call(e),!0}catch(e){}return!1}(n))return J(q(N.call(n)));if(function(e){return!("[object Boolean]"!==z(e)||D&&"object"==typeof e&&D in e)}(n))return J(h.call(n));if(function(e){return!("[object String]"!==z(e)||D&&"object"==typeof e&&D in e)}(n))return J(q(String(n)));if("undefined"!=typeof window&&n===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&n===globalThis||void 0!==t&&n===t)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==z(e)||D&&"object"==typeof e&&D in e)}(n)&&!Y(n)){var le=ee(n,q),pe=R?R(n)===Object.prototype:n instanceof Object||n.constructor===Object,de=n instanceof Object?"":"null prototype",he=!pe&&D&&Object(n)===n&&D in n?v.call(z(n),8,-1):de?"Object":"",Ee=(pe||"function"!=typeof n.constructor?"":n.constructor.name?n.constructor.name+" ":"")+(he||de?"["+m.call(C.call([],he||[],de||[]),": ")+"] ":"");return 0===le.length?Ee+"{}":U?Ee+"{"+Z(le,U)+"}":Ee+"{ "+m.call(le,", ")+" }"}return String(n)};var q=Object.prototype.hasOwnProperty||function(e){return e in this};function K(e,t){return q.call(e,t)}function z(e){return E.call(e)}function W(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function X(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+S.call(t.toString(16))}function J(e){return"Object("+e+")"}function Q(e){return e+" { ? }"}function $(e,t,n,r){return e+" ("+t+") {"+(r?Z(n,r):m.call(n,", "))+"}"}function Z(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+m.call(e,","+n)+"\n"+t.prev}function ee(e,t){var n=G(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=K(e,i)?t(e[i],e):""}var o,a="function"==typeof I?I(e):[];if(w){o={};for(var c=0;c<a.length;c++)o["$"+a[c]]=a[c]}for(var s in e)K(e,s)&&(n&&String(Number(s))===s&&s<e.length||w&&o["$"+s]instanceof Symbol||(g.call(/[^\w$]/,s)?r.push(t(s,e)+": "+t(e[s],e)):r.push(s+": "+t(e[s],e))));if("function"==typeof I)for(var u=0;u<a.length;u++)P.call(e,a[u])&&r.push("["+t(a[u])+"]: "+t(e[a[u]],e));return r}}).call(this,n(84))},function(e,t,n){"use strict";var r=n(369);e.exports=Function.prototype.bind||r},function(e,t){e.exports=f},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e,t){this.targetDbVersion=t,this.migrationNumber=e}return e.prototype.required=function(e,t){return e<this.targetDbVersion&&this.targetDbVersion<=t},e}()},function(e,t,n){"use strict";n.r(t);var r=n(121);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(122);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(123);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(124);for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(305);n.d(t,"DeviceRegisterServiceImpl",(function(){return s.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(51),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"PARAM_NOT_CAPTURED")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";var r=n(68);n.d(t,"a",(function(){return r.TrackingEnabled}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return s}));
/*! Capacitor: https://capacitorjs.com/ - MIT License */
const r=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return n.addPlatform=(e,t)=>{n.platforms.set(e,t)},n.setPlatform=e=>{n.platforms.has(e)&&(n.currentPlatform=n.platforms.get(e))},n})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{});r.addPlatform,r.setPlatform;var i;!function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(i||(i={}));class o extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const a=e=>{var t,n,r,a,c;const s=e.CapacitorCustomPlatform||null,u=e.Capacitor||{},f=u.Plugins=u.Plugins||{},l=e.CapacitorPlatforms,p=(null===(t=null==l?void 0:l.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==s?s.name:(e=>{var t,n;return(null==e?void 0:e.androidBridge)?"android":(null===(n=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===n?void 0:n.bridge)?"ios":"web"})(e)),d=(null===(n=null==l?void 0:l.currentPlatform)||void 0===n?void 0:n.isNativePlatform)||(()=>"web"!==p()),h=(null===(r=null==l?void 0:l.currentPlatform)||void 0===r?void 0:r.isPluginAvailable)||(e=>{const t=b.get(e);return!!(null==t?void 0:t.platforms.has(p()))||!!E(e)}),E=(null===(a=null==l?void 0:l.currentPlatform)||void 0===a?void 0:a.getPluginHeader)||(e=>{var t;return null===(t=u.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)}),b=new Map,y=(null===(c=null==l?void 0:l.currentPlatform)||void 0===c?void 0:c.registerPlugin)||((e,t={})=>{const n=b.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;const r=p(),a=E(e);let c;const l=n=>{let f;const l=(...l)=>{const p=(async()=>(!c&&r in t?c=c="function"==typeof t[r]?await t[r]():t[r]:null!==s&&!c&&"web"in t&&(c=c="function"==typeof t.web?await t.web():t.web),c))().then(t=>{const c=((t,n)=>{var c,s;if(!a){if(t)return null===(s=t[n])||void 0===s?void 0:s.bind(t);throw new o(`"${e}" plugin is not implemented on ${r}`,i.Unimplemented)}{const r=null==a?void 0:a.methods.find(e=>n===e.name);if(r)return"promise"===r.rtype?t=>u.nativePromise(e,n.toString(),t):(t,r)=>u.nativeCallback(e,n.toString(),t,r);if(t)return null===(c=t[n])||void 0===c?void 0:c.bind(t)}})(t,n);if(c){const e=c(...l);return f=null==e?void 0:e.remove,e}throw new o(`"${e}.${n}()" is not implemented on ${r}`,i.Unimplemented)});return"addListener"===n&&(p.remove=async()=>f()),p};return l.toString=()=>n.toString()+"() { [capacitor code] }",Object.defineProperty(l,"name",{value:n,writable:!1,configurable:!1}),l},d=l("addListener"),h=l("removeListener"),y=(e,t)=>{const n=d({eventName:e},t),r=async()=>{const r=await n;h({eventName:e,callbackId:r},t)},i=new Promise(e=>n.then(()=>e({remove:r})));return i.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await r()},i},v=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return a?y:d;case"removeListener":return h;default:return l(t)}}});return f[e]=v,b.set(e,{name:e,proxy:v,platforms:new Set([...Object.keys(t),...a?[r]:[]])}),v});return u.convertFileSrc||(u.convertFileSrc=e=>e),u.getPlatform=p,u.handleError=t=>e.console.error(t),u.isNativePlatform=d,u.isPluginAvailable=h,u.pluginMethodNoop=(e,t,n)=>Promise.reject(`${n} does not have an implementation of "${t}".`),u.registerPlugin=y,u.Exception=o,u.DEBUG=!!u.DEBUG,u.isLoggingEnabled=!!u.isLoggingEnabled,u.platform=u.getPlatform(),u.isNative=u.isNativePlatform(),u},c=(e=>e.Capacitor=a(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}),s=c.registerPlugin,u=c.Plugins;class f{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const n=this.windowListeners[e];n&&!n.registered&&this.addWindowListener(n);const r=async()=>this.removeListener(e,t),i=Promise.resolve({remove:r});return Object.defineProperty(i,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await r()}}),i}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const n=this.listeners[e];n&&n.forEach(e=>e(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new c.Exception(e,i.Unimplemented)}unavailable(e="not available"){return new c.Exception(e,i.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const r=n.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const l=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),p=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class d extends f{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[n,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=p(n).trim(),r=p(r).trim(),t[n]=r}),t}async setCookie(e){try{const t=l(e.key),n=l(e.value),r="; expires="+(e.expires||"").replace("expires=",""),i=(e.path||"/").replace("path=",""),o=null!=e.url&&e.url.length>0?"domain="+e.url:"";document.cookie=`${t}=${n||""}${r}; path=${i}; ${o};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=e.key+"=; Max-Age=0"}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}s("CapacitorCookies",{web:()=>new d});const h=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((n,r,i)=>(n[r]=e[t[i]],n),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)n.body=e.data;else if(r.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[n,r]of Object.entries(e.data||{}))t.set(n,r);n.body=t.toString()}else if(r.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,n)=>{t.append(n,e)});else for(const n of Object.keys(e.data))t.append(n,e.data[n]);n.body=t;const r=new Headers(n.headers);r.delete("content-type"),n.headers=r}else(r.includes("application/json")||"object"==typeof e.data)&&(n.body=JSON.stringify(e.data));return n};class E extends f{async request(e){const t=h(e,e.webFetchExtra),n=((e,t=!0)=>{if(!e)return null;return Object.entries(e).reduce((e,n)=>{const[r,i]=n;let o,a;return Array.isArray(i)?(a="",i.forEach(e=>{o=t?encodeURIComponent(e):e,a+=`${r}=${o}&`}),a.slice(0,-1)):(o=t?encodeURIComponent(i):i,a=`${r}=${o}`),`${e}&${a}`},"").substr(1)})(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,i=await fetch(r,t),o=i.headers.get("content-type")||"";let a,c,{responseType:s="text"}=i.ok?e:{};switch(o.includes("application/json")&&(s="json"),s){case"arraybuffer":case"blob":c=await i.blob(),a=await(async e=>new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>n(e),r.readAsDataURL(e)}))(c);break;case"json":a=await i.json();break;case"document":case"text":default:a=await i.text()}const u={};return i.headers.forEach((e,t)=>{u[t]=e}),{data:a,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}s("CapacitorHttp",{web:()=>new E})}).call(this,n(84))},function(e,t,n){"use strict";n.r(t);var r=n(234);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(235);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(236);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(237);for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(308);n.d(t,"SystemSettingsServiceImpl",(function(){return s.a}))},function(e,t,n){"use strict";n.r(t);var r=n(244);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(245);n.d(t,"PlayerServiceImpl",(function(){return o.a}))},function(e,t,n){"use strict";n.r(t);var r=n(248);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(249);n.d(t,"CodePUshExperimentServiceImpl",(function(){return o.a}))},function(e,t,n){"use strict";n.r(t);var r=n(250);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(309);n.d(t,"FaqServiceImpl",(function(){return o.a}));var a=n(251);for(var i in a)["default","FaqServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(252);for(var i in c)["default","FaqServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(253);for(var i in s)["default","FaqServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(74),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"OBJECT_NOT_FOUND")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.r(t);var r=n(261);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(99);n.d(t,"FetchSegmentationTagHandler",(function(){return o.a}));var a=n(100);n.d(t,"FetchSegmentationCommandHandler",(function(){return a.a}));var c=n(101);n.d(t,"StoreSegmentationTagHandler",(function(){return c.a}));var s=n(102);n.d(t,"StoreSegmentationCommandHandler",(function(){return s.a}));var u=n(262);n.d(t,"SegmentationServiceImpl",(function(){return u.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.keyValueStore=e,this.TAG_KEY="segment-tag_"}return e.prototype.handle=function(e){return this.keyValueStore.getValue(this.TAG_KEY+e).pipe(Object(r.map)((function(e){return e||null})))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.keyValueStore=e,this.COMMAND_KEY="segment-command_"}return e.prototype.handle=function(e){return this.keyValueStore.getValue(this.COMMAND_KEY+e).pipe(Object(r.map)((function(e){return e||null})))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){this.keyValueStore=e,this.TAG_KEY="segment-tag_"}return e.prototype.handle=function(e,t){return this.keyValueStore.setValue(this.TAG_KEY+t,e)},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){this.keyValueStore=e,this.COMMAND_KEY="segment-command_"}return e.prototype.handle=function(e,t){return this.keyValueStore.setValue(this.COMMAND_KEY+t,e)},e}()},function(e,t,n){"use strict";n.r(t);var r=n(263);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(104);n.d(t,"DebuggingDurationHandler",(function(){return o.a}));var a=n(264);n.d(t,"DebuggingServiceImpl",(function(){return a.a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(78),i=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},a=function(){function e(e,t){this.sharedPreferences=e,this.debuggingServiceImpl=t}return e.prototype.handle=function(e){return i(this,void 0,void 0,(function(){var t,n,a=this;return o(this,(function(c){switch(c.label){case 0:return[4,this.sharedPreferences.getString("debug_started_at").toPromise()];case 1:return t=c.sent(),console.log(t),t?(n=setInterval((function(){return i(a,void 0,void 0,(function(){var i,a;return o(this,(function(o){switch(o.label){case 0:return i=(new Date).getTime(),a=(i-new Date(parseInt(t)).getTime())/1e3,a/=60,console.log("diff",Math.abs(Math.round(a))),Math.abs(Math.round(a))>=10?(this.sharedPreferences.putString("debug_started_at","").toPromise(),this.debuggingServiceImpl.disableDebugging(),[4,this.sharedPreferences.putString(r.CsClientStorage.TRACE_ID,"").toPromise()]):[3,2];case 1:return o.sent(),e.next(!1),e.complete(),clearInterval(n),this.debuggingServiceImpl.watcher.interval=null,this.debuggingServiceImpl.watcher.observer=null,this.debuggingServiceImpl.watcher.debugStatus=!1,[3,3];case 2:e.next(!0),o.label=3;case 3:return[2]}}))}))}),6e4),this.debuggingServiceImpl.watcher.interval=n,this.debuggingServiceImpl.watcher.observer=e,this.debuggingServiceImpl.watcher.debugStatus=!0):(e.next(!1),e.complete()),[2]}}))}))},e}()},function(e,t,n){"use strict";n.r(t);var r=n(265);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(310);n.d(t,"CertificateServiceImpl",(function(){return o.a}));var a=n(266);for(var i in a)["default","CertificateServiceImpl"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"VALIDATION_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(3),i=n(0),o=n(23),a=n(52),c=n(31),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},f=function(){function e(e,t){this.networkQueue=e,this.sdkConfig=t}return e.prototype.handle=function(e){var t=this;return this.networkQueue.enqueue(new a.a(this.sdkConfig).generateNetworkQueueRequest(o.b.COURSE_PROGRESS,{request:e},c.a.generateUniqueId(),e.contents?e.contents.length:0,!0),!0).pipe(Object(i.mergeMap)((function(){return new r.Observable((function(e){sbsync.onSyncSucces((function(n){return s(t,void 0,void 0,(function(){var t,r;return u(this,(function(i){return t=n.courseProgressResponse,r=n.course_progress_error,t?e.next(t):r&&e.error(r),e.complete(),[2]}))}))}),(function(n){return s(t,void 0,void 0,(function(){return u(this,(function(t){return e.error(n),[2]}))}))}))}))})))},e.UPDATE_CONTENT_STATE_ENDPOINT="/content/state/update",e}()},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.SAVE="SAVE"}(r||(r={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var r=n(110),i=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new r.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var r=n(109),i=n(130),o=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=i.namedConstraint(e),new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new r.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=i.taggedConstraint(e)(t),new r.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return i.typeConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return i.namedConstraint(e)(t.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return i.taggedConstraint(e)(t)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.typeConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,i.namedConstraint(e))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(e)(t))},new r.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!i.traverseAncerstors(t,e)},new r.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=o},function(e,t,n){"use strict";var r=n(153),i=n(349),o=n(350),a=n(351),c=n(352),s=n(353),u=n(72),f=n(354),l=n(355),p=n(356),d=n(357),h=n(358),E=n(359),b=n(360),y=n(361),v=Function,_=function(e){try{return v('"use strict"; return ('+e+").constructor;")()}catch(e){}},S=n(154),O=n(364),g=function(){throw new u},C=S?function(){try{return g}catch(e){try{return S(arguments,"callee").get}catch(e){return g}}}():g,m=n(365)(),A=n(367),T=n(156),N=n(155),I=n(158),M=n(112),w={},D="undefined"!=typeof Uint8Array&&A?A(Uint8Array):void 0,P={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":m&&A?A([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":w,"%AsyncGenerator%":w,"%AsyncGeneratorFunction%":w,"%AsyncIteratorPrototype%":w,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?void 0:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?void 0:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":i,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":w,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&A?A(A([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&A?A((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":r,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":a,"%ReferenceError%":c,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&A?A((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&A?A(""[Symbol.iterator]()):void 0,"%Symbol%":m?Symbol:void 0,"%SyntaxError%":s,"%ThrowTypeError%":C,"%TypedArray%":D,"%TypeError%":u,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":f,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"%Function.prototype.call%":M,"%Function.prototype.apply%":I,"%Object.defineProperty%":O,"%Object.getPrototypeOf%":T,"%Math.abs%":l,"%Math.floor%":p,"%Math.max%":d,"%Math.min%":h,"%Math.pow%":E,"%Math.round%":b,"%Math.sign%":y,"%Reflect.getPrototypeOf%":N};if(A)try{null.error}catch(e){var R=A(A(e));P["%Error.prototype%"]=R}var L={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},j=n(86),U=n(372),k=j.call(M,Array.prototype.concat),x=j.call(I,Array.prototype.splice),F=j.call(M,String.prototype.replace),B=j.call(M,String.prototype.slice),V=j.call(M,RegExp.prototype.exec),G=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,H=function(e){var t=B(e,0,1),n=B(e,-1);if("%"===t&&"%"!==n)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var r=[];return F(e,G,(function(e,t,n,i){r[r.length]=n?F(i,Y,"$1"):t||e})),r},q=function(e,t){var n,r=e;if(U(L,r)&&(r="%"+(n=L[r])[0]+"%"),U(P,r)){var i=P[r];if(i===w&&(i=function e(t){var n;if("%AsyncFunction%"===t)n=_("async function () {}");else if("%GeneratorFunction%"===t)n=_("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=_("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&A&&(n=A(i.prototype))}return P[t]=n,n}(r)),void 0===i&&!t)throw new u("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new u('"allowMissing" argument must be a boolean');if(null===V(/^%?[^%]*%?$/,e))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=H(e),r=n.length>0?n[0]:"",i=q("%"+r+"%",t),o=i.name,a=i.value,c=!1,f=i.alias;f&&(r=f[0],x(n,k([0,1],f)));for(var l=1,p=!0;l<n.length;l+=1){var d=n[l],h=B(d,0,1),E=B(d,-1);if(('"'===h||"'"===h||"`"===h||'"'===E||"'"===E||"`"===E)&&h!==E)throw new s("property names with quotes must have matching quotes");if("constructor"!==d&&p||(c=!0),U(P,o="%"+(r+="."+d)+"%"))a=P[o];else if(null!=a){if(!(d in a)){if(!t)throw new u("base intrinsic for "+e+" exists, but the property is not available.");return}if(S&&l+1>=n.length){var b=S(a,d);a=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:a[d]}else p=U(a,d),a=a[d];p&&!c&&(P[o]=a)}}return a}},function(e,t,n){"use strict";e.exports=Function.prototype.call},function(e,t,n){"use strict";var r=String.prototype.replace,i=/%20/g,o="RFC1738",a="RFC3986";e.exports={default:a,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:o,RFC3986:a}},function(e,t){e.exports=l},function(e,t){e.exports=p},function(e,t,n){"use strict";var r,i;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE"}(r||(r={})),function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"}(i||(i={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.DATE_TYPE="DATE",e.TEXT_TYPE="TEXT",e.INT_TYPE="INTEGER",e.REAL_TYPE="REAL",e.COMMA_SEP=",",e.SPACE=" ",e.MAX_NUM_OF_EVENTS=1e3,e.MAX_NUM_OF_PROCESSED_EVENTS=1,e.ERROR="DB_ERROR",e.BLOB_TYPE="BLOB",e.NOT_NULL="NOT NULL",e.NULL="NULL",e}()},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var r=n(38),i=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(r.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(r.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(r.TAGGED_PROP,e)||[]},e}();t.MetadataReader=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0;var r=n(43);t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===r.STACK_OVERFLOW}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var r=n(43),i=n(38),o=n(49),a=n(58),c=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=c,t.inject=function(e){return function(t,n,c){if(void 0===e)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(t.name));var s=new o.Metadata(i.INJECT_TAG,e);"number"==typeof c?a.tagParameter(t,n,c,s):a.tagProperty(t,n,s)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var r=n(38),i=n(67),o=n(49),a=n(326),c=function(){function e(e,t,n,c){this.id=i.id(),this.type=e,this.serviceIdentifier=n,this.name=new a.QueryableString(t||""),this.metadata=new Array;var s=null;"string"==typeof c?s=new o.Metadata(r.NAMED_TAG,c):c instanceof o.Metadata&&(s=c),null!==s&&this.metadata.push(s)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(r.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===r.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return r.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(r.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}();t.Target=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var r=n(109),i=n(110),o=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var r=n(38),i=n(49),o=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||o(n,t))};t.traverseAncerstors=o;var a=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new i.Metadata(e,t),n}};t.taggedConstraint=a;var c=a(r.NAMED_TAG);t.namedConstraint=c;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.AUTH="AUTH",e.TELEMETRY="TELEMETRY",e.DOWNLOADS="DOWNLOADS",e.CONTENT="CONTENT",e.ERROR="ERROR",e.STORAGE="STORAGE"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.HTTP_SERVER_ERROR="HTTP_SERVER_ERROR",e.HTTP_CLIENT_ERROR="HTTP_CLIENT_ERROR",e.AUTH_TOKEN_REFRESH_ERROR="AUTH_TOKEN_REFRESH_ERROR",e.PLANNED_MAINTENANCE_PERIOD="PLANNED_MAINTENANCE_PERIOD"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return l})),n.d(t,"e",(function(){return p})),n.d(t,"f",(function(){return d})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return E})),n.d(t,"d",(function(){return b})),n.d(t,"k",(function(){return y})),n.d(t,"o",(function(){return v})),n.d(t,"j",(function(){return _})),n.d(t,"l",(function(){return S})),n.d(t,"n",(function(){return O})),n.d(t,"i",(function(){return g})),n.d(t,"b",(function(){return i})),n.d(t,"m",(function(){return o}));var r,i,o,a=n(81),c=n(33),s=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},f=function(){function e(){this.type=e.TYPE_USER}return e.TYPE_SYSTEM="System",e.TYPE_USER="User",e}(),l=function(){},p=function(){this.os="",this.make="",this.id="",this.mem=-1,this.idisk=-1,this.edisk=-1,this.scrn=-1,this.cpu="",this.sims=-1,this.cap=[]},d=function(){},h=function(){},E=function(){},b=function(){},y=function(){},v=function(){},_=function(){function e(){}return e.prototype.ProducerData=function(){this.id="",this.pid="",this.ver=""},e}(),S=function(){},O=function(){function e(e,t,n){this.id=e,this.type=t,this.version=n}return e.prototype.setRollup=function(e){this.rollup=e},e}(),g=function(){};!function(e){e.AUDIT_CREATED="Created",e.AUDIT_UPDATED="Updated",e.AUDIT_DELETED="Deleted"}(i||(i={})),function(e){var t=function(){function e(t){this.ver=e.TELEMETRY_VERSION,this.eid=t,this.ets=Date.now(),this.actor=new f,this.context=new l,this.edata={}}return e.TELEMETRY_VERSION="3.0",e}();e.Telemetry=t;var n=function(e){function t(n,r,i,o,a,c,s,f,l,p,d){void 0===s&&(s=""),void 0===f&&(f=""),void 0===l&&(l=""),void 0===p&&(p={}),void 0===d&&(d=[]);var h=e.call(this,t.EID)||this;return h.edata=u(u(u(u(u({},n?{type:n}:{}),i?{duration:i}:{}),o?{pageid:o}:{}),r?{mode:r}:{}),a?{summaryList:a}:{}),h.context.cdata=d,h.context.env=c,h.object=new O(s,f,l),h.object.rollup=p,h}return s(t,e),t.EID="END",t}(t);e.End=n;var r=function(e){function t(n,r,i,o,a,c,s,f,l,p,d,h){void 0===n&&(n=""),void 0===f&&(f=""),void 0===l&&(l=""),void 0===p&&(p=""),void 0===d&&(d={}),void 0===h&&(h=[]);var E=e.call(this,t.EID)||this;return E.edata=u(u(u(u(u(u({},n?{type:n}:{type:""}),r?{dspec:r}:{}),i?{loc:i}:{}),o?{mode:o}:{}),a?{mode:o}:{}),c?{pageid:c}:{}),E.context.cdata=h,E.context.env=s,E.object=new O(f,l,p),E.object.rollup=d||{},E}return s(t,e),t.EID="START",t}(t);e.Start=r;var i=function(e){function t(n,r,i,o,a,c,s,f,l,p,d,h,E,b,y,v,_){void 0===E&&(E=[]),void 0===b&&(b=""),void 0===y&&(y=""),void 0===v&&(v=""),void 0===_&&(_={});var S=e.call(this,t.EID)||this;return S.edata=u(u(u(u(u({type:n,starttime:r,endtime:i,timespent:o,pageviews:a,interactions:c},f?{mode:f}:{}),l?{envsummary:l}:{}),p?{eventsummary:p}:{}),d?{pagesummary:d}:{}),h?{extra:h}:{}),S.context.cdata=E,S.context.env=s,S.object=new O(b,y,v),S.object.rollup=_||{},S}return s(t,e),t.EID="SUMMARY",t}(t);e.Summary=i;var o=function(e){function t(n,r,i,o,a,c,s,f,l,p,d,h){void 0===f&&(f=""),void 0===l&&(l=""),void 0===p&&(p=""),void 0===d&&(d={}),void 0===h&&(h=[]);var E=e.call(this,t.EID)||this;return E.edata=u(u(u(u({type:n},{subtype:r}),i?{id:i}:{}),o?{pageid:o}:{}),{extra:u(u({},a?{pos:a}:{}),c?{values:[c]}:{})}),E.context.cdata=h,E.context.env=s,E.object=new O(f,l,p),E.object.rollup=d||{},E}return s(t,e),t.EID="INTERACT",t}(t);e.Interact=o;var p=function(e){function t(n,r,i,o,a,c,s,f,l,p){void 0===c&&(c=""),void 0===s&&(s=""),void 0===f&&(f=""),void 0===l&&(l={}),void 0===p&&(p=[]);var d=e.call(this,t.EID)||this;return d.edata=u(u(u(u(u({},n?{type:n}:{type:""}),r?{subtype:r}:{}),i?{pageid:i}:{}),i?{uri:i}:{}),o?{visits:o}:{}),d.context.cdata=p,d.context.env=a,d.object=new O(c||"",s||"",f||""),d.object.rollup=l||{},d}return s(t,e),t.EID="IMPRESSION",t}(t);e.Impression=p;var d=function(e){function t(n,r,i,o,a,c,s){var l=e.call(this,t.EID)||this;l.edata=u(u(u(u(u({},n?{type:n}:{type:""}),r?{level:r}:{}),i?{message:i}:{}),o?{pageid:o}:{}),a?{params:a}:{}),l.context.env=c;var p=new f;return p.type=s,l.actor=p,l}return s(t,e),t.EID="LOG",t}(t);e.Log=d;var h=function(e){function t(n,r,i,o){var a=e.call(this,t.EID)||this;return a.edata=u(u(u(u({},n?{err:n}:{}),r?{errtype:r}:{}),i?{stacktrace:i}:{}),o?{pageid:o}:{}),a}return s(t,e),t.EID="ERROR",t}(t);e.Error=h;var E=function(e){function t(n,r){var i=e.call(this,t.EID)||this;return i.edata=u({type:n},r?{pageid:r}:{}),i}return s(t,e),t.EID="INTERRUPT",t}(t);e.Interrupt=E;var b=function(e){function t(n,r,i,o,a,c,s,f){void 0===o&&(o=[]),void 0===a&&(a=""),void 0===c&&(c=""),void 0===s&&(s=""),void 0===f&&(f=new y);var l=e.call(this,t.EID)||this;return l.edata=u(u(u({},n?{dir:n}:{}),r?{type:r}:{}),i?{items:i}:{}),l.context.cdata=o,l.object=new O(a||"",c||"",s||""),l.object.rollup=f,l}return s(t,e),t.prototype.addItem=function(e,t,n,r,i,o){var s={};if(s.origin=t,s.id=n,s.type=this.capitalize(e.valueOf()),e.valueOf()===a.j.CONTENT.valueOf()||e.valueOf()===a.j.EXPLODEDCONTENT.valueOf()){s.ver=r.toString();var u=[],f={};f.transfers=c.a.parseInt(i),f.size=o,u.push(f),s.params=u}var l={};l.id=t,l.type="Device",s.origin=l,this.edata.items.push(s)},t.prototype.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.EID="SHARE",t}(t);e.Share=b;var v=function(e){function t(n,r,i,o,a,c,s,f){void 0===o&&(o=""),void 0===a&&(a=""),void 0===c&&(c="");var l=e.call(this,t.EID)||this;return l.edata=u(u(u(u({},n?{rating:n}:{}),s?{commentid:s}:{}),f?{commenttxt:f}:{}),r?{comments:r}:{}),l.context.env=i,l.object=new O(o,a,c),l.object.rollup={},l}return s(t,e),t.EID="FEEDBACK",t}(t);e.Feedback=v;var _=function(e){function t(n,r,i,o,a,c,s,f,l,p){void 0===c&&(c=""),void 0===s&&(s=""),void 0===f&&(f=""),void 0===l&&(l=[]),void 0===p&&(p={});var d=e.call(this,t.EID)||this;return d.edata=u(u({state:i},o?{props:o}:{}),{type:a}),d.context.cdata=l,d.context.env=n,d.object=new O(c,s,f),d.object.rollup=p||{},d.actor=r,d}return s(t,e),t.EID="AUDIT",t}(t);e.Audit=_}(o||(o={}))},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"i",(function(){return c})),n.d(t,"j",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return f})),n.d(t,"g",(function(){return l})),n.d(t,"h",(function(){return p}));var r=function(){this.pos=[]},i=function(){},o=function(){},a=function(){},c=function(){},s=function(){},u=function(){},f=function(){},l=function(){},p=function(){this.items=[]}},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.OFF="OFF",e.OVER_WIFI="OVER_WIFI",e.ALWAYS_ON="ALWAYS_ON"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.AUTO_MIGRATE_SUCCESS="AUTO_MIGRATE_SUCCESS",e.AUTO_MIGRATE_FAIL="AUTO_MIGRATE_FAIL"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r,i=n(50),o=n(59),a=n(26),c=n(75),s=n(63),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},d=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},h=function(e){function t(t,n,r,i){var c=e.call(this,a.a.instance.sdkConfig.apiConfig,a.a.instance.apiService,a.a.instance.eventsBusService)||this;return c.loginConfig=t,c.autoMergeConfig=n,c.customWebViewConfig=r,c.telemetryService=a.a.instance.telemetryService,c.webviewRunner=i||new o.a,c}return u(t,e),t.prototype.provide=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return p(this,(function(r){switch(r.label){case 0:return e=this.webviewRunner,[4,this.telemetryService.buildContext().toPromise()];case 1:return t=r.sent(),"password"==this.loginConfig.context&&(this.loginConfig.target.path="/recover/identify/account"),this.loginConfig.target.params.push({key:"pdata",value:JSON.stringify(t.pdata)}),"ios"!==window.device.platform.toLowerCase()||"login"!==this.loginConfig.context?[3,3]:[4,e.launchWebview({host:this.loginConfig.target.host,path:"logoff",params:this.loginConfig.target.params.reduce((function(e,t){return e[t.key]=t.value,e}),f({},this.resetParams))})];case 2:r.sent(),r.label=3;case 3:return[2,e.launchWebview({host:this.loginConfig.target.host,path:this.loginConfig.target.path,params:this.loginConfig.target.params.reduce((function(e,t){return e[t.key]=t.value,e}),f({},this.resetParams))}).then((function(){return e.any.apply(e,n.loginConfig.return.reduce((function(t,r){switch(r.type){case"password":t.push(n.buildPasswordSessionProvider(e,r)),n.resetParams&&"password"==n.loginConfig.context&&e.closeWebview();break;case"state":t.push(n.buildStateSessionProvider(e,r));break;case"google":t.push(n.buildGoogleSessionProvider(e,r,n.customWebViewConfig));break;case"state-error":t.push(e.capture({host:r.when.host,path:r.when.path,params:r.when.params}).then((function(){return e.closeWebview().then((function(){return e.resolveCaptured("error_message").catch((function(){throw new i.SignInError("Server Error")})).then((function(e){throw new i.SignInError(e)}))}))})));break;case"migrate":t.push(e.capture({host:r.when.host,path:r.when.path,params:r.when.params}).then((function(){return e.success()})).then((function(t){return e.resetInAppBrowserEventListeners(),e.clearCapture().then((function(){return new c.a(n.autoMergeConfig,n.webviewRunner,t).provide()}))})));break;case"reset":t.push(e.capture({host:r.when.host,path:r.when.path,params:d(r.when.params,[{key:"client_id",resolveTo:"client_id",match:"portal"},{key:"automerge",resolveTo:"automerge",exists:"false"}])}).then((function(){return e.getCaptureExtras().then((function(t){return n.resetParams=t,e.closeWebview().then((function(){return new Promise((function(e){return setTimeout(e,500)})).then((function(){return n.provide()}))}))}))})))}return t}),[]))}))]}}))}))},t}(s.a)},function(e,t,n){"use strict";var r=n(111),i=n(159),o=n(85),a=n(72),c=r("%Map%",!0),s=i("Map.prototype.get",!0),u=i("Map.prototype.set",!0),f=i("Map.prototype.has",!0),l=i("Map.prototype.delete",!0),p=i("Map.prototype.size",!0);e.exports=!!c&&function(){var e,t={assert:function(e){if(!t.has(e))throw new a("Side channel does not contain "+o(e))},delete:function(t){if(e){var n=l(e,t);return 0===p(e)&&(e=void 0),n}return!1},get:function(t){if(e)return s(e,t)},has:function(t){return!!e&&f(e,t)},set:function(t,n){e||(e=new c),u(e,t,n)}};return t}},function(e,t,n){"use strict";e.exports=Object},function(e,t,n){"use strict";var r=n(363);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},function(e,t,n){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},function(e,t,n){"use strict";var r=n(153);e.exports=r.getPrototypeOf||null},function(e,t,n){"use strict";var r=n(86),i=n(72),o=n(112),a=n(370);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new i("a function is required");return a(r,o,e)}},function(e,t,n){"use strict";e.exports=Function.prototype.apply},function(e,t,n){"use strict";var r=n(111),i=n(157),o=i([r("%String.prototype.indexOf%")]);e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?i([n]):n}},function(e,t,n){"use strict";var r=n(113),i=Object.prototype.hasOwnProperty,o=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),c=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:c,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],a=i.obj[i.prop],c=Object.keys(a),s=0;s<c.length;++s){var u=c[s],f=a[u];"object"==typeof f&&null!==f&&-1===n.indexOf(f)&&(t.push({obj:a,prop:u}),n.push(f))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(o(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,i,o){if(0===e.length)return e;var c=e;if("symbol"==typeof e?c=Symbol.prototype.toString.call(e):"string"!=typeof e&&(c=String(e)),"iso-8859-1"===n)return escape(c).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var s="",u=0;u<c.length;++u){var f=c.charCodeAt(u);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||o===r.RFC1738&&(40===f||41===f)?s+=c.charAt(u):f<128?s+=a[f]:f<2048?s+=a[192|f>>6]+a[128|63&f]:f<55296||f>=57344?s+=a[224|f>>12]+a[128|f>>6&63]+a[128|63&f]:(u+=1,f=65536+((1023&f)<<10|1023&c.charCodeAt(u)),s+=a[240|f>>18]+a[128|f>>12&63]+a[128|f>>6&63]+a[128|63&f])}return s},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(o(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(o(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var a=t;return o(t)&&!o(n)&&(a=c(t,r)),o(t)&&o(n)?(n.forEach((function(n,o){if(i.call(t,o)){var a=t[o];a&&"object"==typeof a&&n&&"object"==typeof n?t[o]=e(a,n,r):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var a=n[o];return i.call(t,o)?t[o]=e(t[o],a,r):t[o]=a,t}),a)}}},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.NOT_FOUND=-1]="NOT_FOUND",e[e.DELETED_SUCCESSFULLY=1]="DELETED_SUCCESSFULLY"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";var r,i;n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),function(e){e.ASC="asc",e.DESC="desc"}(r||(r={})),function(e){e[e.NOTHING=0]="NOTHING",e[e.PREVIEWED=1]="PREVIEWED",e[e.BOOKMARKED=2]="BOOKMARKED"}(i||(i={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.UPDATE="UPDATE",e.IMPORT_COMPLETED="IMPORT_COMPLETED",e.IMPORT_PROGRESS="IMPORT_PROGRESS",e.SERVER_CONTENT_DATA="SERVER_CONTENT_DATA",e.COURSE_STATE_UPDATED="COURSE_STATE_UPDATED",e.CONTENT_EXTRACT_COMPLETED="CONTENT_EXTRACT_COMPLETED"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r,i,o=n(114);n.d(t,"c",(function(){return o.UserFeedCategory})),n.d(t,"d",(function(){return o.UserFeedStatus})),function(e){e.STUDENT="student",e.TEACHER="teacher",e.ADMIN="administrator",e.PARENT="parent",e.OTHER="other",e.NONE="none"}(r||(r={})),function(e){e.SERVER="server",e.LOCAL="local"}(i||(i={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(31),i=function(e,t){this.uid=e,this.sid=r.a.generateUniqueId(),this.createdTime=Date.now(),this.managedSession=t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var r,i=function(){};!function(e){e[e.NOT_PLAYED=0]="NOT_PLAYED",e[e.PLAYED=1]="PLAYED"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.SERVER="server",e.CACHE="cache"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(24),i=n(1),o=n(4),a=n(33),c=n(18),s=n(108),u=n(6),f=n(5),l=n(3),p=n(0),d=n(106),h=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e,t){return function(n,r){t(n,r,e)}},y=function(){function e(e,t,n,i,o,a){this.dbService=e,this.contenService=t,this.eventsBusService=n,this.courseService=i,this.sharedPreference=o,this.profileService=a,this.summarizerTelemetryHandler=new r.SummaryTelemetryEventHandler(this.courseService,this.sharedPreference,this,this.eventsBusService,this.contenService,this.profileService)}return e.prototype.onInit=function(){return this.eventsBusService.registerObserver({namespace:c.EventNamespace.TELEMETRY,observer:this}),Object(l.of)(void 0)},e.prototype.getDetailsPerQuestion=function(e){var t=r.SummarizerQueries.getQuetsionDetailsQuery(e.uids,e.contentId,e.qId);return this.dbService.execute(t).pipe(Object(p.map)((function(e){return r.SummarizerHandler.mapDBEntriesToQuestionDetails(e)})))},e.prototype.getLearnerAssessmentDetails=function(e){var t=r.SummarizerQueries.getDetailReportsQuery(e.uids,e.contentId);return this.dbService.execute(t).pipe(Object(p.map)((function(e){return r.SummarizerHandler.mapDBEntriesToLearnerAssesmentDetails(e)})))},e.prototype.getReportByQuestions=function(e){var t=this,n=r.SummarizerQueries.getQuestionReportsQuery(e.uids,e.contentId),i=r.SummarizerQueries.getReportAccuracyQuery(e.uids,e.contentId);return this.dbService.execute(i).pipe(Object(p.map)((function(e){return r.SummarizerHandler.mapDBEntriesToAccuracy(e)})),Object(p.mergeMap)((function(e){return t.dbService.execute(n).pipe(Object(p.map)((function(t){return r.SummarizerHandler.mapDBEntriesToQuestionReports(e,t)})))})))},e.prototype.getReportsByUser=function(e){var t=r.SummarizerQueries.getReportsByUserQuery(e.uids,e.contentId);return this.dbService.execute(t).pipe(Object(p.map)((function(e){return r.SummarizerHandler.mapDBEntriesToUserReports(e)})))},e.prototype.getSummary=function(e){var t=this;if(!e.uids)throw new d.a("uids are mandatory");var n=r.SummarizerQueries.getChildProgressQuery(e.uids);return this.getContentCache(e.uids).pipe(Object(p.mergeMap)((function(e){return t.dbService.execute(n).pipe(Object(p.map)((function(t){return r.SummarizerHandler.mapDBEntriesToLearnerAssesmentSummary(t,e)})))})))},e.prototype.getContentCache=function(e){var t=this;if(this.contentMap&&Object.keys(this.contentMap).length)return Object(l.of)(this.contentMap);this.contentMap=new Map;var n={resourcesOnly:!0,primaryCategories:[],uid:e};return this.contenService.getContents(n).pipe(Object(p.map)((function(e){return e.forEach((function(e){var n=new r.ContentCache;n.name=e.contentData&&e.contentData.name,n.totalScore=e.contentData&&e.contentData.totalScore,n.lastUsedTime=e.lastUsedTime,n.identifier=e.identifier,t.contentMap.set(e.identifier,n)})),t.contentMap})))},e.prototype.saveLearnerAssessmentDetails=function(e){var t=this,n=r.SummarizerHandler.mapTelemetryToLearnerAssesmentDetails(e),i=r.SummarizerHandler.mapLearnerAssesmentDetailsToDbEntries(n),a=r.SummarizerQueries.getFilterForLearnerAssessmentDetails(n.qid,n.uid,n.contentId,n.hierarchyData),c=r.SummarizerQueries.getLearnerAssessmentsQuery(a);return this.dbService.execute(c).pipe(Object(p.mergeMap)((function(e){return e&&e.length?t.dbService.update({table:o.d.TABLE_NAME,selection:r.SummarizerQueries.getUpdateSelection(),selectionArgs:[n.uid,n.contentId,n.hierarchyData?n.hierarchyData:"",n.qid],modelJson:i}).pipe(Object(p.map)((function(e){return e>0}))):n.qid?t.dbService.insert({table:o.d.TABLE_NAME,modelJson:i}).pipe(Object(p.map)((function(e){return e>0}))):Object(l.of)(!1)})))},e.prototype.saveLearnerContentSummaryDetails=function(e){var t=this,n=r.SummarizerHandler.mapTelemetryToContentSummaryDetails(e),i=r.SummarizerHandler.mapContentSummaryDetailsToDbEntries(n);return this.dbService.read({table:o.e.TABLE_NAME,selection:r.SummarizerQueries.getLearnerSummaryReadSelection(n.hierarchyData),selectionArgs:[n.uid,n.contentId,n.hierarchyData]}).pipe(Object(p.mergeMap)((function(e){return e&&e.length?(i.sessions=e[0][o.e.COLUMN_NAME_SESSIONS]+1,i.avg_ts=a.a.toFixed(n.timespent/n.sessions),i.total_ts=n.timespent,i.last_updated_on=n.timestamp,t.dbService.update({table:o.e.TABLE_NAME,selection:r.SummarizerQueries.getLearnerSummaryReadSelection(n.hierarchyData),selectionArgs:[n.uid,n.contentId,n.hierarchyData],modelJson:i}).pipe(Object(p.map)((function(e){return e>0})))):(i.avg_ts=n.timespent,i.sessions=1,i.total_ts=n.timespent,i.last_updated_on=n.timestamp,t.dbService.insert({table:o.e.TABLE_NAME,modelJson:i}).pipe(Object(p.map)((function(e){return e>0}))))})))},e.prototype.deletePreviousAssessmentDetails=function(e,t){var n=this;return this.dbService.read({table:o.e.TABLE_NAME,selection:o.e.COLUMN_NAME_CONTENT_ID+" = ? AND "+o.e.COLUMN_NAME_UID+" = ?",selectionArgs:[t,e]}).pipe(Object(p.mergeMap)((function(r){return r&&r.length?n.dbService.delete({table:o.e.TABLE_NAME,selection:o.e.COLUMN_NAME_CONTENT_ID+" = ? AND "+o.e.COLUMN_NAME_UID+" = ?",selectionArgs:[t,e]}):Object(l.of)(void 0)})),Object(p.mergeMap)((function(){return n.dbService.read({table:o.d.TABLE_NAME,selection:o.d.COLUMN_NAME_CONTENT_ID+" = ? AND "+o.d.COLUMN_NAME_UID+" = ?",selectionArgs:[t,e]})})),Object(p.mergeMap)((function(r){return r&&r.length?n.dbService.delete({table:o.d.TABLE_NAME,selection:o.d.COLUMN_NAME_CONTENT_ID+" = ? AND "+o.d.COLUMN_NAME_UID+" = ?",selectionArgs:[t,e]}):Object(l.of)(void 0)})))},e.prototype.onEvent=function(e){return e.type===s.a.SAVE?this.summarizerTelemetryHandler.handle(e.payload):Object(l.of)(void 0)},e=h([Object(u.injectable)(),b(0,Object(u.inject)(f.b.DB_SERVICE)),b(1,Object(u.inject)(f.b.CONTENT_SERVICE)),b(2,Object(u.inject)(f.b.EVENTS_BUS_SERVICE)),b(3,Object(u.inject)(f.b.COURSE_SERVICE)),b(4,Object(u.inject)(f.b.SHARED_PREFERENCES)),b(5,Object(u.inject)(f.b.PROFILE_SERVICE)),E("design:paramtypes",[i.DbService,Object,Object,Object,Object,Object])],e)}()},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(){},i=function(){this.reportDetailsList=[]}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(4),i=n(24),o=n(33),a=function(){function e(){}return e.mapLearnerAssesmentDetailsToDbEntries=function(e){var t;return(t={})[r.d.COLUMN_NAME_UID]=e.uid,t[r.d.COLUMN_NAME_CONTENT_ID]=e.contentId,t[r.d.COLUMN_NAME_QID]=e.qid,t[r.d.COLUMN_NAME_Q_INDEX]=e.qindex,t[r.d.COLUMN_NAME_CORRECT]=e.correct,t[r.d.COLUMN_NAME_SCORE]=e.score,t[r.d.COLUMN_NAME_TIME_SPENT]=e.timespent,t[r.d.COLUMN_NAME_RES]=e.res,t[r.d.COLUMN_NAME_TIMESTAMP]=e.timestamp,t[r.d.COLUMN_NAME_Q_DESC]=e.qdesc,t[r.d.COLUMN_NAME_Q_TITLE]=e.qtitle,t[r.d.COLUMN_NAME_MAX_SCORE]=e.maxScore,t[r.d.COLUMN_NAME_HIERARCHY_DATA]=e.hierarchyData,t},e.mapContentSummaryDetailsToDbEntries=function(e){var t;return(t={})[r.e.COLUMN_NAME_UID]=e.uid,t[r.e.COLUMN_NAME_CONTENT_ID]=e.contentId,t[r.e.COLUMN_NAME_AVG_TS]=e.avgts,t[r.e.COLUMN_NAME_TOTAL_TS]=e.totalts,t[r.e.COLUMN_NAME_LAST_UPDATED_ON]=e.lastUpdated,t[r.d.COLUMN_NAME_HIERARCHY_DATA]=e.hierarchyData,t},e.mapDBEntriesToLearnerAssesmentSummary=function(e,t){return e.map((function(e){var n=t.get(e[r.e.COLUMN_NAME_CONTENT_ID]);return{uid:e[r.e.COLUMN_NAME_UID].toString(),contentId:e[r.e.COLUMN_NAME_CONTENT_ID].toString(),noOfQuestions:o.a.parseInt(e[r.e.COLUMN_NAME_NO_OF_QUESTIONS]),correctAnswers:o.a.parseInt(e[r.e.COLUMN_NAME_CORRECT_ANSWERS]),totalTimespent:Number(e[r.e.COLUMN_NAME_TOTAL_TIME_SPENT]),hierarchyData:e[r.e.COLUMN_NAME_HIERARCHY_DATA].toString(),totalMaxScore:o.a.toFixed(e[r.e.COLUMN_NAME_TOTAL_MAX_SCORE]),totalScore:o.a.toFixed(e[r.e.COLUMN_NAME_TOTAL_SCORE]),totalQuestionsScore:n?n.totalScore:0,name:n?n.name:e[r.e.COLUMN_NAME_CONTENT_ID]}}))},e.mapDBEntriesToLearnerAssesmentDetails=function(e){var t=new Map;return e.map((function(e){var n={uid:e[r.d.COLUMN_NAME_UID],contentId:e[r.d.COLUMN_NAME_CONTENT_ID],qid:e[r.d.COLUMN_NAME_QID],qindex:Number(e[r.d.COLUMN_NAME_Q_INDEX]),correct:o.a.parseInt(e[r.d.COLUMN_NAME_CORRECT]),score:o.a.toFixed(e[r.d.COLUMN_NAME_SCORE]),timespent:Number(e[r.d.COLUMN_NAME_TIME_SPENT]),res:e[r.d[r.d.COLUMN_NAME_RES]],timestamp:Number(e[r.d.COLUMN_NAME_TIMESTAMP]),qdesc:e[r.d.COLUMN_NAME_Q_DESC],qtitle:e[r.d.COLUMN_NAME_Q_TITLE],maxScore:o.a.toFixed(e[r.d.COLUMN_NAME_MAX_SCORE]),hierarchyData:e[r.d.COLUMN_NAME_HIERARCHY_DATA],total_ts:Number(e[r.d.COLUMN_NAME_TOTAL_TS])},a=t.get(n.uid);void 0===a&&((a=new i.ReportDetailPerUser).uid=n.uid,a.totalScore=0,a.maxTotalScore=0),a.reportDetailsList.push(n),a.totalScore+=n.score,a.totalTime=n.total_ts,a.maxTotalScore+=n.maxScore,a.totalScore=parseFloat(a.totalScore.toFixed(2)),t.set(n.uid,a)})),t},e.mapDBEntriesToQuestionReports=function(e,t){return t.map((function(t){var n=t[r.d.COLUMN_NAME_QID],i=0;return e.hasOwnProperty(n)&&(i=o.a.parseInt(e[n])),{uid:t[r.d.COLUMN_NAME_UID],contentId:t[r.d.COLUMN_NAME_CONTENT_ID],qid:t[r.d.COLUMN_NAME_QID],qindex:Number(t[r.d.COLUMN_NAME_Q_INDEX]),correct:o.a.parseInt(t[r.d.COLUMN_NAME_CORRECT]),score:o.a.toFixed(t[r.d.COLUMN_NAME_SCORE]),timespent:Number(t[r.d.COLUMN_NAME_TIME_SPENT]),res:t[r.d[r.d.COLUMN_NAME_RES]],timestamp:Number(t[r.d.COLUMN_NAME_TIMESTAMP]),qdesc:t[r.d.COLUMN_NAME_Q_DESC],qtitle:t[r.d.COLUMN_NAME_Q_TITLE],maxScore:o.a.toFixed(t[r.d.COLUMN_NAME_MAX_SCORE]),hierarchyData:t[r.d.COLUMN_NAME_HIERARCHY_DATA],total_ts:Number(t[r.d.COLUMN_NAME_TOTAL_TS]),marks:Number(t[r.d.COLUMN_NAME_MARKS]),occurenceCount:t[r.d.COLUMN_NAME_COUNT],sum_max_score:Number(t[r.d.COLUMN_NAME_TOTAL_MAX_SCORE]),correct_users_count:i}}))},e.mapDBEntriesToAccuracy=function(e){var t={};return e.map((function(e){t[e[r.d.COLUMN_NAME_QID]]=o.a.parseInt(e[r.d.COLUMN_NAME_USERS_COUNT])})),t},e.mapDBEntriesToQuestionDetails=function(e){return e.map((function(e){return{uid:e.uid,time:Number(e.time),result:o.a.round(e.result),max_score:o.a.parseInt(e.max_score)}}))},e.mapDBEntriesToUserReports=function(e){return e.map((function(e){return{totalTimespent:Number(e[r.d.COLUMN_NAME_TOTAL_TS]),score:o.a.toFixed(e[r.d.COLUMN_NAME_SCORE]),hData:e[r.d.COLUMN_NAME_HIERARCHY_DATA],contentId:e[r.d.COLUMN_NAME_CONTENT_ID],uid:e[r.d.COLUMN_NAME_UID],userName:e[r.d.COLUMN_NAME_HANDLE],timespent:Number(e[r.d.COLUMN_NAME_TIME_SPENT])}}))},e.mapTelemetryToContentSummaryDetails=function(e){var t=e.edata,n=(t.item,e.context.cdata);return{uid:e.actor.id,contentId:e.object.id,timespent:Number(t.duration),timestamp:e.ets,hierarchyData:this.getHierarchyData(n)}},e.mapTelemetryToLearnerAssesmentDetails=function(e){var t=e.edata,n=t.item,r=e.context.cdata;return{uid:e.actor.id,contentId:e.object.id,qid:n&&n.id,qindex:Number(t.index),correct:"Yes"===t.pass?1:0,score:Number(t.score),timespent:Number(t.duration),timestamp:e.ets,res:JSON.stringify(t.resvalues),qdesc:n&&n.desc,qtitle:n&&n.title,maxScore:n&&Number(n.maxscore),hierarchyData:this.getHierarchyData(r)}},e.getHierarchyData=function(e){return e&&e.forEach((function(e){if("Collection"===e.type||"TextBook"===e.type)return e.id})),""},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4),i=n(14),o=function(){function e(){}return e.getChildProgressQuery=function(e){return"SELECT "+r.d.COLUMN_NAME_UID+", "+r.d.COLUMN_NAME_CONTENT_ID+",\n                COUNT ("+r.d.COLUMN_NAME_QID+") AS no_of_questions,\n                SUM ("+r.d.COLUMN_NAME_CORRECT+") AS correct_answers,\n                SUM ("+r.d.COLUMN_NAME_TIME_SPENT+") AS total_time_spent, h_data ,\n                SUM ("+r.d.COLUMN_NAME_MAX_SCORE+") AS total_max_score,\n                SUM ("+r.d.COLUMN_NAME_SCORE+") AS total_score\n                FROM  "+r.d.TABLE_NAME+"\n                WHERE "+r.d.COLUMN_NAME_UID+" IN ("+i.a.joinPreservingQuotes(e)+")\n                GROUP BY "+r.d.COLUMN_NAME_CONTENT_ID+" "},e.getDetailReportsQuery=function(e,t){return"SELECT *, lcs."+r.e.COLUMN_NAME_TOTAL_TS+"\n                FROM  "+r.d.TABLE_NAME+" la\n                LEFT JOIN "+r.e.TABLE_NAME+" lcs\n                ON (la."+r.e.COLUMN_NAME_UID+" = lcs."+r.d.COLUMN_NAME_UID+")\n                AND la."+r.e.COLUMN_NAME_CONTENT_ID+" = lcs."+r.d.COLUMN_NAME_CONTENT_ID+"\n                WHERE la."+r.d.COLUMN_NAME_UID+" IN("+i.a.joinPreservingQuotes(e)+")\n                AND la."+r.d.COLUMN_NAME_CONTENT_ID+"='"+t+"'"},e.getReportsByUserQuery=function(e,t){return"SELECT lcs."+r.e.COLUMN_NAME_TOTAL_TS+",\n                SUM ("+r.d.COLUMN_NAME_SCORE+") AS score,\n                la."+r.d.COLUMN_NAME_HIERARCHY_DATA+",la."+r.d.COLUMN_NAME_CONTENT_ID+",\n                la."+r.d.COLUMN_NAME_UID+",p."+r.f.COLUMN_NAME_HANDLE+",\n                la."+r.d.COLUMN_NAME_TIME_SPENT+"\n                FROM "+r.d.TABLE_NAME+" la\n                LEFT JOIN "+r.e.TABLE_NAME+" lcs\n                ON (la."+r.e.COLUMN_NAME_UID+" = lcs."+r.d.COLUMN_NAME_UID+")\n                LEFT JOIN "+r.f.TABLE_NAME+" p\n                ON (la."+r.d.COLUMN_NAME_UID+" = p."+r.f.COLUMN_NAME_UID+")\n                WHERE la."+r.d.COLUMN_NAME_UID+" IN("+i.a.joinPreservingQuotes(e)+")\n                AND la."+r.d.COLUMN_NAME_CONTENT_ID+"='"+t+"'\n                GROUP BY la."+r.d.COLUMN_NAME_UID},e.getQuetsionDetailsQuery=function(e,t,n){return"SELECT "+r.d.COLUMN_NAME_UID+", "+r.d.COLUMN_NAME_TIME_SPENT+" as time,\n                "+r.d.COLUMN_NAME_SCORE+" as result,\n                "+r.d.COLUMN_NAME_MAX_SCORE+" as max_score\n                FROM "+r.d.TABLE_NAME+"\n                WHERE "+r.d.COLUMN_NAME_UID+" IN("+i.a.joinPreservingQuotes(e)+")\n                AND "+r.d.COLUMN_NAME_CONTENT_ID+"='"+t+"'\n                AND "+r.d.COLUMN_NAME_QID+"='"+n+"'"},e.getReportAccuracyQuery=function(e,t){return"SELECT "+r.d.COLUMN_NAME_QID+", COUNT (*) as users_count\n                FROM  "+r.d.TABLE_NAME+"\n                WHERE "+r.d.COLUMN_NAME_UID+" IN("+i.a.joinPreservingQuotes(e)+")\n                AND "+r.d.COLUMN_NAME_CONTENT_ID+"='"+t+"'\n                AND "+r.d.COLUMN_NAME_SCORE+" > 0\n                GROUP BY "+r.d.COLUMN_NAME_QID},e.getQuestionReportsQuery=function(e,t){return"SELECT *, SUM("+r.d.COLUMN_NAME_SCORE+") as marks,\n                COUNT ("+r.d.COLUMN_NAME_Q_INDEX+") as occurence_count,\n                SUM ("+r.d.COLUMN_NAME_MAX_SCORE+") as  sum_max_score\n                FROM "+r.d.TABLE_NAME+"\n                WHERE "+r.d.COLUMN_NAME_UID+" IN("+i.a.joinPreservingQuotes(e)+")\n                AND "+r.d.COLUMN_NAME_CONTENT_ID+"='"+t+"'\n                GROUP BY "+r.d.COLUMN_NAME_QID},e.getFilterForLearnerAssessmentDetails=function(e,t,n,i){var o=r.d.COLUMN_NAME_QID+" = '"+e+"'";return"WHERE "+(r.d.COLUMN_NAME_UID+" = '"+t+"'")+" AND "+(r.d.COLUMN_NAME_CONTENT_ID+" = '"+n+"'")+" AND "+(r.d.COLUMN_NAME_HIERARCHY_DATA+" = '"+(i||"")+"'")+" "+(e?" AND "+o:"")},e.getLearnerAssessmentsQuery=function(e){return"SELECT * from "+r.d.TABLE_NAME+" "+e+"\n                       ORDER BY "+r.d.COLUMN_NAME_Q_INDEX},e.getUpdateSelection=function(){return r.d.COLUMN_NAME_UID+" = ? AND "+r.d.COLUMN_NAME_CONTENT_ID+" = ? AND "+r.d.COLUMN_NAME_HIERARCHY_DATA+" = ? AND "+r.d.COLUMN_NAME_QID+" = ? "},e.getLearnerSummaryReadSelection=function(e){return r.d.COLUMN_NAME_UID+" = ? AND "+r.d.COLUMN_NAME_CONTENT_ID+" = ? AND "+r.d.COLUMN_NAME_HIERARCHY_DATA+" = ? "},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(10),i=n(36),o=n(11),a=n(18),c=n(9),s=n(15),u=n(3),f=n(0),l=n(313),p=n(35),d=n(65),h=n(71),E=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},y=function(){function e(e){this.contentService=e}return e.prototype.provide=function(t,n){var r=this;return t.objectType=e.getCategoryMapper(n),this.trackableSessionContentCache?Object(u.iif)((function(){return!!r.trackableSessionContentCache[t.contentId]}),Object(u.defer)((function(){return Object(u.of)(r.trackableSessionContentCache[t.contentId])})),Object(u.defer)((function(){return r.contentService.getContentDetails(t).pipe(Object(f.tap)((function(e){return r.trackableSessionContentCache[t.contentId]=e})))}))):this.contentService.getContentDetails(t)},e.prototype.cache=function(e){this.trackableSessionContentCache&&(this.trackableSessionContentCache[e.identifier]=e)},e.prototype.init=function(){this.trackableSessionContentCache={}},e.prototype.dispose=function(){this.trackableSessionContentCache=void 0},e.getCategoryMapper=function(e){switch(e){case d.CsPrimaryCategory.PRACTICE_QUESTION_SET:return"QuestionSet";case"Multiple Choice Question":return"Question"}},e}(),v=function(){function e(e,t,n,r,i,o){this.courseService=e,this.sharedPreference=t,this.summarizerService=n,this.eventBusService=r,this.contentService=i,this.profileService=o,this.currentUID=void 0,this.currentContentID=void 0,this.courseContext={},this.trackableSessionProxyContentProvider=new y(this.contentService)}return e.checkPData=function(t){return null!=t&&null!==t.pid&&-1!==t.pid.indexOf(e.CONTENT_PLAYER_PID)},e.isContentTrackable=function(e){return!!e.contentData.trackable&&e.contentData.trackable.enabled===h.TrackingEnabled.YES},e.isCourseAssessmentContent=function(e){return e.primaryCategory&&e.primaryCategory.toLowerCase()===d.CsPrimaryCategory.COURSE_ASSESSMENT.toLowerCase()},e.prototype.updateContentState=function(t){var n=this;return this.getCourseContext().pipe(Object(f.mergeMap)((function(r){var o=r.userId,s=r.courseId,p=r.batchId,d=0;r.hasOwnProperty("batchStatus")&&(d=r.batchStatus);if(1===d){var h=t.object.id;return n.checkStatusOfContent(o,s,p,h).pipe(Object(f.mergeMap)((function(d){if("START"===t.eid&&0===d){var E={userId:o,contentId:h,courseId:s,batchId:p,status:1,progress:5};return n.courseService.updateContentState(E).pipe(Object(f.mapTo)(void 0))}return"END"===t.eid&&0===d||"END"===t.eid&&1===d?n.trackableSessionProxyContentProvider.provide({contentId:t.object.id},t.object.type).pipe(Object(f.mergeMap)((function(d){return n.validEndEvent(t,d,r).pipe(Object(f.mergeMap)((function(r){if(r){var h=l.CsContentProgressCalculator.calculate(t.edata.summary,d.mimeType),E={userId:o,contentId:d.identifier,courseId:s,batchId:p,status:100===h?2:1,progress:h,target:e.isCourseAssessmentContent(d)?[i.UpdateContentStateTarget.LOCAL]:[i.UpdateContentStateTarget.LOCAL,i.UpdateContentStateTarget.SERVER]};return n.generateAuditTelemetry(o,s,p,d,t.object?t.object.rollup:{}),n.courseService.updateContentState(E).pipe(Object(f.tap)((function(){n.eventBusService.emit({namespace:a.EventNamespace.CONTENT,event:{type:c.ContentEventType.COURSE_STATE_UPDATED,payload:{contentId:E.courseId}}})})),Object(f.mapTo)(void 0))}return Object(u.of)(void 0)})))}))):Object(u.of)(void 0)})),Object(f.tap)((function(){n.updateLastReadContentId(o,s,p,h).toPromise()})))}return Object(u.of)(void 0)})))},e.prototype.handle=function(t){var n=this;return Object(u.defer)((function(){return E(n,void 0,void 0,(function(){var n,r=this;return b(this,(function(i){switch(i.label){case 0:return"START"!==t.eid?[3,4]:e.checkPData(t.context.pdata)?(this.courseService.resetCapturedAssessmentEvents(),[2,this.processOEStart(t).pipe(Object(f.tap)((function(){return E(r,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return[4,this.summarizerService.saveLearnerAssessmentDetails(t).pipe(Object(f.mapTo)(void 0)).toPromise()];case 1:return e.sent(),[2]}}))}))})),Object(f.tap)((function(){return E(r,void 0,void 0,(function(){var e=this;return b(this,(function(n){switch(n.label){case 0:return[4,this.getCourseContext().pipe(Object(f.mergeMap)((function(){return e.updateContentState(t)}))).toPromise()];case 1:return n.sent(),[2]}}))}))})),Object(f.tap)((function(){return E(r,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return[4,this.markContentAsPlayed(t).toPromise()];case 1:return e.sent(),[2]}}))}))}))).toPromise()]):[3,1];case 1:return t.object&&t.object.id?[4,this.trackableSessionProxyContentProvider.provide({contentId:t.object.id},t.object.type).toPromise()]:[3,3];case 2:if(n=i.sent(),e.isContentTrackable(n))return this.trackableSessionProxyContentProvider.init(),this.trackableSessionProxyContentProvider.cache(n),[2,this.getCourseContext().pipe(Object(f.mapTo)(void 0)).toPromise()];i.label=3;case 3:return[3,8];case 4:return"ASSESS"===t.eid&&e.checkPData(t.context.pdata)?[2,this.processOEAssess(t).pipe(Object(f.tap)((function(){return E(r,void 0,void 0,(function(){var e;return b(this,(function(n){switch(n.label){case 0:return[4,this.getCourseContext().toPromise()];case 1:return e=n.sent(),t.context.cdata.find((function(e){return"AttemptId"===e.type}))&&e.userId&&e.courseId&&e.batchId?[4,this.courseService.captureAssessmentEvent({event:t,courseContext:e})]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})),Object(f.tap)((function(){return E(r,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return[4,this.summarizerService.saveLearnerAssessmentDetails(t).pipe(Object(f.mapTo)(void 0)).toPromise()];case 1:return e.sent(),[2]}}))}))}))).toPromise()]:[3,5];case 5:return"END"!==t.eid?[3,8]:e.checkPData(t.context.pdata)?[2,this.processOEEnd(t).pipe(Object(f.tap)((function(){return E(r,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return[4,this.summarizerService.saveLearnerContentSummaryDetails(t).pipe(Object(f.mapTo)(void 0)).toPromise()];case 1:return e.sent(),[2]}}))}))})),Object(f.tap)((function(){return E(r,void 0,void 0,(function(){var e=this;return b(this,(function(n){switch(n.label){case 0:return[4,this.getCourseContext().pipe(Object(f.mergeMap)((function(){return e.updateContentState(t)}))).toPromise()];case 1:return n.sent(),[2]}}))}))}))).toPromise()]:[3,6];case 6:return t.object&&t.object.id?[4,this.trackableSessionProxyContentProvider.provide({contentId:t.object.id},t.object.type).toPromise()]:[3,8];case 7:if(n=i.sent(),e.isContentTrackable(n))return this.trackableSessionProxyContentProvider.dispose(),[2,this.setCourseContextEmpty().toPromise()];i.label=8;case 8:return[2]}}))}))}))},e.prototype.setCourseContextEmpty=function(){return this.courseContext={},this.sharedPreference.putString(o.f.COURSE_CONTEXT,"")},e.prototype.validEndEvent=function(t,n,r){var i=this;return Object(u.defer)((function(){return Object(u.of)(void 0)})).pipe(Object(f.delay)(2e3),Object(f.map)((function(){return!(r&&(e.isCourseAssessmentContent(n)||n.contentType&&"onboardingresource"===n.contentType.toLowerCase()||n.primaryCategory&&"onboardingresource"===n.primaryCategory.toLowerCase())&&i.courseService.hasCapturedAssessmentEvent({courseContext:r}))&&(t.edata.summary&&!!t.edata.summary.find((function(e){return e.progress})))})),Object(f.tap)((function(){return i.courseService.resetCapturedAssessmentEvents()})))},e.prototype.updateLastReadContentId=function(e,t,n,r){var o=i.CourseServiceImpl.LAST_READ_CONTENTID_PREFIX.concat("_").concat(e).concat("_").concat(t).concat("_").concat(n);return this.sharedPreference.putString(o,r)},e.prototype.markContentAsPlayed=function(e){var t=this,n=e.actor.id,r=e.object.id,i={contentId:r};return this.trackableSessionProxyContentProvider.provide(i,e.object.type).pipe(Object(f.mergeMap)((function(e){var i={status:s.ContentAccessStatus.PLAYED,contentId:r,contentType:e.contentType||e.primaryCategory};return t.profileService.addContentAccess(i).pipe(Object(f.mergeMap)((function(){var i={uid:n,contentId:r,data:JSON.stringify(e.contentData),marker:c.MarkerType.PREVIEWED,isMarked:!0,extraInfo:{}};return t.contentService.setContentMarker(i).pipe(Object(f.mapTo)(!0))})))})))},e.prototype.getCourseContext=function(){return this.sharedPreference.getString(o.f.COURSE_CONTEXT).pipe(Object(f.map)((function(e){return e?JSON.parse(e):{}})))},e.prototype.checkStatusOfContent=function(e,t,n,r){var i=this,o={userId:e,batchId:n,contentIds:[r],courseId:t};return this.courseService.getContentState(o).pipe(Object(f.map)((function(e){var t=e&&e.contentList;return i.getStatus(t,r)})))},e.prototype.getStatus=function(e,t){void 0===e&&(e=[]);var n=e.find((function(e){return e.contentId===t}));return n&&n.status||0},e.prototype.processOEStart=function(e){return this.currentUID=e.actor.id,this.currentContentID=e.object.id,Object(u.of)(void 0)},e.prototype.processOEAssess=function(e){var t=this;return this.currentUID&&this.currentContentID&&this.currentUID.toLocaleLowerCase()===e.actor.id.toLocaleLowerCase()&&this.currentContentID.toLocaleLowerCase()===e.object.id.toLocaleLowerCase()?this.summarizerService.deletePreviousAssessmentDetails(this.currentUID,this.currentContentID).pipe(Object(f.tap)((function(){t.currentUID=void 0,t.currentContentID=void 0})),Object(f.mapTo)(void 0)):Object(u.of)(void 0)},e.prototype.processOEEnd=function(e){return Object(u.of)(void 0)},e.prototype.generateAuditTelemetry=function(e,t,n,i,o){var a=new r.Actor;a.id=e,a.type=r.Actor.TYPE_USER;var c=[{type:"CourseId",id:t||""},{type:"BatchId",id:n||""},{type:"UserId",id:e||""},{type:"ContentId",id:i.identifier||""}],s={env:"course",actor:a,currentState:r.AuditState.AUDIT_UPDATED,updatedProperties:["progress"],objId:i.identifier,objType:i.contentData.contentType||"",objVer:i.contentData.pkgVersion||"",rollUp:o||{},correlationData:c,type:"content-progress"};p.a.log.audit(s).toPromise()},e.CONTENT_PLAYER_PID="contentplayer",e}()},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.START="START",e.PROGRESS="PROGRESS",e.END="END"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.STATUS_FAILED=16]="STATUS_FAILED",e[e.STATUS_PAUSED=4]="STATUS_PAUSED",e[e.STATUS_PENDING=1]="STATUS_PENDING",e[e.STATUS_RUNNING=2]="STATUS_RUNNING",e[e.STATUS_SUCCESSFUL=8]="STATUS_SUCCESSFUL"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t,n){(function(t){var r;e.exports=(r=r||function(e,r){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=n(377)}catch(e){}var o=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),c={},s=c.lib={},u=s.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},f=s.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||p).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=a<<24-(r+o)%4*8}else for(var c=0;c<i;c+=4)t[r+c>>>2]=n[c>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(o());return new f.init(t,e)}}),l=c.enc={},p=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new f.init(n,t/2)}},d=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new f.init(n,t)}},h=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},E=s.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,a=this.blockSize,c=o/(4*a),s=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,u=e.min(4*s,o);if(s){for(var l=0;l<s;l+=a)this._doProcessBlock(i,l);n=i.splice(0,s),r.sigBytes-=u}return new f.init(n,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),b=(s.Hasher=E.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){E.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new b.HMAC.init(e,n).finalize(t)}}}),c.algo={});return c}(Math),r)}).call(this,n(84))},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r,i,o;n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),function(e){e.LOCAL="LOCAL",e.SERVER="SERVER"}(r||(r={})),function(e){e.OPEN="open",e.INVITE_ONLY="invite-only"}(i||(i={})),function(e){e.NOT_STARTED="0",e.IN_PROGRESS="1",e.COMPLETED="2"}(o||(o={}))},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n,r){var i=e.call(this,n,"CERTIFICATE_ALREADY_DOWNLOADED")||this;return i.filePath=r,Object.setPrototypeOf(i,t.prototype),i}return o(t,e),t}(i.a)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"NO_ACTIVE_SESSION")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"NO_PROFILE_FOUND")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),function(e){e.BOARD="board",e.MEDIUM="medium",e.GRADE_LEVEL="gradeLevel",e.SUBJECT="subject",e.TOPIC="topic",e.PURPOSE="purpose"}(r||(r={}));var i=function(){function e(){}return e.DEFAULT_FRAMEWORK_CATEGORIES=[r.BOARD,r.MEDIUM,r.GRADE_LEVEL,r.SUBJECT],e.COURSE_FRAMEWORK_CATEGORIES=[r.TOPIC,r.PURPOSE,r.MEDIUM,r.GRADE_LEVEL,r.SUBJECT],e}()},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(53);function i(e,t,n){for(var i=n||r.defaultEquals,o=e.length,a=0;a<o;a++)if(i(e[a],t))return a;return-1}t.indexOf=i,t.lastIndexOf=function(e,t,n){for(var i=n||r.defaultEquals,o=e.length-1;o>=0;o--)if(i(e[o],t))return o;return-1},t.contains=function(e,t,n){return i(e,t,n)>=0},t.remove=function(e,t,n){var r=i(e,t,n);return!(r<0)&&(e.splice(r,1),!0)},t.frequency=function(e,t,n){for(var i=n||r.defaultEquals,o=e.length,a=0,c=0;c<o;c++)i(e[c],t)&&a++;return a},t.equals=function(e,t,n){var i=n||r.defaultEquals;if(e.length!==t.length)return!1;for(var o=e.length,a=0;a<o;a++)if(!i(e[a],t[a]))return!1;return!0},t.copy=function(e){return e.concat()},t.swap=function(e,t,n){if(t<0||t>=e.length||n<0||n>=e.length)return!1;var r=e[t];return e[t]=e[n],e[n]=r,!0},t.toString=function(e){return"["+e.toString()+"]"},t.forEach=function(e,t){for(var n=0,r=e;n<r.length;n++){if(!1===t(r[n]))return}}},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.RESOURCE="Resource",e.COURSE="Course",e.ANONYMOUS_COURSE="AnonymousCourse",e.DIAL_CODE="DIAL Code Consumption"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.INTERNAL_STORAGE="INTERNAL_STORAGE",e.EXTERNAL_STORAGE="EXTERNAL_STORAGE"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.TRANSFER_PROGRESS="TRANSFER_PROGRESS",e.TRANSFER_COMPLETED="TRANSFER_COMPLETED",e.TRANSFER_REVERT_COMPLETED="TRANSFER_REVERT_COMPLETED",e.TRANSFER_FAILED_DUPLICATE_CONTENT="TRANSFER_FAILED_DUPLICATE_CONTENT",e.TRANSFER_FAILED_LOW_MEMORY="TRANSFER_FAILED_LOW_MEMORY"}(r||(r={}))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.IGNORE="IGNORE",e.KEEP_HIGER_VERSION="KEEP_HIGER_VERSION",e.KEEP_LOWER_VERSION="KEEP_LOWER_VERSION",e.KEEP_SOURCE="KEEP_SOURCE",e.KEEP_DESTINATION="KEEP_DESTINATION"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"TRANSFER_FAILED_DUPLICATE_CONTENT_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n,r){var i=e.call(this,n,"TRANSFER_FAILED_ERROR")||this;return i.directory=r,Object.setPrototypeOf(i,t.prototype),i}return o(t,e),t}(i.a)},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(10),i=n(8),o=n(6),a=n(5),c=n(3),s=n(0),u=n(1),f=n(30),l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},p=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,t){return function(n,r){t(n,r,e)}},E=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},y=function(){function e(e,t,n,r,i,o,a){this.profileService=e,this.groupService=t,this.config=n,this.frameworkService=r,this.deviceInfo=i,this.appInfo=o,this.dbService=a}return e.prototype.getPlayerConfig=function(e,t){var n=this,o={};o.did=this.deviceInfo.getDeviceID(),o.origin=this.config.apiConfig.host;var a=new r.ProducerData;a.id=this.config.apiConfig.api_authentication.producerId,a.pid=this.config.apiConfig.api_authentication.producerUniqueId,a.ver=this.appInfo.getVersionName(),o.pdata=a;var u={};return e.rollup=i.a.getRollup(e.identifier,e.hierarchyInfo),o.objectRollup=e.rollup,"ios"===window.device.platform.toLowerCase()?e.basePath=(e.basePath||(e.basePath="")).replace(/\/$/,""):e.basePath=e.basePath.replace(/\/$/,""),e.isAvailableLocally&&(e.contentData.streamingUrl=e.basePath,e.contentData.previewUrl=e.basePath),u.metadata=e,u.config=this.config.playerConfig,this.profileService.getActiveProfileSession().pipe(Object(s.mergeMap)((function(t){o.sid=t?t.sid:"";var i=new r.Actor;i.id=t?t.uid:"",o.actor=i;var a=n.config.appConfig.deepLinkBasePath;o.deeplinkBasePath=a||"";var c=e.rollup&&e.rollup.l1?e.rollup.l1:e.identifier;return n.fetchPlayerState(i.id,c,e.identifier).then((function(e){e&&u.config&&(u.config=l(l({},u.config),JSON.parse(e.saveState)))})),n.profileService.getActiveSessionProfile({requiredFields:[]})})),Object(s.mergeMap)((function(e){if(e&&e.serverProfile){var r=e.serverProfile.organisations;if(r){var i=r[0]&&r[0].organisationId;o.contextRollup={l1:i}}}return e&&e.profileType&&(t.correlationData=(t.correlationData||[]).concat([{id:e.profileType,type:"UserType"}])),n.groupService.getActiveGroupSession()})),Object(s.mergeMap)((function(e){var r=[];e&&e.gid&&r.push({id:e.gid,type:"group"});var i=t&&t.hasOwnProperty("streaming"),a=t.correlationData;a&&a.length&&(r=r.concat(a)),r.push({id:i?"streaming":"offline",type:"PlayerLaunch"}),o.cdata=r,u.context=o;var c={local:!0,server:!1};return c.groupId=e?e.gid:"",u.appContext=c,n.frameworkService.getActiveChannelId()})),Object(s.mergeMap)((function(e){return o.channel=e||n.config.apiConfig.api_authentication.channelId,u.context=o,Object(c.of)(u)})))},e.prototype.savePlayerState=function(e,t,n,r){var i=this;return this.dbService.read({table:f.a.TABLE_NAME,selection:f.a.COLUMN_NAME_USER_ID+" = ? AND "+f.a.COLUMN_PARENT_IDENTIFIER+" = ?\n                 AND "+f.a.COLUMN_IDENTIFIER+" = ?",selectionArgs:[e,t,n]}).toPromise().then((function(o){return E(i,void 0,void 0,(function(){return b(this,(function(i){return o&&o.length?[2,this.dbService.update({table:f.a.TABLE_NAME,selection:f.a.COLUMN_NAME_USER_ID+" = ? AND "+f.a.COLUMN_PARENT_IDENTIFIER+" = ?\n                        AND "+f.a.COLUMN_IDENTIFIER+" = ?",selectionArgs:[e,t,n],modelJson:f.b.mapPlayerStateToPlayerDbEntry(e,t,n,r)}).toPromise()]:[2,this.dbService.insert({table:f.a.TABLE_NAME,modelJson:f.b.mapPlayerStateToPlayerDbEntry(e,t,n,r)}).toPromise()]}))}))}))},e.prototype.fetchPlayerState=function(e,t,n){return this.dbService.read({table:f.a.TABLE_NAME,selection:f.a.COLUMN_NAME_USER_ID+" = ? AND "+f.a.COLUMN_PARENT_IDENTIFIER+" = ?\n             AND "+f.a.COLUMN_IDENTIFIER+" = ?",selectionArgs:[e,t,n]}).toPromise().then((function(e){return e&&e[0]&&f.b.mapPlayerDbEntryToPlayer(e[0])}))},e.prototype.deletePlayerSaveState=function(e,t,n){return this.dbService.delete({table:f.a.TABLE_NAME,selection:f.a.COLUMN_NAME_USER_ID+" =? AND "+f.a.COLUMN_PARENT_IDENTIFIER+" = ?\n            AND "+f.a.COLUMN_IDENTIFIER+" = ?",selectionArgs:[e,t,n]}).toPromise()},e=p([Object(o.injectable)(),h(0,Object(o.inject)(a.b.PROFILE_SERVICE)),h(1,Object(o.inject)(a.b.GROUP_SERVICE_DEPRECATED)),h(2,Object(o.inject)(a.b.SDK_CONFIG)),h(3,Object(o.inject)(a.b.FRAMEWORK_SERVICE)),h(4,Object(o.inject)(a.b.DEVICE_INFO)),h(5,Object(o.inject)(a.b.APP_INFO)),h(6,Object(o.inject)(a.b.DB_SERVICE)),d("design:paramtypes",[Object,Object,Object,Object,Object,Object,u.DbService])],e)}()},function(e,t,n){"use strict";var r,i;n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),function(e){e[e.ACTIONABLE_NOTIFICATION=1]="ACTIONABLE_NOTIFICATION",e[e.NOTIFY=2]="NOTIFY",e[e.CONFIG=3]="CONFIG"}(r||(r={})),function(e){e.READ="read",e.UNREAD="unread",e.ALL="all"}(i||(i={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(6),i=n(5),o=n(11),a=n(0),c=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t){return function(n,r){t(n,r,e)}},f=function(){function e(e){this.sharedPreferences=e}return e.prototype.setDefaultDeploymentKey=function(e){return this.sharedPreferences.putString(o.e.DEFAULT_DEPLOYMENT_KEY,e)},e.prototype.getDefaultDeploymentKey=function(){return this.sharedPreferences.getString(o.e.DEFAULT_DEPLOYMENT_KEY)},e.prototype.setExperimentKey=function(e){var t=this;return this.sharedPreferences.putString(o.e.EXPERIMENT_KEY,e).pipe(Object(a.tap)((function(){t.experimentKey||(t.experimentKey=e)})))},e.prototype.getExperimentKey=function(){var e=this;return this.experimentKey?this.experimentKey:this.sharedPreferences.getString(o.e.EXPERIMENT_KEY).pipe(Object(a.tap)((function(t){return e.experimentKey=t,t})))},e.prototype.setExperimentAppVersion=function(e){return this.sharedPreferences.putString(o.e.EXPERIMENT_APP_VERSION,e)},e.prototype.getExperimentAppVersion=function(){return this.sharedPreferences.getString(o.e.EXPERIMENT_APP_VERSION)},e=c([Object(r.injectable)(),u(0,Object(r.inject)(i.b.SHARED_PREFERENCES)),s("design:paramtypes",[Object])],e)}()},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(31),i=function(){function e(e){this._gid=e,this._sid=r.a.generateUniqueId(),this._createdTime=Date.now()}return Object.defineProperty(e.prototype,"gid",{get:function(){return this._gid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sid",{get:function(){return this._sid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createdTime",{get:function(){return this._createdTime},enumerable:!1,configurable:!0}),e}()},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"NO_GROUP_FOUND")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(19),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(n){var r=e.call(this,n,"NO_ACTIVE_SESSION")||this;return Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(i.a)},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(6),i=n(5),o=n(100),a=n(99),c=n(102),s=n(101),u=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t){return function(n,r){t(n,r,e)}},p=function(){function e(e){this.keyValueStore=e}return e.prototype.saveTags=function(e,t){return new s.a(this.keyValueStore).handle(e,t)},e.prototype.getTags=function(e){return new a.a(this.keyValueStore).handle(e)},e.prototype.removeTagsForId=function(e){throw new Error("Method not implemented.")},e.prototype.clearAllTags=function(){throw new Error("Method not implemented.")},e.prototype.saveCommandList=function(e,t){return new c.a(this.keyValueStore).handle(e,t)},e.prototype.getCommand=function(e){return new o.a(this.keyValueStore).handle(e)},e=u([Object(r.injectable)(),l(0,Object(r.inject)(i.b.KEY_VALUE_STORE)),f("design:paramtypes",[Object])],e)}()},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(6),i=n(3),o=n(5),a=n(104),c=n(78),s=n(39),u=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t){return function(n,r){t(n,r,e)}},p=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},h=function(){function e(e,t){this.sharedPreferences=e,this.profileService=t,this.watcher={interval:null,observer:null,debugStatus:!1}}return Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},set:function(e){this._userId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceId",{get:function(){return this._deviceId},set:function(e){this._deviceId=e},enumerable:!1,configurable:!0}),e.prototype.enableDebugging=function(e){var t=this;return new i.Observable((function(n){t.profileService.getActiveProfileSession().toPromise().then((function(r){return p(t,void 0,void 0,(function(){var t;return d(this,(function(i){switch(i.label){case 0:return(null==r?void 0:r.uid)?(this._userId=r.uid,[4,s.a.createJWTToken(this._deviceId,this.userId)]):[3,6];case 1:return t=i.sent(),e?[4,this.sharedPreferences.putString(c.CsClientStorage.TRACE_ID,e).toPromise()]:[3,3];case 2:return i.sent(),[3,5];case 3:return[4,this.sharedPreferences.putString(c.CsClientStorage.TRACE_ID,t).toPromise()];case 4:i.sent(),i.label=5;case 5:new a.a(this.sharedPreferences,this).handle(n),console.log("Watcher Value:",this.watcher),i.label=6;case 6:return[2]}}))}))}))}))},e.prototype.disableDebugging=function(){return this.watcher.debugStatus?(clearTimeout(this.watcher.interval),this.watcher.observer.complete(),this.watcher={interval:null,observer:null,debugStatus:!1},this.sharedPreferences.putString("debug_started_at","").toPromise(),this.sharedPreferences.putString(c.CsClientStorage.TRACE_ID,"").toPromise(),Object(i.of)(!0)):Object(i.of)(!1)},e.prototype.isDebugOn=function(){return!!this.watcher.debugStatus},e=u([Object(r.injectable)(),l(0,Object(r.inject)(o.b.SHARED_PREFERENCES)),l(1,Object(r.inject)(o.b.PROFILE_SERVICE)),f("design:paramtypes",[Object,Object])],e)}()},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,i=n(63),o=n(26),a=n(59),c=n(50),s=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=function(e){function t(t,n){var r=e.call(this,o.a.instance.sdkConfig.apiConfig,o.a.instance.apiService,o.a.instance.eventsBusService)||this;return r.manualMergeConfig=t,r.telemetryService=o.a.instance.telemetryService,r.webviewRunner=n||new a.a,r}return s(t,e),t.prototype.provide=function(){return u(this,void 0,void 0,(function(){var e,t,n=this;return f(this,(function(r){switch(r.label){case 0:return e=this.webviewRunner,[4,this.telemetryService.buildContext().toPromise()];case 1:return t=r.sent(),this.manualMergeConfig.target.params.push({key:"pdata",value:JSON.stringify(t.pdata)}),[2,e.launchWebview({host:this.manualMergeConfig.target.host,path:this.manualMergeConfig.target.path,params:this.manualMergeConfig.target.params.reduce((function(e,t){return e[t.key]=t.value,e}),{})}).then((function(){return e.any.apply(e,n.manualMergeConfig.return.reduce((function(t,r){switch(r.type){case"password":t.push(n.buildPasswordSessionProvider(e,r));break;case"google":t.push(n.buildGoogleSessionProvider(e,r));break;case"exit":t.push(e.capture({host:r.when.host,path:r.when.path,params:r.when.params}).then((function(){return e.closeWebview().then((function(){return e.clearCapture().then((function(){return u(n,void 0,void 0,(function(){return f(this,(function(e){throw new c.InterruptError("EXIT param found")}))}))}))}))})))}return t}),[]))}))]}}))}))},t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r,i=n(51),o=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(e){function t(t){var n=e.call(this,t,"INTERRUPT_ERROR")||this;return Object.setPrototypeOf(n,i.a.prototype),n}return o(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(7),i=n(0),o=n(26),a=n(13),c=n(39),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},f=function(){function e(e){this.nativeGoogleTokenProvider=e,this.apiService=o.a.instance.apiService}return e.parseAccessToken=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return[4,c.a.decodeJWT(e)];case 1:return t=r.sent(),[2,{userToken:3===(n=JSON.parse(t)).sub.split(":").length?n.sub.split(":").pop():n.sub,accessTokenExpiresOn:1e3*n.exp}]}}))}))},e.prototype.provide=function(){return s(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,this.nativeGoogleTokenProvider()];case 1:return e=t.sent(),[2,this.callGoogleNativeLogin(e.idToken,e.email).toPromise()]}}))}))},e.prototype.callGoogleNativeLogin=function(t,n){var o=this,c="ios"===window.device.platform.toLowerCase()?"ios":null,f=(new r.Request.Builder).withType(r.HttpRequestType.POST).withPath(e.LOGIN_API_ENDPOINT).withBearerToken(!1).withUserToken(!1).withBody({emailId:n,platform:c}).withHeaders({"X-GOOGLE-ID-TOKEN":t}).build();return this.apiService.fetch(f).pipe(Object(i.map)((function(t){return s(o,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return t.body&&a.CsModule.instance.updateAuthTokenConfig(t.body.access_token),n={access_token:t.body.access_token,refresh_token:t.body.refresh_token},[4,e.parseAccessToken(t.body.access_token)];case 1:return[2,(n.userToken=r.sent().userToken,n)]}}))}))})))},e.LOGIN_API_ENDPOINT="/google/auth/android",e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(7),i=n(0),o=n(26),a=n(13),c=n(39),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=function(){function e(e){this.nativeAppleTokenProvider=e,this.apiService=o.a.instance.apiService,console.log(this.apiService)}return e.parseAccessToken=function(e){return u(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return[4,c.a.decodeJWT(e)];case 1:return t=r.sent(),[2,{userToken:3===(n=JSON.parse(t)).sub.split(":").length?n.sub.split(":").pop():n.sub,accessTokenExpiresOn:1e3*n.exp}]}}))}))},e.prototype.provide=function(){return u(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this.nativeAppleTokenProvider()];case 1:return e=t.sent(),[2,this.callAppleNativeLogin(e).toPromise()]}}))}))},e.prototype.callAppleNativeLogin=function(t){var n=this,o="ios"===window.device.platform.toLowerCase()?"ios":null,c=(new r.Request.Builder).withType(r.HttpRequestType.POST).withPath(e.LOGIN_API_ENDPOINT).withBearerToken(!1).withUserToken(!1).withBody(s({emailId:t.email,platform:o},t)).build();return this.apiService.fetch(c).pipe(Object(i.map)((function(t){return u(n,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return t.body&&a.CsModule.instance.updateAuthTokenConfig(t.body.sessionId.access_token),n={access_token:t.body.sessionId.access_token,refresh_token:t.body.sessionId.refresh_token},[4,e.parseAccessToken(t.body.sessionId.access_token)];case 1:return[2,(n.userToken=r.sent().userToken,n)]}}))}))})))},e.LOGIN_API_ENDPOINT="/apple/auth/ios",e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,i=n(63),o=n(26),a=n(59),c=n(48),s=n(75),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},d=function(e){function t(t,n,r){var i=e.call(this,o.a.instance.sdkConfig.apiConfig,o.a.instance.apiService,o.a.instance.eventsBusService)||this;return i.stateSessionConfig=t,i.autoMergeConfig=n,i.telemetryService=o.a.instance.telemetryService,i.webViewRunner=r||new a.a,i}return u(t,e),t.prototype.provide=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return p(this,(function(r){switch(r.label){case 0:return e=this.webViewRunner,[4,this.telemetryService.buildContext().toPromise()];case 1:return t=r.sent(),this.stateSessionConfig.target.params.push({key:"pdata",value:JSON.stringify(t.pdata)}),[2,e.launchWebview({host:this.stateSessionConfig.target.host,path:this.stateSessionConfig.target.path,params:this.stateSessionConfig.target.params.reduce((function(e,t){return e[t.key]=t.value,e}),f({},this.resetParams))}).then((function(){return e.any.apply(e,n.stateSessionConfig.return.reduce((function(t,r){switch(r.type){case"state":t.push(n.buildStateSessionProvider(e,r));break;case"state-error":t.push(e.capture({host:r.when.host,path:r.when.path,params:r.when.params}).then((function(){return e.closeWebview().then((function(){return e.resolveCaptured("error_message").catch((function(){throw new c.a("Server Error")})).then((function(e){throw new c.a(e)}))}))})));break;case"migrate":t.push(e.capture({host:r.when.host,path:r.when.path,params:r.when.params}).then((function(){return e.success()})).then((function(t){return e.resetInAppBrowserEventListeners(),e.clearCapture().then((function(){return new s.a(n.autoMergeConfig,n.webViewRunner,t).provide()}))})))}return t}),[]))}))]}}))}))},t}(i.a)},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(7),i=n(0),o=n(26),a=n(13),c=n(39),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},f=function(){function e(e,t){this.loginConfig=e,this.nativeKeycloakTokenProvider=t,this.apiService=o.a.instance.apiService}return e.parseAccessToken=function(e){return s(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:return[4,c.a.decodeJWT(e)];case 1:return t=r.sent(),[2,{userToken:3===(n=JSON.parse(t)).sub.split(":").length?n.sub.split(":").pop():n.sub,accessTokenExpiresOn:1e3*n.exp}]}}))}))},e.prototype.provide=function(){return s(this,void 0,void 0,(function(){return u(this,(function(e){return[2,this.callKeycloakNativeLogin(this.nativeKeycloakTokenProvider.username,this.nativeKeycloakTokenProvider.password).toPromise()]}))}))},e.prototype.callKeycloakNativeLogin=function(t,n){var o=this,c="ios"===window.device.platform.toLowerCase()?"ios":window.device.platform.toLowerCase(),f=(new r.Request.Builder).withType(r.HttpRequestType.POST).withPath(e.LOGIN_API_ENDPOINT).withBearerToken(!1).withUserToken(!1).withBody({client_id:c,emailId:t,password:n,loginConfig:this.loginConfig.target}).build();return this.apiService.fetch(f).pipe(Object(i.map)((function(t){return s(o,void 0,void 0,(function(){var n,r;return u(this,(function(i){switch(i.label){case 0:return(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.access_token)?(a.CsModule.instance.updateAuthTokenConfig(t.body.access_token),n={access_token:t.body.access_token,refresh_token:t.body.refresh_token},[4,e.parseAccessToken(t.body.access_token)]):[3,2];case 1:return[2,(n.userToken=i.sent().userToken,n)];case 2:return[2,t.body]}}))}))})))},e.LOGIN_API_ENDPOINT="/keycloak/login",e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(26),i=n(59),o=n(54),a=n(39),c=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},u=function(){function e(e,t,n){this.loginConfig=e,this.customWebViewConfig=t,this.apiConfig=r.a.instance.sdkConfig.apiConfig,this.telemetryService=r.a.instance.telemetryService,this.webviewRunner=n||new i.a}return e.parseAccessToken=function(e){return c(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,a.a.decodeJWT(e)];case 1:return t=r.sent(),[2,{userToken:3===(n=JSON.parse(t)).sub.split(":").length?n.sub.split(":").pop():n.sub,accessTokenExpiresOn:1e3*n.exp}]}}))}))},e.prototype.buildGoogleTargetUrl=function(e,t){var n=new URL(e.googleRedirectUrl);return delete t.redirect_uri,n.searchParams.set("redirect_uri",this.apiConfig.user_authentication.redirectUrl),delete t.error_callback,n.searchParams.set("error_callback",this.apiConfig.user_authentication.redirectUrl),Object.keys(t).forEach((function(e){return n.searchParams.set(e,t[e])})),n},e.prototype.provide=function(){return c(this,void 0,void 0,(function(){var t,n,r,i,a,u=this;return s(this,(function(f){switch(f.label){case 0:return t=this.webviewRunner,[4,this.telemetryService.buildContext().toPromise()];case 1:return n=f.sent(),this.loginConfig.target.params.push({key:"pdata",value:JSON.stringify(n.pdata)}),r="",i={},this.loginConfig.target.params.forEach((function(e){"redirect_uri"==e.key&&(r=e.value),i[e.key]=e.value})),a=this.buildGoogleTargetUrl({googleRedirectUrl:this.loginConfig.target.host+"/"+e.LOGIN_API_ENDPOINT+"?redirect_uri="+r},i),[2,t.launchCustomTab({host:a.origin,path:a.pathname,params:o.parse(a.searchParams.toString(),{ignoreQueryPrefix:!0}),extraParams:this.customWebViewConfig.get("extraParam")}).then((function(){return t.success()})).then((function(t){return c(u,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n={access_token:t.access_token,refresh_token:t.refresh_token},[4,e.parseAccessToken(t.access_token)];case 1:return[2,(n.userToken=r.sent().userToken,n)]}}))}))}))]}}))}))},e.LOGIN_API_ENDPOINT="/google/auth",e}()},function(e,t,n){"use strict";n.r(t);var r=n(277);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(278);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(279);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(280);for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(282);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(283);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(284);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(285);for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(286);n.d(t,"GroupMembershipType",(function(){return s.c})),n.d(t,"GroupMemberRole",(function(){return s.b})),n.d(t,"GroupEntityStatus",(function(){return s.a}))},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r=n(87);n.d(t,"c",(function(){return r.GroupMembershipType})),n.d(t,"b",(function(){return r.GroupMemberRole})),n.d(t,"a",(function(){return r.GroupEntityStatus}))},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(289);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(291);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(293);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(294);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i)},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(296);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(298);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(300);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(301);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i)},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return Ve}));var r,i=n(15),o=n(1),a=n(4),c=n(7),s=n(0),u=function(){function e(e,t){this.apiService=e,this.tenantServiceConfig=t,this.GET_TENANT_INFO_ENDPOINT="/info"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.GET).withPath(this.tenantServiceConfig.tenantApiPath+this.GET_TENANT_INFO_ENDPOINT+"/"+e.slug).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return e.body.result})))},e}(),f=n(21),l=n(3),p=n(5),d=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},E=function(){function e(e,t,n,r){this.cachedItemStore=e,this.keyValueStore=t,this.container=n,this.profileServiceConfig=r,this.USER_PROFILE_DETAILS_KEY_PREFIX="userProfileDetails"}return Object.defineProperty(e.prototype,"csUserService",{get:function(){return this.container.get(p.a.USER_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.handle=function(e){var t=this;return e.from=e.from||f.CachedItemRequestSourceFrom.CACHE,Object(l.of)(e.from).pipe(Object(s.mergeMap)((function(n){return n===f.CachedItemRequestSourceFrom.SERVER?t.fetchFromServer(e).pipe(Object(s.tap)((function(e){return d(t,void 0,void 0,(function(){return h(this,(function(t){return[2,this.keyValueStore.setValue(this.USER_PROFILE_DETAILS_KEY_PREFIX+"-"+e.id,JSON.stringify(e)).toPromise()]}))}))})),Object(s.catchError)((function(n){if(e.forceRefresh)throw n;return t.fetchFromCache(e)}))):t.fetchFromCache(e)})))},e.prototype.fetchFromServer=function(e){return this.csUserService.getProfileDetails(e,{apiPath:this.profileServiceConfig.profileApiPath_V5})},e.prototype.fetchFromCache=function(e){var t=this;return this.cachedItemStore.getCached(e.userId,this.USER_PROFILE_DETAILS_KEY_PREFIX,this.USER_PROFILE_DETAILS_KEY_PREFIX,(function(){return t.fetchFromServer(e)}))},e}(),b=function(){function e(){}return e.mapProfileDBEntryToProfile=function(e){return{uid:e[a.f.COLUMN_NAME_UID],handle:e[a.f.COLUMN_NAME_HANDLE],createdAt:e[a.f.COLUMN_NAME_CREATED_AT],medium:e[a.f.COLUMN_NAME_MEDIUM]?e[a.f.COLUMN_NAME_MEDIUM].split(","):[],board:e[a.f.COLUMN_NAME_BOARD]?e[a.f.COLUMN_NAME_BOARD].split(","):[],subject:e[a.f.COLUMN_NAME_SUBJECT]?e[a.f.COLUMN_NAME_SUBJECT].split(","):[],profileType:e[a.f.COLUMN_NAME_PROFILE_TYPE],grade:e[a.f.COLUMN_NAME_GRADE]?e[a.f.COLUMN_NAME_GRADE].split(","):[],syllabus:e[a.f.COLUMN_NAME_SYLLABUS]?e[a.f.COLUMN_NAME_SYLLABUS].split(","):[],source:e[a.f.COLUMN_NAME_SOURCE],gradeValue:e[a.f.COLUMN_NAME_GRADE_VALUE]&&JSON.parse(e[a.f.COLUMN_NAME_GRADE_VALUE]),categories:e[a.f.COLUMN_NAME_CATEGORIES]}},e.mapProfileToProfileDBEntry=function(e){var t;return(t={})[a.f.COLUMN_NAME_UID]=e.uid,t[a.f.COLUMN_NAME_HANDLE]=e.handle,t[a.f.COLUMN_NAME_CREATED_AT]=Number(e.createdAt),t[a.f.COLUMN_NAME_MEDIUM]=e.medium?e.medium.join(","):"",t[a.f.COLUMN_NAME_BOARD]=e.board?e.board.join(","):"",t[a.f.COLUMN_NAME_SUBJECT]=e.subject?e.subject.join(","):"",t[a.f.COLUMN_NAME_PROFILE_TYPE]=e.profileType,t[a.f.COLUMN_NAME_GRADE]=e.grade?e.grade.join(","):"",t[a.f.COLUMN_NAME_SYLLABUS]=e.syllabus?e.syllabus.join(","):"",t[a.f.COLUMN_NAME_SOURCE]=e.source,t[a.f.COLUMN_NAME_GRADE_VALUE]=e.gradeValue?JSON.stringify(e.gradeValue):"",t[a.f.COLUMN_NAME_CATEGORIES]=e.categories?JSON.stringify(e.categories):"",t},e}(),y=function(){function e(e,t){this.apiService=e,this.acceptTermsConditionApiConfig=t,this.GET_ACCEPT_TERM_CONDITIONS_ENDPOINT="/tnc/accept"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.acceptTermsConditionApiConfig.profileApiPath+this.GET_ACCEPT_TERM_CONDITIONS_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return"SUCCESS"===e.body.result.response})))},e}(),v=n(2),_=function(){function e(){}return e.mapDBEntryToContenetAccess=function(e){var t=e[v.a.COLUMN_NAME_LEARNER_STATE];return{status:Number(e[v.a.COLUMN_NAME_STATUS]),contentId:e[v.a.COLUMN_NAME_CONTENT_IDENTIFIER],contentType:e[v.a.COLUMN_NAME_CONTENT_TYPE],contentLearnerState:{learnerState:t&&JSON.parse(t)}}},e}(),S=n(19),O=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),g=function(e){function t(n){var r=e.call(this,n,"INVALID_PROFILE_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return O(t,e),t}(S.a),C=n(31),m=function(){function e(e,t){this.apiService=e,this.profileAlreadyInUseConfig=t,this.GET_PROFILE_ALREADY_IN_USE_ENDPOINT="/get"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.GET).withPath(this.profileAlreadyInUseConfig.profileApiPath_V2+this.GET_PROFILE_ALREADY_IN_USE_ENDPOINT+"/"+e.type+"/"+e.key).withBearerToken(!0).withUserToken(!0).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return e.body.result})))},e}(),A=function(){function e(e,t){this.apiService=e,this.otpServiceConfig=t,this.GET_GENERATE_OTP_ENDPOINT="/generate"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.otpServiceConfig.otpApiPath+this.GET_GENERATE_OTP_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return"SUCCESS"===e.body.result.response})))},e}(),T=function(){function e(e,t){this.apiService=e,this.optServiceConfig=t,this.GET_VERIFY_OTP_ENDPOINT="/verify"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.optServiceConfig.otpApiPath+this.GET_VERIFY_OTP_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return"SUCCESS"===e.body.result.response})))},e}(),N=n(47),I=function(){function e(e,t,n,r){this.apiService=e,this.profileServiceConfig=t,this.fileService=n,this.cachedItemStore=r,this.LOCATION_LOCAL_KEY="location-"}return e.prototype.handle=function(t){var n=this,r=t.filters.type;return t.filters.parentId&&(r=r+"_"+t.filters.parentId),this.cachedItemStore[t.from===f.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](r,this.LOCATION_LOCAL_KEY,"ttl_"+this.LOCATION_LOCAL_KEY,(function(){return n.fetchFromServer(t)}),(function(){return n.fetchFromFile(t)}),e.LOCATION_TTL)},e.prototype.fetchFromServer=function(t){var n=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.profileServiceConfig.searchLocationApiPath+e.GET_SEARCH_LOCATION_ENDPOINT).withBearerToken(!0).withUserToken(!1).withBody({request:t}).build();return this.apiService.fetch(n).pipe(Object(s.map)((function(e){return e.body.result.response})))},e.prototype.fetchFromFile=function(e){var t=this;return Object(l.from)(N.a.getAssetPath()).pipe(Object(s.switchMap)((function(n){var r=n+t.profileServiceConfig.locationDirPath,i=e.filters.type;e.filters.parentId&&(i=i+"-"+e.filters.parentId);var o=r+"/"+(i+=".json");return Object(l.from)(t.fileService.readFileFromAssets(o)).pipe(Object(s.map)((function(e){return JSON.parse(e).result.response})))})))},e.GET_SEARCH_LOCATION_ENDPOINT="/location/search",e.LOCATION_TTL=864e5,e}(),M=n(8),w=n(11),D=n(35),P=n(41),R=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},j=function(){function e(e){this.fileService=e}return e.prototype.execute=function(e){return R(this,void 0,void 0,(function(){var t,n,r=this;return L(this,(function(i){switch(i.label){case 0:return t=new c.Response,n="profiles_"+P().format("YYYYMMDDhhmmss")+".epar",[4,this.fileService.createDir(e.destinationFolder.concat("Profile"),!1).then((function(e){return R(r,void 0,void 0,(function(){return L(this,(function(t){switch(t.label){case 0:return[4,this.fileService.createFile(e.nativeURL,n,!0).catch((function(e){throw new Error(e)}))];case 1:return[2,t.sent()]}}))}))})).then((function(n){return e.destinationDBFilePath=n.nativeURL,t.body=e,t})).catch((function(e){throw new Error(e)}))];case 1:return[2,i.sent()]}}))}))},e}(),U=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},k=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},x=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){return U(this,void 0,void 0,(function(){var t;return k(this,(function(n){return t=new c.Response,[2,this.dbService.copyDatabase(e.destinationDBFilePath).toPromise().then((function(n){return t.body=e,t})).then((function(){return t.body=e,t}))]}))}))},e}(),F=n(17),B=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},V=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},G=function(){function e(e,t,n){this.dbService=e,this.fileService=t,this.deviceInfo=n}return e.prototype.execute=function(e){return B(this,void 0,void 0,(function(){var t,n,r=this;return V(this,(function(i){return t=new c.Response,n=this.generateMetaData(e.userIds,e.groupIds),[2,this.dbService.open(e.destinationDBFilePath).then((function(){return r.dbService.execute(F.b.getCreateEntry(),!0).toPromise()})).then((function(){return r.populateMetaData(n)})).then((function(){return t.body=e,t})).catch((function(e){throw console.log("error",e),t}))]}))}))},e.prototype.generateMetaData=function(e,t){var n={version:20};return n.types=JSON.stringify(["userprofile"]),n.did=this.deviceInfo.getDeviceID(),n.export_id=C.a.generateUniqueId(),t||(t=[]),n.profiles_count=e.length+t.length,n},e.prototype.populateMetaData=function(e){return B(this,void 0,void 0,(function(){var t=this;return V(this,(function(n){return Object.keys(e).forEach((function(n){return B(t,void 0,void 0,(function(){var t;return V(this,(function(r){switch(r.label){case 0:return t={key:n,value:e[n]},[4,this.dbService.insert({table:F.b.TABLE_NAME,modelJson:t,useExternalDb:!0}).toPromise()];case 1:return r.sent(),[2]}}))}))})),[2]}))}))},e}(),Y=n(14),H=n(9),q=n(12),K=n(25),z=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},W=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},X=function(){function e(e,t){this.dbService=e,this.fileService=t}return e.prototype.execute=function(e){return z(this,void 0,void 0,(function(){var t,n=this;return W(this,(function(r){return t=new c.Response,[2,this.getAllTables().then((function(e){var t=e.map((function(e){return e.name}));return n.removeTables(t,n.getAllTablesToExclude())})).then((function(){return n.deleteUnwantedProfilesAndUsers(e.userIds)})).then((function(){return n.deleteUnwantedProfileSummary(e.userIds)})).then((function(){return n.deleteUnwantedGroups(e.groupIds)})).then((function(){return n.deleteUnwantedGroupProfiles(e.groupIds)})).then((function(){return n.keepAllFrameworknChannel()})).then((function(){return n.fileService.getMetaData(e.destinationDBFilePath)})).then((function(t){return e.size=t.size.toString(),n.populateMetaData({FILE_SIZE:t.size})})).then((function(){return n.fileService.removeFile(e.destinationDBFilePath.concat("-journal"))})).then((function(){return t.body=e,t})).catch((function(e){throw t.errorMesg=H.ErrorCode.EXPORT_FAILED,t}))]}))}))},e.prototype.getAllTables=function(){return this.dbService.execute("SELECT name FROM sqlite_master WHERE type = 'table'",!0).toPromise()},e.prototype.getAllTablesToExclude=function(){return[F.b.TABLE_NAME,a.g.TABLE_NAME,a.f.TABLE_NAME,a.d.TABLE_NAME,a.e.TABLE_NAME,q.a.TABLE_NAME,q.b.TABLE_NAME,K.a.TABLE_NAME]},e.prototype.removeTables=function(e,t){return z(this,void 0,void 0,(function(){var n,r,i;return W(this,(function(o){switch(o.label){case 0:n=0,r=e,o.label=1;case 1:return n<r.length?(i=r[n],Y.a.contains(t,i)?[3,3]:[4,this.dbService.execute("DROP TABLE IF EXISTS "+i,!0).toPromise()]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2,!0]}}))}))},e.prototype.populateMetaData=function(e){return z(this,void 0,void 0,(function(){var t=this;return W(this,(function(n){return Object.keys(e).forEach((function(n){return z(t,void 0,void 0,(function(){var t;return W(this,(function(r){switch(r.label){case 0:return t={key:n,value:e[n]},[4,this.dbService.insert({table:F.b.TABLE_NAME,modelJson:t,useExternalDb:!0}).toPromise()];case 1:return r.sent(),[2]}}))}))})),[2]}))}))},e.prototype.deleteUnwantedProfilesAndUsers=function(e){return z(this,void 0,void 0,(function(){var t,n,r,i,o,c,s;return W(this,(function(u){switch(u.label){case 0:t=[],n=[],r=0,i=e,u.label=1;case 1:return r<i.length?(o=i[r],[4,this.dbService.read({table:a.f.TABLE_NAME,useExternalDb:!0,selection:a.f.COLUMN_NAME_UID+"=?",selectionArgs:[o],limit:"1"}).toPromise()]):[3,5];case 2:return(c=u.sent())&&c.length&&t.push(c[0][a.f.COLUMN_NAME_UID]),[4,this.dbService.read({table:a.g.TABLE_NAME,useExternalDb:!0,selection:a.g.COLUMN_NAME_UID+"=?",selectionArgs:[o],limit:"1"}).toPromise()];case 3:(s=u.sent())&&s.length&&n.push(s[0][a.g.COLUMN_NAME_UID]),u.label=4;case 4:return r++,[3,1];case 5:return[4,this.cleanTable(a.f.TABLE_NAME,a.f.COLUMN_NAME_UID,t)];case 6:return u.sent(),[4,this.cleanTable(a.g.TABLE_NAME,a.g.COLUMN_NAME_UID,t)];case 7:return u.sent(),[2]}}))}))},e.prototype.deleteUnwantedProfileSummary=function(e){return z(this,void 0,void 0,(function(){return W(this,(function(t){switch(t.label){case 0:return[4,this.cleanTable(a.d.TABLE_NAME,a.d.COLUMN_NAME_UID,e)];case 1:return t.sent(),[4,this.cleanTable(a.e.TABLE_NAME,a.e.COLUMN_NAME_UID,e)];case 2:return t.sent(),[2]}}))}))},e.prototype.deleteUnwantedGroups=function(e){return z(this,void 0,void 0,(function(){var t,n,r,i,o;return W(this,(function(a){switch(a.label){case 0:if(!e||!e.length)return[2];t=[],n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],[4,this.dbService.read({table:q.a.TABLE_NAME,useExternalDb:!0,selection:q.a.COLUMN_NAME_GID+"=?",selectionArgs:[i],limit:"1"}).toPromise()]):[3,4];case 2:(o=a.sent())&&o.length&&t.push(o[0][q.b.COLUMN_NAME_GID]),a.label=3;case 3:return n++,[3,1];case 4:return[4,this.cleanTable(q.a.TABLE_NAME,q.a.COLUMN_NAME_GID,t)];case 5:return a.sent(),[2]}}))}))},e.prototype.deleteUnwantedGroupProfiles=function(e){return z(this,void 0,void 0,(function(){var t,n,r,i,o;return W(this,(function(c){switch(c.label){case 0:if(!e||!e.length)return[2];t=[],n=0,r=e,c.label=1;case 1:return n<r.length?(i=r[n],[4,this.dbService.read({table:q.b.TABLE_NAME,useExternalDb:!0,selection:q.b.COLUMN_NAME_GID+"=?",selectionArgs:[i],limit:"1"}).toPromise()]):[3,4];case 2:(o=c.sent())&&o.length&&t.push(o[0][a.f.COLUMN_NAME_UID]),c.label=3;case 3:return n++,[3,1];case 4:return[4,this.cleanTable(q.a.TABLE_NAME,q.a.COLUMN_NAME_GID,e)];case 5:return c.sent(),[2]}}))}))},e.prototype.keepAllFrameworknChannel=function(){return z(this,void 0,void 0,(function(){var e,t,n=this;return W(this,(function(r){switch(r.label){case 0:return e="SELECT *  FROM  "+K.a.TABLE_NAME+"\n                       WHERE "+K.a.COLUMN_NAME_KEY+" LIKE 'channel_details_key-%'\n                       OR "+K.a.COLUMN_NAME_KEY+" LIKE 'framework_details_key-%'\n                       OR "+K.a.COLUMN_NAME_KEY+" LIKE 'form-%'",[4,this.dbService.execute(e,!0).toPromise()];case 1:return t=r.sent(),[4,this.dbService.execute("DELETE FROM "+K.a.TABLE_NAME,!0)];case 2:return r.sent(),t.forEach((function(e){return z(n,void 0,void 0,(function(){return W(this,(function(t){switch(t.label){case 0:return[4,this.dbService.insert({table:K.a.TABLE_NAME,useExternalDb:!0,modelJson:e})];case 1:return t.sent(),[2]}}))}))})),[2]}}))}))},e.prototype.cleanTable=function(e,t,n){return z(this,void 0,void 0,(function(){var r,i;return W(this,(function(o){switch(o.label){case 0:return n&&n.length?(r=Y.a.joinPreservingQuotes(n),i="DELETE FROM "+e+"\n             WHERE "+t+"  NOT IN("+r+")",[4,this.dbService.execute(i,!0).toPromise()]):[2];case 1:return o.sent(),[2]}}))}))},e}(),J=n(10),Q=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=new c.Response;return this.dbService.read({table:a.c.TABLE_NAME}).toPromise().then((function(e){var t=[];e.forEach((function(e){var n={type:J.ShareItemType.PROFILE,origin:e[a.c.COLUMN_NAME_DEVICE_ID],identifier:e[a.c.COLUMN_NAME_IMPORTED_ID],pkgVersion:0,transferCount:0,size:""};t.push(n)}));var n={dir:J.ShareDirection.IN,type:J.ShareType.FILE.valueOf(),items:t,env:"sdk"};return D.a.log.share(n).toPromise()})).then((function(){return t.body=e,t}))},e}(),$=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=new c.Response;return this.dbService.read({table:a.c.TABLE_NAME}).toPromise().then((function(e){var t=[];e.forEach((function(e){var n={type:J.ShareItemType.PROFILE,origin:e[a.c.COLUMN_NAME_DEVICE_ID],identifier:e[a.c.COLUMN_NAME_IMPORTED_ID],pkgVersion:0,transferCount:0,size:""};t.push(n)}));var n={dir:J.ShareDirection.OUT,type:J.ShareType.FILE.valueOf(),items:t,env:"sdk"};return D.a.log.share(n).toPromise()})).then((function(){return t.body=e,t}))},e}(),Z=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.open(e.sourceDBFilePath).then((function(){return t.dbService.read({table:F.b.TABLE_NAME,useExternalDb:!0}).toPromise()})).then((function(r){if(!r||!r.length)throw n.errorMesg=H.ErrorCode.IMPORT_FAILED.valueOf(),n;var i={};r.forEach((function(e){i[e.key]=e.value})),e.metadata=i;var o=t.getImportTypes(i);if(o&&!Y.a.contains(o,"userprofile"))throw n.errorMesg=H.ErrorCode.IMPORT_FAILED.valueOf(),n;return n.body=e,n}))},e.prototype.getImportTypes=function(e){var t=[];return e.hasOwnProperty("types")&&(t=JSON.parse(e.types)),t},e}(),ee=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},te=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ne=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:a.g.TABLE_NAME,useExternalDb:!0}).toPromise().then((function(n){return t.saveUsersToDb(e,n)})).then((function(){return n.body=e,n}))},e.prototype.saveUsersToDb=function(e,t){return ee(this,void 0,void 0,(function(){var e=this;return te(this,(function(n){return t.forEach((function(t){return ee(e,void 0,void 0,(function(){var e;return te(this,(function(n){switch(n.label){case 0:return delete t[a.g._ID],[4,this.dbService.read({table:a.f.TABLE_NAME,selection:a.g.COLUMN_NAME_UID+" = ?",selectionArgs:[t[a.g.COLUMN_NAME_UID]],limit:"1"}).toPromise()];case 1:return(e=n.sent())&&e.length?[3,3]:[4,this.dbService.insert({table:a.g.TABLE_NAME,modelJson:t}).toPromise()];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})),[2]}))}))},e}(),re=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ie=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},oe=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:q.a.TABLE_NAME,useExternalDb:!0}).toPromise().then((function(n){return t.saveGroupsToDb(e,n)})).then((function(){return n.body=e,n}))},e.prototype.saveGroupsToDb=function(e,t){return re(this,void 0,void 0,(function(){var n,r,i=this;return ie(this,(function(o){return n=0,r=0,t.forEach((function(e){return re(i,void 0,void 0,(function(){var t;return ie(this,(function(i){switch(i.label){case 0:return[4,this.dbService.read({table:q.a.TABLE_NAME,selection:q.a.COLUMN_NAME_GID+" = ?",selectionArgs:[e[q.a.COLUMN_NAME_GID]],limit:"1"}).toPromise()];case 1:return(t=i.sent())&&t.length?[3,3]:(e[q.a.COLUMN_NAME_CREATED_AT]||(e[q.a.COLUMN_NAME_CREATED_AT]=Date.now()),[4,this.dbService.insert({table:q.a.TABLE_NAME,modelJson:e}).toPromise()]);case 2:return i.sent(),n++,[3,4];case 3:r++,i.label=4;case 4:return[2]}}))}))})),e.failed=e.failed?e.failed+r:r,e.imported=e.imported?e.imported+n:n,[2]}))}))},e}(),ae=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ce=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},se=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:q.b.TABLE_NAME,useExternalDb:!0}).toPromise().then((function(n){return t.saveGroupProfilesToDb(e,n)})).then((function(){return n.body=e,n}))},e.prototype.saveGroupProfilesToDb=function(e,t){return ae(this,void 0,void 0,(function(){var e=this;return ce(this,(function(n){return t.forEach((function(n){return ae(e,void 0,void 0,(function(){var e;return ce(this,(function(r){switch(r.label){case 0:return delete n[q.b._ID],[4,this.dbService.read({table:q.b.TABLE_NAME,selection:q.b.COLUMN_NAME_GID+" = ? AND "+q.b.COLUMN_NAME_UID+" = ?",selectionArgs:[t[q.b.COLUMN_NAME_GID],n[q.b.COLUMN_NAME_UID]],limit:"1"}).toPromise()];case 1:return(e=r.sent())&&e.length?[3,3]:[4,this.dbService.insert({table:q.b.TABLE_NAME,modelJson:n})];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))})),[2]}))}))},e}(),ue=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},fe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},le=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:K.a.TABLE_NAME,useExternalDb:!0}).toPromise().then((function(e){return t.saveNoSqlEntryToDb(e)})).then((function(){return n.body=e,n}))},e.prototype.saveNoSqlEntryToDb=function(e){return ue(this,void 0,void 0,(function(){var t=this;return fe(this,(function(n){return e.forEach((function(e){return ue(t,void 0,void 0,(function(){var t;return fe(this,(function(n){switch(n.label){case 0:return delete e[K.a._ID],[4,this.dbService.read({table:K.a.TABLE_NAME,selection:K.a.COLUMN_NAME_KEY+" = ?",selectionArgs:[e[K.a.COLUMN_NAME_KEY]],limit:"1"}).toPromise()];case 1:return(t=n.sent())&&t.length?[3,3]:[4,this.dbService.insert({table:K.a.TABLE_NAME,modelJson:e}).toPromise()];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})),[2]}))}))},e}(),pe=n(24),de=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},he=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ee=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:a.f.TABLE_NAME,orderBy:a.f.COLUMN_NAME_HANDLE+" asc",useExternalDb:!0}).toPromise().then((function(e){var n=e.map((function(e){return e[a.f.COLUMN_NAME_UID]}));return t.deleteUnwantedAssesments(n)})).then((function(){return t.saveLearnerAssesmentDetails()})).then((function(){return t.saveLearnerSummary()})).then((function(){return n.body=e,n}))},e.prototype.deleteUnwantedAssesments=function(e){return de(this,void 0,void 0,(function(){var t,n,r;return he(this,(function(i){switch(i.label){case 0:return t=Y.a.joinPreservingQuotes(e),n="DELETE FROM "+a.d.TABLE_NAME+"\n             WHERE "+a.d.COLUMN_NAME_UID+"  NOT IN("+t+")",r="DELETE FROM "+a.e.TABLE_NAME+"\n             WHERE "+a.e.COLUMN_NAME_UID+"  NOT IN("+t+")",[4,this.dbService.execute(n,!0).toPromise()];case 1:return i.sent(),[4,this.dbService.execute(r,!0).toPromise()];case 2:return i.sent(),[2]}}))}))},e.prototype.saveLearnerAssesmentDetails=function(){return de(this,void 0,void 0,(function(){var e,t,n,r,i,o,c,s;return he(this,(function(u){switch(u.label){case 0:return[4,this.dbService.read({table:a.d.TABLE_NAME,orderBy:""+a.d.COLUMN_NAME_Q_INDEX,useExternalDb:!0}).toPromise()];case 1:e=u.sent(),t=0,n=e,u.label=2;case 2:return t<n.length?(r=n[t],i=r,o=pe.SummarizerQueries.getFilterForLearnerAssessmentDetails(i[a.d.COLUMN_NAME_QID],i[a.d.COLUMN_NAME_UID],i[a.d.COLUMN_NAME_CONTENT_ID],i[a.d.COLUMN_NAME_HIERARCHY_DATA]),c=pe.SummarizerQueries.getLearnerAssessmentsQuery(o),[4,this.dbService.execute(c).toPromise()]):[3,8];case 3:return(s=u.sent())&&s.length?[4,this.dbService.update({table:a.d.TABLE_NAME,selection:a.d.COLUMN_NAME_CONTENT_ID+" = ?\n                                AND "+a.d.COLUMN_NAME_UID+" = ?\n                                AND "+a.d.COLUMN_NAME_QID+" = ?",selectionArgs:[i[a.d.COLUMN_NAME_CONTENT_ID],i[a.d.COLUMN_NAME_UID],i[a.d.COLUMN_NAME_QID]],modelJson:i}).toPromise()]:[3,5];case 4:return u.sent(),[3,7];case 5:return[4,this.dbService.insert({table:a.d.TABLE_NAME,modelJson:i}).toPromise()];case 6:u.sent(),u.label=7;case 7:return t++,[3,2];case 8:return[2]}}))}))},e.prototype.saveLearnerSummary=function(){return de(this,void 0,void 0,(function(){var e,t,n,r,i,o,c=this;return he(this,(function(s){switch(s.label){case 0:return[4,this.dbService.read({table:a.e.TABLE_NAME,useExternalDb:!0}).toPromise()];case 1:e=s.sent(),t=0,n=e,s.label=2;case 2:return t<n.length?(r=n[t],i=r,[4,this.dbService.read({table:a.e.TABLE_NAME,selection:a.e.COLUMN_NAME_CONTENT_ID+" = ? AND "+a.e.COLUMN_NAME_UID+" = ?",selectionArgs:[i[a.d.COLUMN_NAME_CONTENT_ID],i[a.d.COLUMN_NAME_UID]]}).toPromise()]):[3,8];case 3:return(o=s.sent())&&o.length?[4,this.dbService.update({table:a.e.TABLE_NAME,selection:a.e.COLUMN_NAME_CONTENT_ID+" = ? AND "+a.e.COLUMN_NAME_UID+" = ?",selectionArgs:[i[a.d.COLUMN_NAME_CONTENT_ID],i[a.d.COLUMN_NAME_UID]],modelJson:i}).toPromise()]:[3,5];case 4:return s.sent(),[3,7];case 5:return[4,this.dbService.insert({table:a.e.TABLE_NAME,modelJson:i}).toPromise()];case 6:s.sent(),s.label=7;case 7:return t++,[3,2];case 8:return e.forEach((function(e){return de(c,void 0,void 0,(function(){var t,n,r;return he(this,(function(i){switch(i.label){case 0:return t=pe.SummarizerQueries.getFilterForLearnerAssessmentDetails(e[a.d.COLUMN_NAME_QID],e[a.d.COLUMN_NAME_UID],e[a.d.COLUMN_NAME_CONTENT_ID],e[a.d.COLUMN_NAME_HIERARCHY_DATA]),n=pe.SummarizerQueries.getLearnerAssessmentsQuery(t),[4,this.dbService.execute(n).toPromise()];case 1:return(r=i.sent())&&r.length?[4,this.dbService.update({table:a.e.TABLE_NAME,modelJson:r[0]}).toPromise()]:[3,3];case 2:return i.sent(),[3,5];case 3:return[4,this.dbService.insert({table:a.e.TABLE_NAME,modelJson:r[0]}).toPromise()];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))})),[2]}}))}))},e}(),be=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response,r=e.metadata.export_id,i=e.metadata.did,o={imported_id:r,device_id:i,count:e.metadata.profiles_count};return this.dbService.read({table:a.c.TABLE_NAME,selection:a.c.COLUMN_NAME_IMPORTED_ID+" =? AND "+a.c.COLUMN_NAME_DEVICE_ID+" = ?",selectionArgs:[r,i],limit:"1"}).toPromise().then((function(e){return e&&e.length?t.dbService.update({table:a.c.TABLE_NAME,modelJson:o,selection:a.c.COLUMN_NAME_IMPORTED_ID+" =? AND "+a.c.COLUMN_NAME_DEVICE_ID+" =?",selectionArgs:[r,i]}).toPromise():t.dbService.insert({table:a.c.TABLE_NAME,modelJson:o}).toPromise()})).then((function(){return n.body=e,n}))},e}(),ye=n(40),ve=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},_e=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Se=function(){function e(e){this.dbService=e}return e.prototype.execute=function(e){var t=this,n=new c.Response;return this.dbService.read({table:a.f.TABLE_NAME,orderBy:a.f.COLUMN_NAME_HANDLE+" asc",useExternalDb:!0}).toPromise().then((function(n){return t.saveProfilesToDb(e,n)})).then((function(){return n.body=e,n}))},e.prototype.saveProfilesToDb=function(e,t){return ve(this,void 0,void 0,(function(){var n,r,i,o,c,s;return _e(this,(function(u){switch(u.label){case 0:n=0,r=0,i=0,o=t,u.label=1;case 1:return i<o.length?(c=o[i],[4,this.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[c[a.f.COLUMN_NAME_UID]],limit:"1"}).toPromise()]):[3,6];case 2:return(s=u.sent())&&s.length?[3,4]:(c[a.f.COLUMN_NAME_CREATED_AT]||(c[a.f.COLUMN_NAME_CREATED_AT]=(new Date).getTime()),delete c[a.f._ID],[4,this.dbService.insert({table:a.f.TABLE_NAME,modelJson:c}).toPromise()]);case 3:return u.sent(),n++,e.imported=n,[3,5];case 4:r++,e.failed=r,u.label=5;case 5:return i++,[3,1];case 6:return e.failed=r,e.imported=n,[2]}}))}))},e}(),Oe=n(6),ge=function(){function e(e,t){this.sdkConfig=e,this.apiService=t,this.profileServiceConfig=this.sdkConfig.profileServiceConfig,this.apiConfig=this.sdkConfig.apiConfig}return e.prototype.handle=function(e){return this.fetchFromServer(e)},e.prototype.fetchFromServer=function(t){console.log("Request",t);var n=(new c.Request.Builder).withHost(this.apiConfig.host).withType(c.HttpRequestType.POST).withPath(this.profileServiceConfig.profileApiPath_V5+e.USER_MIGRATE).withBearerToken(!0).withUserToken(!0).withBody({request:t}).build();return this.apiService.fetch(n).pipe(Object(s.map)((function(e){return console.log("sucees",e),e.body})))},e.USER_MIGRATE="/migrate",e}(),Ce=function(){return(Ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},me=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ae=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Te=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},Ne=function(){function e(e,t,n,r,i,o,a,c){this.profileService=e,this.authService=t,this.profileServiceConfig=n,this.apiService=r,this.cachedItemStore=i,this.dbService=o,this.frameworkService=a,this.sharedPreferences=c,this.managedProfileAdded$=new l.Subject}return e.prototype.addManagedProfile=function(e){var t=this;return Object(l.defer)((function(){return me(t,void 0,void 0,(function(){var t,n=this;return Ae(this,(function(r){switch(r.label){case 0:return[4,this.isLoggedInUser()];case 1:if(!r.sent())throw new i.NoActiveSessionError("No active LoggedIn Session found");return[4,this.createManagedProfile(e)];case 2:return t=r.sent().uid,setTimeout((function(){n.managedProfileAdded$.next(!0)}),1e3),[2,{uid:t}]}}))}))}))},e.prototype.getManagedServerProfiles=function(t){var n=this;return this.managedProfileAdded$.pipe(Object(s.startWith)(!1),Object(s.mergeMap)((function(r){return Object(l.defer)((function(){return me(n,void 0,void 0,(function(){var n,o,u,p=this;return Ae(this,(function(d){switch(d.label){case 0:return[4,this.isLoggedInUser()];case 1:if(!d.sent())throw new i.NoActiveSessionError("No active LoggedIn Session found");return t.from!==f.CachedItemRequestSourceFrom.SERVER&&(t.from=r?f.CachedItemRequestSourceFrom.SERVER:f.CachedItemRequestSourceFrom.CACHE),[4,this.profileService.getActiveSessionProfile({requiredFields:[]}).toPromise()];case 2:return n=d.sent(),o=n.serverProfile&&n.serverProfile.managedBy?n.serverProfile.managedBy:n.uid,u=function(){return Object(l.defer)((function(){return me(p,void 0,void 0,(function(){var e,r,i;return Ae(this,(function(a){switch(a.label){case 0:return!n.serverProfile||n.serverProfile.managedBy?[3,1]:(r=n.serverProfile,[3,3]);case 1:return[4,this.profileService.getServerProfilesDetails({userId:n.serverProfile.managedBy,requiredFields:t.requiredFields}).toPromise()];case 2:r=a.sent(),a.label=3;case 3:return e=r,i=(new c.Request.Builder).withType(c.HttpRequestType.GET).withPath(this.profileServiceConfig.profileApiPath+"/managed/"+o).withParameters({withTokens:"true",sortBy:"createdDate",order:"desc"}).withBearerToken(!0).withUserToken(!0).build(),[4,this.apiService.fetch(i).toPromise().then((function(t){return Te([e],t.body.result.response.content.sort((function(e,t){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()})))}))];case 4:return[2,a.sent()]}}))}))})).pipe(Object(s.tap)((function(e){return me(p,void 0,void 0,(function(){var t,n,r,i,o;return Ae(this,(function(c){switch(c.label){case 0:return[4,this.dbService.execute("\n                                    SELECT * from "+a.f.TABLE_NAME+"\n                                    WHERE "+a.f.COLUMN_NAME_UID+"\n                                    IN ("+Y.a.joinPreservingQuotes(e.map((function(e){return e.id})))+")\n                                ").toPromise().then((function(e){return e.map((function(e){return b.mapProfileDBEntryToProfile(e)}))}))];case 1:for(t=c.sent(),n=e.filter((function(e){return!t.find((function(t){return t.uid===e.id}))})),r=0,i=n;r<i.length;r++)o=i[r],this.persistManagedProfile(o);return[2]}}))}))})))},[2,this.cachedItemStore[t.from===f.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](o,e.MANGED_SERVER_PROFILES_LOCAL_KEY,"ttl_"+e.MANGED_SERVER_PROFILES_LOCAL_KEY,(function(){return u()})).toPromise()]}}))}))}))})))},e.prototype.switchSessionToManagedProfile=function(e){var t=this,n=e.uid;return Object(l.defer)((function(){return me(t,void 0,void 0,(function(){var e,t,r,o,c,u,l,p=this;return Ae(this,(function(d){switch(d.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return e=d.sent(),t=Ce({},e),[4,D.a.log.end({type:"session",env:"sdk",mode:"switch-user",duration:Math.floor((Date.now()-(t.managedSession||t).createdTime)/1e3),correlationData:[{type:"InitiatorId",id:t.managedSession?t.managedSession.uid:t.uid},{type:"ManagedUserId",id:n}]}).toPromise()];case 2:return d.sent(),[4,function(){return me(p,void 0,void 0,(function(){return Ae(this,(function(e){return[2,this.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[n]}).toPromise().then((function(e){return e&&e[0]&&b.mapProfileDBEntryToProfile(e[0])}))]}))}))}()];case 3:if(!(r=d.sent()))throw new i.NoProfileFoundError("No Profile found with uid="+n);if(r.source!==i.ProfileSource.SERVER)throw new i.NoProfileFoundError("No Server Profile found with uid="+n);return e.uid!==n?[3,6]:(e.managedSession=void 0,[4,this.authService.getSession().toPromise()]);case 4:return(o=d.sent()).managed_access_token=void 0,[4,this.authService.setSession(new(function(){function e(){}return e.prototype.provide=function(){return me(this,void 0,void 0,(function(){return Ae(this,(function(e){return[2,o]}))}))},e}())).toPromise()];case 5:return d.sent(),[3,10];case 6:return e.managedSession=new i.ProfileSession(n),[4,this.getManagedServerProfiles({from:f.CachedItemRequestSourceFrom.CACHE,requiredFields:[]}).pipe(Object(s.take)(1)).toPromise()];case 7:return c=d.sent(),u=c.find((function(e){return e.id===n})),[4,this.authService.getSession().toPromise()];case 8:return(l=d.sent()).managed_access_token=u.managedToken,[4,this.authService.setSession(new(function(){function e(){}return e.prototype.provide=function(){return me(this,void 0,void 0,(function(){return Ae(this,(function(e){return[2,l]}))}))},e}())).toPromise()];case 9:d.sent(),d.label=10;case 10:return[4,this.sharedPreferences.putString(w.m.KEY_USER_SESSION,JSON.stringify(e)).toPromise()];case 11:return d.sent(),D.a.log.start({type:"session",env:"sdk",mode:"switch-user",correlationData:[{type:"InitiatorId",id:t.managedSession?t.managedSession.uid:t.uid},{type:"ManagedUserId",id:e.managedSession?e.managedSession.uid:e.uid}]}).toPromise(),[2]}}))}))})).pipe(Object(s.mergeMap)((function(){return t.authService.getSession().pipe(Object(s.mergeMap)((function(e){return t.authService.setSession(new(function(){function t(){}return t.prototype.provide=function(){return me(this,void 0,void 0,(function(){return Ae(this,(function(t){return[2,Ce(Ce({},e),{userToken:n})]}))}))},t}()))})))})),Object(s.mergeMap)((function(){return me(t,void 0,void 0,(function(){var e,t;return Ae(this,(function(r){switch(r.label){case 0:return[4,this.profileService.getServerProfilesDetails({userId:n,requiredFields:[]}).toPromise()];case 1:return e=r.sent(),t=e.rootOrg?e.rootOrg.hashTagId:e.rootOrgId,[2,this.frameworkService.setActiveChannelId(t).toPromise()]}}))}))})),Object(s.mapTo)(void 0))},e.prototype.persistManagedProfile=function(t){return me(this,void 0,void 0,(function(){return Ae(this,(function(n){return t.userId=t.id,t.rootOrg={hashTagId:t.rootOrgId},this.profileService.createProfile({uid:t.id,profileType:i.ProfileType.STUDENT,source:i.ProfileSource.SERVER,handle:t.firstName,board:t.framework&&t.framework.board||[],medium:t.framework&&t.framework.medium||[],grade:t.framework&&t.framework.gradeLevel||[],gradeValue:t.framework&&t.framework.gradeValue||"",subject:t.framework&&t.framework.subject||[],serverProfile:t},i.ProfileSource.SERVER).toPromise(),this.cachedItemStore.getCached(t.id,e.USER_PROFILE_DETAILS_KEY_PREFIX,e.USER_PROFILE_DETAILS_KEY_PREFIX,(function(){return Object(l.of)(t)})).toPromise(),[2]}))}))},e.prototype.createManagedProfile=function(e){return me(this,void 0,void 0,(function(){var t;return Ae(this,(function(n){switch(n.label){case 0:return[4,this.profileService.getActiveSessionProfile({requiredFields:[]}).toPromise()];case 1:if(n.sent().source!==i.ProfileSource.SERVER)throw new i.NoActiveSessionError("No active session available");return t=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.profileServiceConfig.profileApiPath_V2+"/managed/create").withBearerToken(!0).withUserToken(!0).withBody({request:e}).build(),[4,this.apiService.fetch(t).toPromise().then((function(e){return{uid:e.body.result.userId}}))];case 2:return[2,n.sent()]}}))}))},e.prototype.isLoggedInUser=function(){return me(this,void 0,void 0,(function(){return Ae(this,(function(e){switch(e.label){case 0:return[4,this.authService.getSession().toPromise()];case 1:return[2,!!e.sent()]}}))}))},e.MANGED_SERVER_PROFILES_LOCAL_KEY="managed_server_profiles-",e.USER_PROFILE_DETAILS_KEY_PREFIX="userProfileDetails",e}(),Ie=n(13),Me=n(30),we=n(28),De=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Pe=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Re=function(){function e(e){this.dbService=e}return e.prototype.delete=function(e){var t=this;return Object(l.defer)((function(){return Object(l.of)(t.dbService.beginTransaction())})).pipe(Object(s.mergeMap)((function(){return Object(l.zip)(t.dbService.delete({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:v.d.TABLE_NAME,selection:v.d.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:v.a.TABLE_NAME,selection:v.a.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:a.d.TABLE_NAME,selection:a.d.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:a.e.TABLE_NAME,selection:a.e.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:v.c.TABLE_NAME,selection:v.c.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:we.a.TABLE_NAME,selection:we.a.COLUMN_NAME_USER_ID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:a.b.TABLE_NAME,selection:a.b.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:a.g.TABLE_NAME,selection:a.g.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}),t.dbService.delete({table:Me.a.TABLE_NAME,selection:Me.a.COLUMN_NAME_USER_ID+" = ?",selectionArgs:[e]}),t.dbService.execute("DELETE  FROM "+K.a.TABLE_NAME+" \n                                            WHERE "+K.a.COLUMN_NAME_KEY+" \n                                            LIKE '%%"+e+"%%'")).pipe(Object(s.mapTo)(!0))})),Object(s.tap)((function(){return De(t,void 0,void 0,(function(){var t=this;return Pe(this,(function(n){switch(n.label){case 0:return[4,this.dbService.execute("SELECT * FROM "+K.a.TABLE_NAME+" \n                     WHERE "+K.a.COLUMN_NAME_KEY+" \n                     LIKE '%%userProfileDetails%%'").pipe(Object(s.map)((function(t){return t.filter((function(t){return JSON.parse(t.value).managedBy===e})).map((function(e){return JSON.parse(e.value).userId}))})),Object(s.mergeMap)((function(e){var n=t.dbService.execute("DELETE  FROM "+K.a.TABLE_NAME+" \n                            WHERE "+t.generateLikeQuery(e,K.a.COLUMN_NAME_KEY));return e.length?n.pipe(Object(s.mapTo)(e)):Object(l.of)(!0).pipe(Object(s.mapTo)(e))})),Object(s.mergeMap)((function(e){var n=t.dbService.execute("DELETE  FROM "+a.f.TABLE_NAME+" \n                            WHERE "+t.generateLikeQuery(e,a.f.COLUMN_NAME_UID));return e.length?n.pipe(Object(s.mapTo)(!0)):Object(l.of)(!0).pipe(Object(s.mapTo)(!0))}))).toPromise()];case 1:return n.sent(),[2]}}))}))})),Object(s.tap)((function(){t.dbService.endTransaction(!0)})),Object(s.catchError)((function(e){return console.error(e),t.dbService.endTransaction(!1),Object(l.of)(!1)})))},e.prototype.generateLikeQuery=function(e,t){for(var n="",r=t+" LIKE ",i=0;i<e.length;i++)n=i<e.length-1?n.concat(r,"'%%~"+e[i].toLowerCase().trim()+"~%%' OR "):n.concat(r,"'%%~"+e[i].toLowerCase().trim()+"~%%' ");return"("+n+")"},e}(),Le=function(){function e(e,t){this.apiService=e,this.profileServiceConfig=t,this.DELETE_ENDPOINT="/delete"}return e.prototype.handle=function(e){var t=(new c.Request.Builder).withType(c.HttpRequestType.POST).withPath(this.profileServiceConfig.profileApiPath+this.DELETE_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return"SUCCESS"===e.body.result.response})))},e}(),je=function(){return(je=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ue=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xe=function(e,t){return function(n,r){t(n,r,e)}},Fe=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Be=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Ve=function(){function e(e,t,n,r,i,o,a,c,s,u,f,l){this.container=e,this.sdkConfig=t,this.dbService=n,this.apiService=r,this.cachedItemStore=i,this.keyValueStore=o,this.sharedPreferences=a,this.frameworkService=c,this.fileService=s,this.deviceInfo=u,this.authService=f,this.userService=l,this.apiConfig=this.sdkConfig.apiConfig,this.profileServiceConfig=this.sdkConfig.profileServiceConfig,this.managedProfileManager=new Ne(this,this.authService,this.sdkConfig.profileServiceConfig,this.apiService,this.cachedItemStore,this.dbService,this.frameworkService,this.sharedPreferences)}var t;return t=e,Object.defineProperty(e.prototype,"telemetryService",{get:function(){return this.container.get(p.b.TELEMETRY_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.preInit=function(){var e=this;return this.sharedPreferences.getString(t.KEY_USER_SESSION).pipe(Object(s.map)((function(e){return e&&JSON.parse(e)})),Object(s.mergeMap)((function(t){if(!t){var n={uid:"",handle:"",profileType:i.ProfileType.TEACHER,source:i.ProfileSource.LOCAL};return e.createProfile(n).pipe(Object(s.mergeMap)((function(t){return e.setActiveSessionForProfile(t.uid)})),Object(s.mapTo)(void 0))}return t.managedSession?e.managedProfileManager.switchSessionToManagedProfile({uid:t.managedSession.uid}):e.setActiveSessionForProfile(t.uid).pipe(Object(s.mapTo)(void 0))})))},e.prototype.checkServerProfileExists=function(e){return this.userService.checkUserExists(e.matching,e.captchaResponseToken?{token:e.captchaResponseToken,app:"1"}:void 0)},e.prototype.createProfile=function(e,t){var n=this;switch(void 0===t&&(t=i.ProfileSource.LOCAL),t){case i.ProfileSource.LOCAL:if(e.source!==i.ProfileSource.LOCAL)throw new g("Invalid value supplied for field 'source': "+e.source);if(e.serverProfile)throw new g("Invalid value supplied for field 'serverProfile': "+e.serverProfile);e.uid=C.a.generateUniqueId();break;case i.ProfileSource.SERVER:if(e.source!==i.ProfileSource.SERVER)throw new g("Invalid value supplied for field 'source': "+e.source);if(!e.serverProfile)throw new g("Invalid value supplied for field 'serverProfile': "+e.serverProfile);if(!e.uid)throw new g("Invalid value supplied for field 'uid': "+e.uid)}return e.createdAt=Date.now(),this.dbService.insert({table:a.f.TABLE_NAME,modelJson:b.mapProfileToProfileDBEntry(e)}).pipe(Object(s.tap)((function(){return Fe(n,void 0,void 0,(function(){var t=this;return Be(this,(function(n){switch(n.label){case 0:return[4,this.getActiveProfileSession().pipe(Object(s.map)((function(e){return e.uid})),Object(s.catchError)((function(t){return t instanceof i.NoActiveSessionError?Object(l.of)(e.uid):Object(l.throwError)(t)})),Object(s.mergeMap)((function(n){var r=new J.Actor;r.id=n,r.type=J.Actor.TYPE_SYSTEM;var i={env:"sdk",actor:r,currentState:J.AuditState.AUDIT_CREATED,updatedProperties:ye.a.getTruthyProps(e),objId:e.uid,objType:J.ObjectType.USER,correlationData:[{id:e.profileType,type:"UserRole"}]};return t.telemetryService.audit(i)}))).toPromise()];case 1:return n.sent(),[2]}}))}))})),Object(s.mergeMap)((function(){return Object(l.of)(e)})))},e.prototype.deleteProfile=function(e){var t=this;return this.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e]}).pipe(Object(s.map)((function(t){if(!t||!t[0])throw new i.NoProfileFoundError("No Profile found with ID "+e);return b.mapProfileDBEntryToProfile(t[0])})),Object(s.tap)((function(n){return Fe(t,void 0,void 0,(function(){var t=this;return Be(this,(function(r){switch(r.label){case 0:return[4,this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(r){var i=new J.Actor;i.id=r.uid,i.type=J.Actor.TYPE_SYSTEM;var o={env:"sdk",actor:i,currentState:J.AuditState.AUDIT_DELETED,objId:e,objType:J.ObjectType.USER,correlationData:[{id:n.profileType,type:"UserRole"}]};return t.telemetryService.audit(o)}))).toPromise()];case 1:return[2,r.sent()]}}))}))})),Object(s.mergeMap)((function(){return t.dbService.delete({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e]})})))},e.prototype.updateProfile=function(e){var t=this;return this.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e.uid]}).pipe(Object(s.map)((function(t){if(!t||!t[0])throw new i.NoProfileFoundError("No Profile found with ID "+e.uid);return b.mapProfileDBEntryToProfile(t[0])})),Object(s.tap)((function(n){return Fe(t,void 0,void 0,(function(){var t=this;return Be(this,(function(r){switch(r.label){case 0:return[4,this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(r){var i=new J.Actor;i.id=r.uid,i.type=J.Actor.TYPE_SYSTEM;var o={env:"sdk",actor:i,currentState:J.AuditState.AUDIT_UPDATED,updatedProperties:ye.a.getPropDiff(e,n),objId:e.uid,objType:J.ObjectType.USER,correlationData:[{id:e.profileType,type:"UserRole"}]};return t.telemetryService.audit(o)}))).toPromise()];case 1:return r.sent(),[2]}}))}))})),Object(s.mergeMap)((function(){var n=b.mapProfileToProfileDBEntry(e);return delete n[a.f.COLUMN_NAME_CREATED_AT],t.dbService.update({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e.uid],modelJson:n}).pipe(Object(s.mergeMap)((function(){return Object(l.of)(e)})))})))},e.prototype.updateServerProfile=function(e){return this.userService.updateProfile(e,{apiPath:"/api/user/v3"})},e.prototype.getTenantInfo=function(e){return new u(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.prototype.getAllProfiles=function(e){var t=this;return e?e.groupId?e.groupId&&(e.local||e.server)?this.dbService.execute("\n                SELECT * FROM "+a.f.TABLE_NAME+" LEFT JOIN "+a.b.TABLE_NAME+"\n                ON "+a.f.TABLE_NAME+"."+a.f.COLUMN_NAME_UID+" =\n                "+a.b.TABLE_NAME+"."+a.b.COLUMN_NAME_UID+"\n                WHERE "+a.b.COLUMN_NAME_GID+' = "'+e.groupId+'" AND\n                '+a.f.COLUMN_NAME_SOURCE+' = "'+(e.local?i.ProfileSource.LOCAL:i.ProfileSource.SERVER)+'"\n            ').pipe(Object(s.map)((function(e){return t.mapDbProfileEntriesToProfiles(e)}))):this.dbService.execute("\n            SELECT * FROM "+a.f.TABLE_NAME+"\n            LEFT JOIN "+a.b.TABLE_NAME+" ON\n            "+a.f.TABLE_NAME+"."+a.f.COLUMN_NAME_UID+" =\n            "+a.b.TABLE_NAME+"."+a.b.COLUMN_NAME_UID+"\n            WHERE "+a.b.TABLE_NAME+"."+a.b.COLUMN_NAME_GID+' = "'+e.groupId+'"\n        ').pipe(Object(s.map)((function(e){return t.mapDbProfileEntriesToProfiles(e)}))):this.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_SOURCE+" = ?",selectionArgs:[e.local?i.ProfileSource.LOCAL:i.ProfileSource.SERVER],columns:[]}).pipe(Object(s.map)((function(e){return t.mapDbProfileEntriesToProfiles(e)}))):this.dbService.read({table:a.f.TABLE_NAME,columns:[]}).pipe(Object(s.map)((function(e){return t.mapDbProfileEntriesToProfiles(e)})))},e.prototype.getServerProfilesDetails=function(e){return new E(this.cachedItemStore,this.keyValueStore,this.container,this.profileServiceConfig).handle(e)},e.prototype.getActiveSessionProfile=function(e){var t=this,n=e.requiredFields;return this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(e){return t.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e.managedSession?e.managedSession.uid:e.uid]}).pipe(Object(s.map)((function(t){var n=t&&t[0];if(!n)throw new i.NoProfileFoundError("No profile found for profileSession with uid "+(e.managedSession?e.managedSession.uid:e.uid));return b.mapProfileDBEntryToProfile(n)})),Object(s.mergeMap)((function(e){return e.source===i.ProfileSource.SERVER?t.getServerProfilesDetails({userId:e.uid,requiredFields:n}).pipe(Object(s.map)((function(t){return je(je({},e),{handle:t.firstName+(t.lastName?" "+t.lastName:""),serverProfile:t})}))):Object(l.of)(e)})))})))},e.prototype.setActiveSessionForProfile=function(e){var n=this;return Object(l.defer)((function(){return n.generateSessionEndTelemetry()})).pipe(Object(s.mergeMap)((function(){return n.dbService.read({table:a.f.TABLE_NAME,selection:a.f.COLUMN_NAME_UID+" = ?",selectionArgs:[e]})})),Object(s.map)((function(e){return e&&e[0]&&b.mapProfileDBEntryToProfile(e[0])})),Object(s.map)((function(e){if(!e)throw new i.NoProfileFoundError("No Profile found");return e})),Object(s.mergeMap)((function(e){return Object(l.iif)((function(){return e.source===i.ProfileSource.SERVER}),Object(l.defer)((function(){return n.getServerProfilesDetails({userId:e.uid,requiredFields:[]}).pipe(Object(s.map)((function(t){return je(je({},e),{serverProfile:t})})),Object(s.mergeMap)((function(e){return n.frameworkService.setActiveChannelId(e.serverProfile.rootOrg.hashTagId)})),Object(s.catchError)((function(){return Object(l.of)(void 0)})))})),n.frameworkService.setActiveChannelId(n.sdkConfig.apiConfig.api_authentication.channelId).pipe(Object(s.mapTo)(void 0))).pipe(Object(s.mapTo)(e))})),Object(s.mergeMap)((function(e){var r=new i.ProfileSession(e.uid);return Ie.CsModule.instance.isInitialised&&Ie.CsModule.instance.updateConfig(je(je({},Ie.CsModule.instance.config),{core:je(je({},Ie.CsModule.instance.config.core),{global:je(je({},Ie.CsModule.instance.config.core.global),{sessionId:r.sid})})})),n.sharedPreferences.putString(t.KEY_USER_SESSION,JSON.stringify(r)).pipe(Object(s.mapTo)(!0))})),Object(s.tap)((function(){return Fe(n,void 0,void 0,(function(){return Be(this,(function(e){switch(e.label){case 0:return[4,this.generateSessionStartTelemetry()];case 1:return[2,e.sent()]}}))}))})))},e.prototype.getActiveProfileSession=function(){return this.sharedPreferences.getString(t.KEY_USER_SESSION).pipe(Object(s.map)((function(e){if(e)return JSON.parse(e);throw new i.NoActiveSessionError("No active session available")})))},e.prototype.acceptTermsAndConditions=function(e){return new y(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.prototype.isProfileAlreadyInUse=function(e){return new m(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.prototype.generateOTP=function(e){return new A(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.prototype.verifyOTP=function(e){return new T(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.prototype.searchLocation=function(e){return new I(this.apiService,this.sdkConfig.profileServiceConfig,this.fileService,this.cachedItemStore).handle(e)},e.prototype.getAllContentAccess=function(e){var t="SELECT * FROM "+v.a.TABLE_NAME+" "+M.a.getUidnIdentifierFiler(e.uid,e.contentId);return this.dbService.execute(t).pipe(Object(s.map)((function(e){return e.map((function(e){return _.mapDBEntryToContenetAccess(e)}))})))},e.prototype.addContentAccess=function(e){var t=this;return this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(n){var r=n.uid;return t.dbService.read({table:v.a.TABLE_NAME,selection:v.a.COLUMN_NAME_UID+"= ? AND "+v.a.COLUMN_NAME_CONTENT_IDENTIFIER+"= ?",selectionArgs:[r,e.contentId],orderBy:v.a.COLUMN_NAME_EPOCH_TIMESTAMP+" DESC",limit:"1"}).pipe(Object(s.mergeMap)((function(n){var o={uid:r,identifier:e.contentId,epoch_timestamp:Date.now(),status:i.ContentAccessStatus.PLAYED.valueOf(),content_type:e.contentType&&e.contentType.toLowerCase(),learner_state:e.contentLearnerState&&JSON.stringify(e.contentLearnerState.learnerState)};return n&&n.length?(o.status=n[0][v.a.COLUMN_NAME_STATUS],t.dbService.update({table:v.a.TABLE_NAME,selection:v.a.COLUMN_NAME_UID+"= ? AND "+v.a.COLUMN_NAME_CONTENT_IDENTIFIER+"= ?",selectionArgs:[r,e.contentId],modelJson:o}).pipe(Object(s.map)((function(e){return e>0})))):t.dbService.insert({table:v.a.TABLE_NAME,modelJson:o}).pipe(Object(s.map)((function(e){return e>0})))})))})))},e.prototype.exportProfile=function(e){var t=this,n={userIds:e.userIds,destinationFolder:e.destinationFolder,groupIds:e.groupIds};return Object(l.from)(new j(this.fileService).execute(n).then((function(e){return new x(t.dbService).execute(e.body)})).then((function(e){return new G(t.dbService,t.fileService,t.deviceInfo).execute(e.body)})).then((function(e){return new X(t.dbService,t.fileService).execute(e.body).catch((function(){return e}))})).then((function(e){return new $(t.dbService).execute(e.body)})).then((function(e){return{exportedFilePath:e.body.destinationDBFilePath}})))},e.prototype.importProfile=function(e){var t=this,n={sourceDBFilePath:e.sourceFilePath};return Object(l.from)(new Z(this.dbService).execute(n).then((function(e){return new ne(t.dbService).execute(e.body)})).then((function(e){return new Se(t.dbService).execute(e.body)})).then((function(e){return new oe(t.dbService).execute(e.body)})).then((function(e){return new se(t.dbService).execute(e.body)})).then((function(e){return new le(t.dbService).execute(e.body)})).then((function(e){return new Ee(t.dbService).execute(e.body)})).then((function(e){return new be(t.dbService).execute(e.body)})).then((function(e){return new Q(t.dbService).execute(e.body)})).then((function(e){return{failed:e.body.failed,imported:e.body.imported}})))},e.prototype.mergeServerProfiles=function(e){var n=this,r=(new c.Request.Builder).withType(c.HttpRequestType.PATCH).withPath(t.MERGE_SERVER_PROFILES_PATH).withBearerToken(!0).withHeaders({"x-source-user-token":e.from.accessToken,"x-authenticated-user-token":e.to.accessToken}).withBody({request:{fromAccountId:e.from.userId,toAccountId:e.to.userId}}).build();return this.apiService.fetch(r).pipe(Object(s.map)((function(e){console.log(e)})),Object(s.finalize)((function(){var e=n.sdkConfig.apiConfig.user_authentication.mergeUserHost+n.sdkConfig.apiConfig.user_authentication.authUrl+"/logout?redirect_uri="+n.sdkConfig.apiConfig.host+"/oauth2callback",t=cordova.InAppBrowser.open(e,"_blank","zoom=no,hidden=yes");t.addEventListener("loadstart",(function(e){return Fe(n,void 0,void 0,(function(){return Be(this,(function(n){return e.url.indexOf("/oauth2callback")>-1&&t.close(),[2]}))}))}))})))},e.prototype.isDefaultChannelProfile=function(){return Object(l.zip)(this.frameworkService.getDefaultChannelId(),this.frameworkService.getActiveChannelId()).pipe(Object(s.map)((function(e){return e[0]===e[1]})))},e.prototype.getUserFeed=function(){var e=this;return this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(t){return e.userService.getUserFeed(t.managedSession?t.managedSession.uid:t.uid,{apiPath:e.sdkConfig.profileServiceConfig.profileApiPath_V5})})))},e.prototype.updateUserFeedEntry=function(e){var t=this;return this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(n){return t.userService.updateUserFeedEntry(n.managedSession?n.managedSession.uid:n.uid,e.feedEntryId,e.category,e.request,{apiPath:t.sdkConfig.profileServiceConfig.profileApiPath_V5}).pipe(Object(s.mapTo)(!0),Object(s.catchError)((function(){return Object(l.of)(!1)})))})))},e.prototype.deleteUserFeedEntry=function(e){var t=this;return this.getActiveProfileSession().pipe(Object(s.mergeMap)((function(n){return t.userService.deleteUserFeedEntry(n.managedSession?n.managedSession.uid:n.uid,e.feedEntryId,e.category,{apiPath:t.sdkConfig.profileServiceConfig.profileApiPath}).pipe(Object(s.mapTo)(!0),Object(s.catchError)((function(){return Object(l.of)(!1)})))})))},e.prototype.userMigrate=function(e){return new ge(this.sdkConfig,this.apiService).handle(e)},e.prototype.updateServerProfileDeclarations=function(e){return this.userService.updateUserDeclarations(e.declarations,{apiPath:this.sdkConfig.profileServiceConfig.profileApiPath})},e.prototype.getConsent=function(e){return this.userService.getConsent(e,{apiPath:this.sdkConfig.profileServiceConfig.profileApiPath_V2})},e.prototype.updateConsent=function(e){return this.userService.updateConsent(e,{apiPath:this.sdkConfig.profileServiceConfig.profileApiPath})},e.prototype.mapDbProfileEntriesToProfiles=function(e){return e.map((function(e){return b.mapProfileDBEntryToProfile(e)}))},e.prototype.generateSessionStartTelemetry=function(){return Fe(this,void 0,void 0,(function(){return Be(this,(function(e){return[2,D.a.log.start({type:"session",env:"sdk"}).toPromise()]}))}))},e.prototype.generateSessionEndTelemetry=function(){return Fe(this,void 0,void 0,(function(){var e,n;return Be(this,(function(r){switch(r.label){case 0:return[4,this.sharedPreferences.getString(t.KEY_USER_SESSION).toPromise()];case 1:return(e=r.sent())?(n=JSON.parse(e),[4,D.a.log.end({type:"session",env:"sdk",duration:Math.floor((Date.now()-n.createdTime)/1e3)}).toPromise()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.deleteProfileData=function(e){return new Re(this.dbService).delete(e)},e.prototype.deleteUser=function(e){return new Le(this.apiService,this.sdkConfig.profileServiceConfig).handle(e)},e.KEY_USER_SESSION=w.m.KEY_USER_SESSION,e.MERGE_SERVER_PROFILES_PATH="/api/user/v1/account/merge",e=t=Ue([Object(Oe.injectable)(),xe(0,Object(Oe.inject)(p.b.CONTAINER)),xe(1,Object(Oe.inject)(p.b.SDK_CONFIG)),xe(2,Object(Oe.inject)(p.b.DB_SERVICE)),xe(3,Object(Oe.inject)(p.b.API_SERVICE)),xe(4,Object(Oe.inject)(p.b.CACHED_ITEM_STORE)),xe(5,Object(Oe.inject)(p.b.KEY_VALUE_STORE)),xe(6,Object(Oe.inject)(p.b.SHARED_PREFERENCES)),xe(7,Object(Oe.inject)(p.b.FRAMEWORK_SERVICE)),xe(8,Object(Oe.inject)(p.b.FILE_SERVICE)),xe(9,Object(Oe.inject)(p.b.DEVICE_INFO)),xe(10,Object(Oe.inject)(p.b.AUTH_SERVICE)),xe(11,Object(Oe.inject)(p.a.USER_SERVICE)),ke("design:paramtypes",[Oe.Container,Object,o.DbService,Object,Object,Object,Object,Object,Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return oe}));var r=n(36),i=n(3),o=n(7),a=n(0),c=function(){function e(e,t){this.apiService=e,this.courseServiceConfig=t,this.GET_BATCH_DETAILS_ENDPOINT="/batch/read/"}return e.prototype.handle=function(e){var t=(new o.Request.Builder).withType(o.HttpRequestType.GET).withPath(this.courseServiceConfig.apiPath+this.GET_BATCH_DETAILS_ENDPOINT+e.batchId).withBearerToken(!0).withUserToken(!0).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){return e.body.result.response})))},e}(),s=n(107),u=function(){function e(e,t){this.apiService=e,this.courseServiceConfig=t,this.GET_COURSE_BATCHES="/batch/list?creatorDetails"}return e.prototype.handle=function(e){var t=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(this.courseServiceConfig.apiPath+this.GET_COURSE_BATCHES).withBearerToken(!0).withUserToken(!1).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){return Array.from(new Set(e.body.result.response.content))})))},e}(),f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},p=function(){function e(e,t,n,r,i){this.keyValueStore=e,this.apiService=t,this.courseServiceConfig=n,this.sharedPreference=r,this.apiHandler=i,this.GET_ENROLLED_COURSES_ENDPOINT="/user/enrollment/list/",this.STORED_ENROLLED_COURSES_PREFIX="enrolledCourses"}return e.prototype.handle=function(e){var t=this;return this.keyValueStore.getValue(this.STORED_ENROLLED_COURSES_PREFIX+e.userId).pipe(Object(a.mergeMap)((function(n){if(n){if(e.returnFreshCourses)return t.fetchFromServer(e).pipe(Object(a.mergeMap)((function(n){return t.keyValueStore.setValue(t.STORED_ENROLLED_COURSES_PREFIX+e.userId,JSON.stringify(n)).pipe(Object(a.mapTo)(n.result.courses),Object(a.tap)((function(e){return Object(i.from)(t.updateLastPlayedContent(e))})))})),Object(a.catchError)((function(){var e,t=JSON.parse(n),r=t.result;return e=r&&r.hasOwnProperty("courses")?r.courses:t.courses,Object(i.of)(e)})));var r=JSON.parse(n),o=r.result,c=void 0;return c=o&&o.hasOwnProperty("courses")?o.courses:r.courses,Object(i.of)(c)}return t.fetchFromServer(e).pipe(Object(a.mergeMap)((function(n){return t.keyValueStore.setValue(t.STORED_ENROLLED_COURSES_PREFIX+e.userId,JSON.stringify(n)).pipe(Object(a.mapTo)(n.result.courses),Object(a.tap)((function(e){return Object(i.from)(t.updateLastPlayedContent(e))})))})))})))},e.prototype.updateLastPlayedContent=function(e){return f(this,void 0,void 0,(function(){var t,n,i,o,a;return l(this,(function(c){switch(c.label){case 0:t=0,n=e,c.label=1;case 1:return t<n.length?(i=n[t],o=r.CourseServiceImpl.LAST_READ_CONTENTID_PREFIX.concat("_").concat(i.userId).concat("_").concat(i.contentId).concat("_").concat(i.batchId),a=i.lastReadContentId,i.lastReadContentId?[4,this.sharedPreference.putString(o,a).toPromise()]:[3,3]):[3,4];case 2:c.sent(),c.label=3;case 3:return t++,[3,1];case 4:return[2,Promise.resolve(!0)]}}))}))},e.prototype.fetchFromServer=function(e){if(this.apiHandler)return this.apiHandler.handle(e);var t=(new o.Request.Builder).withType(o.HttpRequestType.GET).withPath(this.courseServiceConfig.apiPath+this.GET_ENROLLED_COURSES_ENDPOINT+e.userId+"?orgdetails=orgName,email&fields=contentType,topic,name,channel,pkgVersion,primaryCategory,trackable&batchDetails=name,endDate,startDate,status,enrollmentType,createdBy,certificates").withBearerToken(!0).withUserToken(!0).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){return e.body})))},e}(),d=n(35),h=n(10),E=function(){function e(e,t){this.apiService=e,this.courseServiceConfig=t,this.ENROL_ENDPOINT="/enrol"}return e.prototype.handle=function(e){var t=this;delete e.batchStatus;var n=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(this.courseServiceConfig.apiPath+this.ENROL_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(n).pipe(Object(a.map)((function(e){return"SUCCESS"===e.body.result.response})),Object(a.tap)((function(){t.generateAuditTelemetry(e)})))},e.prototype.generateAuditTelemetry=function(e){var t=new h.Actor;t.id=e.userId,t.type=h.Actor.TYPE_USER;var n=[{type:"CourseId",id:e.courseId},{type:"BatchId",id:e.batchId},{type:"UserId",id:e.userId}],r={env:"course",actor:t,currentState:h.AuditState.AUDIT_CREATED,updatedProperties:["courseId","userId","batchId"],objId:e.courseId,objType:"Course",rollUp:{l1:e.courseId},correlationData:n,type:"enrollment"};d.a.log.audit(r).toPromise()},e}(),b=n(21),y=function(){function e(e,t){this.apiService=e,this.unenrollCourseServiceApiConfig=t,this.GET_UNENROLL_COURSE_ENDPOINT="/unenrol"}return e.prototype.handle=function(e){var t=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(this.unenrollCourseServiceApiConfig.apiPath+this.GET_UNENROLL_COURSE_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:e}).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){return"SUCCESS"===e.body.result.response})))},e}(),v=n(1),_=n(11),S=n(5),O=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},g=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},C=function(){function e(e,t,n){this.apiService=e,this.courseServiceConfig=t,this.container=n}return Object.defineProperty(e.prototype,"csCourseService",{get:function(){return this.container.get(S.a.COURSE_SERVICE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentService",{get:function(){return this.container.get(S.b.CONTENT_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.handle=function(e){var t=this;return delete e.returnRefreshedContentStates,Object(i.iif)((function(){return!e.contentIds||!e.contentIds.length}),Object(i.defer)((function(){return O(t,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return t=e,[4,this.contentService.getContentDetails({contentId:e.courseId}).toPromise().then((function(e){return e.contentData.leafNodes||[]}))];case 1:return t.contentIds=n.sent(),[2,this.fetchFromApi(e).toPromise()]}}))}))})),Object(i.defer)((function(){return t.fetchFromApi(e)})))},e.prototype.fetchFromApi=function(e){return e.contentIds&&!e.contentIds.length&&delete e.contentIds,this.csCourseService.getContentState(e).pipe(Object(a.map)((function(e){return{contentList:e}})))},e}(),m=n(14),A=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},T=function(){function e(e,t){this.keyValueStore=e,this.offlineContentStateHandler=t}return e.prototype.updateEnrollCourses=function(t){var n=this,r=e.GET_ENROLLED_COURSES_KEY_PREFIX.concat(t.userId);return this.offlineContentStateHandler.getLocalContentStateResponse(t).pipe(Object(a.mergeMap)((function(e){return n.keyValueStore.getValue(r).pipe(Object(a.mergeMap)((function(o){if(o){var c=JSON.parse(o),s=c.result,u=void 0;u=s&&s.hasOwnProperty("courses")?s.courses:c.courses;var f=A(u);return u.forEach((function(n){if(n.courseId===t.courseId&&n.batchId===t.batchId){var r=n;e.contentList.forEach((function(e){if(2===e.status){var t=n.contentsPlayedOffline;t||(t=[]),t.push(e.contentId),r.contentsPlayedOffline=m.a.deDupe(t)}}));var i=f.findIndex((function(e){return e.contentId===n.contentId&&e.batchId===n.batchId}));f.splice(i,1,r)}})),f&&f.length?(s&&s.hasOwnProperty("courses")?s.courses=f:c.courses=f,n.keyValueStore.setValue(r,JSON.stringify(c)).pipe(Object(a.map)((function(){return e})))):Object(i.of)(e)}return Object(i.of)(e)})))})))},e.GET_ENROLLED_COURSES_KEY_PREFIX="enrolledCourses",e}(),N=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},I=function(){function e(e){this.keyValueStore=e}return e.prototype.getLocalContentStateResponse=function(e){var t=r.CourseServiceImpl.GET_CONTENT_STATE_KEY_PREFIX.concat(e.userId,e.courseId);return this.keyValueStore.getValue(t).pipe(Object(a.map)((function(e){var t={contentList:[]};if(e){var n=JSON.parse(e),r=n.result;return r&&r.hasOwnProperty("contentList")?(t.contentList=r.contentList,t):(t.contentList=n.contentList,t)}return t.contentList=t.contentList.map((function(e){return"string"==typeof e.score&&(e.score=void 0),e})),t})))},e.prototype.manipulateEnrolledCoursesResponseLocally=function(e){var t=this,n=r.CourseServiceImpl.GET_ENROLLED_COURSE_KEY_PREFIX.concat(e.userId);return this.keyValueStore.getValue(n).pipe(Object(a.mergeMap)((function(r){if(r){var o=JSON.parse(r),a=o.result,c=void 0;if((c=a&&a.hasOwnProperty("courses")?a.courses:o.courses)&&c.length){var s=N(c);return c.forEach((function(n){if(n.courseId===e.courseId&&n.batchId===e.batchId&&(n.contentsPlayedOffline&&n.contentsPlayedOffline.length||(n.contentsPlayedOffline=[]),1!==e.status&&(0===n.contentsPlayedOffline.length||n.contentsPlayedOffline.length>0&&!m.a.contains(n.contentsPlayedOffline,e.contentId)))){n.progress=n.progress?n.progress:0,n.progress=n.progress+1,n.completionPercentage=t.getCourseCompletionPercentage(n.leafNodesCount,n.progress);var r=n,i=r.contentsPlayedOffline;i||(i=[]),i.push(e.contentId),r.contentsPlayedOffline=i,r.progress=n.progress,r.completionPercentage=n.completionPercentage;var o=s.findIndex((function(e){return e.contentId===n.contentId||e.batchId===n.batchId}));s.splice(o,1,r)}})),s&&s.length?(a&&a.hasOwnProperty("courses")?a.courses=s:o.courses=s,t.keyValueStore.setValue(n,JSON.stringify(o))):Object(i.of)(!1)}return Object(i.of)(!1)}return Object(i.of)(!1)})))},e.prototype.manipulateGetContentStateResponseLocally=function(e){var t=this,n=r.CourseServiceImpl.GET_CONTENT_STATE_KEY_PREFIX.concat(e.userId,e.courseId);return this.keyValueStore.getValue(n).pipe(Object(a.mergeMap)((function(r){if(r){var o={contentList:[]},a=JSON.parse(r),c=a.result;if(c&&c.hasOwnProperty("contentList")?o.contentList=c.contentList:o.contentList=a.contentList,o){var s,u=o.contentList;return u&&u.length?(u.forEach((function(n){n.contentId===e.contentId?n.status!==e.status&&(e.score=n.score,e.bestScore=n.bestScore,s=t.getContentState(e),u=u.filter((function(e){return e.contentId!==n.contentId}))):s=t.getContentState(e)})),s?(u.push(s),o.contentList=u,t.keyValueStore.setValue(n,JSON.stringify(o))):Object(i.of)(!1)):(s=t.getContentState(e),(u=[]).push(s),o.contentList=u,t.keyValueStore.setValue(n,JSON.stringify(o)))}return Object(i.of)(!1)}return Object(i.of)(!1)})))},e.prototype.getCourseCompletionPercentage=function(e,t){if(0===e||void 0===e)return 0;var n=t/e*100;return isNaN(n)?0:n>100?100:Math.floor(n)},e.prototype.getContentState=function(e){return{id:e.userId,userId:e.userId,courseId:e.courseId,contentId:e.contentId,batchId:e.batchId,result:e.result,grade:e.grade,score:e.score,bestScore:e.bestScore,status:e.status,progress:e.progress}},e}(),M=function(){function e(){}return e.getUpdateContentStateRequest=function(e){var t=[];return t.push(this.getRequestMap(e)),{userId:e.userId,contents:t}},e.getUpdateContentStateListRequest=function(e,t){var n=this,r=[];return t.forEach((function(e){r.push(n.getRequestMap(e))})),{userId:e,contents:r}},e.getRequestMap=function(e){var t={userId:e.userId,contentId:e.contentId,courseId:e.courseId,batchId:e.batchId,status:e.status,progress:e.progress};return e.result&&(t.result=e.result),e.grade&&(t.grade=e.grade),e.score&&(t.score=e.score),t},e}(),w=n(6),D=n(42),P=n(312),R=n(29),L=n(23),j=n(52),U=n(31),k=n(40),x=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},F=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},B=function(){function e(e,t,n,r){this.courseService=e,this.sdkConfig=t,this.dbService=n,this.networkQueue=r,this.capturedAssessmentEvents={}}return e.prototype.handle=function(e){var t=this;return this.capturedAssessmentEvents=e,Object(i.from)(this.syncCapturedAssessmentEvents().then((function(){t.capturedAssessmentEvents={}})).then((function(){return t.syncPersistedAssessmentEvents()})).catch((function(e){Object.keys(t.capturedAssessmentEvents).forEach((function(e){var n=JSON.parse(e);t.capturedAssessmentEvents[e].forEach((function(e){2!==n.batchStatus&&t.persistAssessEvent(e,n).toPromise()}))}))}))).pipe(Object(a.mapTo)(void 0))},e.prototype.invokeSyncApi=function(e){var t=this;return console.log("COURSE_ASSESSMENT_INVOKED_SYNC----------------------------------------------",e.assessments.map((function(e){return{assessmentTs:e.assessmentTs,userId:e.userId,contentId:e.contentId,courseId:e.courseId,batchId:e.batchId,attemptId:e.attemptId,events:e.events.length}}))),this.networkQueue.enqueue(new j.a(this.sdkConfig).generateNetworkQueueRequest(L.b.COURSE_ASSESMENT,{request:e},U.a.generateUniqueId(),0,!0),!0).pipe(Object(a.mergeMap)((function(){return new i.Observable((function(e){sbsync.onSyncSucces((function(n){return x(t,void 0,void 0,(function(){var t,r;return F(this,(function(i){return t=n.courseAssesmentResponse,r=n.course_assesment_error,t?e.next(t):r&&e.error(r),e.complete(),[2]}))}))}),(function(n){return x(t,void 0,void 0,(function(){return F(this,(function(t){return e.error(n),[2]}))}))}))}))}))).toPromise()},e.prototype.persistAssessEvent=function(e,t){var n;return this.dbService.insert({table:R.a.TABLE_NAME,modelJson:(n={},n[R.a.COLUMN_NAME_ASSESSMENT_EVENT]=JSON.stringify(e),n[R.a.COLUMN_NAME_CONTENT_ID]=e.object.id,n[R.a.COLUMN_NAME_CREATED_AT]=e.ets,n[R.a.COLUMN_NAME_USER_ID]=t.userId,n[R.a.COLUMN_NAME_COURSE_ID]=t.courseId,n[R.a.COLUMN_NAME_BATCH_ID]=t.batchId,n)}).pipe(Object(a.mapTo)(void 0))},e.prototype.syncCapturedAssessmentEvents=function(){return x(this,void 0,void 0,(function(){var e,t=this;return F(this,(function(n){return(e=Object.keys(this.capturedAssessmentEvents).reduce((function(e,n){var r=JSON.parse(n),i=t.capturedAssessmentEvents[n];e.userId||(e.userId=r.userId);var o={contentId:i[0].object.id,courseId:r.courseId,batchId:r.batchId,status:2};e.contents.find((function(e){return k.a.equals(e,o)}))||e.contents.push(o);var a=i.reduce((function(e,t){return t.ets<e?t.ets:e}),i[0].ets);return e.assessments.push({assessmentTs:a,userId:r.userId,contentId:i[0].object.id,courseId:r.courseId,batchId:r.batchId,attemptId:t.courseService.generateAssessmentAttemptId({courseId:r.courseId,batchId:r.batchId,contentId:i[0].object.id,userId:r.userId,date:a}),events:i}),e}),{userId:"",contents:[],assessments:[]})).userId&&e.contents.length&&e.assessments.length?[2,this.invokeSyncApi(e)]:[2]}))}))},e.prototype.syncPersistedAssessmentEvents=function(){return x(this,void 0,void 0,(function(){var e=this;return F(this,(function(t){return this.dbService.execute("\n            SELECT\n                "+R.a.COLUMN_NAME_USER_ID+",\n                "+R.a.COLUMN_NAME_CONTENT_ID+",\n                "+R.a.COLUMN_NAME_COURSE_ID+",\n                "+R.a.COLUMN_NAME_BATCH_ID+",\n                MIN("+R.a.COLUMN_NAME_CREATED_AT+") as first_ts,\n                GROUP_CONCAT("+R.a.COLUMN_NAME_ASSESSMENT_EVENT+",',') as events\n            FROM "+R.a.TABLE_NAME+"\n            GROUP BY\n                "+R.a.COLUMN_NAME_USER_ID+",\n                "+R.a.COLUMN_NAME_CONTENT_ID+",\n                "+R.a.COLUMN_NAME_COURSE_ID+",\n                "+R.a.COLUMN_NAME_BATCH_ID+"\n            ORDER BY "+R.a.COLUMN_NAME_CREATED_AT+"\n        ").pipe(Object(a.map)((function(e){return e.map((function(e){return{userId:e[R.a.COLUMN_NAME_USER_ID],contentId:e[R.a.COLUMN_NAME_CONTENT_ID],courseId:e[R.a.COLUMN_NAME_COURSE_ID],batchId:e[R.a.COLUMN_NAME_BATCH_ID],firstTs:e.first_ts,events:JSON.parse("["+e.events+"]")}}))})),Object(a.mergeMap)((function(t){if(!t.length)return Object(i.of)(void 0);var n=t.reduce((function(t,n){var r=n.firstTs,i=n.userId,o=n.contentId,a=n.courseId,c=n.batchId,s=n.events;t.userId||(t.userId=i);var u={contentId:o,courseId:a,batchId:c,status:2};return t.contents.find((function(e){return k.a.equals(e,u)}))||t.contents.push(u),t.assessments.push({assessmentTs:r,userId:i,contentId:o,courseId:a,batchId:c,attemptId:e.courseService.generateAssessmentAttemptId({courseId:a,batchId:c,contentId:o,userId:i}),events:s}),t}),{userId:"",contents:[],assessments:[]});return e.invokeSyncApi(n)})),Object(a.tap)((function(){return x(e,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return[4,this.dbService.execute("DELETE FROM "+R.a.TABLE_NAME).toPromise()];case 1:return[2,e.sent()]}}))}))})),Object(a.mapTo)(void 0)).toPromise(),[2]}))}))},e.UPDATE_CONTENT_STATE_ENDPOINT="/content/state/update",e}(),V=n(54),G=function(){return(G=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Y=function(){function e(e,t){this.apiService=e,this.cachedItemStore=t}return e.prototype.handle=function(t){var n=this;return this.cachedItemStore.get(t.userId,e.GET_LEARNER_CERTIFICATE_LOCAL_KEY,"ttl_"+e.GET_LEARNER_CERTIFICATE_LOCAL_KEY,(function(){return n.fetchFromServer(t)}))},e.prototype.fetchFromServer=function(t){var n=G(G({},t.size?{size:t.size}:null),{_source:["data.badge.issuer.name","pdfUrl","data.issuedOn","data.badge.name","related.courseId","related.Id"],query:{bool:{must:[{match_phrase:{"recipient.id":t.userId}}]}}}),r=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(e.CERTIFICATE_SEARCH_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:n}).build();return this.apiService.fetch(r).pipe(Object(a.map)((function(e){return e.body.result.response})))},e.CERTIFICATE_SEARCH_ENDPOINT="/api/certreg/v1/certs/search",e.GET_LEARNER_CERTIFICATE_LOCAL_KEY="learner-certificate",e}(),H=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},q=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},K=function(){function e(e,t){this.keyValueStore=e,this.sharedPreference=t}return e.prototype.process=function(e){return H(this,void 0,void 0,(function(){var t,n,r,i,o,a;return q(this,(function(c){switch(c.label){case 0:return[4,this.getCourseContext().toPromise()];case 1:if(t=c.sent(),1,1!==t.batchStatus)return[3,5];n=function(t){var n,i,o,a,c,s;return q(this,(function(u){switch(u.label){case 0:return n=JSON.parse(t),(i=e[t])?(o=oe.GET_CONTENT_STATE_KEY_PREFIX.concat(n.userId,n.courseId),[4,r.keyValueStore.getValue(o).toPromise()]):[2,"continue"];case 1:return a=u.sent(),c=a?JSON.parse(a):{contentList:[]},s=i.reduce((function(e,t){try{var r=t.context.cdata.find((function(e){return"AttemptId"===e.type})).id,i=t.object.id,o=t.edata.item.maxscore,a=t.edata.score;if(e[i]){var s=e[i];s.attemptId=r,s.lastAttemptedOn=Date.now()+"",s.totalMaxScore+=o,s.totalScore+=a}else e[i]={attemptId:r,lastAttemptedOn:Date.now()+"",totalMaxScore:o,totalScore:a};c.contentList.find((function(e){return e.contentId===i}))||c.contentList.push({lastAccessTime:"2021-01-14 07:09:32:602+0000",contentId:i,progress:100,batchId:n.batchId,courseId:n.courseId,collectionId:n.courseId,lastCompletedTime:"2021-01-14 07:09:32:810+0000",status:2})}catch(e){console.error(e)}return e}),{}),c.contentList=c.contentList.map((function(e){return e.score&&e.score.length?s[e.contentId]?(e.score.push(s[e.contentId]),e.bestScore&&e.bestScore.totalScore<s[e.contentId].totalScore&&(e.bestScore=s[e.contentId]),e):e:(e.score=s[e.contentId]?[s[e.contentId]]:[],e.bestScore=e.score.reduce((function(e,t){return e?e.totalScore<t.totalScore?t:e:t}),void 0),e)})),console.log(c),[4,r.keyValueStore.setValue(o,JSON.stringify(c)).toPromise()];case 2:return u.sent(),[2]}}))},r=this,i=0,o=Object.keys(e),c.label=2;case 2:return i<o.length?(a=o[i],[5,n(a)]):[3,5];case 3:c.sent(),c.label=4;case 4:return i++,[3,2];case 5:return[2]}}))}))},e.prototype.getCourseContext=function(){return this.sharedPreference.getString(_.f.COURSE_CONTEXT).pipe(Object(a.map)((function(e){return e?JSON.parse(e):{}})))},e}(),z=n(60),W=n(77),X=n(37),J=n(22),Q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},$=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Z=function(){function e(e,t,n,r){this.profileService=e,this.fileService=t,this.keyValueStore=n,this.csCourseService=r}return e.prototype.isCertificateCached=function(e){var t=this;return Object(i.defer)((function(){return Q(t,void 0,void 0,(function(){var t;return $(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getCertificateFromCache(e)];case 1:return[2,!!n.sent()];case 2:return t=n.sent(),console.error(t),[2,!1];case 3:return[2]}}))}))}))},e.prototype.getCertificate=function(e){var t=this;return this.csCourseService.getSignedCourseCertificate(e.certificate.identifier).pipe(Object(a.tap)((function(n){return Q(t,void 0,void 0,(function(){var t,r;return $(this,(function(i){switch(i.label){case 0:return r=(t=this.keyValueStore).setValue,[4,this.buildCertificatePersistenceId(e)];case 1:return[4,r.apply(t,[i.sent(),Object(z.gzip)(n.printUri,{to:"string"})]).toPromise()];case 2:return i.sent(),[2]}}))}))})),Object(a.map)((function(e){return e.printUri})),Object(a.catchError)((function(n){return Object(i.defer)((function(){return Q(t,void 0,void 0,(function(){var t;return $(this,(function(r){switch(r.label){case 0:return[4,this.getCertificateFromCache(e)];case 1:if(t=r.sent())return[2,t];throw n}}))}))}))})))},e.prototype.downloadCertificate=function(e){var t=this,n=e.fileName,r=e.blob;return Object(i.defer)((function(){return Q(t,void 0,void 0,(function(){var e;return $(this,(function(t){switch(t.label){case 0:return[4,X.a.getFilePath(J.a.EXTERNAL)];case 1:return e=t.sent(),[4,this.fileService.writeFile(e,n,r,{replace:!0}).then((function(){return{path:""+e+n}})).catch((function(e){throw new Error(e)}))];case 2:return[2,t.sent()]}}))}))}))},e.prototype.buildCertificatePersistenceId=function(e){return Q(this,void 0,void 0,(function(){var t,n;return $(this,(function(r){switch(r.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return t=r.sent(),n=t.managedSession?t.managedSession.uid:t.uid,[2,"certificate_"+e.certificate.identifier+"_"+e.courseId+"_"+n]}}))}))},e.prototype.getCertificateFromCache=function(e){return Q(this,void 0,void 0,(function(){var t,n,r;return $(this,(function(i){switch(i.label){case 0:return r=(n=this.keyValueStore).getValue,[4,this.buildCertificatePersistenceId(e)];case 1:return[4,r.apply(n,[i.sent()]).toPromise()];case 2:return[2,(t=i.sent())?Object(W.ungzip)(t,{to:"string"}):void 0]}}))}))},e}(),ee=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ne=function(e,t){return function(n,r){t(n,r,e)}},re=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ie=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},oe=function(){function e(e,t,n,r,i,o,a,c,s,u,f,l,p){this.sdkConfig=e,this.apiService=t,this.profileService=n,this.keyValueStore=r,this.dbService=i,this.sharedPreferences=o,this.appInfo=a,this.fileService=c,this.cachedItemStore=s,this.csCourseService=u,this.networkQueue=f,this.container=l,this.authService=p,this.capturedAssessmentEvents={},this.courseServiceConfig=this.sdkConfig.courseServiceConfig,this.profileServiceConfig=this.sdkConfig.profileServiceConfig,this.syncAssessmentEventsHandler=new B(this,this.sdkConfig,this.dbService,this.networkQueue),this.offlineAssessmentScoreProcessor=new K(this.keyValueStore,this.sharedPreferences)}var t;return t=e,Object.defineProperty(e.prototype,"certificateManager",{get:function(){return this._certificateManager||(this._certificateManager=new Z(this.profileService,this.fileService,this.keyValueStore,this.csCourseService)),this._certificateManager},enumerable:!1,configurable:!0}),e.buildUrl=function(e,t,n){return""+e+t+"?"+V.stringify(n)},e.prototype.getBatchDetails=function(e){return new c(this.apiService,this.courseServiceConfig).handle(e)},e.prototype.updateContentState=function(e){var t=this;return e.target||(e.target=[r.UpdateContentStateTarget.LOCAL,r.UpdateContentStateTarget.SERVER]),Object(i.defer)((function(){return re(t,void 0,void 0,(function(){var t;return ie(this,(function(n){switch(n.label){case 0:if(t=new I(this.keyValueStore),!(e.target.indexOf(r.UpdateContentStateTarget.SERVER)>-1))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,new s.a(this.networkQueue,this.sdkConfig).handle(M.getUpdateContentStateRequest(e)).toPromise()];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return e.target.indexOf(r.UpdateContentStateTarget.LOCAL)>-1?[4,t.manipulateEnrolledCoursesResponseLocally(e).toPromise()]:[3,7];case 5:return n.sent(),[4,t.manipulateGetContentStateResponseLocally(e).toPromise()];case 6:n.sent(),n.label=7;case 7:return[2,!0]}}))}))}))},e.prototype.getCourseBatches=function(e){return new u(this.apiService,this.courseServiceConfig).handle(e)},e.prototype.getEnrolledCourses=function(e,t){return new p(this.keyValueStore,this.apiService,this.courseServiceConfig,this.sharedPreferences,t).handle(e)},e.prototype.getUserEnrolledCourses=function(e){var n=this,r=e.request,i=e.from;return this.cachedItemStore[i===b.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](r.userId+(r.filters?"_"+JSON.stringify(r.filters):""),t.USER_ENROLLMENT_LIST_KEY_PREFIX,"ttl_"+t.USER_ENROLLMENT_LIST_KEY_PREFIX,(function(){return n.csCourseService.getUserEnrolledCourses(r,{},{apiPath:"/api/course/v2",certRegistrationApiPath:""})}))},e.prototype.enrollCourse=function(e){var t=this;return new E(this.apiService,this.courseServiceConfig).handle(e).pipe(Object(a.mergeMap)((function(n){if(n){var r={};return r.userId=e.userId,r.batchStatus=e.batchStatus,t.sharedPreferences.putString(_.f.COURSE_CONTEXT,JSON.stringify(r)).pipe(Object(a.delay)(2e3),Object(a.concatMap)((function(){return t.getEnrolledCourses({userId:e.userId,returnFreshCourses:!0})})),Object(a.mapTo)(n))}return Object(i.of)(n)})))},e.prototype.getContentState=function(e){var n=this,r=t.GET_CONTENT_STATE_KEY_PREFIX.concat(e.userId,e.courseId),o=new I(this.keyValueStore),c=new T(this.keyValueStore,o);return this.keyValueStore.getValue(r).pipe(Object(a.mergeMap)((function(t){return!t||e.returnRefreshedContentStates?new C(n.apiService,n.courseServiceConfig,n.container).handle(e).pipe(Object(a.mergeMap)((function(t){return t?n.keyValueStore.setValue(r,JSON.stringify(t)).pipe(Object(a.mergeMap)((function(){return o.getLocalContentStateResponse(e)})),Object(a.mergeMap)((function(){return c.updateEnrollCourses(e)}))):Object(i.of)(void 0)})),Object(a.catchError)((function(t){return o.getLocalContentStateResponse(e).pipe(Object(a.mergeMap)((function(){return c.updateEnrollCourses(e)})))}))):o.getLocalContentStateResponse(e)})))},e.prototype.unenrollCourse=function(e){var t=this;return new y(this.apiService,this.courseServiceConfig).handle(e).pipe(Object(a.delay)(2e3),Object(a.concatMap)((function(){return t.getEnrolledCourses({userId:e.userId,returnFreshCourses:!0})})),Object(a.mapTo)(!0))},e.prototype.downloadCurrentProfileCourseCertificate=function(e){var n=this;return Object(i.defer)((function(){return re(n,void 0,void 0,(function(){var t,n,r,i,o;return ie(this,(function(a){switch(a.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return t=a.sent(),n=t.managedSession?t.managedSession.uid:t.uid,r=window.device.platform.toLowerCase(),i="ios"===r?J.a.DOCUMENTS:J.a.EXTERNAL_STORAGE,[4,X.a.getFilePath(i)];case 2:return o=a.sent(),o+"Download/"+e.certificate.name+"_"+e.courseId+"_"+n+".pdf",[2,{userId:n}]}}))}))})).pipe(Object(a.mergeMap)((function(r){var i=r.userId,c=(new o.Request.Builder).withType(o.HttpRequestType.POST).withPath(t.CERTIFICATE_SIGN_ENDPOINT).withBearerToken(!0).withUserToken(!0).withBody({request:{pdfUrl:e.certificate.url}}).build();return n.apiService.fetch(c).pipe(Object(a.map)((function(e){return{signedPdfUrl:e.body.result.signedUrl,userId:i}})))})),Object(a.mergeMap)((function(t){var n=t.signedPdfUrl,r=t.userId,o={uri:n,title:e.certificate.token,description:"",mimeType:"application/pdf",visibleInDownloadsUi:!0,notificationVisibility:1,destinationInExternalPublicDir:{dirType:"Download",subPath:"/"+e.certificate.name+"_"+e.courseId+"_"+r+".pdf"},headers:[]};return new i.Observable((function(e){downloadManager.enqueue(o,(function(t,n){if(t)return e.error(t);e.next(n),e.complete()}))}))})),Object(a.mergeMap)((function(e){return Object(i.interval)(1e3).pipe(Object(a.mergeMap)((function(){return new i.Observable((function(t){downloadManager.query({ids:[e]},(function(e,n){return e||n[0].status===D.DownloadStatus.STATUS_FAILED?t.error(e||new Error("Unknown Error")):t.next(n[0])}))}))})),Object(a.filter)((function(e){return e.status===D.DownloadStatus.STATUS_SUCCESSFUL})),Object(a.take)(1))})),Object(a.map)((function(e){return{path:e.localUri}})))},e.prototype.hasCapturedAssessmentEvent=function(e){var t=e.courseContext,n=k.a.toOrderedString(t);return!!this.capturedAssessmentEvents[n]},e.prototype.captureAssessmentEvent=function(e){var t=e.event,n=e.courseContext,r=k.a.toOrderedString(n);this.capturedAssessmentEvents[r]||(this.capturedAssessmentEvents[r]=[]),this.capturedAssessmentEvents[r].push(t)},e.prototype.syncAssessmentEvents=function(e){void 0===e&&(e={persistedOnly:!1});var t={};return e.persistedOnly||(t=this.capturedAssessmentEvents,this.resetCapturedAssessmentEvents()),this.offlineAssessmentScoreProcessor.process(t),this.syncAssessmentEventsHandler.handle(t)},e.prototype.resetCapturedAssessmentEvents=function(){this.capturedAssessmentEvents={}},e.prototype.generateAssessmentAttemptId=function(e){return P([e.courseId,e.batchId,e.contentId,e.userId,e.date?e.date:Date.now()].join("-")).toString()},e.prototype.displayDiscussionForum=function(e){var n=this;return Object(i.defer)((function(){return re(n,void 0,void 0,(function(){var n,r;return ie(this,(function(i){switch(i.label){case 0:return[4,this.authService.getSession().toPromise()];case 1:return(n=i.sent())?(r=n.managed_access_token||n.access_token,cordova.InAppBrowser.open(t.buildUrl(this.sdkConfig.apiConfig.host,t.DISCUSSION_FORUM_ENDPOINT,{access_token:r,returnTo:"/category/"+e.forumId}),"_blank","zoom=no,clearcache=yes,clearsessioncache=yes,cleardata=yes,hideurlbar=yes,hidenavigationbuttons=true"),[2,!0]):[2,!1]}}))}))}))},e.prototype.getLearnerCertificates=function(e){return new Y(this.apiService,this.cachedItemStore).handle(e)},e.prototype.syncCourseProgress=function(e){return this.csCourseService.updateContentState(e,{apiPath:"/api/course/v1"})},e.prototype.clearAssessments=function(){var e=this;return this.sharedPreferences.getString(_.f.COURSE_CONTEXT).pipe(Object(a.map)((function(t){var n=t?JSON.parse(t):{};if(n){var r=k.a.toOrderedString(n);e.capturedAssessmentEvents[r]&&(e.capturedAssessmentEvents[r]=[])}})))},e.USER_ENROLLMENT_LIST_KEY_PREFIX="userEnrollmentList",e.GET_CONTENT_STATE_KEY_PREFIX="getContentState",e.GET_ENROLLED_COURSE_KEY_PREFIX="enrolledCourses",e.UPDATE_CONTENT_STATE_KEY_PREFIX="updateContentState",e.LAST_READ_CONTENTID_PREFIX="lastReadContentId",e.CERTIFICATE_SIGN_ENDPOINT="/api/certreg/v1/certs/download",e.DISCUSSION_FORUM_ENDPOINT="/discussions/auth/sunbird-oidc/callback",e=t=ee([Object(w.injectable)(),ne(0,Object(w.inject)(S.b.SDK_CONFIG)),ne(1,Object(w.inject)(S.b.API_SERVICE)),ne(2,Object(w.inject)(S.b.PROFILE_SERVICE)),ne(3,Object(w.inject)(S.b.KEY_VALUE_STORE)),ne(4,Object(w.inject)(S.b.DB_SERVICE)),ne(5,Object(w.inject)(S.b.SHARED_PREFERENCES)),ne(6,Object(w.inject)(S.b.APP_INFO)),ne(7,Object(w.inject)(S.b.FILE_SERVICE)),ne(8,Object(w.inject)(S.b.CACHED_ITEM_STORE)),ne(9,Object(w.inject)(S.a.COURSE_SERVICE)),ne(10,Object(w.inject)(S.b.NETWORK_QUEUE)),ne(11,Object(w.inject)(S.b.CONTAINER)),ne(12,Object(w.inject)(S.b.AUTH_SERVICE)),te("design:paramtypes",[Object,Object,Object,Object,v.DbService,Object,Object,Object,Object,Object,Object,w.Container,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var r,i=n(21),o=n(47),a=n(7),c=n(3),s=n(0),u=function(){function e(e,t,n,r){this.apiService=e,this.frameworkServiceConfig=t,this.fileService=n,this.cachedItemStore=r,this.CHANNEL_FILE_KEY_PREFIX="channel-",this.CHANNEL_LOCAL_KEY="channel-",this.GET_FRAMEWORK_DETAILS_ENDPOINT="/read"}return e.prototype.handle=function(e){var t=this;return this.cachedItemStore[e.from===i.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](e.channelId,this.CHANNEL_LOCAL_KEY,"ttl_"+this.CHANNEL_LOCAL_KEY,(function(){return t.fetchFromServer(e)}),(function(){return t.fetchFromFile(e)})).pipe(Object(s.map)((function(e){return e.frameworks&&e.frameworks.sort((function(e,t){return e.name.localeCompare(t.name)})),e})))},e.prototype.fetchFromServer=function(e){var t=(new a.Request.Builder).withType(a.HttpRequestType.GET).withPath(this.frameworkServiceConfig.channelApiPath+this.GET_FRAMEWORK_DETAILS_ENDPOINT+"/"+e.channelId).withBearerToken(!0).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return e.body.result.channel})))},e.prototype.fetchFromFile=function(e){var t=this;return Object(c.defer)((function(){return o.a.getAssetPath()})).pipe(Object(s.switchMap)((function(n){var r=n+t.frameworkServiceConfig.channelConfigDirPath+"/"+(t.CHANNEL_FILE_KEY_PREFIX+e.channelId+".json");return Object(c.from)(t.fileService.readFileFromAssets(r)).pipe(Object(s.map)((function(e){return JSON.parse(e).result.channel})))})),Object(s.catchError)((function(e){return console.error("Error fetching form from file:",e),Object(c.throwError)(e)})))},e}(),f=n(66),l=function(){function e(e,t,n,r,i){this.frameworkService=e,this.apiService=t,this.frameworkServiceConfig=n,this.fileService=r,this.cachedItemStore=i,this.FRAMEWORK_FILE_KEY_PREFIX="framework-",this.FRAMEWORK_LOCAL_KEY="framework-",this.GET_FRAMEWORK_DETAILS_ENDPOINT="/read"}return e.prototype.handle=function(e){var t=this;return Object(c.iif)((function(){return!!e.frameworkId}),Object(c.defer)((function(){return t.cachedItemStore[e.from===i.CachedItemRequestSourceFrom.SERVER?"get":"getCached"](e.frameworkId,t.FRAMEWORK_LOCAL_KEY,"ttl_"+t.FRAMEWORK_LOCAL_KEY,(function(){return t.fetchFromServer(e)}),(function(){return t.fetchFromFile(e)}))})),Object(c.defer)((function(){return t.frameworkService.getDefaultChannelDetails().pipe(Object(s.mergeMap)((function(n){return t.frameworkService.getFrameworkDetails({from:e.from,frameworkId:n.defaultFramework,requiredCategories:e.requiredCategories})})))})))},e.prototype.fetchFromServer=function(e){var t=(new a.Request.Builder).withType(a.HttpRequestType.GET).withPath(this.frameworkServiceConfig.frameworkApiPath+this.GET_FRAMEWORK_DETAILS_ENDPOINT+"/"+e.frameworkId).withParameters({categories:e.requiredCategories.join(",")}).withBearerToken(!0).build();return this.apiService.fetch(t).pipe(Object(s.map)((function(e){return e.body.result.framework})),Object(s.map)((function(e){return f.a.prepareFrameworkCategoryAssociations(e)})))},e.prototype.fetchFromFile=function(e){var t=this;return Object(c.defer)((function(){return o.a.getAssetPath()})).pipe(Object(s.switchMap)((function(n){var r=n+t.frameworkServiceConfig.frameworkConfigDirPath+"/"+(t.FRAMEWORK_FILE_KEY_PREFIX+e.frameworkId+".json");return Object(c.from)(t.fileService.readFileFromAssets(r)).pipe(Object(s.map)((function(e){return JSON.parse(e).result.framework})),Object(s.map)((function(e){return f.a.prepareFrameworkCategoryAssociations(e)})))})),Object(s.catchError)((function(e){return console.error("Error fetching form from file:",e),Object(c.throwError)(e)})))},e}(),p=n(19),d=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),h=function(e){function t(n){var r=e.call(this,n,"NO_ACTIVE_CHANNEL_FOUND_ERROR")||this;return Object.setPrototypeOf(r,t.prototype),r}return d(t,e),t}(p.a),E=n(11),b=n(6),y=n(5),v=n(13),_=function(){return(_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},S=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t){return function(n,r){t(n,r,e)}},C=function(){function e(e,t,n,r,i,o,a){this.sdkConfig=e,this.fileService=t,this.apiService=n,this.cachedItemStore=r,this.sharedPreferences=i,this.systemSettingsService=o,this.csFrameworkService=a}var t;return t=e,Object.defineProperty(e.prototype,"activeChannelId",{get:function(){return this._activeChannelId},enumerable:!1,configurable:!0}),e.prototype.preInit=function(){var e=this;return this.getActiveChannelId().pipe(Object(s.tap)((function(t){return e._activeChannelId=t})),Object(s.mapTo)(void 0),Object(s.catchError)((function(t){if(t instanceof h)return e.setActiveChannelId(e.sdkConfig.apiConfig.api_authentication.channelId);throw t})))},e.prototype.getDefaultChannelId=function(){var e=this;return Object(c.iif)((function(){return!e.sdkConfig.frameworkServiceConfig.overriddenDefaultChannelId}),Object(c.defer)((function(){return e.systemSettingsService.getSystemSettings({id:e.sdkConfig.frameworkServiceConfig.systemSettingsDefaultChannelIdKey}).pipe(Object(s.map)((function(e){return e.value})))})),Object(c.defer)((function(){return Object(c.of)(e.sdkConfig.frameworkServiceConfig.overriddenDefaultChannelId)})))},e.prototype.getDefaultChannelDetails=function(e){var t=this;return void 0===e&&(e={from:i.CachedItemRequestSourceFrom.CACHE}),this.systemSettingsService.getSystemSettings({id:this.sdkConfig.frameworkServiceConfig.systemSettingsDefaultChannelIdKey}).pipe(Object(s.map)((function(e){return e.value})),Object(s.mergeMap)((function(n){return t.getChannelDetails({from:e.from,channelId:t.sdkConfig.frameworkServiceConfig.overriddenDefaultChannelId||n})})))},e.prototype.getChannelDetails=function(e){return new u(this.apiService,this.sdkConfig.frameworkServiceConfig,this.fileService,this.cachedItemStore).handle(e)},e.prototype.getFrameworkDetails=function(e){return new l(this,this.apiService,this.sdkConfig.frameworkServiceConfig,this.fileService,this.cachedItemStore).handle(e)},e.prototype.getFrameworkConfig=function(e,t){var n;return t&&(n={type:t.type,subType:t.subType,action:t.action,rootOrgId:t.rootOrgId,framework:t.framework,component:t.component}),this.csFrameworkService.getFrameworkConfig(e,{apiPath:"/api/framework/v1"},{apiPath:"/api/data/v1/form",params:n})},e.prototype.searchOrganization=function(e){var n=(new a.Request.Builder).withType(a.HttpRequestType.POST).withPath(this.sdkConfig.frameworkServiceConfig.searchOrganizationApiPath+t.SEARCH_ORGANIZATION_ENDPOINT).withBody({request:e}).withBearerToken(!0).build();return this.apiService.fetch(n).pipe(Object(s.map)((function(e){return e.body.result.response})))},e.prototype.getActiveChannelId=function(){return this.sharedPreferences.getString(t.KEY_ACTIVE_CHANNEL_ID).pipe(Object(s.map)((function(e){if(!e)throw new h("No Active channel ID set in preferences");return e})))},e.prototype.setActiveChannelId=function(e){return this._activeChannelId=e,v.CsModule.instance.isInitialised&&v.CsModule.instance.updateConfig(_(_({},v.CsModule.instance.config),{core:_(_({},v.CsModule.instance.config.core),{global:_(_({},v.CsModule.instance.config.core.global),{channelId:e})})})),this.sharedPreferences.putString(t.KEY_ACTIVE_CHANNEL_ID,e)},e.KEY_ACTIVE_CHANNEL_ID=E.j.KEY_ACTIVE_CHANNEL_ID,e.SEARCH_ORGANIZATION_ENDPOINT="/search",e=t=S([Object(b.injectable)(),g(0,Object(b.inject)(y.b.SDK_CONFIG)),g(1,Object(b.inject)(y.b.FILE_SERVICE)),g(2,Object(b.inject)(y.b.API_SERVICE)),g(3,Object(b.inject)(y.b.CACHED_ITEM_STORE)),g(4,Object(b.inject)(y.b.SHARED_PREFERENCES)),g(5,Object(b.inject)(y.b.SYSTEM_SETTINGS_SERVICE)),g(6,Object(b.inject)(y.a.FRAMEWORK_SERVICE)),O("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(6),i=n(7),o=n(3),a=n(11),c=n(0),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},l=function(){function e(e,t,n,r,i,o,a){this.sdkConfig=e,this.deviceInfo=t,this.sharedPreferences=n,this.frameworkService=r,this.appInfoService=i,this.apiService=o,this.getDeviceProfileHandler=a,this.deviceRegisterConfig=this.sdkConfig.deviceRegisterConfig,this.apiConfig=this.sdkConfig.apiConfig}return e.prototype.handle=function(e){return this.registerDevice(e)},e.prototype.registerDevice=function(t){var n=this;return Object(o.zip)(this.deviceInfo.getDeviceSpec(),this.frameworkService.getActiveChannelId(),this.appInfoService.getFirstAccessTimestamp(),this.sharedPreferences.getString(a.g.DEVICE_LOCATION)).pipe(Object(c.mergeMap)((function(r){return u(n,void 0,void 0,(function(){var n,o,u,l,p,d,h,E=this;return f(this,(function(f){switch(f.label){case 0:if(n=r[0],o=r[1],u=r[2],l=r[3],(t=s(s({},t||{}),{dspec:n,channel:o,fcmToken:this.deviceRegisterConfig.fcmToken,producer:this.apiConfig.api_authentication.producerId,first_access:Number(u)})).userDeclaredLocation||!l)return[3,4];if(t.userDeclaredLocation=JSON.parse(l),t.userDeclaredLocation.declaredOffline)return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.getDeviceProfileHandler.handle().toPromise()];case 2:return(p=f.sent()).userDeclaredLocation&&p.userDeclaredLocation.state&&p.userDeclaredLocation.district||(delete t.userDeclaredLocation,this.sharedPreferences.putString(a.g.DEVICE_LOCATION,"").toPromise()),[3,4];case 3:return d=f.sent(),console.error(d),delete t.userDeclaredLocation,[3,4];case 4:return t.userDeclaredLocation&&delete t.userDeclaredLocation.declaredOffline,h=(new i.Request.Builder).withType(i.HttpRequestType.POST).withPath(this.deviceRegisterConfig.apiPath+e.DEVICE_REGISTER_ENDPOINT+"/"+this.deviceInfo.getDeviceID()).withBearerToken(!0).withBody({request:t}).build(),[2,this.apiService.fetch(h).pipe(Object(c.map)((function(e){return e.body})),Object(c.tap)((function(){t.userDeclaredLocation&&E.sharedPreferences.putString(a.g.DEVICE_LOCATION,JSON.stringify(t.userDeclaredLocation)).toPromise()}))).toPromise()]}}))}))})))},e.DEVICE_REGISTER_ENDPOINT="/register",e}(),p=n(5),d=function(){function e(e,t,n){this.sdkConfig=e,this.deviceInfo=t,this.apiService=n,this.deviceRegisterConfig=this.sdkConfig.deviceRegisterConfig,this.apiConfig=this.sdkConfig.apiConfig}return e.prototype.handle=function(){return this.fetchFromServer()},e.prototype.fetchFromServer=function(){return this.apiService.fetch((new i.Request.Builder).withType(i.HttpRequestType.GET).withPath(this.deviceRegisterConfig.apiPath+e.GET_DEVICE_PROFILE_ENDPOINT+"/"+this.deviceInfo.getDeviceID()).withBearerToken(!0).build()).pipe(Object(c.map)((function(e){return e.body.result})))},e.GET_DEVICE_PROFILE_ENDPOINT="/profile",e}(),h=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e,t){return function(n,r){t(n,r,e)}},y=function(){function e(e,t,n,r,i,o){this.sdkConfig=e,this.deviceInfo=t,this.sharedPreferences=n,this.frameworkService=r,this.appInfoService=i,this.apiService=o,this.getDeviceProfileHandler=new d(this.sdkConfig,this.deviceInfo,this.apiService),this.deviceRegisterHandler=new l(this.sdkConfig,this.deviceInfo,this.sharedPreferences,this.frameworkService,this.appInfoService,this.apiService,this.getDeviceProfileHandler)}return e.prototype.registerDevice=function(e){return this.deviceRegisterHandler.handle(e)},e.prototype.getDeviceProfile=function(){return this.getDeviceProfileHandler.handle()},e=h([Object(r.injectable)(),b(0,Object(r.inject)(p.b.SDK_CONFIG)),b(1,Object(r.inject)(p.b.DEVICE_INFO)),b(2,Object(r.inject)(p.b.SHARED_PREFERENCES)),b(3,Object(r.inject)(p.b.FRAMEWORK_SERVICE)),b(4,Object(r.inject)(p.b.APP_INFO)),b(5,Object(r.inject)(p.b.API_SERVICE)),E("design:paramtypes",[Object,Object,Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(3),i=n(6),o=n(5),a=n(11),c=n(76),s=n(18),u=n(0),f=n(34),l=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},p=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},d=function(){function e(e,t,n,r){this.sharedPreferences=e,this.apiConfig=t,this.deviceInfo=n,this.apiService=r,this.apiTokenHandler=new c.a(this.apiConfig,this.apiService,this.deviceInfo)}return e.prototype.interceptResponse=function(e,t){var n=this;return t.responseCode===f.CsHttpResponseCode.HTTP_UNAUTHORISED&&"Unauthorized"===t.body.message||t.responseCode===f.CsHttpResponseCode.HTTP_FORBIDDEN?this.apiTokenHandler.refreshAuthToken().pipe(Object(u.tap)((function(e){return l(n,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this.sharedPreferences.putString(a.a.KEY_API_TOKEN,e).toPromise()];case 1:return t.sent(),[2]}}))}))})),Object(u.mergeMap)((function(){return n.apiService.fetch(e)}))):Object(r.of)(t)},e}(),h=function(){function e(e,t){this.apiService=e,this.authService=t}return e.prototype.interceptResponse=function(e,t){var n=this;return t.responseCode!==f.CsHttpResponseCode.HTTP_UNAUTHORISED||t.body.message?Object(r.of)(t):this.invokeRefreshSessionTokenApi().pipe(Object(u.mergeMap)((function(){return n.apiService.fetch(e)})))},e.prototype.invokeRefreshSessionTokenApi=function(){return this.authService.refreshSession()},e}(),E=n(13),b=n(83),y=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t){return function(n,r){t(n,r,e)}},S=function(){function e(e,t,n,r,i,o){this.container=e,this.sdkConfig=t,this.deviceInfo=n,this.sharedPreferences=r,this.eventsBusService=i,this.httpService=o,this.hasEmittedPlannedMaintenanceErrorEvent=!1,this.defaultRequestInterceptors=[],this.defaultResponseInterceptors=[],this.apiConfig=this.sdkConfig.apiConfig,this.apiConfig.debugMode&&(this.defaultRequestInterceptors=[new b.CsRequestLoggerInterceptor],this.defaultResponseInterceptors=[new b.CsResponseLoggerInterceptor])}var t;return t=e,Object.defineProperty(e.prototype,"bearerTokenRefreshInterceptor",{get:function(){return this._bearerTokenRefreshInterceptor||(this._bearerTokenRefreshInterceptor=new d(this.container.get(o.b.SHARED_PREFERENCES),this.container.get(o.b.SDK_CONFIG).apiConfig,this.container.get(o.b.DEVICE_INFO),this.container.get(o.b.API_SERVICE))),this._bearerTokenRefreshInterceptor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userTokenRefreshInterceptor",{get:function(){return this._userTokenRefreshInterceptor||(this._userTokenRefreshInterceptor=new h(this.container.get(o.b.API_SERVICE),this.container.get(o.b.AUTH_SERVICE))),this._userTokenRefreshInterceptor},enumerable:!1,configurable:!0}),e.prototype.onInit=function(){var e=this;return this.sharedPreferences.addListener(a.a.KEY_API_TOKEN,(function(e){E.CsModule.instance.config.core.api.authentication.bearerToken=e||void 0,E.CsModule.instance.updateConfig(E.CsModule.instance.config)})),this.sharedPreferences.getString(a.a.KEY_API_TOKEN).pipe(Object(u.mergeMap)((function(t){return t?(E.CsModule.instance.config.core.api.authentication.bearerToken=t,E.CsModule.instance.updateConfig(E.CsModule.instance.config),Object(r.of)(void 0)):new c.a(e.apiConfig,e,e.deviceInfo).refreshAuthToken().pipe(Object(u.mergeMap)((function(t){return e.sharedPreferences.putString(a.a.KEY_API_TOKEN,t)})),Object(u.catchError)((function(){return Object(r.of)(void 0)})))})))},e.prototype.fetch=function(e){var n=this;if(this.defaultRequestInterceptors.forEach((function(t){-1===e.requestInterceptors.indexOf(t)&&e.requestInterceptors.push(t)})),this.defaultResponseInterceptors.forEach((function(t){-1===e.responseInterceptors.indexOf(t)&&e.responseInterceptors.push(t)})),e.withBearerToken){var i=e.responseInterceptors.indexOf(this.bearerTokenRefreshInterceptor);-1===i?e.responseInterceptors.push(this.bearerTokenRefreshInterceptor):e.responseInterceptors.splice(i,1)}if(e.withUserToken){var o=e.responseInterceptors.indexOf(this.userTokenRefreshInterceptor);-1===o?e.responseInterceptors.push(this.userTokenRefreshInterceptor):e.responseInterceptors.splice(o,1)}return this.httpService.fetch(e).pipe(Object(u.catchError)((function(e){return f.CsHttpServerError.isInstance(e)?(n.eventsBusService.emit({namespace:s.EventNamespace.ERROR,event:{type:s.ErrorEventType.HTTP_SERVER_ERROR,payload:e}}),e.response.responseCode===t.PLANNED_MAINTENANCE_ERROR_CODE&&(n.hasEmittedPlannedMaintenanceErrorEvent||(n.hasEmittedPlannedMaintenanceErrorEvent=!0,n.eventsBusService.emit({namespace:s.EventNamespace.ERROR,event:{type:s.ErrorEventType.PLANNED_MAINTENANCE_PERIOD,payload:e}})))):f.CsHttpClientError.isInstance(e)&&n.eventsBusService.emit({namespace:s.EventNamespace.ERROR,event:{type:s.ErrorEventType.HTTP_CLIENT_ERROR,payload:e}}),Object(r.throwError)(e)})))},e.prototype.setDefaultRequestInterceptors=function(e){this.defaultRequestInterceptors=e,this.apiConfig.debugMode&&this.defaultRequestInterceptors.push(new b.CsRequestLoggerInterceptor)},e.prototype.setDefaultResponseInterceptors=function(e){this.defaultResponseInterceptors=e,this.apiConfig.debugMode&&this.defaultResponseInterceptors.push(new b.CsResponseLoggerInterceptor)},e.PLANNED_MAINTENANCE_ERROR_CODE=531,e=t=y([Object(i.injectable)(),_(0,Object(i.inject)(o.b.CONTAINER)),_(1,Object(i.inject)(o.b.SDK_CONFIG)),_(2,Object(i.inject)(o.b.DEVICE_INFO)),_(3,Object(i.inject)(o.b.SHARED_PREFERENCES)),_(4,Object(i.inject)(o.b.EVENTS_BUS_SERVICE)),_(5,Object(i.inject)(o.a.HTTP_SERVICE)),v("design:paramtypes",[i.Container,Object,Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n(3),i=n(66),o=n(46),a=n.n(o),c=n(53),s=n(11),u=n(0),f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},p=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)r[i]=o[a];return r},d=function(){function e(e,t,n){this.frameworkUtilService=e,this.frameworkService=t,this.sharedPreferences=n}return e.prototype.handle=function(e){var t=this;return(e.frameworkId?t.getTranslatedFrameworkDetails(e.frameworkId,e.requiredCategories,e.language):t.getActiveChannelTranslatedDefaultFrameworkDetails(e)).pipe(Object(u.tap)((function(e){return f(t,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this.sharedPreferences.putString(s.j.KEY_ACTIVE_CHANNEL_ACTIVE_FRAMEWORK_ID,e.identifier).toPromise()];case 1:return[2,t.sent()]}}))}))})),Object(u.map)((function(n){var r=[];if(r=!e.prevCategoryCode&&e.currentCategoryCode?t.getCategoryTerms(n,e).toArray():t.getCategoryAssociationTerms(n,e).toArray(),"gradeLevel"===e.currentCategoryCode){var i=r.reduce((function(e,t){return t.index&&t.index>e?t.index:e}),0);r.sort((function(e,t){return(e.index||i+1)-(t.index||i+1)}))}else r.sort((function(e,t){return e.name.localeCompare(t.name)}));var o=r.indexOf(r.find((function(e){return"Others"===e.name})));if(o>=0&&o!==r.length){var a=r[r.length-1];r[r.length-1]=r[o],r[o]=a}return r})))},e.prototype.getActiveChannelTranslatedDefaultFrameworkDetails=function(e){var t=this;return this.frameworkUtilService.getActiveChannel({from:e.from}).pipe(Object(u.mergeMap)((function(n){return t.getTranslatedFrameworkDetails(n.defaultFramework,e.requiredCategories,e.language,e.from)})))},e.prototype.getTranslatedFrameworkDetails=function(e,t,n,r){return this.frameworkService.getFrameworkDetails({from:r,frameworkId:e,requiredCategories:t}).pipe(Object(u.map)((function(e){return i.a.prepareFrameworkTranslations(e,n)})))},e.prototype.getAllCategoriesTermsSet=function(e){return e.categories?e.categories.reduce((function(e,t){return p(e,[t.terms||[]])}),[]).reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.add(t),e}),new a.a((function(e){return Object(c.makeString)(e)}))):new a.a},e.prototype.getCategoryTerms=function(e,t){return e.categories.find((function(e){return e.code===t.currentCategoryCode})).terms.reduce((function(e,t){return e.add(t),e}),new a.a((function(e){return Object(c.makeString)(e)})))},e.prototype.getCategoryAssociationTerms=function(e,t){var n=this;if(!e.categories)return new a.a;var r=e.categories.find((function(e){return e.code===t.prevCategoryCode})).terms;if(!r)return new a.a;var i=r.filter((function(e){return t.selectedTermsCodes.find((function(t){return t===e.code}))})).map((function(e){return e.associations||[]}));return i.some((function(e){return 0===e.length}))?e.categories.find((function(e){return e.code===t.currentCategoryCode})).terms.reduce((function(e,t){return e.add(t),e}),new a.a((function(e){return Object(c.makeString)(e)}))):i.reduce((function(e,t){return e.concat(t)}),[]).reduce((function(e,t){return e.add(t),e}),new a.a((function(e){return Object(c.makeString)(e)}))).toArray().map((function(t){return n.getAllCategoriesTermsSet(e).toArray().find((function(e){return e.identifier===t.identifier}))})).reduce((function(e,t){return e.add(t),e}),new a.a((function(e){return Object(c.makeString)(e)})))},e}(),h=n(6),E=n(5),b=n(21),y=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t){return function(n,r){t(n,r,e)}},S=function(){function e(e,t,n){this.sharedPreferences=e,this.frameworkService=t,this.profileService=n}return e.prototype.getActiveChannel=function(e){var t=this;return void 0===e&&(e={from:b.CachedItemRequestSourceFrom.CACHE}),this.frameworkService.getActiveChannelId().pipe(Object(u.mergeMap)((function(n){return t.frameworkService.getChannelDetails({from:e.from,channelId:n})})))},e.prototype.getActiveChannelSuggestedFrameworkList=function(e){var t=this;return this.profileService.getActiveSessionProfile({requiredFields:[]}).pipe(Object(u.mergeMap)((function(n){return Object(r.iif)((function(){return!!n.serverProfile&&!e.ignoreActiveChannel}),Object(r.defer)((function(){return t.getActiveChannel({from:e.from})})),Object(r.defer)((function(){return t.frameworkService.getDefaultChannelDetails({from:e.from})})))})),Object(u.mergeMap)((function(n){return n.frameworks?Object(r.of)(n.frameworks).pipe(Object(u.map)((function(t){return t.map((function(e){return i.a.prepareFrameworkCategoryAssociations(e)})).map((function(t){return i.a.prepareFrameworkTranslations(t,e.language)}))}))):t.frameworkService.getFrameworkDetails({from:e.from,frameworkId:n.defaultFramework,requiredCategories:e.requiredCategories}).pipe(Object(u.map)((function(e){return e.index=0,[e]})))})))},e.prototype.getFrameworkCategoryTerms=function(e){return new d(this,this.frameworkService,this.sharedPreferences).handle(e)},e=y([Object(h.injectable)(),_(0,Object(h.inject)(E.b.SHARED_PREFERENCES)),_(1,Object(h.inject)(E.b.FRAMEWORK_SERVICE)),_(2,Object(h.inject)(E.b.PROFILE_SERVICE)),v("design:paramtypes",[Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(47),i=n(7),o=n(3),a=n(0),c=function(){function e(e,t,n,r){this.apiService=e,this.systemSettingsConfig=t,this.fileservice=n,this.cachedItemStore=r,this.SYSTEM_SETTINGS_FILE_KEY_PREFIX="system-setting-",this.SYSTEM_SETTINGS_LOCAL_KEY="system-settings-",this.GET_SYSTEM_SETTINGS_ENDPOINT="/system/settings/get"}return e.prototype.handle=function(e){var t=this;return this.cachedItemStore.getCached(e.id,this.SYSTEM_SETTINGS_LOCAL_KEY,"ttl_"+this.SYSTEM_SETTINGS_LOCAL_KEY,(function(){return t.fetchFromServer(e)}),(function(){return t.fetchFromFile(e)}))},e.prototype.fetchFromServer=function(e){var t=(new i.Request.Builder).withType(i.HttpRequestType.GET).withPath(this.systemSettingsConfig.systemSettingsApiPath+this.GET_SYSTEM_SETTINGS_ENDPOINT+"/"+e.id).withBearerToken(!0).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){return e.body.result.response})))},e.prototype.fetchFromFile=function(e){var t=this;return Object(o.defer)((function(){return r.a.getAssetPath()})).pipe(Object(a.switchMap)((function(n){var r=n+t.systemSettingsConfig.systemSettingsDirPath+"/"+(t.SYSTEM_SETTINGS_FILE_KEY_PREFIX+e.id+".json");return Object(o.from)(t.fileservice.readFileFromAssets(r)).pipe(Object(a.map)((function(e){return JSON.parse(e).result.response})))})),Object(a.catchError)((function(e){return console.error("Error fetching form from file:",e),Object(o.throwError)(e)})))},e}(),s=n(6),u=n(5),f=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e,t){return function(n,r){t(n,r,e)}},d=function(){function e(e,t,n,r){this.sdkConfig=e,this.apiService=t,this.fileService=n,this.cachedChannelItemStore=r,this.systemSettingsConfig=this.sdkConfig.systemSettingsConfig}return e.prototype.getSystemSettings=function(e){return new c(this.apiService,this.systemSettingsConfig,this.fileService,this.cachedChannelItemStore).handle(e)},e=f([Object(s.injectable)(),p(0,Object(s.inject)(u.b.SDK_CONFIG)),p(1,Object(s.inject)(u.b.API_SERVICE)),p(2,Object(s.inject)(u.b.FILE_SERVICE)),p(3,Object(s.inject)(u.b.CACHED_ITEM_STORE)),l("design:paramtypes",[Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(47),i=n(7),o=n(3),a=n(0),c=function(){function e(e,t,n,r){this.apiService=e,this.faqServiceConfig=t,this.fileservice=n,this.cachedItemStore=r,this.FAQ_FILE_KEY_PREFIX="faq-",this.FAQ_LOCAL_KEY="faq-new-"}return e.prototype.handle=function(e){var t=this;return this.cachedItemStore.getCached(e.language,this.FAQ_LOCAL_KEY,"ttl_"+this.FAQ_LOCAL_KEY,(function(){return t.fetchFromServer(e)}),(function(){return t.fetchFromFile(e.language)}))},e.prototype.fetchFromServer=function(e){var t=(new i.Request.Builder).withType(i.HttpRequestType.GET).withHost(e.faqUrl).withPath("/faq-"+e.language+".json").withBearerToken(!1).build();return this.apiService.fetch(t).pipe(Object(a.map)((function(e){var t;try{t=JSON.parse(e.body.trim())}catch(n){t=e.body}return t})))},e.prototype.fetchFromFile=function(e){var t=this;return Object(o.from)(r.a.getAssetPath()).pipe(Object(a.switchMap)((function(n){var r=n+t.faqServiceConfig.faqConfigDirPath+"/"+(t.FAQ_FILE_KEY_PREFIX+e+".json");return Object(o.from)(t.fileservice.readFileFromAssets(r)).pipe(Object(a.map)((function(e){return JSON.parse(e)})))})))},e}(),s=n(6),u=n(5),f=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e,t){return function(n,r){t(n,r,e)}},d=function(){function e(e,t,n,r){this.sdkConfig=e,this.fileService=t,this.apiService=n,this.cachedItemStore=r}return e.prototype.getFaqDetails=function(e){return new c(this.apiService,this.sdkConfig.faqServiceConfig,this.fileService,this.cachedItemStore).handle(e)},e=f([Object(s.injectable)(),p(0,Object(s.inject)(u.b.SDK_CONFIG)),p(1,Object(s.inject)(u.b.FILE_SERVICE)),p(2,Object(s.inject)(u.b.API_SERVICE)),p(3,Object(s.inject)(u.b.CACHED_ITEM_STORE)),l("design:paramtypes",[Object,Object,Object,Object])],e)}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var r=n(6),i=n(3),o=n(0),a=n(5),c=n(1),s=n(55),u=function(){function e(e,t,n,r){this.dbService=e,this.container=t,this.certificateServiceConfig=n,this.apiConfig=r}return Object.defineProperty(e.prototype,"csCertificateService",{get:function(){return this.container.get(a.a.CERTIFICATE_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.handle=function(e){var t=this;return this.dbService.read({table:s.a.TABLE_NAME,selection:s.a.COLUMN_NAME_IDENTIFIER+"= ?",selectionArgs:[e.osid.toString()]}).pipe(Object(o.mergeMap)((function(n){return n&&n.length?n[0].expiry_time<Date.now()?t.fetchFromServer(e).pipe(Object(o.mergeMap)((function(e){return t.updatePublicKey(e)}))):Object(i.of)({osid:n[0].identifier,value:n[0].public_key,alg:n[0].alg,osOwner:n[0].owner?n[0].owner.split(","):[]}):t.fetchFromServer(e).pipe(Object(o.mergeMap)((function(e){return t.insertPublicKey(e)})))})))},e.prototype.updatePublicKey=function(e){return this.dbService.update({table:s.a.TABLE_NAME,selection:s.a.COLUMN_NAME_IDENTIFIER+" = ?",selectionArgs:[e.osid],modelJson:{identifier:e.osid,public_key:e.value,alg:e.alg,owner:e.osOwner&&e.osOwner.length?e.osOwner.join(","):"",expiry_time:Date.now()+this.apiConfig.cached_requests.timeToLive}}).pipe(Object(o.mapTo)(e))},e.prototype.insertPublicKey=function(e){return this.dbService.insert({table:s.a.TABLE_NAME,modelJson:{identifier:e.osid,public_key:e.value,alg:e.alg,owner:e.osOwner&&e.osOwner.length?e.osOwner.join(","):"",expiry_time:Date.now()+this.apiConfig.cached_requests.timeToLive}}).pipe(Object(o.mapTo)(e))},e.prototype.fetchFromServer=function(e){return this.csCertificateService.getPublicKey(e)},e}(),f=n(60),l=n(77),p=n(22),d=n(37),h=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e,t){return function(n,r){t(n,r,e)}},y=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},_=function(){function e(e,t,n,r,i,o){this.container=e,this.dbService=t,this.sdkConfig=n,this.profileService=r,this.keyValueStore=i,this.fileService=o}return e.prototype.getCertificates=function(e){return this.csCertificateService.fetchCertificates(e)},e.prototype.getPublicKey=function(e){return new u(this.dbService,this.container,this.sdkConfig.certificateServiceConfig,this.sdkConfig.apiConfig).handle(e)},e.prototype.getCertificate=function(e){var t=this;return this.csCertificateService.getCerificateDownloadURI({certificateId:e.certificate.identifier,type:e.certificate.type,schemaName:"certificate",templateUrl:e.certificate.templateUrl}).pipe(Object(o.tap)((function(n){return y(t,void 0,void 0,(function(){var t,r;return v(this,(function(i){switch(i.label){case 0:return r=(t=this.keyValueStore).setValue,[4,this.buildCertificatePersistenceId(e)];case 1:return[4,r.apply(t,[i.sent(),Object(f.gzip)(n.printUri,{to:"string"})]).toPromise()];case 2:return i.sent(),[2]}}))}))})),Object(o.map)((function(e){return e.printUri})),Object(o.catchError)((function(n){return Object(i.defer)((function(){return y(t,void 0,void 0,(function(){var t;return v(this,(function(r){switch(r.label){case 0:return[4,this.getCertificateFromCache(e)];case 1:if(t=r.sent())return[2,t];throw n}}))}))}))})))},e.prototype.downloadCertificate=function(e){var t=this,n=e.fileName,r=e.blob;return Object(i.defer)((function(){return y(t,void 0,void 0,(function(){var e;return v(this,(function(t){switch(t.label){case 0:return[4,d.a.getFilePath(p.a.EXTERNAL)];case 1:return e=t.sent(),[4,this.fileService.writeFile(e,n,r,{replace:!0}).then((function(){return{path:""+e+n}})).catch((function(e){throw new Error("Error while writing file")}))];case 2:return[2,t.sent()]}}))}))}))},e.prototype.downloadLegacyeCertificate=function(e){var t=this;return Object(i.defer)((function(){return y(t,void 0,void 0,(function(){var t,n,r,i,o;return v(this,(function(a){switch(a.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return t=a.sent(),n=t.managedSession?t.managedSession.uid:t.uid,r=window.device.platform.toLowerCase(),i="ios"===r?p.a.DOCUMENTS:p.a.EXTERNAL_STORAGE,[4,d.a.getFilePath(i)];case 2:return o=a.sent(),o+"Download/"+e.certificate.name+"_"+e.courseId+"_"+n+".pdf",[2,{userId:n}]}}))}))})).pipe(Object(o.mergeMap)((function(n){var r=n.userId;return t.csCertificateService.getLegacyCerificateDownloadURI({pdfUrl:e.certificate.url}).pipe(Object(o.map)((function(e){return{signedPdfUrl:e.signedUrl,userId:r}})))})),Object(o.mergeMap)((function(t){var n=t.signedPdfUrl,r=t.userId,o={uri:n,title:e.certificate.token,description:"",mimeType:"application/pdf",visibleInDownloadsUi:!0,notificationVisibility:1,destinationInExternalPublicDir:{dirType:"Download",subPath:"/"+e.certificate.name+"_"+e.courseId+"_"+r+".pdf"},headers:[]};return new i.Observable((function(e){downloadManager.enqueue(o,(function(t,n){if(t)return e.error(t);e.next(n),e.complete()}))}))})),Object(o.mergeMap)((function(e){return Object(i.interval)(1e3).pipe(Object(o.mergeMap)((function(){return new i.Observable((function(t){downloadManager.query({ids:[e]},(function(e,n){return e||n[0].status===DownloadStatus.STATUS_FAILED?t.error(e||new Error("Unknown Error")):t.next(n[0])}))}))})),Object(o.filter)((function(e){return e.status===DownloadStatus.STATUS_SUCCESSFUL})),Object(o.take)(1))})),Object(o.map)((function(e){return{path:e.localUri}})))},e.prototype.isCertificateCached=function(e){var t=this;return Object(i.defer)((function(){return y(t,void 0,void 0,(function(){var t;return v(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getCertificateFromCache(e)];case 1:return[2,!!n.sent()];case 2:return t=n.sent(),console.error(t),[2,!1];case 3:return[2]}}))}))}))},e.prototype.getEncodedData=function(e){return this.csCertificateService.getEncodedData(e)},e.prototype.verifyCertificate=function(e){return this.csCertificateService.verifyCertificate(e)},Object.defineProperty(e.prototype,"csCertificateService",{get:function(){return this.container.get(a.a.CERTIFICATE_SERVICE)},enumerable:!1,configurable:!0}),e.prototype.buildCertificatePersistenceId=function(e){return y(this,void 0,void 0,(function(){var t,n;return v(this,(function(r){switch(r.label){case 0:return[4,this.profileService.getActiveProfileSession().toPromise()];case 1:return t=r.sent(),n=t.managedSession?t.managedSession.uid:t.uid,[2,"certificate_"+e.certificate.identifier+"_"+e.courseId+"_"+n]}}))}))},e.prototype.getCertificateFromCache=function(e){return y(this,void 0,void 0,(function(){var t,n,r;return v(this,(function(i){switch(i.label){case 0:return r=(n=this.keyValueStore).getValue,[4,this.buildCertificatePersistenceId(e)];case 1:return[4,r.apply(n,[i.sent()]).toPromise()];case 2:return[2,(t=i.sent())?Object(l.ungzip)(t,{to:"string"}):void 0]}}))}))},e=h([Object(r.injectable)(),b(0,Object(r.inject)(a.b.CONTAINER)),b(1,Object(r.inject)(a.b.DB_SERVICE)),b(2,Object(r.inject)(a.b.SDK_CONFIG)),b(3,Object(r.inject)(a.b.PROFILE_SERVICE)),b(4,Object(r.inject)(a.b.KEY_VALUE_STORE)),b(5,Object(r.inject)(a.b.FILE_SERVICE)),E("design:paramtypes",[r.Container,c.DbService,Object,Object,Object,Object])],e)}()},function(e,t,n){var r=n(375),i=n(376);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var c=0;c<16;++c)t[o+c]=a[c];return t||i(a)}},function(e,t,n){var r;e.exports=(r=n(190),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,a=t.algo,c=[];!function(){for(var t=0;t<64;t++)c[t]=4294967296*e.abs(e.sin(t+1))|0}();var s=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],s=e[t+1],d=e[t+2],h=e[t+3],E=e[t+4],b=e[t+5],y=e[t+6],v=e[t+7],_=e[t+8],S=e[t+9],O=e[t+10],g=e[t+11],C=e[t+12],m=e[t+13],A=e[t+14],T=e[t+15],N=o[0],I=o[1],M=o[2],w=o[3];N=u(N,I,M,w,a,7,c[0]),w=u(w,N,I,M,s,12,c[1]),M=u(M,w,N,I,d,17,c[2]),I=u(I,M,w,N,h,22,c[3]),N=u(N,I,M,w,E,7,c[4]),w=u(w,N,I,M,b,12,c[5]),M=u(M,w,N,I,y,17,c[6]),I=u(I,M,w,N,v,22,c[7]),N=u(N,I,M,w,_,7,c[8]),w=u(w,N,I,M,S,12,c[9]),M=u(M,w,N,I,O,17,c[10]),I=u(I,M,w,N,g,22,c[11]),N=u(N,I,M,w,C,7,c[12]),w=u(w,N,I,M,m,12,c[13]),M=u(M,w,N,I,A,17,c[14]),N=f(N,I=u(I,M,w,N,T,22,c[15]),M,w,s,5,c[16]),w=f(w,N,I,M,y,9,c[17]),M=f(M,w,N,I,g,14,c[18]),I=f(I,M,w,N,a,20,c[19]),N=f(N,I,M,w,b,5,c[20]),w=f(w,N,I,M,O,9,c[21]),M=f(M,w,N,I,T,14,c[22]),I=f(I,M,w,N,E,20,c[23]),N=f(N,I,M,w,S,5,c[24]),w=f(w,N,I,M,A,9,c[25]),M=f(M,w,N,I,h,14,c[26]),I=f(I,M,w,N,_,20,c[27]),N=f(N,I,M,w,m,5,c[28]),w=f(w,N,I,M,d,9,c[29]),M=f(M,w,N,I,v,14,c[30]),N=l(N,I=f(I,M,w,N,C,20,c[31]),M,w,b,4,c[32]),w=l(w,N,I,M,_,11,c[33]),M=l(M,w,N,I,g,16,c[34]),I=l(I,M,w,N,A,23,c[35]),N=l(N,I,M,w,s,4,c[36]),w=l(w,N,I,M,E,11,c[37]),M=l(M,w,N,I,v,16,c[38]),I=l(I,M,w,N,O,23,c[39]),N=l(N,I,M,w,m,4,c[40]),w=l(w,N,I,M,a,11,c[41]),M=l(M,w,N,I,h,16,c[42]),I=l(I,M,w,N,y,23,c[43]),N=l(N,I,M,w,S,4,c[44]),w=l(w,N,I,M,C,11,c[45]),M=l(M,w,N,I,T,16,c[46]),N=p(N,I=l(I,M,w,N,d,23,c[47]),M,w,a,6,c[48]),w=p(w,N,I,M,v,10,c[49]),M=p(M,w,N,I,A,15,c[50]),I=p(I,M,w,N,b,21,c[51]),N=p(N,I,M,w,C,6,c[52]),w=p(w,N,I,M,h,10,c[53]),M=p(M,w,N,I,O,15,c[54]),I=p(I,M,w,N,s,21,c[55]),N=p(N,I,M,w,_,6,c[56]),w=p(w,N,I,M,T,10,c[57]),M=p(M,w,N,I,y,15,c[58]),I=p(I,M,w,N,m,21,c[59]),N=p(N,I,M,w,E,6,c[60]),w=p(w,N,I,M,g,10,c[61]),M=p(M,w,N,I,d,15,c[62]),I=p(I,M,w,N,S,21,c[63]),o[0]=o[0]+N|0,o[1]=o[1]+I|0,o[2]=o[2]+M|0,o[3]=o[3]+w|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296),a=r;n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var c=this._hash,s=c.words,u=0;u<4;u++){var f=s[u];s[u]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return c},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,r,i,o,a){var c=e+(t&n|~t&r)+i+a;return(c<<o|c>>>32-o)+t}function f(e,t,n,r,i,o,a){var c=e+(t&r|n&~r)+i+a;return(c<<o|c>>>32-o)+t}function l(e,t,n,r,i,o,a){var c=e+(t^n^r)+i+a;return(c<<o|c>>>32-o)+t}function p(e,t,n,r,i,o,a){var c=e+(n^(t|~r))+i+a;return(c<<o|c>>>32-o)+t}t.MD5=o._createHelper(s),t.HmacMD5=o._createHmacHelper(s)}(Math),r.MD5)},function(e,t){e.exports=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(379),i=function(){function e(){this.list=new r.default}return e.prototype.enqueue=function(e){return this.list.add(e)},e.prototype.add=function(e){return this.list.add(e)},e.prototype.dequeue=function(){if(0!==this.list.size()){var e=this.list.first();return this.list.removeElementAtIndex(0),e}},e.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},e.prototype.size=function(){return this.list.size()},e.prototype.contains=function(e,t){return this.list.contains(e,t)},e.prototype.isEmpty=function(){return this.list.size()<=0},e.prototype.clear=function(){this.list.clear()},e.prototype.forEach=function(e){this.list.forEach(e)},e}();t.default=i},function(e,t){e.exports=h},function(e,t,n){var r=n(380);function i(){}function o(e,t,n){null==n&&(n=a),cordova.exec((function(){var e=Array.prototype.slice.call(arguments);e.unshift(null),n.apply(null,e)}),(function(e){e=e instanceof Error?e:new Error(e),n(e)}),"DownloadManagerPlugin",e,t||[])}function a(){}e.exports=new i,i.prototype.enqueue=function(e,t){"string"==typeof e&&(e={uri:e}),e.url&&(e.uri=e.url),r("string"==typeof e.uri,"req.uri must be string"),r(null==t||"function"==typeof t,"cb must be function"),r(null==e.title||"string"==typeof e.title,"req.title must be string"),r(null==e.description||"string"==typeof e.description,"req.description must be string"),r(null==e.mimeType||"string"==typeof e.mimeType,"req.mimeType must be string"),r(null==e.destinationInExternalFilesDir||"string"==typeof e.destinationInExternalFilesDir.dirType,"req.destinationInExternalFilesDir.dirType must be string"),r(null==e.destinationInExternalFilesDir||"string"==typeof e.destinationInExternalFilesDir.subPath,"req.destinationInExternalFilesDir.subPath must be string"),r(null==e.destinationInExternalPublicDir||"string"==typeof e.destinationInExternalPublicDir.dirType,"req.destinationInExternalPublicDir.dirType must be string"),r(null==e.destinationInExternalPublicDir||"string"==typeof e.destinationInExternalPublicDir.subPath,"req.destinationInExternalPublicDir.subPath must be string"),r(null==e.destinationUri||"string"==typeof e.destinationUri,"req.destinationUri must be string"),r(null==e.visibleInDownloadsUi||"boolean"==typeof e.visibleInDownloadsUi,"req.visibleInDownloadsUi must be boolean"),r(null==e.notificationVisibility||Number.isSafeInteger(e.notificationVisibility),"req.notificationVisibility must be safe integer"),o("enqueue",[e],t)},i.prototype.query=function(e,t){"function"==typeof e&&(t=e,e=null),null==e&&(e={}),r("function"==typeof t,"cb must be function"),o("query",[e],t)},i.prototype.remove=function(e,t){r(Array.isArray(e),"ids must be array"),r(null==t||"function"==typeof t,"cb must be function"),o("remove",e,t)},i.prototype.addCompletedDownload=function(e,t){o("addCompletedDownload",[e],t)},i.prototype.fetchSpeedLog=function(e){o("fetchSpeedLog",[],e)}},function(e,t,n){"use strict";n.r(t);n(318);var r=n(1);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(89);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var a=n(7);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);var c=n(10);for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);var s=n(50);for(var i in s)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);var u=n(36);for(var i in u)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(i);var f=n(82);for(var i in f)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return f[e]}))}(i);var l=n(276);for(var i in l)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return l[e]}))}(i);var p=n(9);for(var i in p)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return p[e]}))}(i);var d=n(15);for(var i in d)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return d[e]}))}(i);var h=n(281);for(var i in h)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return h[e]}))}(i);var E=n(70);for(var i in E)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return E[e]}))}(i);var b=n(61);for(var i in b)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return b[e]}))}(i);var y=n(26);n.d(t,"SunbirdSdk",(function(){return y.a}));var v=n(287);for(var i in v)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return v[e]}))}(i);var _=n(18);for(var i in _)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return _[e]}))}(i);var S=n(93);for(var i in S)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return S[e]}))}(i);var O=n(24);for(var i in O)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return O[e]}))}(i);var g=n(21);for(var i in g)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return g[e]}))}(i);var C=n(20);for(var i in C)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return C[e]}))}(i);var m=n(62);for(var i in m)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return m[e]}))}(i);var A=n(288);for(var i in A)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return A[e]}))}(i);var T=n(95);for(var i in T)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return T[e]}))}(i);var N=n(96);for(var i in N)["default","SunbirdSdk"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return N[e]}))}(i);var I=n(32);n.d(t,"ArchiveObjectType",(function(){return I.a})),n.d(t,"ExportAssertionError",(function(){return I.b})),n.d(t,"InvalidRequestError",(function(){return I.c})),n.d(t,"ObjectNotFoundError",(function(){return I.d}));var M=n(290);for(var i in M)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return M[e]}))}(i);var w=n(98);for(var i in w)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return w[e]}))}(i);var D=n(103);for(var i in D)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return D[e]}))}(i);var P=n(105);for(var i in P)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return P[e]}))}(i);var R=n(292);for(var i in R)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return R[e]}))}(i);var L=n(42);for(var i in L)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return L[e]}))}(i);var j=n(295);for(var i in j)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return j[e]}))}(i);var U=n(94);for(var i in U)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return U[e]}))}(i);var k=n(297);for(var i in k)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return k[e]}))}(i);var x=n(299);for(var i in x)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return x[e]}))}(i);var F=n(45);for(var i in F)["default","SunbirdSdk","ArchiveObjectType","ExportAssertionError","InvalidRequestError","ObjectNotFoundError"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return F[e]}))}(i);var B=n(106);n.d(t,"ValidationError",(function(){return B.a}))},function(e,t,n){"use strict";(function(e){var t="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==e&&e||{},n="URLSearchParams"in t,r="Symbol"in t&&"iterator"in Symbol,i="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in t,a="ArrayBuffer"in t;if(a)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&c.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function h(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function E(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function b(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&i&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=b(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=b(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=d(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(i)return this.blob().then(E);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,n,r,i,o=d(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),r=/charset=([A-Za-z0-9_-]+)/.exec(e.type),i=r?r[1]:"utf-8",t.readAsText(e,i),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=u(e),t=f(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},p.prototype.delete=function(e){delete this.map[u(e)]},p.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},p.prototype.set=function(e,t){this.map[u(e)]=f(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),l(e)},p.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),l(e)},p.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),l(e)},r&&(p.prototype[Symbol.iterator]=p.prototype.entries);var v=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function _(e,n){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,i,o=(n=n||{}).body;if(e instanceof _){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,n.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=n.credentials||this.credentials||"same-origin",!n.headers&&this.headers||(this.headers=new p(n.headers)),this.method=(r=n.method||this.method||"GET",i=r.toUpperCase(),v.indexOf(i)>-1?i:r),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal||function(){if("AbortController"in t)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==n.cache&&"no-cache"!==n.cache)){var a=/([?&])_=[^&]*/;if(a.test(this.url))this.url=this.url.replace(a,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function O(e,t){if(!(this instanceof O))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})},y.call(_.prototype),y.call(O.prototype),O.prototype.clone=function(){return new O(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},O.error=function(){var e=new O(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var g=[301,302,303,307,308];O.redirect=function(e,t){if(-1===g.indexOf(t))throw new RangeError("Invalid status code");return new O(null,{status:t,headers:{location:e}})};var C=t.DOMException;try{new C}catch(e){(C=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),C.prototype.constructor=C}function m(e,n){return new Promise((function(r,o){var c=new _(e,n);if(c.signal&&c.signal.aborted)return o(new C("Aborted","AbortError"));var s=new XMLHttpRequest;function l(){s.abort()}if(s.onload=function(){var e,t,n={statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();try{t.append(r,i)}catch(e){console.warn("Response "+e.message)}}})),t)};0===c.url.indexOf("file://")&&(s.status<200||s.status>599)?n.status=200:n.status=s.status,n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;setTimeout((function(){r(new O(i,n))}),0)},s.onerror=function(){setTimeout((function(){o(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){o(new TypeError("Network request timed out"))}),0)},s.onabort=function(){setTimeout((function(){o(new C("Aborted","AbortError"))}),0)},s.open(c.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(t){return e}}(c.url),!0),"include"===c.credentials?s.withCredentials=!0:"omit"===c.credentials&&(s.withCredentials=!1),"responseType"in s&&(i?s.responseType="blob":a&&(s.responseType="arraybuffer")),n&&"object"==typeof n.headers&&!(n.headers instanceof p||t.Headers&&n.headers instanceof t.Headers)){var d=[];Object.getOwnPropertyNames(n.headers).forEach((function(e){d.push(u(e)),s.setRequestHeader(e,f(n.headers[e]))})),c.headers.forEach((function(e,t){-1===d.indexOf(t)&&s.setRequestHeader(t,e)}))}else c.headers.forEach((function(e,t){s.setRequestHeader(t,e)}));c.signal&&(c.signal.addEventListener("abort",l),s.onreadystatechange=function(){4===s.readyState&&c.signal.removeEventListener("abort",l)}),s.send(void 0===c._bodyInit?null:c._bodyInit)}))}m.polyfill=!0,t.fetch||(t.fetch=m,t.Headers=p,t.Request=_,t.Response=O)}).call(this,n(84))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},o=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=n(320),c=n(43),s=n(56),u=n(38),f=n(125),l=n(321),p=n(328),d=n(330),h=n(67),E=n(80),b=n(333),y=n(334),v=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+c.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=s.BindingScopeEnum.Transient;else if(t.defaultScope!==s.BindingScopeEnum.Singleton&&t.defaultScope!==s.BindingScopeEnum.Transient&&t.defaultScope!==s.BindingScopeEnum.Request)throw new Error(""+c.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+c.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+c.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=h.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new f.MetadataReader}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=new e,c=o([t,n],r).map((function(e){return l.getBindingDictionary(e)})),s=l.getBindingDictionary(a);function u(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return c.forEach((function(e){u(e,s)})),a},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,o,a;return i(this,(function(i){switch(i.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,i.label=1;case 1:return n<r.length?(o=r[n],a=t(o.id),[4,o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||s.BindingScopeEnum.Transient,n=new a.Binding(e,t);return this._bindingDictionary.add(e,n),new d.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(c.CANNOT_UNBIND+" "+E.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,u.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=l.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(b.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(c.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,s.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,s.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,u.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,s.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,s.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,u.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,o){var a=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(null==(a=this._middleware(s)))throw new Error(c.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=l.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),p.resolve(n)}},e}();t.Container=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(56),i=n(67),o=function(){function e(e,t){this.id=i.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===r.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0;var r=n(322),i=n(43),o=n(56),a=n(38),c=n(126),s=n(80),u=n(323),f=n(49),l=n(324),p=n(325),d=n(327),h=n(128);function E(e){return e._bindingDictionary}function b(e,t,n,o,a){var c=y(n.container,a.serviceIdentifier),u=[];return c.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof a.serviceIdentifier&&e.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(a.serviceIdentifier).toSelf(),c=y(n.container,a.serviceIdentifier)),u=t?c:c.filter((function(e){var t=new d.Request(e.serviceIdentifier,n,o,e,a);return e.constraint(t)})),function(e,t,n,o){switch(t.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var a=s.getServiceIdentifierAsString(e),c=i.NOT_REGISTERED;throw c+=s.listMetadataForTarget(a,n),c+=s.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(c);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;a=s.getServiceIdentifierAsString(e),c=i.AMBIGUOUS_MATCH+" "+a;throw c+=s.listRegisteredBindingsForServiceIdentifier(o,a,y),new Error(c)}}(a.serviceIdentifier,u,a,n.container),u}function y(e,t){var n=[],r=E(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=y(e.parent,t)),n}t.getBindingDictionary=E,t.plan=function(e,t,n,r,E,y,v,_){void 0===_&&(_=!1);var S=new u.Context(t),O=function(e,t,n,r,i,o){var c=e?a.MULTI_INJECT_TAG:a.INJECT_TAG,s=new f.Metadata(c,n),u=new h.Target(t,r,n,s);if(void 0!==i){var l=new f.Metadata(i,o);u.metadata.push(l)}return u}(n,r,E,"",y,v);try{return function e(t,n,r,a,c,s){var u,f;if(null===c){u=b(t,n,a,null,s),f=new d.Request(r,a,null,u,s);var h=new l.Plan(a,f);a.addPlan(h)}else u=b(t,n,a,c,s),f=c.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=f.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=f}if(n.type===o.BindingTypeEnum.Instance&&null!==n.implementationType){var c=p.getDependencies(t,n.implementationType);if(!a.container.options.skipBaseClassChecks){var u=p.getBaseClassDependencyCount(t,n.implementationType);if(c.length<u){var l=i.ARGUMENTS_LENGTH_MISMATCH(p.getFunctionName(n.implementationType));throw new Error(l)}}c.forEach((function(n){e(t,!1,n.serviceIdentifier,a,r,n)}))}}))}(e,_,E,S,null,O),S}catch(e){throw c.isStackOverflowExeption(e)&&S.plan&&s.circularDependencyToException(S.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new h.Target(o.TargetTypeEnum.Variable,"",t,new f.Metadata(n,r)),a=new u.Context(e);return new d.Request(t,a,null,[],i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(67),i=function(){function e(e){this.id=r.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var r=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=r},function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0;var i=n(127),o=n(43),a=n(56),c=n(38),s=n(80);Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return s.getFunctionName}});var u=n(128);function f(e,t,n,i){var c=e.getConstructorMetadata(n),s=c.compilerGeneratedMetadata;if(void 0===s){var f=o.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(f)}var d=c.userGeneratedMetadata,h=Object.keys(d),E=0===n.length&&h.length>0,b=h.length>n.length,y=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var c=l(a,e,t,n,r);null!==c&&o.push(c)}return o}(i,t,s,d,E||b?h.length:n.length),v=function e(t,n){for(var i=t.getPropertiesMetadata(n),o=[],c=Object.keys(i),s=0,f=c;s<f.length;s++){var l=f[s],d=i[l],h=p(i[l]),E=h.targetName||l,b=h.inject||h.multiInject,y=new u.Target(a.TargetTypeEnum.ClassProperty,E,b);y.metadata=d,o.push(y)}var v=Object.getPrototypeOf(n.prototype).constructor;if(v!==Object){var _=e(t,v);o=r(r([],o),_)}return o}(e,n);return r(r([],y),v)}function l(e,t,n,r,c){var s=c[e.toString()]||[],f=p(s),l=!0!==f.unmanaged,d=r[e],h=f.inject||f.multiInject;if((d=h||d)instanceof i.LazyServiceIdentifer&&(d=d.unwrap()),l){if(!t&&(d===Object||d===Function||void 0===d)){var E=o.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(E)}var b=new u.Target(a.TargetTypeEnum.ConstructorArgument,f.targetName,d);return b.metadata=s,b}return null}function p(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[c.INJECT_TAG],multiInject:t[c.MULTI_INJECT_TAG],targetName:t[c.NAME_TAG],unmanaged:t[c.UNMANAGED_TAG]}}t.getDependencies=function(e,t){return f(e,s.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var r=Object.getPrototypeOf(n.prototype).constructor;if(r!==Object){var i=f(t,s.getFunctionName(r),r,!0),o=i.map((function(e){return e.metadata.filter((function(e){return e.key===c.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,u=i.length-a;return u>0?u:e(t,r)}return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var r=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var r=n(67),i=function(){function e(e,t,n,i,o){this.id=r.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var r=n(43),i=n(56),o=n(126),a=n(80),c=n(329),s=function(e,t,n){try{return n()}catch(n){throw o.isStackOverflowExeption(n)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},u=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,o=t.childRequests,f=t.target&&t.target.isArray(),l=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(f&&l)return o.map((function(t){return u(e)(t)}));var p=null;if(!t.target.isOptional()||0!==n.length){var d=n[0],h=d.scope===i.BindingScopeEnum.Singleton,E=d.scope===i.BindingScopeEnum.Request;if(h&&d.activated)return d.cache;if(E&&null!==e&&e.has(d.id))return e.get(d.id);if(d.type===i.BindingTypeEnum.ConstantValue)p=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Function)p=d.cache,d.activated=!0;else if(d.type===i.BindingTypeEnum.Constructor)p=d.implementationType;else if(d.type===i.BindingTypeEnum.DynamicValue&&null!==d.dynamicValue)p=s("toDynamicValue",d.serviceIdentifier,(function(){return d.dynamicValue(t.parentContext)}));else if(d.type===i.BindingTypeEnum.Factory&&null!==d.factory)p=s("toFactory",d.serviceIdentifier,(function(){return d.factory(t.parentContext)}));else if(d.type===i.BindingTypeEnum.Provider&&null!==d.provider)p=s("toProvider",d.serviceIdentifier,(function(){return d.provider(t.parentContext)}));else{if(d.type!==i.BindingTypeEnum.Instance||null===d.implementationType){var b=a.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+b)}p=c.resolveInstance(d.implementationType,o,u(e))}return"function"==typeof d.onActivation&&(p=d.onActivation(t.parentContext,p)),h&&(d.cache=p,d.activated=!0),E&&null!==e&&!e.has(d.id)&&e.set(d.id,p),p}}};t.resolve=function(e){return u(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}},function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0;var i=n(43),o=n(56),a=n(38);t.resolveInstance=function(e,t,n){var c,s,u=null;if(t.length>0){var f=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ConstructorArgument})).map(n);s=f,u=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var o=i[n];e[r]=o})),e}(u=new((c=e).bind.apply(c,r([void 0],s))),t,n)}else u=new e;return function(e,t){if(Reflect.hasMetadata(a.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(i.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,u),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var r=n(43),i=n(56),o=n(331),a=n(129),c=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=e,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(r.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var r=n(332),i=n(109),o=n(110),a=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var r=n(56),i=n(129),o=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var r=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var r=n(43),i=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(r.NULL_ARGUMENT);if(null==t)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(r.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(r.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(r.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var r=n(67),i=function(e){this.id=r.id(),this.registry=e};t.ContainerModule=i;var o=function(e){this.id=r.id(),this.registry=e};t.AsyncContainerModule=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0;var r=n(43),i=n(38);t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,e))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(i.PARAM_TYPES,t,e),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0;var r=n(49),i=n(58);t.tagged=function(e,t){return function(n,o,a){var c=new r.Metadata(e,t);"number"==typeof a?i.tagParameter(n,o,a,c):i.tagProperty(n,o,c)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0;var r=n(38),i=n(49),o=n(58);t.named=function(e){return function(t,n,a){var c=new i.Metadata(r.NAMED_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,c):o.tagProperty(t,n,c)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0;var r=n(38),i=n(49),o=n(58);t.optional=function(){return function(e,t,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"==typeof n?o.tagParameter(e,t,n,a):o.tagProperty(e,t,a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0;var r=n(38),i=n(49),o=n(58);t.unmanaged=function(){return function(e,t,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(e,t,n,a)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0;var r=n(38),i=n(49),o=n(58);t.multiInject=function(e){return function(t,n,a){var c=new i.Metadata(r.MULTI_INJECT_TAG,e);"number"==typeof a?o.tagParameter(t,n,a,c):o.tagProperty(t,n,c)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0;var r=n(38),i=n(49),o=n(58);t.targetName=function(e){return function(t,n,a){var c=new i.Metadata(r.NAME_TAG,e);o.tagParameter(t,n,a,c)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0;var r=n(43),i=n(38),o=n(49);t.postConstruct=function(){return function(e,t,n){var a=new o.Metadata(i.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,e.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,e.constructor)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}},function(e,t,n){"use strict";var r=n(346),i=n(160),o=n(113),a=Object.prototype.hasOwnProperty,c={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Array.isArray,u=Array.prototype.push,f=function(e,t){u.apply(e,s(t)?t:[t])},l=Date.prototype.toISOString,p=o.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:i.encode,encodeValuesOnly:!1,format:p,formatter:o.formatters[p],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},h={},E=function e(t,n,o,a,c,u,l,p,E,b,y,v,_,S,O,g,C,m){for(var A,T=t,N=m,I=0,M=!1;void 0!==(N=N.get(h))&&!M;){var w=N.get(t);if(I+=1,void 0!==w){if(w===I)throw new RangeError("Cyclic object value");M=!0}void 0===N.get(h)&&(I=0)}if("function"==typeof b?T=b(n,T):T instanceof Date?T=_(T):"comma"===o&&s(T)&&(T=i.maybeMap(T,(function(e){return e instanceof Date?_(e):e}))),null===T){if(u)return E&&!g?E(n,d.encoder,C,"key",S):n;T=""}if("string"==typeof(A=T)||"number"==typeof A||"boolean"==typeof A||"symbol"==typeof A||"bigint"==typeof A||i.isBuffer(T))return E?[O(g?n:E(n,d.encoder,C,"key",S))+"="+O(E(T,d.encoder,C,"value",S))]:[O(n)+"="+O(String(T))];var D,P=[];if(void 0===T)return P;if("comma"===o&&s(T))g&&E&&(T=i.maybeMap(T,E)),D=[{value:T.length>0?T.join(",")||null:void 0}];else if(s(b))D=b;else{var R=Object.keys(T);D=y?R.sort(y):R}var L=p?n.replace(/\./g,"%2E"):n,j=a&&s(T)&&1===T.length?L+"[]":L;if(c&&s(T)&&0===T.length)return j+"[]";for(var U=0;U<D.length;++U){var k=D[U],x="object"==typeof k&&void 0!==k.value?k.value:T[k];if(!l||null!==x){var F=v&&p?k.replace(/\./g,"%2E"):k,B=s(T)?"function"==typeof o?o(j,F):j:j+(v?"."+F:"["+F+"]");m.set(t,I);var V=r();V.set(h,m),f(P,e(x,B,o,a,c,u,l,p,"comma"===o&&g&&s(T)?null:E,b,y,v,_,S,O,g,C,V))}}return P};e.exports=function(e,t){var n,i=e,u=function(e){if(!e)return d;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if(void 0!==e.format){if(!a.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r,i=o.formatters[n],u=d.filter;if(("function"==typeof e.filter||s(e.filter))&&(u=e.filter),r=e.arrayFormat in c?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var f=void 0===e.allowDots?!0===e.encodeDotInKeys||d.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:f,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?d.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:d.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:u,format:n,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}}(t);"function"==typeof u.filter?i=(0,u.filter)("",i):s(u.filter)&&(n=u.filter);var l=[];if("object"!=typeof i||null===i)return"";var p=c[u.arrayFormat],h="comma"===p&&u.commaRoundTrip;n||(n=Object.keys(i)),u.sort&&n.sort(u.sort);for(var b=r(),y=0;y<n.length;++y){var v=n[y];u.skipNulls&&null===i[v]||f(l,E(i[v],v,p,h,u.allowEmptyArrays,u.strictNullHandling,u.skipNulls,u.encodeDotInKeys,u.encode?u.encoder:null,u.filter,u.sort,u.allowDots,u.serializeDate,u.format,u.formatter,u.encodeValuesOnly,u.charset,b))}var _=l.join(u.delimiter),S=!0===u.addQueryPrefix?"?":"";return u.charsetSentinel&&("iso-8859-1"===u.charset?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),_.length>0?S+_:""}},function(e,t,n){"use strict";var r=n(72),i=n(85),o=n(348),a=n(152),c=n(373)||a||o;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+i(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,n){e||(e=c()),e.set(t,n)}};return t}},function(e,t){},function(e,t,n){"use strict";var r=n(85),i=n(72),o=function(e,t,n){for(var r,i=e;null!=(r=i.next);i=r)if(r.key===t)return i.next=r.next,n||(r.next=e.next,e.next=r),r};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new i("Side channel does not contain "+r(e))},delete:function(t){var n=e&&e.next,r=function(e,t){if(e)return o(e,t,!0)}(e,t);return r&&n&&n===r&&(e=void 0),!!r},get:function(t){return function(e,t){if(e){var n=o(e,t);return n&&n.value}}(e,t)},has:function(t){return function(e,t){return!!e&&!!o(e,t)}(e,t)},set:function(t,n){e||(e={next:void 0}),function(e,t,n){var r=o(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(e,t,n)}};return t}},function(e,t,n){"use strict";e.exports=Error},function(e,t,n){"use strict";e.exports=EvalError},function(e,t,n){"use strict";e.exports=RangeError},function(e,t,n){"use strict";e.exports=ReferenceError},function(e,t,n){"use strict";e.exports=SyntaxError},function(e,t,n){"use strict";e.exports=URIError},function(e,t,n){"use strict";e.exports=Math.abs},function(e,t,n){"use strict";e.exports=Math.floor},function(e,t,n){"use strict";e.exports=Math.max},function(e,t,n){"use strict";e.exports=Math.min},function(e,t,n){"use strict";e.exports=Math.pow},function(e,t,n){"use strict";e.exports=Math.round},function(e,t,n){"use strict";var r=n(362);e.exports=function(e){return r(e)||0===e?e:e<0?-1:1}},function(e,t,n){"use strict";e.exports=Number.isNaN||function(e){return e!=e}},function(e,t,n){"use strict";e.exports=Object.getOwnPropertyDescriptor},function(e,t,n){"use strict";var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch(e){r=!1}e.exports=r},function(e,t,n){"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(366);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},function(e,t,n){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},function(e,t,n){"use strict";var r=n(155),i=n(156),o=n(368);e.exports=r?function(e){return r(e)}:i?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return i(e)}:o?function(e){return o(e)}:null},function(e,t,n){"use strict";var r,i=n(157),o=n(154);try{r=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var a=!!r&&o&&o(Object.prototype,"__proto__"),c=Object,s=c.getPrototypeOf;e.exports=a&&"function"==typeof a.get?i([a.get]):"function"==typeof s&&function(e){return s(null==e?e:c(e))}},function(e,t,n){"use strict";var r="Function.prototype.bind called on incompatible ",i=Object.prototype.toString,o=Math.max,a=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var i=0;i<t.length;i+=1)n[i+e.length]=t[i];return n},c=function(e,t){for(var n=[],r=t||0,i=0;r<e.length;r+=1,i+=1)n[i]=e[r];return n},s=function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n};e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==i.apply(t))throw new TypeError(r+t);for(var n,u=c(arguments,1),f=function(){if(this instanceof n){var r=t.apply(this,a(u,arguments));return Object(r)===r?r:this}return t.apply(e,a(u,arguments))},l=o(0,t.length-u.length),p=[],d=0;d<l;d++)p[d]="$"+d;if(n=Function("binder","return function ("+s(p,",")+"){ return binder.apply(this,arguments); }")(f),t.prototype){var h=function(){};h.prototype=t.prototype,n.prototype=new h,h.prototype=null}return n}},function(e,t,n){"use strict";var r=n(86),i=n(158),o=n(112),a=n(371);e.exports=a||r.call(o,i)},function(e,t,n){"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},function(e,t,n){"use strict";var r=Function.prototype.call,i=Object.prototype.hasOwnProperty,o=n(86);e.exports=o.call(r,i)},function(e,t,n){"use strict";var r=n(111),i=n(159),o=n(85),a=n(152),c=n(72),s=r("%WeakMap%",!0),u=i("WeakMap.prototype.get",!0),f=i("WeakMap.prototype.set",!0),l=i("WeakMap.prototype.has",!0),p=i("WeakMap.prototype.delete",!0);e.exports=s?function(){var e,t,n={assert:function(e){if(!n.has(e))throw new c("Side channel does not contain "+o(e))},delete:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return p(e,n)}else if(a&&t)return t.delete(n);return!1},get:function(n){return s&&n&&("object"==typeof n||"function"==typeof n)&&e?u(e,n):t&&t.get(n)},has:function(n){return s&&n&&("object"==typeof n||"function"==typeof n)&&e?l(e,n):!!t&&t.has(n)},set:function(n,r){s&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new s),f(e,n,r)):a&&(t||(t=a()),t.set(n,r))}};return n}:a},function(e,t,n){"use strict";var r=n(160),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},c=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},s=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},u=function(e,t,n,r){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,c=n.depth>0&&/(\[[^[\]]*])/.exec(o),u=c?o.slice(0,c.index):o,f=[];if(u){if(!n.plainObjects&&i.call(Object.prototype,u)&&!n.allowPrototypes)return;f.push(u)}for(var l=0;n.depth>0&&null!==(c=a.exec(o))&&l<n.depth;){if(l+=1,!n.plainObjects&&i.call(Object.prototype,c[1].slice(1,-1))&&!n.allowPrototypes)return;f.push(c[1])}return c&&f.push("["+o.slice(c.index)+"]"),function(e,t,n,r){for(var i=r?t:s(t,n),o=e.length-1;o>=0;--o){var a,c=e[o];if("[]"===c&&n.parseArrays)a=n.allowEmptyArrays&&""===i?[]:[].concat(i);else{a=n.plainObjects?Object.create(null):{};var u="["===c.charAt(0)&&"]"===c.charAt(c.length-1)?c.slice(1,-1):c,f=n.decodeDotInKeys?u.replace(/%2E/g,"."):u,l=parseInt(f,10);n.parseArrays||""!==f?!isNaN(l)&&c!==f&&String(l)===f&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(a=[])[l]=i:"__proto__"!==f&&(a[f]=i):a={0:i}}i=a}return i}(f,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return a;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset,n=void 0===e.duplicates?a.duplicates:e.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||a.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:a.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:a.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,duplicates:n,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var f="string"==typeof e?function(e,t){var n,u={__proto__:null},f=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,l=t.parameterLimit===1/0?void 0:t.parameterLimit,p=f.split(t.delimiter,l),d=-1,h=t.charset;if(t.charsetSentinel)for(n=0;n<p.length;++n)0===p[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[n]?h="utf-8":"utf8=%26%2310003%3B"===p[n]&&(h="iso-8859-1"),d=n,n=p.length);for(n=0;n<p.length;++n)if(n!==d){var E,b,y=p[n],v=y.indexOf("]="),_=-1===v?y.indexOf("="):v+1;-1===_?(E=t.decoder(y,a.decoder,h,"key"),b=t.strictNullHandling?null:""):(E=t.decoder(y.slice(0,_),a.decoder,h,"key"),b=r.maybeMap(s(y.slice(_+1),t),(function(e){return t.decoder(e,a.decoder,h,"value")}))),b&&t.interpretNumericEntities&&"iso-8859-1"===h&&(b=c(b)),y.indexOf("[]=")>-1&&(b=o(b)?[b]:b);var S=i.call(u,E);S&&"combine"===t.duplicates?u[E]=r.combine(u[E],b):S&&"last"!==t.duplicates||(u[E]=b)}return u}(e,n):e,l=n.plainObjects?Object.create(null):{},p=Object.keys(f),d=0;d<p.length;++d){var h=p[d],E=u(h,f[h],n,"string"==typeof e);l=r.merge(l,E,n)}return!0===n.allowSparse?l:r.compact(l)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(53),i=function(){function e(e){this.table={},this.nElements=0,this.toStr=e||r.defaultToString}return e.prototype.getValue=function(e){var t=this.table["$"+this.toStr(e)];if(!r.isUndefined(t))return t.value},e.prototype.setValue=function(e,t){if(!r.isUndefined(e)&&!r.isUndefined(t)){var n,i="$"+this.toStr(e),o=this.table[i];return r.isUndefined(o)?(this.nElements++,n=void 0):n=o.value,this.table[i]={key:e,value:t},n}},e.prototype.remove=function(e){var t="$"+this.toStr(e),n=this.table[t];if(!r.isUndefined(n))return delete this.table[t],this.nElements--,n.value},e.prototype.keys=function(){var e=[];for(var t in this.table)if(r.has(this.table,t)){var n=this.table[t];e.push(n.key)}return e},e.prototype.values=function(){var e=[];for(var t in this.table)if(r.has(this.table,t)){var n=this.table[t];e.push(n.value)}return e},e.prototype.forEach=function(e){for(var t in this.table)if(r.has(this.table,t)){var n=this.table[t];if(!1===e(n.key,n.value))return}},e.prototype.containsKey=function(e){return!r.isUndefined(this.getValue(e))},e.prototype.clear=function(){this.table={},this.nElements=0},e.prototype.size=function(){return this.nElements},e.prototype.isEmpty=function(){return this.nElements<=0},e.prototype.toString=function(){var e="{";return this.forEach((function(t,n){e+="\n\t"+t+" : "+n})),e+"\n}"},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(53),i=n(228),o=function(){function e(){this.firstNode=null,this.lastNode=null,this.nElements=0}return e.prototype.add=function(e,t){if(r.isUndefined(t)&&(t=this.nElements),t<0||t>this.nElements||r.isUndefined(e))return!1;var n=this.createNode(e);if(0===this.nElements||null===this.lastNode)this.firstNode=n,this.lastNode=n;else if(t===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===t)n.next=this.firstNode,this.firstNode=n;else{var i=this.nodeAtIndex(t-1);if(null===i)return!1;n.next=i.next,i.next=n}return this.nElements++,!0},e.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},e.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},e.prototype.elementAtIndex=function(e){var t=this.nodeAtIndex(e);if(null!==t)return t.element},e.prototype.indexOf=function(e,t){var n=t||r.defaultEquals;if(r.isUndefined(e))return-1;for(var i=this.firstNode,o=0;null!==i;){if(n(i.element,e))return o;o++,i=i.next}return-1},e.prototype.contains=function(e,t){return this.indexOf(e,t)>=0},e.prototype.remove=function(e,t){var n=t||r.defaultEquals;if(this.nElements<1||r.isUndefined(e))return!1;for(var i=null,o=this.firstNode;null!==o;){if(n(o.element,e))return null===i?(this.firstNode=o.next,o===this.lastNode&&(this.lastNode=null)):o===this.lastNode?(this.lastNode=i,i.next=o.next,o.next=null):(i.next=o.next,o.next=null),this.nElements--,!0;i=o,o=o.next}return!1},e.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},e.prototype.equals=function(t,n){var i=n||r.defaultEquals;return t instanceof e&&(this.size()===t.size()&&this.equalsAux(this.firstNode,t.firstNode,i))},e.prototype.equalsAux=function(e,t,n){for(;null!==e&&null!==t;){if(!n(e.element,t.element))return!1;e=e.next,t=t.next}return!0},e.prototype.removeElementAtIndex=function(e){if(!(e<0||e>=this.nElements||null===this.firstNode||null===this.lastNode)){var t;if(1===this.nElements)t=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(e-1);null===n?(t=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(t=this.lastNode.element,this.lastNode=n),null!==n&&null!==n.next&&(t=n.next.element,n.next=n.next.next)}return this.nElements--,t}},e.prototype.forEach=function(e){for(var t=this.firstNode;null!==t&&!1!==e(t.element);)t=t.next},e.prototype.reverse=function(){for(var e=null,t=this.firstNode,n=null;null!==t;)n=t.next,t.next=e,e=t,t=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},e.prototype.toArray=function(){for(var e=[],t=this.firstNode;null!==t;)e.push(t.element),t=t.next;return e},e.prototype.size=function(){return this.nElements},e.prototype.isEmpty=function(){return this.nElements<=0},e.prototype.toString=function(){return i.toString(this.toArray())},e.prototype.nodeAtIndex=function(e){if(e<0||e>=this.nElements)return null;if(e===this.nElements-1)return this.lastNode;for(var t=this.firstNode,n=0;n<e&&null!==t;n++)t=t.next;return t},e.prototype.createNode=function(e){return{element:e,next:null}},e}();t.default=o},function(e,t){function n(e,t){if(!e)throw new Error(t||"AssertionError")}n.notEqual=function(e,t,r){n(e!=t,r)},n.notOk=function(e,t){n(!e,t)},n.equal=function(e,t,r){n(e==t,r)},n.ok=n,e.exports=n}])}));